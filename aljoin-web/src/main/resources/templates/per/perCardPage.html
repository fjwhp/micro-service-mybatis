<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>名片夹</title>
<link rel="stylesheet" href="/getCssStyle?css=static/web/plugins/layui/css/layui.css" media="all" />
<link rel="stylesheet" href="../../web/css/global.css" media="all">
<link rel="stylesheet" href="../../web/css/zTreeStyle.css" media="all">
<link rel="stylesheet" href="../../web/plugins/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="../../web/css/table.css" />
<link rel="stylesheet" href="/getCssStyle?css=static/web/plugins/layui2/css/layui.css" />
<link rel="stylesheet" href="../../web/css/public.css" media="all">
</head>
<body> 
	<input type="hidden" name="${_csrf.parameterName}" id="${_csrf.parameterName}" value="${_csrf.token}" />
	<div class="layui-tab layui-tab-brief m_t0" lay-filter="docDemoTabBrief">
		<ul class="layui-tab-title">
		    <li class="layui-this">名片夹</li>
		    <li>名片管理</li>
		</ul>
		<div class="layui-tab-content">
		  	<div class="layui-tab-item layui-show content_sel">
		  		<div class="">
		  			<blockquote class="layui-elem-quote" style="padding:5px;">
						<form class="layui-form" action="">
							<div class="r">
								<div class="layui-input-inline">
									<input type="text" name="searchKey" id="searchKey" placeholder="输入分类查询" autocomplete="off" class="layui-input"
										style="height: 30px; line-height: 30px;">
								</div>
								<span><@a code="000101" href="javascript:void(0)" class="layui-btn layui-btn-small" id="" onclick="loadData()" iclass="layui-icon"
									 icon="&#xe615;" text="查询"/></span>
							</div>
					 	    <div class="layui-input-inline">
							  	<span><a class="layui-btn layui-btn-small" onclick="newOne()"><i class="layui-icon">&#xe608;</i>新增</a></span>
							</div> 
						</form>
					</blockquote>
					<div class="layui-form">
						<table class="layui-table admin-table">
							<thead>
								<tr>
									<th style="display: none;">用户ID</th>
									<th>序号</th>
									<th>分类</th>
									<th>排序</th>
									<th>操作</th>
								</tr>
							</thead>
					<tbody id="paging-data">
					<script id="paging-script" type="text/html">
					{{each records value index}}
						<tr onclick="detail()"> 
							<td style="display: none;">{{value.id}}</td>
							<td>{{value.}}</td>
							<td>{{value.}}</td>
							<td>{{value.}}</td>
							<td>
								<@a code="000103" href="javascript:void(0)" class="layui-btn layui-btn-mini" id="show-edit" onclick="edit('{{value.id}}')" text="编辑"/>
								<@a code="000105" href="javascript:void(0)" class="layui-btn layui-btn-danger layui-btn-mini" id="show-delete" onclick="showDelete('{{value.id}}',this)" text="删除"/>
							</td>
						</tr>
					{{/each}}
					</script>
					</tbody>
					</table>
					</div>
					<div class="admin-table-page" style="border-width: 0px; z-index: 0;">
						<div id="paging-footer" class="page" style="background-color: white; text-align: center;"></div>
					</div>
		  		</div>
		  	</div>
		    <div class="layui-tab-item content_sel">
		     <!--名片管理tree-->
				<div class="menuContentAndList">
					<div id="menuContent" class="tree_left">
						<div class="left" >
							<input id="citySel" class="tree_search" type="text" value="" onkeyup="AutoMatch(this)" placeholder="搜索"/>	
					    </div>
						<ul id="treeDemo" class="ztree"></ul> 
					</div>
					<!-- 岗位 -->
					<div id="post_list" style="width: 78%; float: left;margin-left:10px;">
						<blockquote class="layui-elem-quote" style="padding:5px;">
						<form class="layui-form" action="">
							<div class="r">
								<div class="layui-input-inline">
									<input type="text" name="searchKey" id="searchKey" placeholder="输入姓名、手机号查询" autocomplete="off" class="layui-input"
										style="height: 30px; line-height: 30px;">
								</div>
								<span><@a code="000101" href="javascript:void(0)" class="layui-btn layui-btn-small" id="" onclick="detail()" iclass="layui-icon"
									 icon="&#xe615;" text="查询"/></span>
							</div>
					 	    <div class="layui-input-inline">
							  	<span><a class="layui-btn layui-btn-small" onclick="newCard()"><i class="layui-icon">&#xe61f;</i>新增名片</a></span>
							</div> 
						</form>
						</blockquote>   
					<div class="layui-field-box layui-form"
						style="padding: 0 0 20px 0;">
						<table class="layui-table admin-table">
						    <colgroup>
							    <col width="10%">
							    <col width="10%">
							    <col width="10%">
							    <col width="10%">
							    <col width="10%">
							    <col width="10%">
							    <col width="10%">
							    <col width="10%">
							    <col width="10%">
			 				 </colgroup>
							<thead>
								<tr>
									<th style="display: none;">用户ID</th>
									<th>序号</th>
									<th>姓名</th>
									<th>分类</th>
									<th>单位</th>
									<th>职务</th>
									<th>手机</th>
									<th>单位电话</th>
									<th>传真</th>
									<th>个人邮箱</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody id="content">
								<script id="test" type="text/html">
					{{each str value index}}
						<tr>
							<td style="display: none;">{{value.id}}</td>
							<td>{{index+1}}</td>
							<td>{{value.}}</td>
							<td>{{value.}}</td>
							<td>{{value.}}</td>
							<td>{{value.}}</td>
							<td>{{value.}}</td>
							<td>{{value.}}</td>
							<td>{{value.}}</td>
							<td>{{value.}}</td>
							<td>
								<@a code="000103" href="javascript:void(0)" class="layui-btn layui-btn-mini" id="show-edit" onclick="edit('{{value.id}}')" text="编辑"/>
								<@a code="000105" href="javascript:void(0)" class="layui-btn layui-btn-danger layui-btn-mini" id="show-delete" onclick="showDelete('{{value.id}}',this)" text="删除"/>
							</td>
						</tr>
					{{/each}}
					</script> 
							</tbody>
						</table>
					</div>
					<div class="admin-table-page" style="border-width: 0px; z-index: 0;">
						<div id="paging-footer" class="page"
							style="background-color: white; text-align: center;"></div>
					</div>
				</div>
			</div>	
		</div>
	</div>  
	<!-- 新增 -->
	<div class="admin-main" style="display: none; z-index: 19940200;" id="win-new-object">
		<div id="win-newsms-object">
			<form class="layui-form layui-form-pane" id="add-object-form">
				<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
				<div class="layui-form-item">
					<label class="layui-form-label">类别</label>
					<div class="layui-input-block">
						<input type="text" name="" id="" lay-verify="required|spactily" autocomplete="off" placeholder="类别" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">排序</label>
					<div class="layui-input-block">
						<input type="text" name="" id="" lay-verify="required|spactily" autocomplete="off" placeholder="排序" class="layui-input">
					</div>
				</div>
				<div class="btn_fixed">
					<a href="javascript:void(0)" class="layui-btn layui-btn-primary" onclick="layer.closeAll();"><i class="fa fa-backward"></i> 返回</a>
					<div style="float: right;">
						<button class="layui-btn" lay-filter="form-add-submit">
							<i class="fa fa-eraser"></i> 保存
						</button>
						<button lay-submit="" class="layui-btn layui-btn-primary">
							<li class="fa fa-save"></li> 取消
						</button>
					</div>
				</div>
			</form>
		</div>
	</div>
	<!-- 新增名片 -->
	<div class="admin-main" style="display: none; z-index: 19940200;margin-bottom:60px;" id="win-newCard-object">
		<div id="win-newsms-object">
			<form class="layui-form layui-form-pane" id="add-object-form">
				<div class="layui-form-item">
				    <label class="layui-form-label">分类</label>
				    <div class="layui-input-block">
				        <select name="city" lay-verify="required">
				         	<option value=""></option>
		       				<option value="0">分类1</option>
					        <option value="1">分类2</option>
					        <option value="2">分类3</option>
				        </select>
				    </div>
			 	</div>
				<div class="layui-form-item">
					<label class="layui-form-label">职务</label>
					<div class="layui-input-block">
						<input type="text" name="" id="" lay-verify="required|textLength100" autocomplete="off" placeholder="职务" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">姓名</label>
					<div class="layui-input-block">
						<input type="text" name="" id="" lay-verify="required|textLength100" autocomplete="off" placeholder="姓名" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
				    <label class="layui-form-label">性别</label>
				    <div class="layui-input-block">
				        <select name="city" lay-verify="required">
				         	<option value=""></option>
		       				<option value="0">男</option>
					        <option value="1">女</option>
				        </select>
				    </div>
			 	</div>
			 	<div class="layui-form-item">
					<label class="layui-form-label">单位名称</label>
					<div class="layui-input-block">
						<input type="text" name="" id="" lay-verify="required|textLength100" autocomplete="off" placeholder="单位名称" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">单位电话</label>
					<div class="layui-input-block">
						<input type="text" name="" id="" lay-verify="required|number" autocomplete="off" placeholder="单位电话" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">单位传真</label>
					<div class="layui-input-block">
						<input type="text" name="" id="" lay-verify="required|number" autocomplete="off" placeholder="单位传真" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">单位地址</label>
					<div class="layui-input-block">
						<input type="text" name="" id="" lay-verify="required|textLength100" autocomplete="off" placeholder="单位地址" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">手机号</label>
					<div class="layui-input-block">
						<input type="text" name="" id="" lay-verify="required|phone" autocomplete="off" placeholder="手机号" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">微信</label>
					<div class="layui-input-block">
						<input type="text" name="" id="" lay-verify="required|textLength100" autocomplete="off" placeholder="微信" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">QQ</label>
					<div class="layui-input-block">
						<input type="text" name="" id="" lay-verify="required|number" autocomplete="off" placeholder="QQ" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">MSN</label>
					<div class="layui-input-block">
						<input type="text" name="" id="" lay-verify="required|nochinese" autocomplete="off" placeholder="MSN" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">电子邮件</label>
					<div class="layui-input-block">
						<input type="text" name="" id="" lay-verify="required|email" autocomplete="off" placeholder="电子邮件" class="layui-input">
					</div>
				</div>	
				<div class="layui-form-item">
					<label class="layui-form-label">备注</label>
					<div class="layui-input-block">
						 <textarea name="" id="" placeholder="请输入内容" onkeyup="countnum(this);" class="layui-textarea"></textarea>	
					</div>
				</div> 			
				<div class="btn_fixed">
					<a href="javascript:void(0)" class="layui-btn layui-btn-primary" onclick="layer.closeAll();"><i class="fa fa-backward"></i> 返回</a>
					<div style="float: right;">
						<button class="layui-btn" lay-filter="form-add-submit">
							<i class="fa fa-eraser"></i> 取消
						</button>
						<button type="reset" lay-submit="" class="layui-btn layui-btn-primary">
							<li class="fa fa-save"></li> 保存
						</button>
					</div>
				</div>
			</form>
		</div>
	</div>
	<script type="text/javascript" src="../../web/plugins/layui2/layui.js"></script>
	<script type="text/javascript" src="../../web/plugins/layui/lay/modules/laypage.js"></script>
	<script type="text/javascript" src="../../web/js/template-web.js"></script>
	<script type="text/javascript" src="../../web/js/jquery.js"></script>
	<script type="text/javascript" src="../../web/js/tool_upload.js"></script>
    <script type="text/javascript" src="../../web/js/jquery.ztree.all.min.js"></script>
	<script type="text/javascript" src="../../web/js/laydate/laydate.js"></script>
	<script type="text/javascript" src="../../web/js/tool_upload.js"></script>
	<script>
		//定义layui
		var pform;
		layui.use(['form','element'], function() {
			pform = layui.form;
	          pform.verify({
	                //限制输入的长度为200
	                textLength200 : function(value) {
	                    if (value.length>200) {
	                        return "长度不能超过200个字符";
	                    }
	                },
	                //限制输入的长度为100
	                textLength100 : function(value) {
	                    if (value.length100) {
	                        return "长度不能超过100个字符";
	                    }
	                },
	                //限制输入的长度为10
	                textLength10 : function(value) {
	                    if (value.length>10) {
	                        return "长度不能超过10个字符";
	                    }
	                },
	                //不能输入汉字
	                nochinese : function(value) {
	                    /^[^\u4e00-\u9fa5]{0,}$/
	                    ,'密码必须6到12位，且不能出现空格'
	                },
	                //限制不能输入特殊10
	                specailChar:function (value) {
	                    if (new RegExp("[':;' \"\",\\[\\]——|‘；`：”“']").test(value)) {
	                        return '不能输入特殊字符';
	                    }
	                }
	            });
		});
		//新增
		function newOne() {
			var index = layer.open({
				title : '新增',
				maxmin : false,
				type : 1,
				content : $('#win-new-object')
			});
			pform.render();
			layer.full(index);
		}
		//新增名片
		function newCard() {
			var index = layer.open({
				title : '新增名片',
				maxmin : false,
				type : 1,
				content : $('#win-newCard-object')
			});
			pform.render();
			layer.full(index);
		}
		//名片详情
		function detail() {
			var index = layer.open({
				title : '详情',
				maxmin : false,
				type : 1,
				content : $('#win-detail-object')
			});
			pform.render();
			layer.full(index);
		}
		//生成树
		var setting = {
				data : {
					simpleData : {
						enable : true
					}
				},
				callback : {
					beforeClick : beforeClick
				}
			};
		var param = new Object();
		param._csrf = $("#_csrf").val();
		redern();
		function redern() {
			tool.post("/aut/autDepartment/getDepartmentList", param, postCallBack_newtree);
		}
		var obj = [];
		var zTreeObj; 
		function postCallBack_newtree(data) {
			for (var i = 0; i < data.length; i++) {
				obj.push({
					id : data[i].id,
					pId : data[i].parentId,
					name : data[i].deptName,
					obj : {
						deptCode : data[i].deptCode,
						deptLevel : data[i].deptLevel,
						isActive : data[i].isActive,
						parentId : data[i].parentId,
						parentCode : data[i].parentCode
					}
				}) 
			}  
			zTreeObj = $.fn.zTree.init($("#treeDemo"), setting, obj);
		}

		var hiddenNodes=[];	//用于存储被隐藏的结点
		var targetParent = [];
		function getParentByChild(node){
			if(node.parentTId != null){
				targetParent.push(node.getParentNode());
				getParentByChild(node.getParentNode());
			}
		}
		
		//过滤ztree显示数据
		function AutoMatch(){
			//显示上次搜索后背隐藏的结点
			zTreeObj.showNodes(hiddenNodes);
			//查找不符合条件的叶子节点
			targetParent = [];
			function filterFunc(node){
				var _keywords=$("#citySel").val();
				if(node.name.indexOf(_keywords)!=-1) {
					getParentByChild(node)
					return false;
				}
				return true;		
			};
			//获取不符合条件的叶子结点
			hiddenNodes=zTreeObj.getNodesByFilter(filterFunc);
			//隐藏不符合条件的叶子结点
			zTreeObj.hideNodes(hiddenNodes);
			//显示满足条件的根节点
			zTreeObj.showNodes(targetParent);
			zTreeObj.expandAll(true);
		};

		//获取数节点加载岗位列表
		function beforeClick(hh, treeNode) {
			$("#deptTreeId").val(treeNode.id);
			$("#deptTreeName").val(treeNode.name);
			loadData(treeNode.id,treeNode.name,treeNode.obj.deptCode,
					treeNode.obj.isActive);
		}
	 	//加载岗位list
	 	var id1 , deptName1;//点击后对应的id和name
		function loadData(id,deptName) {
			id1=id;
			deptName1 = deptName;
			var _csrf = $("#_csrf").val();
			
		 	var data = {
		 			 deptId:id,
		 			 deptName:deptName,		
					 _csrf:_csrf, 
				}  	
		 	tool.post("../attSignInOut/getAttSignInCountList",data,callBt,false);  	
		}  
	 	function callBt(data){
	 		var str={str:data}
	 	 	var html = template('test', str);
			document.getElementById('content').innerHTML = html; 
	 	}
	</script>
</body>
</html>