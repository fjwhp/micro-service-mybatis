var currentXmlCode="";(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){'use strict';var $=require('jquery'),BpmnModeler=require('bpmn-js/lib/Modeler');var propertiesPanelModule=require('bpmn-js-properties-panel'),propertiesProviderModule=require('bpmn-js-properties-panel/lib/provider/camunda'),camundaModdleDescriptor=require('camunda-bpmn-moddle/resources/camunda');var container=$('#js-drop-zone');var canvas=$('#js-canvas');var bpmnModeler=new BpmnModeler({container:canvas,propertiesPanel:{parent:'#js-properties-panel'},additionalModules:[propertiesPanelModule,propertiesProviderModule],moddleExtensions:{camunda:camundaModdleDescriptor}});var aljoin_init_id=Math.uuid(10);var newDiagramXML="<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n";newDiagramXML+="<bpmn2:definitions xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" ";newDiagramXML+="xmlns:bpmn2=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" ";newDiagramXML+="xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" ";newDiagramXML+="xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\" ";newDiagramXML+="xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\" ";newDiagramXML+="xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\" ";newDiagramXML+="xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" ";newDiagramXML+="xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" ";newDiagramXML+="xmlns:activiti=\"http://activiti.org/bpmn\" ";newDiagramXML+="xmlns:omgdc=\"http://www.omg.org/spec/DD/20100524/DC\" ";newDiagramXML+="xmlns:omgdi=\"http://www.omg.org/spec/DD/20100524/DI\" ";newDiagramXML+="typeLanguage=\"http://www.w3.org/2001/XMLSchema\" ";newDiagramXML+="expressionLanguage=\"http://www.w3.org/1999/XPath\" ";newDiagramXML+="xmlns:bpmn2=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"  ";newDiagramXML+="id=\"sample-diagram-"+aljoin_init_id+"\" ";newDiagramXML+="targetNamespace=\"http://bpmn.io/schema/bpmn\">\n  ";newDiagramXML+="<bpmn2:process id=\"Process_"+aljoin_init_id+"\" name=\"新流程_"+Math.uuid(7)+"\" isExecutable=\"true\">\n    ";newDiagramXML+="<bpmn2:startEvent id=\"StartEvent_"+aljoin_init_id+"\"/>\n  </bpmn2:process>\n  ";newDiagramXML+="<bpmndi:BPMNDiagram id=\"BPMNDiagram_"+aljoin_init_id+"\">\n    ";newDiagramXML+="<bpmndi:BPMNPlane id=\"BPMNPlane_"+aljoin_init_id+"\" bpmnElement=\"Process_"+aljoin_init_id+"\">\n      ";newDiagramXML+="<bpmndi:BPMNShape id=\"_BPMNShape_StartEvent_2\" bpmnElement=\"StartEvent_"+aljoin_init_id+"\">\n        ";newDiagramXML+="<dc:Bounds height=\"36.0\" width=\"36.0\" x=\"412.0\" y=\"240.0\"/>\n      ";newDiagramXML+="</bpmndi:BPMNShape>\n    </bpmndi:BPMNPlane>\n  </bpmndi:BPMNDiagram>\n</bpmn2:definitions>";function createNewDiagram(){if($("#isEdit").val()==1){newDiagramXML=$("#actAljoinBpmnXmlCode").val();}openDiagram(newDiagramXML);}createNewDiagram();function openDiagram(xml){bpmnModeler.importXML(xml,function(err){if(err){container.removeClass('with-diagram').addClass('with-error');container.find('.error pre').text(err.message);console.error(err);}else{container.removeClass('with-error').addClass('with-diagram');}});}function saveSVG(done){bpmnModeler.saveSVG(done);}function saveDiagram(done){bpmnModeler.saveXML({format:true},function(err,xml){done(err,xml);});}function registerFileDrop(container,callback){function handleFileSelect(e){e.stopPropagation();e.preventDefault();var files=e.dataTransfer.files;var file=files[0];var reader=new FileReader();reader.onload=function(e){var xml=e.target.result;callback(xml);};reader.readAsText(file);}function handleDragOver(e){e.stopPropagation();e.preventDefault();e.dataTransfer.dropEffect='copy';}container.get(0).addEventListener('dragover',handleDragOver,false);container.get(0).addEventListener('drop',handleFileSelect,false);}if(!window.FileList||!window.FileReader){window.alert('Looks like you use an older browser that does not support drag and drop. '+'Try using Chrome, Firefox or the Internet Explorer > 10.');}else{registerFileDrop(container,openDiagram);}$(document).on('ready',function(){$('#js-create-diagram').click(function(e){e.stopPropagation();e.preventDefault();createNewDiagram();});var downloadLink=$('#js-download-diagram');var downloadSvgLink=$('#js-download-svg');$('.buttons a').click(function(e){if(!$(this).is('.active')){e.preventDefault();e.stopPropagation();}});function setEncoded(link,name,data){var encodedData=encodeURIComponent(data);if(data){currentXmlCode=data;link.addClass('active').attr({'href':'data:application/bpmn20-xml;charset=UTF-8,'+encodedData,'download':name});}else{link.removeClass('active');}}var debounce=require('lodash/function/debounce');var exportArtifacts=debounce(function(){saveSVG(function(err,svg){setEncoded(downloadSvgLink,'diagram.svg',err?null:svg);});saveDiagram(function(err,xml){setEncoded(downloadLink,'diagram.bpmn',err?null:xml);});},500);bpmnModeler.on('commandStack.changed',exportArtifacts);});},{"bpmn-js-properties-panel":3,"bpmn-js-properties-panel/lib/provider/camunda":63,"bpmn-js/lib/Modeler":104,"camunda-bpmn-moddle/resources/camunda":212,"jquery":401,"lodash/function/debounce":428}],2:[function(require,module,exports){'use strict';exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=='undefined'?Uint8Array:Array;var code='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i;}revLookup['-'.charCodeAt(0)]=62;revLookup['_'.charCodeAt(0)]=63;function placeHoldersCount(b64){var len=b64.length;if(len%4>0){throw new Error('Invalid string. Length must be a multiple of 4');}return b64[len-2]==='='?2:b64[len-1]==='='?1:0;}function byteLength(b64){return(b64.length*3/4)-placeHoldersCount(b64);}function toByteArray(b64){var i,l,tmp,placeHolders,arr;var len=b64.length;placeHolders=placeHoldersCount(b64);arr=new Arr((len*3/4)-placeHolders);l=placeHolders>0?len-4:len;var L=0;for(i=0;i<l;i+=4){tmp=(revLookup[b64.charCodeAt(i)]<<18)|(revLookup[b64.charCodeAt(i+1)]<<12)|(revLookup[b64.charCodeAt(i+2)]<<6)|revLookup[b64.charCodeAt(i+3)];arr[L++]=(tmp>>16)&0xFF;arr[L++]=(tmp>>8)&0xFF;arr[L++]=tmp&0xFF;}if(placeHolders===2){tmp=(revLookup[b64.charCodeAt(i)]<<2)|(revLookup[b64.charCodeAt(i+1)]>>4);arr[L++]=tmp&0xFF;}else if(placeHolders===1){tmp=(revLookup[b64.charCodeAt(i)]<<10)|(revLookup[b64.charCodeAt(i+1)]<<4)|(revLookup[b64.charCodeAt(i+2)]>>2);arr[L++]=(tmp>>8)&0xFF;arr[L++]=tmp&0xFF;}return arr;}function tripletToBase64(num){return lookup[num>>18&0x3F]+lookup[num>>12&0x3F]+lookup[num>>6&0x3F]+lookup[num&0x3F];}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+(uint8[i+2]);output.push(tripletToBase64(tmp));}return output.join('');}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var output='';var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,(i+maxChunkLength)>len2?len2:(i+maxChunkLength)));}if(extraBytes===1){tmp=uint8[len-1];output+=lookup[tmp>>2];output+=lookup[(tmp<<4)&0x3F];output+='==';}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+(uint8[len-1]);output+=lookup[tmp>>10];output+=lookup[(tmp>>4)&0x3F];output+=lookup[(tmp<<2)&0x3F];output+='=';}parts.push(output);return parts.join('');}},{}],3:[function(require,module,exports){module.exports=require('./lib');},{"./lib":33}],4:[function(require,module,exports){'use strict';var DEFAULT_PRIORITY=1000;function PropertiesActivator(eventBus,priority){var self=this;priority=priority||DEFAULT_PRIORITY;eventBus.on('propertiesPanel.isEntryVisible',priority,function(e){return self.isEntryVisible(e.entry,e.element);});eventBus.on('propertiesPanel.isPropertyEditable',priority,function(e){return self.isPropertyEditable(e.entry,e.propertyName,e.element);});}PropertiesActivator.$inject=['eventBus'];module.exports=PropertiesActivator;PropertiesActivator.prototype.isEntryVisible=function(entry,element){return true;};PropertiesActivator.prototype.isPropertyEditable=function(entry,propertyName,element){return true;};},{}],5:[function(require,module,exports){'use strict';var domify=require('min-dom/lib/domify'),domQuery=require('min-dom/lib/query'),domRemove=require('min-dom/lib/remove'),domClasses=require('min-dom/lib/classes'),domClosest=require('min-dom/lib/closest'),domAttr=require('min-dom/lib/attr'),domDelegate=require('min-dom/lib/delegate'),domMatches=require('min-dom/lib/matches');var forEach=require('lodash/collection/forEach'),filter=require('lodash/collection/filter'),get=require('lodash/object/get'),keys=require('lodash/object/keys'),isEmpty=require('lodash/lang/isEmpty'),isArray=require('lodash/lang/isArray'),xor=require('lodash/array/xor'),debounce=require('lodash/function/debounce');var updateSelection=require('selection-update');var scrollTabs=require('scroll-tabs');var getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject;var HIDE_CLASS='bpp-hidden';var DEBOUNCE_DELAY=300;function isToggle(node){return node.type==='checkbox'||node.type==='radio';}function isSelect(node){return node.type==='select-one';}function isContentEditable(node){return domAttr(node,'contenteditable');}function getPropertyPlaceholders(node){var selector='input[name], textarea[name], [data-value], [contenteditable]';var placeholders=domQuery.all(selector,node);if((!placeholders||!placeholders.length)&&domMatches(node,selector)){placeholders=[node];}return placeholders;}function getFormControls(node,all){var controls=domQuery.all('input[name], textarea[name], select[name], [contenteditable]',node);if(!controls||!controls.length){controls=domMatches(node,'option')?[node]:controls;}if(!all){controls=filter(controls,function(node){return!domClosest(node,'.'+HIDE_CLASS);});}return controls;}function getFormControlValuesInScope(entryNode){var values={};var controlNodes=getFormControls(entryNode);forEach(controlNodes,function(controlNode){var value=controlNode.value;var name=domAttr(controlNode,'name')||domAttr(controlNode,'data-name');if(isToggle(controlNode)){if(controlNode.checked){if(!domAttr(controlNode,'value')){value=true;}else{value=controlNode.value;}}else{value=null;}}else
if(isContentEditable(controlNode)){value=controlNode.innerText;}if(value!==null){values[name]=value;}});return values;}function getFormControlValues(entryNode){var values;var listContainer=domQuery('[data-list-entry-container]',entryNode);if(listContainer){values=[];var listNodes=listContainer.children||[];forEach(listNodes,function(listNode){values.push(getFormControlValuesInScope(listNode));});}else{values=getFormControlValuesInScope(entryNode);}return values;}function valueEqual(value,oldValue){if(value&&!oldValue){return false;}var allKeys=keys(value).concat(keys(oldValue));return allKeys.every(function(key){return value[key]===oldValue[key];});}function valuesEqual(values,oldValues){if(isArray(values)){if(values.length!==oldValues.length){return false;}return values.every(function(v,idx){return valueEqual(v,oldValues[idx]);});}return valueEqual(values,oldValues);}function extractEntries(tabs){return indexBy(flattenDeep(map(flattenDeep(map(tabs,'groups')),'entries')),'id');}function extractGroups(tabs){return indexBy(flattenDeep(map(tabs,'groups')),'id');}function PropertiesPanel(config,eventBus,modeling,propertiesProvider,commandStack,canvas){this._eventBus=eventBus;this._modeling=modeling;this._commandStack=commandStack;this._canvas=canvas;this._propertiesProvider=propertiesProvider;this._init(config);}PropertiesPanel.$inject=['config.propertiesPanel','eventBus','modeling','propertiesProvider','commandStack','canvas'];module.exports=PropertiesPanel;PropertiesPanel.prototype._init=function(config){var eventBus=this._eventBus;var self=this;eventBus.on('root.added',function(e){self.update(e.element);});eventBus.on('selection.changed',function(e){var newElement=e.newSelection[0];self.update(newElement);});eventBus.on(['propertiesPanel.changed','propertiesPanel.resized'],function(event){var tabBarNode=domQuery('.bpp-properties-tab-bar',self._container);if(!tabBarNode){return;}var scroller=scrollTabs.get(tabBarNode);if(!scroller){scroller=scrollTabs(tabBarNode,{selectors:{tabsContainer:'.bpp-properties-tabs-links',tab:'.bpp-properties-tabs-links li',ignore:'.bpp-hidden',active:'.bpp-active'}});scroller.on('scroll',function(newActiveNode,oldActiveNode,direction){var linkNode=domQuery('[data-tab-target]',newActiveNode);var tabId=domAttr(linkNode,'data-tab-target');self.activateTab(tabId);});}scroller.update();});eventBus.on('elements.changed',function(e){var current=self._current;var element=current&&current.element;if(element){if(e.elements.indexOf(element)!==-1){self.update(element);}}});eventBus.on('elementTemplates.changed',function(){var current=self._current;var element=current&&current.element;if(element){self.update(element);}});eventBus.on('diagram.destroy',function(){self.detach();});this._container=domify('<div class="bpp-properties-panel"></div>');this._bindListeners(this._container);if(config&&config.parent){this.attachTo(config.parent);}};PropertiesPanel.prototype.attachTo=function(parentNode){if(!parentNode){throw new Error('parentNode required');}this.detach();if(parentNode.get&&parentNode.constructor.prototype.jquery){parentNode=parentNode.get(0);}if(typeof parentNode==='string'){parentNode=domQuery(parentNode);}var container=this._container;parentNode.appendChild(container);this._emit('attach');};PropertiesPanel.prototype.detach=function(){var container=this._container,parentNode=container.parentNode;if(!parentNode){return;}this._emit('detach');parentNode.removeChild(container);};PropertiesPanel.prototype.activateTab=function(tab){var tabId=typeof tab==='string'?tab:tab.id;var current=this._current;var panelNode=current.panel;var allTabNodes=domQuery.all('.bpp-properties-tab',panelNode),allTabLinkNodes=domQuery.all('.bpp-properties-tab-link',panelNode);forEach(allTabNodes,function(tabNode){var currentTabId=domAttr(tabNode,'data-tab');domClasses(tabNode).toggle('bpp-active',tabId===currentTabId);});forEach(allTabLinkNodes,function(tabLinkNode){var tabLink=domQuery('[data-tab-target]',tabLinkNode),currentTabId=domAttr(tabLink,'data-tab-target');domClasses(tabLinkNode).toggle('bpp-active',tabId===currentTabId);});};PropertiesPanel.prototype.update=function(element){var current=this._current;var needsCreate=true;if(typeof element==='undefined'){element=this._canvas.getRootElement();}var newTabs=this._propertiesProvider.getTabs(element);if(current&&current.element===element){needsCreate=this._entriesChanged(current,newTabs);}if(needsCreate){if(current){var activeTabNode=domQuery('.bpp-properties-tab.bpp-active',current.panel);var activeTabId;if(activeTabNode){activeTabId=domAttr(activeTabNode,'data-tab');}domRemove(current.panel);}this._current=this._create(element,newTabs);(activeTabId)?this.activateTab(activeTabId):this.activateTab(this._current.tabs[0]);}if(this._current){this._updateActivation(this._current);}this._emit('changed');};PropertiesPanel.prototype._entriesChanged=function(current,newTabs){var oldEntryIds=keys(current.entries),newEntryIds=keys(extractEntries(newTabs));return!isEmpty(xor(oldEntryIds,newEntryIds));};PropertiesPanel.prototype._emit=function(event){this._eventBus.fire('propertiesPanel.'+event,{panel:this,current:this._current});};PropertiesPanel.prototype._bindListeners=function(container){var self=this;var handleChange=function handleChange(event){var node=domClosest(event.delegateTarget,'[data-entry]'),entryId,entry;if(!node){return;}entryId=domAttr(node,'data-entry');entry=self.getEntry(entryId);var values=getFormControlValues(node);if(event.type==='change'){var onChangeAction=event.delegateTarget.getAttribute('data-on-change');if(onChangeAction){var isEntryDirty=self.executeAction(entry,node,onChangeAction,event);if(!isEntryDirty){return self.update(self._current.element);}}}self.applyChanges(entry,values,node);self.updateState(entry,node);};domDelegate.bind(container,'input, textarea, [contenteditable]','input',debounce(handleChange,DEBOUNCE_DELAY));domDelegate.bind(container,'input, textarea, select, [contenteditable]','change',handleChange);domDelegate.bind(container,'[data-action]','click',function onClick(event){var inputNode=event.delegateTarget;var entryNode=domClosest(inputNode,'[data-entry]');var actionId=domAttr(inputNode,'data-action'),entryId=domAttr(entryNode,'data-entry');var entry=self.getEntry(entryId);var isEntryDirty=self.executeAction(entry,entryNode,actionId,event);if(isEntryDirty){var values=getFormControlValues(entryNode);self.applyChanges(entry,values,entryNode);}self.updateState(entry,entryNode);});function handleInput(event,element){var inputNode=event.delegateTarget;var entryNode=domClosest(inputNode,'[data-entry]');if(!entryNode){return;}var eventHandlerId=domAttr(inputNode,'data-blur'),entryId=domAttr(entryNode,'data-entry');var entry=self.getEntry(entryId);var isEntryDirty=self.executeAction(entry,entryNode,eventHandlerId,event);if(isEntryDirty){var values=getFormControlValues(entryNode);self.applyChanges(entry,values,entryNode);}self.updateState(entry,entryNode);}domDelegate.bind(container,'[data-blur]','blur',handleInput,true);domDelegate.bind(container,'.bpp-properties-tabs-links [data-tab-target]','click',function(event){event.preventDefault();var delegateTarget=event.delegateTarget;var tabId=domAttr(delegateTarget,'data-tab-target');self.activateTab(tabId);});};PropertiesPanel.prototype.updateState=function(entry,entryNode){this.updateShow(entry,entryNode);this.updateDisable(entry,entryNode);};PropertiesPanel.prototype.updateShow=function(entry,node){var current=this._current;if(!current){return;}var showNodes=domQuery.all('[data-show]',node)||[];forEach(showNodes,function(showNode){var expr=domAttr(showNode,'data-show');var fn=get(entry,expr);if(fn){var scope=domClosest(showNode,'[data-scope]')||node;var shouldShow=fn(current.element,node,showNode,scope)||false;if(shouldShow){domClasses(showNode).remove(HIDE_CLASS);}else{domClasses(showNode).add(HIDE_CLASS);}}});};PropertiesPanel.prototype.updateDisable=function(entry,node){var current=this._current;if(!current){return;}var nodes=domQuery.all('[data-disable]',node)||[];forEach(nodes,function(currentNode){var expr=domAttr(currentNode,'data-disable');var fn=get(entry,expr);if(fn){var scope=domClosest(currentNode,'[data-scope]')||node;var shouldDisable=fn(current.element,node,currentNode,scope)||false;domAttr(currentNode,'disabled',shouldDisable?'':null);}});};PropertiesPanel.prototype.executeAction=function(entry,entryNode,actionId,event){var current=this._current;if(!current){return;}var fn=get(entry,actionId);if(fn){var scopeNode=domClosest(event.target,'[data-scope]')||entryNode;return fn.apply(entry,[current.element,entryNode,event,scopeNode]);}};PropertiesPanel.prototype.applyChanges=function(entry,values,containerElement){var element=this._current.element;if(valuesEqual(values,entry.oldValues)){return;}var command=entry.set(element,values,containerElement);var commandToExecute;if(isArray(command)){if(command.length){commandToExecute={cmd:'properties-panel.multi-command-executor',context:flattenDeep(command)};}}else{commandToExecute=command;}if(commandToExecute){this._commandStack.execute(commandToExecute.cmd,commandToExecute.context||{element:element});}else{this.update(element);}};PropertiesPanel.prototype.applyValidationErrors=function(validationErrors,entryNode){var valid=true;var controlNodes=getFormControls(entryNode,true);forEach(controlNodes,function(controlNode){var name=domAttr(controlNode,'name')||domAttr(controlNode,'data-name');var error=validationErrors&&validationErrors[name];var errorMessageNode=domQuery('.bpp-error-message',controlNode.parentNode);if(error){valid=false;if(!errorMessageNode){errorMessageNode=domify('<div></div>');domClasses(errorMessageNode).add('bpp-error-message');controlNode.parentNode.insertBefore(errorMessageNode,controlNode.nextSibling);}errorMessageNode.innerHTML=error;domClasses(controlNode).add('invalid');}else{domClasses(controlNode).remove('invalid');if(errorMessageNode){controlNode.parentNode.removeChild(errorMessageNode);}}});return valid;};PropertiesPanel.prototype.validate=function(entry,values,entryNode){var self=this;var current=this._current;var valid=true;entryNode=entryNode||domQuery('[data-entry="'+entry.id+'"]',current.panel);if(values instanceof Array){var listContainer=domQuery('[data-list-entry-container]',entryNode),listEntryNodes=listContainer.children||[];for(var i=0;i<values.length;i++){var listValue=values[i];if(entry.validateListItem){var validationErrors=entry.validateListItem(current.element,listValue,entryNode,i),listEntryNode=listEntryNodes[i];valid=self.applyValidationErrors(validationErrors,listEntryNode)&&valid;}}}else{if(entry.validate){this.validationErrors=entry.validate(current.element,values,entryNode);valid=self.applyValidationErrors(this.validationErrors,entryNode)&&valid;}}return valid;};PropertiesPanel.prototype.getEntry=function(id){return this._current&&this._current.entries[id];};var flattenDeep=require('lodash/array/flattenDeep'),indexBy=require('lodash/collection/indexBy'),map=require('lodash/collection/map');PropertiesPanel.prototype._create=function(element,tabs){if(!element){return null;}var containerNode=this._container;var panelNode=this._createPanel(element,tabs);containerNode.appendChild(panelNode);var entries=extractEntries(tabs);var groups=extractGroups(tabs);return{tabs:tabs,groups:groups,entries:entries,element:element,panel:panelNode};};PropertiesPanel.prototype._bindTemplate=function(element,entry,values,entryNode,idx){var eventBus=this._eventBus;function isPropertyEditable(entry,propertyName){return eventBus.fire('propertiesPanel.isPropertyEditable',{entry:entry,propertyName:propertyName,element:element});}var inputNodes=getPropertyPlaceholders(entryNode);forEach(inputNodes,function(node){var name,newValue,editable;if('value'in node||isContentEditable(node)==='true'){name=domAttr(node,'name')||domAttr(node,'data-name');newValue=values[name];editable=isPropertyEditable(entry,name);if(editable&&entry.editable){editable=entry.editable(element,entryNode,node,name,newValue,idx);}domAttr(node,'readonly',editable?null:'');domAttr(node,'disabled',editable?null:'');if(entry.setControlValue){entry.setControlValue(element,entryNode,node,name,newValue,idx);}else if(isToggle(node)){setToggleValue(node,newValue);}else if(isSelect(node)){setSelectValue(node,newValue);}else{setInputValue(node,newValue);}}else{name=domAttr(node,'data-value');newValue=values[name];if(entry.setControlValue){entry.setControlValue(element,entryNode,node,name,newValue,idx);}else{setTextValue(node,newValue);}}});};PropertiesPanel.prototype._updateActivation=function(current){var self=this;var eventBus=this._eventBus;var element=current.element;function isEntryVisible(entry){return eventBus.fire('propertiesPanel.isEntryVisible',{entry:entry,element:element});}function isGroupVisible(group,element,groupNode){if(typeof group.enabled==='function'){return group.enabled(element,groupNode);}else{return true;}}function isTabVisible(tab,element){if(typeof tab.enabled==='function'){return tab.enabled(element);}else{return true;}}function toggleVisible(node,visible){domClasses(node).toggle(HIDE_CLASS,!visible);}function checkActiveTabVisibility(node,visible){var isActive=domClasses(node).has('bpp-active');if(!visible&&isActive){self.activateTab(current.tabs[0]);}}function updateLabel(element,selector,text){var labelNode=domQuery(selector,element);if(!labelNode){return;}labelNode.textContent=text;}var panelNode=current.panel;forEach(current.tabs,function(tab){var tabNode=domQuery('[data-tab='+tab.id+']',panelNode);var tabLinkNode=domQuery('[data-tab-target='+tab.id+']',panelNode).parentNode;var tabVisible=false;forEach(tab.groups,function(group){var groupVisible=false;var groupNode=domQuery('[data-group='+group.id+']',tabNode);forEach(group.entries,function(entry){var entryNode=domQuery('[data-entry="'+entry.id+'"]',groupNode);var entryVisible=isEntryVisible(entry);groupVisible=groupVisible||entryVisible;toggleVisible(entryNode,entryVisible);var values='get'in entry?entry.get(element,entryNode):{};if(values instanceof Array){var listEntryContainer=domQuery('[data-list-entry-container]',entryNode);var existingElements=listEntryContainer.children||[];for(var i=0;i<values.length;i++){var listValue=values[i];var listItemNode=existingElements[i];if(!listItemNode){listItemNode=domify(entry.createListEntryTemplate(listValue,i,listEntryContainer));listEntryContainer.appendChild(listItemNode);}domAttr(listItemNode,'data-index',i);self._bindTemplate(element,entry,listValue,listItemNode,i);}var entriesToRemove=existingElements.length-values.length;for(var j=0;j<entriesToRemove;j++){listEntryContainer.removeChild(listEntryContainer.lastChild);}}else{self._bindTemplate(element,entry,values,entryNode);}self.updateState(entry,entryNode);self.validate(entry,values,entryNode);entry.oldValues=getFormControlValues(entryNode);});if(typeof group.label==='function'){updateLabel(groupNode,'.group-label',group.label(element,groupNode));}groupVisible=groupVisible&&isGroupVisible(group,element,groupNode);tabVisible=tabVisible||groupVisible;toggleVisible(groupNode,groupVisible);});tabVisible=tabVisible&&isTabVisible(tab,element);toggleVisible(tabNode,tabVisible);toggleVisible(tabLinkNode,tabVisible);checkActiveTabVisibility(tabNode,tabVisible);});updateLabel(panelNode,'[data-label-id]',getBusinessObject(element).id||'');};PropertiesPanel.prototype._createPanel=function(element,tabs){var self=this;var panelNode=domify('<div class="bpp-properties"></div>'),headerNode=domify('<div class="bpp-properties-header">'+'<div class="label" data-label-id></div>'+'<div class="search">'+'<input type="search" placeholder="Search for property" />'+'<button><span>Search</span></button>'+'</div>'+'</div>'),tabBarNode=domify('<div class="bpp-properties-tab-bar"></div>'),tabLinksNode=domify('<ul class="bpp-properties-tabs-links"></ul>'),tabContainerNode=domify('<div class="bpp-properties-tabs-container"></div>');panelNode.appendChild(headerNode);forEach(tabs,function(tab,tabIndex){if(!tab.id){throw new Error('tab must have an id');}var tabNode=domify('<div class="bpp-properties-tab" data-tab="'+tab.id+'"></div>'),tabLinkNode=domify('<li class="bpp-properties-tab-link">'+'<a href data-tab-target="'+tab.id+'">'+tab.label+'</a>'+'</li>');var groups=tab.groups;forEach(groups,function(group){if(!group.id){throw new Error('group must have an id');}var custom_element="";if(group.id=="general"&&element.type=="bpmn:Process"){var custom_dom=$("#custom-jbpm-prop").clone();custom_dom.attr("id","custom-jbpm-prop_1");custom_dom.css("display","block");custom_element=custom_dom.prop("outerHTML");}if(group.id=="forms"&&(element.type=="bpmn:StartEvent"||element.type=="bpmn:UserTask")){var custom_dom;if($("#custom-jbpm-form_"+element.id).length>0){custom_dom=$("#custom-jbpm-form_"+element.id).clone();custom_dom.attr("id","custom-jbpm-form_"+element.id+"_1");}else{var custom_dom2=$("#custom-jbpm-form").clone();custom_dom2.attr("id","custom-jbpm-form_"+element.id);var etype="";if(element.type=="bpmn:StartEvent"){etype="StartEvent";}else{etype="UserTask";}custom_dom2.attr("etype",etype);custom_dom2.appendTo(".process_backup_div");custom_dom=$("#custom-jbpm-form").clone();custom_dom.attr("id","custom-jbpm-form_"+element.id+"_1");}custom_dom.css("display","block");custom_element=custom_dom.prop("outerHTML");}if(group.id=="details"&&element.type=="bpmn:UserTask"){var custom_dom;if($("#custom-jbpm-detail-assignee_"+element.id).length>0){custom_dom=$("#custom-jbpm-detail-assignee_"+element.id).clone();custom_dom.attr("id","custom-jbpm-detail-assignee_"+element.id+"_1");}else{var custom_dom2=$("#custom-jbpm-detail-assignee").clone();custom_dom2.attr("id","custom-jbpm-detail-assignee_"+element.id);custom_dom2.appendTo(".process_backup_div");custom_dom=$("#custom-jbpm-detail-assignee").clone();custom_dom.attr("id","custom-jbpm-detail-assignee_"+element.id+"_1");}custom_dom.css("display","block");custom_element=custom_dom.prop("outerHTML");}var groupNode=domify('<div class="bpp-properties-group" data-group="'+group.id+'">'+'<span class="group-toggle"></span>'+'<span class="group-label">'+group.label+'</span>'+custom_element+'</div>');groupNode.querySelector('.group-toggle').addEventListener('click',function(evt){domClasses(groupNode).toggle('group-closed');evt.preventDefault();evt.stopPropagation();});groupNode.addEventListener('click',function(evt){if(!evt.defaultPrevented&&domClasses(groupNode).has('group-closed')){domClasses(groupNode).remove('group-closed');}});forEach(group.entries,function(entry){if(!entry.id){throw new Error('entry must have an id');}var html=entry.html;if(typeof html==='string'){html=domify(html);}if(html.get&&html.constructor.prototype.jquery){html=html.get(0);}var entryNode=domify('<div class="bpp-properties-entry" data-entry="'+entry.id+'"></div>');forEach(entry.cssClasses||[],function(cssClass){domClasses(entryNode).add(cssClass);});entryNode.appendChild(html);groupNode.appendChild(entryNode);self.updateState(entry,entryNode);});tabNode.appendChild(groupNode);});tabLinksNode.appendChild(tabLinkNode);tabContainerNode.appendChild(tabNode);});tabBarNode.appendChild(tabLinksNode);panelNode.appendChild(tabBarNode);panelNode.appendChild(tabContainerNode);return panelNode;};function setInputValue(node,value){var contentEditable=isContentEditable(node);var oldValue=contentEditable?node.innerText:node.value;var selection;if(value===undefined){value='';}if(oldValue===value){return;}if(document.activeElement===node){selection=updateSelection(getSelection(node),oldValue,value);}if(contentEditable){node.innerText=value;}else{node.value=value;}if(selection){setSelection(node,selection);}}function setSelectValue(node,value){if(value!==undefined){node.value=value;}}function setToggleValue(node,value){var nodeValue=node.value;node.checked=(value===nodeValue)||(!domAttr(node,'value')&&value);}function setTextValue(node,value){node.textContent=value;}function getSelection(node){return isContentEditable(node)?getContentEditableSelection(node):{start:node.selectionStart,end:node.selectionEnd};}function getContentEditableSelection(node){var selection=window.getSelection();var focusNode=selection.focusNode,focusOffset=selection.focusOffset,anchorOffset=selection.anchorOffset;if(!focusNode){throw new Error('not selected');}if(!node.contains(focusNode)){throw new Error('not selected');}return{start:Math.min(focusOffset,anchorOffset),end:Math.max(focusOffset,anchorOffset)};}function setSelection(node,selection){if(isContentEditable(node)){setContentEditableSelection(node,selection);}else{node.selectionStart=selection.start;node.selectionEnd=selection.end;}}function setContentEditableSelection(node,selection){var focusNode,domRange,domSelection;focusNode=node.firstChild||node,domRange=document.createRange();domRange.setStart(focusNode,selection.start);domRange.setEnd(focusNode,selection.end);domSelection=window.getSelection();domSelection.removeAllRanges();domSelection.addRange(domRange);}},{"bpmn-js/lib/util/ModelUtil":197,"lodash/array/flattenDeep":404,"lodash/array/xor":411,"lodash/collection/filter":415,"lodash/collection/forEach":417,"lodash/collection/indexBy":419,"lodash/collection/map":420,"lodash/function/debounce":428,"lodash/lang/isArray":537,"lodash/lang/isEmpty":538,"lodash/object/get":548,"lodash/object/keys":550,"min-dom/lib/attr":561,"min-dom/lib/classes":562,"min-dom/lib/closest":564,"min-dom/lib/delegate":565,"min-dom/lib/domify":566,"min-dom/lib/matches":568,"min-dom/lib/query":569,"min-dom/lib/remove":570,"scroll-tabs":602,"selection-update":603}],6:[function(require,module,exports){'use strict';var domQuery=require('min-dom/lib/query'),domClear=require('min-dom/lib/clear'),is=require('bpmn-js/lib/util/ModelUtil').is,forEach=require('lodash/collection/forEach'),domify=require('min-dom/lib/domify'),Ids=require('ids');var SPACE_REGEX=/\s/;var QNAME_REGEX=/^([a-z][\w-.]*:)?[a-z_][\w-.]*$/i;var ID_REGEX=/^[a-z_][\w-.]*$/i;var PLACEHOLDER_REGEX=/\$\{([^\}]*)\}/g;function selectedOption(selectBox){if(selectBox.selectedIndex>=0){return selectBox.options[selectBox.selectedIndex].value;}}module.exports.selectedOption=selectedOption;function selectedType(elementSyntax,inputNode){var typeSelect=domQuery(elementSyntax,inputNode);return selectedOption(typeSelect);}module.exports.selectedType=selectedType;function getRoot(businessObject){var parent=businessObject;while(parent.$parent){parent=parent.$parent;}return parent;}module.exports.getRoot=getRoot;function filterElementsByType(objectList,type){var list=objectList||[];var result=[];forEach(list,function(obj){if(is(obj,type)){result.push(obj);}});return result;}module.exports.filterElementsByType=filterElementsByType;function findRootElementsByType(businessObject,referencedType){var root=getRoot(businessObject);return filterElementsByType(root.rootElements,referencedType);}module.exports.findRootElementsByType=findRootElementsByType;function removeAllChildren(domElement){while(domElement.firstChild){domElement.removeChild(domElement.firstChild);}}module.exports.removeAllChildren=removeAllChildren;function addEmptyParameter(list){return list.push({'label':'','value':'','name':''});}module.exports.addEmptyParameter=addEmptyParameter;function refreshOptionsModel(businessObject,referencedType){var model=[];var referableObjects=findRootElementsByType(businessObject,referencedType);forEach(referableObjects,function(obj){model.push({label:(obj.name||'')+' (id='+obj.id+')',value:obj.id,name:obj.name});});return model;}module.exports.refreshOptionsModel=refreshOptionsModel;function updateOptionsDropDown(domSelector,businessObject,referencedType,entryNode){var options=refreshOptionsModel(businessObject,referencedType);addEmptyParameter(options);var selectBox=domQuery(domSelector,entryNode);domClear(selectBox);forEach(options,function(option){var optionEntry=domify('<option value="'+option.value+'">'+option.label+'</option>');selectBox.appendChild(optionEntry);});return options;}module.exports.updateOptionsDropDown=updateOptionsDropDown;function isIdValid(bo,idValue){var assigned=bo.$model.ids.assigned(idValue);var idExists=assigned&&assigned!==bo;if(!idValue||idExists){return'元素必须有一个唯一值';}return validateId(idValue);}module.exports.isIdValid=isIdValid;function validateId(idValue){idValue=stripPlaceholders(idValue);if(containsSpace(idValue)){return'Id must not contain spaces.';}if(!ID_REGEX.test(idValue)){if(QNAME_REGEX.test(idValue)){return'Id must not contain prefix.';}return'Id must be a valid QName.';}}module.exports.validateId=validateId;function containsSpace(value){return SPACE_REGEX.test(value);}module.exports.containsSpace=containsSpace;function stripPlaceholders(idValue){return idValue.replace(PLACEHOLDER_REGEX,'$1');}function nextId(prefix){var ids=new Ids([32,32,1]);return ids.nextPrefixed(prefix);}module.exports.nextId=nextId;function triggerClickEvent(element){var evt;var eventType='click';if(document.createEvent){try{evt=new MouseEvent((eventType),{view:window,bubbles:true,cancelable:true});}catch(e){evt=document.createEvent('MouseEvent');evt.initEvent((eventType),true,true);}return element.dispatchEvent(evt);}else{evt=document.createEventObject();return element.fireEvent('on'+eventType,evt);}}module.exports.triggerClickEvent=triggerClickEvent;},{"bpmn-js/lib/util/ModelUtil":197,"ids":396,"lodash/collection/forEach":417,"min-dom/lib/clear":563,"min-dom/lib/domify":566,"min-dom/lib/query":569}],7:[function(require,module,exports){'use strict';var elementHelper=require('../helper/ElementHelper');function CreateAndReferenceElementHandler(elementRegistry,bpmnFactory){this._elementRegistry=elementRegistry;this._bpmnFactory=bpmnFactory;}CreateAndReferenceElementHandler.$inject=['elementRegistry','bpmnFactory'];module.exports=CreateAndReferenceElementHandler;function ensureNotNull(prop,name){if(!prop){throw new Error(name+' required');}return prop;}CreateAndReferenceElementHandler.prototype.execute=function(context){var referencingObject=ensureNotNull(context.referencingObject,'referencingObject'),referenceProperty=ensureNotNull(context.referenceProperty,'referenceProperty'),newObject=ensureNotNull(context.newObject,'newObject'),newObjectContainer=ensureNotNull(context.newObjectContainer,'newObjectContainer'),newObjectParent=ensureNotNull(context.newObjectParent,'newObjectParent'),changed=[context.element];var referencedObject=elementHelper.createElement(newObject.type,newObject.properties,newObjectParent,this._bpmnFactory);context.referencedObject=referencedObject;newObjectContainer.push(referencedObject);context.previousReference=referencingObject[referenceProperty];referencingObject[referenceProperty]=referencedObject;context.changed=changed;return changed;};CreateAndReferenceElementHandler.prototype.revert=function(context){var referencingObject=context.referencingObject,referenceProperty=context.referenceProperty,previousReference=context.previousReference,referencedObject=context.referencedObject,newObjectContainer=context.newObjectContainer;referencingObject.set(referenceProperty,previousReference);newObjectContainer.splice(newObjectContainer.indexOf(referencedObject),1);return context.changed;};},{"../helper/ElementHelper":26}],8:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');var elementHelper=require('../helper/ElementHelper');function CreateBusinessObjectListHandler(elementRegistry,bpmnFactory){this._elementRegistry=elementRegistry;this._bpmnFactory=bpmnFactory;}CreateBusinessObjectListHandler.$inject=['elementRegistry','bpmnFactory'];module.exports=CreateBusinessObjectListHandler;function ensureNotNull(prop,name){if(!prop){throw new Error(name+' required');}return prop;}function ensureList(prop,name){if(!prop||Object.prototype.toString.call(prop)!=='[object Array]'){throw new Error(name+' needs to be a list');}return prop;}CreateBusinessObjectListHandler.prototype.execute=function(context){var currentObject=ensureNotNull(context.currentObject,'currentObject'),propertyName=ensureNotNull(context.propertyName,'propertyName'),newObjects=ensureList(context.newObjects,'newObjects'),changed=[context.element];var childObjects=[];var self=this;forEach(newObjects,function(obj){var element=elementHelper.createElement(obj.type,obj.properties,currentObject,self._bpmnFactory);childObjects.push(element);});context.childObject=childObjects;context.previousChilds=currentObject[propertyName];currentObject[propertyName]=childObjects;context.changed=changed;return changed;};CreateBusinessObjectListHandler.prototype.revert=function(context){var currentObject=context.currentObject,propertyName=context.propertyName,previousChilds=context.previousChilds;currentObject.set(propertyName,previousChilds);return context.changed;};},{"../helper/ElementHelper":26,"lodash/collection/forEach":417}],9:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');function MultiCommandHandler(commandStack){this._commandStack=commandStack;}MultiCommandHandler.$inject=['commandStack'];module.exports=MultiCommandHandler;MultiCommandHandler.prototype.preExecute=function(context){var commandStack=this._commandStack;forEach(context,function(command){commandStack.execute(command.cmd,command.context);});};},{"lodash/collection/forEach":417}],10:[function(require,module,exports){'use strict';var reduce=require('lodash/object/transform'),is=require('bpmn-js/lib/util/ModelUtil').is,keys=require('lodash/object/keys'),forEach=require('lodash/collection/forEach');function UpdateBusinessObjectHandler(elementRegistry){this._elementRegistry=elementRegistry;}UpdateBusinessObjectHandler.$inject=['elementRegistry'];module.exports=UpdateBusinessObjectHandler;function getRoot(businessObject){var parent=businessObject;while(parent.$parent){parent=parent.$parent;}return parent;}function getProperties(businessObject,propertyNames){return reduce(propertyNames,function(result,key){result[key]=businessObject.get(key);return result;},{});}function setProperties(businessObject,properties){forEach(properties,function(value,key){businessObject.set(key,value);});}UpdateBusinessObjectHandler.prototype.execute=function(context){var element=context.element,businessObject=context.businessObject,rootElements=getRoot(businessObject).rootElements,referenceType=context.referenceType,referenceProperty=context.referenceProperty,changed=[element];if(!element){throw new Error('element required');}if(!businessObject){throw new Error('businessObject required');}var properties=context.properties,oldProperties=context.oldProperties||getProperties(businessObject,keys(properties));if(typeof referenceType!=='undefined'&&typeof referenceProperty!=='undefined'){forEach(rootElements,function(rootElement){if(is(rootElement,referenceType)){if(rootElement.id===properties[referenceProperty]){properties[referenceProperty]=rootElement;}}});}setProperties(businessObject,properties);context.oldProperties=oldProperties;context.changed=changed;return changed;};UpdateBusinessObjectHandler.prototype.revert=function(context){var oldProperties=context.oldProperties,businessObject=context.businessObject;setProperties(businessObject,oldProperties);return context.changed;};},{"bpmn-js/lib/util/ModelUtil":197,"lodash/collection/forEach":417,"lodash/object/keys":550,"lodash/object/transform":556}],11:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');function UpdateBusinessObjectListHandler(elementRegistry,bpmnFactory){this._elementRegistry=elementRegistry;this._bpmnFactory=bpmnFactory;}UpdateBusinessObjectListHandler.$inject=['elementRegistry','bpmnFactory'];module.exports=UpdateBusinessObjectListHandler;function ensureNotNull(prop,name){if(!prop){throw new Error(name+'required');}return prop;}UpdateBusinessObjectListHandler.prototype.execute=function(context){var currentObject=ensureNotNull(context.currentObject,'currentObject'),propertyName=ensureNotNull(context.propertyName,'propertyName'),updatedObjectList=context.updatedObjectList,objectsToRemove=context.objectsToRemove||[],objectsToAdd=context.objectsToAdd||[],changed=[context.element],referencePropertyName;if(context.referencePropertyName){referencePropertyName=context.referencePropertyName;}var objectList=currentObject[propertyName];context.previousList=currentObject[propertyName];if(updatedObjectList){currentObject[propertyName]=updatedObjectList;}else{var listCopy=[];forEach(objectList,function(object){if(objectsToRemove.indexOf(object)==-1){listCopy.push(object);}});listCopy=listCopy.concat(objectsToAdd);if(listCopy.length>0||!referencePropertyName){currentObject[propertyName]=listCopy;}else if(referencePropertyName){var parentObject=currentObject.$parent;parentObject.set(referencePropertyName,undefined);}}context.changed=changed;return changed;};UpdateBusinessObjectListHandler.prototype.revert=function(context){var currentObject=context.currentObject,propertyName=context.propertyName,previousList=context.previousList,parentObject=currentObject.$parent;if(context.referencePropertyName){parentObject.set(context.referencePropertyName,currentObject);}currentObject.set(propertyName,previousList);return context.changed;};},{"lodash/collection/forEach":417}],12:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');var HANDLERS={'properties-panel.update-businessobject':require('./UpdateBusinessObjectHandler'),'properties-panel.create-and-reference':require('./CreateAndReferenceHandler'),'properties-panel.create-businessobject-list':require('./CreateBusinessObjectListHandler'),'properties-panel.update-businessobject-list':require('./UpdateBusinessObjectListHandler'),'properties-panel.multi-command-executor':require('./MultiCommandHandler')};function CommandInitializer(eventBus,commandStack){eventBus.on('diagram.init',function(){forEach(HANDLERS,function(handler,id){commandStack.registerHandler(id,handler);});});}CommandInitializer.$inject=['eventBus','commandStack'];module.exports={__init__:[CommandInitializer]};},{"./CreateAndReferenceHandler":7,"./CreateBusinessObjectListHandler":8,"./MultiCommandHandler":9,"./UpdateBusinessObjectHandler":10,"./UpdateBusinessObjectListHandler":11,"lodash/collection/forEach":417}],13:[function(require,module,exports){'use strict';var getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject,cmdHelper=require('../helper/CmdHelper');var entryFieldDescription=require('./EntryFieldDescription');var checkbox=function(options,defaultParameters){var resource=defaultParameters,label=options.label||resource.id,canBeDisabled=!!options.disabled&&typeof options.disabled==='function',canBeHidden=!!options.hidden&&typeof options.hidden==='function',description=options.description;resource.html='<input id="camunda-'+resource.id+'" '+'type="checkbox" '+'name="'+options.modelProperty+'" '+(canBeDisabled?'data-disable="isDisabled"':'')+(canBeHidden?'data-show="isHidden"':'')+' />'+'<label for="camunda-'+resource.id+'" '+(canBeDisabled?'data-disable="isDisabled"':'')+(canBeHidden?'data-show="isHidden"':'')+'>'+label+'</label>';if(description){resource.html+=entryFieldDescription(description);}resource.get=function(element){var bo=getBusinessObject(element),res={};res[options.modelProperty]=bo.get(options.modelProperty);return res;};resource.set=function(element,values){var res={};res[options.modelProperty]=!!values[options.modelProperty];return cmdHelper.updateProperties(element,res);};if(typeof options.set==='function'){resource.set=options.set;}if(typeof options.get==='function'){resource.get=options.get;}if(canBeDisabled){resource.isDisabled=function(){return options.disabled.apply(resource,arguments);};}if(canBeHidden){resource.isHidden=function(){return!options.hidden.apply(resource,arguments);};}resource.cssClasses=['bpp-checkbox'];return resource;};module.exports=checkbox;},{"../helper/CmdHelper":25,"./EntryFieldDescription":16,"bpmn-js/lib/util/ModelUtil":197}],14:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign'),find=require('lodash/collection/find');var domQuery=require('min-dom/lib/query');var selectEntryFactory=require('./SelectEntryFactory'),entryFieldDescription=require('./EntryFieldDescription');var comboBox=function(options){var selectOptions=options.selectOptions,modelProperty=options.modelProperty,customValue=options.customValue||'custom',customName=options.customName||'custom '+modelProperty,description=options.description;var isCustomValue=function(value){if(typeof value[modelProperty]==='undefined'){return false;}var isCustom=!find(selectOptions,function(option){return value[modelProperty]===option.value;});return isCustom;};var comboOptions=assign({},options);comboOptions.showCustomInput=function(element,node){var selectBox=domQuery('[data-entry="'+options.id+'"] select',node.parentNode);if(selectBox){return selectBox.value===customValue;}return false;};comboOptions.get=function(element,node){var value=options.get(element,node);var modifiedValues={};if(!isCustomValue(value)){modifiedValues[modelProperty]=value[modelProperty]||'';return modifiedValues;}modifiedValues[modelProperty]=customValue;modifiedValues['custom-'+modelProperty]=value[modelProperty];return modifiedValues;};comboOptions.set=function(element,values,node){var modifiedValues={};if(values[modelProperty]===customValue){modifiedValues[modelProperty]=values['custom-'+modelProperty]||'';}else if(options.emptyParameter&&values[modelProperty]===''){modifiedValues[modelProperty]=undefined;}else{modifiedValues[modelProperty]=values[modelProperty];}return options.set(element,modifiedValues,node);};comboOptions.selectOptions.push({name:customName,value:customValue});var comboBoxEntry=assign({},selectEntryFactory(comboOptions,comboOptions));comboBoxEntry.html+='<div class="bpp-field-wrapper bpp-combo-input" '+'data-show="showCustomInput"'+'>'+'<input id="camunda-'+options.id+'-input" type="text" name="custom-'+modelProperty+'" '+' />'+'</div>';if(description){comboBoxEntry.html+=entryFieldDescription(description);}return comboBoxEntry;};module.exports=comboBox;},{"./EntryFieldDescription":16,"./SelectEntryFactory":19,"lodash/collection/find":416,"lodash/object/assign":547,"min-dom/lib/query":569}],15:[function(require,module,exports){'use strict';var getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject;var textInputField=require('./TextInputEntryFactory'),checkboxField=require('./CheckboxEntryFactory'),selectBoxField=require('./SelectEntryFactory'),comboBoxField=require('./ComboEntryFactory'),textBoxField=require('./TextBoxEntryFactory'),validationAwareTextInputField=require('./ValidationAwareTextInput'),tableField=require('./TableEntryFactory'),labelEntry=require('./LabelFactory'),link=require('./LinkEntryFactory');var cmdHelper=require('../helper/CmdHelper');function ensureNotNull(prop){if(!prop){throw new Error(prop+' must be set.');}return prop;}var setDefaultParameters=function(options){var defaultGet=function(element){var bo=getBusinessObject(element),res={},prop=ensureNotNull(options.modelProperty);res[prop]=bo.get(prop);return res;};var defaultSet=function(element,values){var res={},prop=ensureNotNull(options.modelProperty);if(values[prop]!==''){res[prop]=values[prop];}else{res[prop]=undefined;}return cmdHelper.updateProperties(element,res);};var defaultValidate=function(){return{};};return{id:options.id,description:(options.description||''),get:(options.get||defaultGet),set:(options.set||defaultSet),validate:(options.validate||defaultValidate),html:''};};function EntryFactory(){}EntryFactory.textField=function(options){return textInputField(options,setDefaultParameters(options));};EntryFactory.validationAwareTextField=function(options){return validationAwareTextInputField(options,setDefaultParameters(options));};EntryFactory.checkbox=function(options){return checkboxField(options,setDefaultParameters(options));};EntryFactory.textBox=function(options){return textBoxField(options,setDefaultParameters(options));};EntryFactory.selectBox=function(options){return selectBoxField(options,setDefaultParameters(options));};EntryFactory.comboBox=function(options){return comboBoxField(options);};EntryFactory.table=function(options){return tableField(options);};EntryFactory.label=function(options){return labelEntry(options);};EntryFactory.link=function(options){return link(options);};module.exports=EntryFactory;},{"../helper/CmdHelper":25,"./CheckboxEntryFactory":13,"./ComboEntryFactory":14,"./LabelFactory":17,"./LinkEntryFactory":18,"./SelectEntryFactory":19,"./TableEntryFactory":20,"./TextBoxEntryFactory":21,"./TextInputEntryFactory":22,"./ValidationAwareTextInput":23,"bpmn-js/lib/util/ModelUtil":197}],16:[function(require,module,exports){'use strict';var MARKDOWN_LINK_REGEX=/\[([^\)]+)\]\(([^\]]+)\)/g;function linkify(text){return text.replace(MARKDOWN_LINK_REGEX,'<a href="$2" target="_blank">$1</a>');}module.exports=function entryFieldDescription(description){description=linkify(description);return'<div class="bpp-field-description">'+description+'</div>';};},{}],17:[function(require,module,exports){'use strict';var label=function(options){return{id:options.id,html:'<label data-value="label" '+'data-show="showLabel" '+'class="entry-label'+(options.divider?' divider':'')+'">'+'</label>',get:function(element,node){if(typeof options.get==='function'){return options.get(element,node);}return{label:options.labelText};},showLabel:function(element,node){if(typeof options.showLabel==='function'){return options.showLabel(element,node);}return true;}};};module.exports=label;},{}],18:[function(require,module,exports){'use strict';var utils=require('../Utils');var entryFieldDescription=require('./EntryFieldDescription');var link=function(options,defaultParameters){var id=options.id,label=options.label||id,hideLink=options.hideLink,canBeHidden=typeof hideLink==='function',getClickableElement=options.getClickableElement,description=options.description;var resource={id:id};resource.html='<a data-action="linkSelected" '+(canBeHidden?'data-show="hideLink" ':'')+'class="bpp-entry-link'+(options.cssClasses?' '+options.cssClasses:'')+'">'+label+'</a>';if(description){resource.html+=entryFieldDescription(description);}resource.linkSelected=function(element,node,event,scopeNode){if(typeof getClickableElement==='function'){var link=getClickableElement.apply(resource,[element,node,event,scopeNode]);link&&utils.triggerClickEvent(link);}return false;};if(canBeHidden){resource.hideLink=function(){return!hideLink.apply(resource,arguments);};}return resource;};module.exports=link;},{"../Utils":6,"./EntryFieldDescription":16}],19:[function(require,module,exports){'use strict';var domify=require('min-dom/lib/domify');var forEach=require('lodash/collection/forEach');var entryFieldDescription=require('./EntryFieldDescription');var isList=function(list){return!(!list||Object.prototype.toString.call(list)!=='[object Array]');};var addEmptyParameter=function(list){return list.concat([{name:'',value:''}]);};var createOption=function(option){return'<option value="'+option.value+'">'+option.name+'</option>';};var selectbox=function(options,defaultParameters){var resource=defaultParameters,label=options.label||resource.id,selectOptions=options.selectOptions||[{name:'',value:''}],modelProperty=options.modelProperty,emptyParameter=options.emptyParameter,canBeDisabled=!!options.disabled&&typeof options.disabled==='function',canBeHidden=!!options.hidden&&typeof options.hidden==='function',description=options.description;if(emptyParameter){selectOptions=addEmptyParameter(selectOptions);}resource.html='<label for="camunda-'+resource.id+'"'+(canBeDisabled?'data-disable="isDisabled" ':'')+(canBeHidden?'data-show="isHidden" ':'')+'>'+label+'</label>'+'<select id="camunda-'+resource.id+'-select" name="'+modelProperty+'"'+(canBeDisabled?'data-disable="isDisabled" ':'')+(canBeHidden?'data-show="isHidden" ':'')+' data-value>';if(isList(selectOptions)){forEach(selectOptions,function(option){resource.html+='<option value="'+option.value+'">'+(option.name||'')+'</option>';});}resource.html+='</select>';if(description&&!typeof options.showCustomInput==='function'){resource.html+=entryFieldDescription(description);}resource.setControlValue=function(element,entryNode,inputNode,inputName,newValue){if(typeof selectOptions==='function'){var options=selectOptions(element,inputNode);if(options){while(inputNode.firstChild){inputNode.removeChild(inputNode.firstChild);}forEach(options,function(option){var template=domify(createOption(option));inputNode.appendChild(template);});}}if(newValue!==undefined){inputNode.value=newValue;}};if(canBeDisabled){resource.isDisabled=function(){return options.disabled.apply(resource,arguments);};}if(canBeHidden){resource.isHidden=function(){return!options.hidden.apply(resource,arguments);};}resource.cssClasses=['dropdown'];return resource;};module.exports=selectbox;},{"./EntryFieldDescription":16,"lodash/collection/forEach":417,"min-dom/lib/domify":566}],20:[function(require,module,exports){'use strict';var cmdHelper=require('../helper/CmdHelper');var domQuery=require('min-dom/lib/query'),domAttr=require('min-dom/lib/attr'),domClosest=require('min-dom/lib/closest');var filter=require('lodash/collection/filter'),forEach=require('lodash/collection/forEach'),keys=require('lodash/object/keys');var domify=require('min-dom/lib/domify');var entryFieldDescription=require('./EntryFieldDescription');var updateSelection=require('selection-update');var TABLE_ROW_DIV_SNIPPET='<div class="bpp-field-wrapper bpp-table-row">';var DELETE_ROW_BUTTON_SNIPPET='<button class="clear" data-action="deleteElement">'+'<span>X</span>'+'</button>';function createInputRowTemplate(properties,canRemove){var template=TABLE_ROW_DIV_SNIPPET;template+=createInputTemplate(properties,canRemove);template+=canRemove?DELETE_ROW_BUTTON_SNIPPET:'';template+='</div>';return template;}function createInputTemplate(properties,canRemove){var columns=properties.length;var template='';forEach(properties,function(prop){template+='<input class="bpp-table-row-columns-'+columns+' '+(canRemove?'bpp-table-row-removable':'')+'" '+'id="camunda-table-row-cell-input-value" '+'type="text" '+'name="'+prop+'" />';});return template;}function createLabelRowTemplate(labels){var template=TABLE_ROW_DIV_SNIPPET;template+=createLabelTemplate(labels);template+='</div>';return template;}function createLabelTemplate(labels){var columns=labels.length;var template='';forEach(labels,function(label){template+='<label class="bpp-table-row-columns-'+columns+'">'+label+'</label>';});return template;}function pick(elements,properties){return(elements||[]).map(function(elem){var newElement={};forEach(properties,function(prop){newElement[prop]=elem[prop]||'';});return newElement;});}function diff(element,node,values,oldValues,editable){return filter(values,function(value,idx){return!valueEqual(element,node,value,oldValues[idx],editable,idx);});}function valueEqual(element,node,value,oldValue,editable,idx){if(value&&!oldValue){return false;}var allKeys=keys(value).concat(keys(oldValue));return allKeys.every(function(key){var n=value[key]||undefined;var o=oldValue[key]||undefined;return!editable(element,node,key,idx)||n===o;});}function getEntryNode(node){return domClosest(node,'[data-entry]',true);}function getContainer(node){return domQuery('div[data-list-entry-container]',node);}function getSelection(node){return{start:node.selectionStart,end:node.selectionEnd};}function setSelection(node,selection){node.selectionStart=selection.start;node.selectionEnd=selection.end;}module.exports=function(options){var id=options.id,modelProperties=options.modelProperties,labels=options.labels,description=options.description;var labelRow=createLabelRowTemplate(labels);var getElements=options.getElements;var removeElement=options.removeElement,canRemove=typeof removeElement==='function';var addElement=options.addElement,canAdd=typeof addElement==='function',addLabel=options.addLabel||'Add Value';var updateElement=options.updateElement,canUpdate=typeof updateElement==='function';var editable=options.editable||function(){return true;},setControlValue=options.setControlValue;var show=options.show,canBeShown=typeof show==='function';var elements=function(element,node){return pick(getElements(element,node),modelProperties);};var factory={id:id,html:(canAdd?'<div class="bpp-table-add-row" '+(canBeShown?'data-show="show"':'')+'>'+'<label>'+addLabel+'</label>'+'<button class="add" data-action="addElement"><span>+</span></button>'+'</div>':'')+'<div class="bpp-table" data-show="showTable">'+'<div class="bpp-field-wrapper bpp-table-row">'+labelRow+'</div>'+'<div data-list-entry-container>'+'</div>'+'</div>'+(description?entryFieldDescription(description):''),get:function(element,node){var boElements=elements(element,node,this.__invalidValues);var invalidValues=this.__invalidValues;delete this.__invalidValues;forEach(invalidValues,function(value,idx){var element=boElements[idx];forEach(modelProperties,function(prop){element[prop]=value[prop];});});return boElements;},set:function(element,values,node){var action=this.__action||{};delete this.__action;if(action.id==='delete-element'){return removeElement(element,node,action.idx);}else if(action.id==='add-element'){return addElement(element,node);}else if(canUpdate){var commands=[],valuesToValidate=values;if(typeof options.validate!=='function'){valuesToValidate=diff(element,node,values,elements(element,node),editable);}var self=this;forEach(valuesToValidate,function(value){var validationError,idx=values.indexOf(value);if(typeof options.validate==='function'){validationError=options.validate(element,value,node,idx);}if(!validationError){var cmd=updateElement(element,value,node,idx);if(cmd){commands.push(cmd);}}else{self.__invalidValues=self.__invalidValues||{};self.__invalidValues[idx]=value;commands.push(cmdHelper.updateProperties(element,{}));}});return commands;}},createListEntryTemplate:function(value,index,selectBox){return createInputRowTemplate(modelProperties,canRemove);},addElement:function(element,node,event,scopeNode){var template=domify(createInputRowTemplate(modelProperties,canRemove));var container=getContainer(node);container.appendChild(template);this.__action={id:'add-element'};return true;},deleteElement:function(element,node,event,scopeNode){var container=getContainer(node);var rowToDelete=event.delegateTarget.parentNode;var idx=parseInt(domAttr(rowToDelete,'data-index'),10);container.removeChild(rowToDelete);this.__action={id:'delete-element',idx:idx};return true;},editable:function(element,rowNode,input,prop,value,idx){var entryNode=domClosest(rowNode,'[data-entry]');return editable(element,entryNode,prop,idx);},show:function(element,entryNode,node,scopeNode){entryNode=getEntryNode(entryNode);return show(element,entryNode,node,scopeNode);},showTable:function(element,entryNode,node,scopeNode){entryNode=getEntryNode(entryNode);var elems=elements(element,entryNode);return elems&&elems.length&&(!canBeShown||show(element,entryNode,node,scopeNode));},validateListItem:function(element,value,node,idx){if(typeof options.validate==='function'){return options.validate(element,value,node,idx);}}};if(setControlValue){factory.setControlValue=function(element,rowNode,input,prop,value,idx){var entryNode=getEntryNode(rowNode);var isReadOnly=domAttr(input,'readonly');var oldValue=input.value;var selection;if(value===undefined){value='';}if(!!isReadOnly&&oldValue===value){return;}if(document.activeElement===input){selection=updateSelection(getSelection(input),oldValue,value);}setControlValue(element,entryNode,input,prop,value,idx);if(selection){setSelection(input,selection);}};}return factory;};},{"../helper/CmdHelper":25,"./EntryFieldDescription":16,"lodash/collection/filter":415,"lodash/collection/forEach":417,"lodash/object/keys":550,"min-dom/lib/attr":561,"min-dom/lib/closest":564,"min-dom/lib/domify":566,"min-dom/lib/query":569,"selection-update":603}],21:[function(require,module,exports){'use strict';var entryFieldDescription=require('./EntryFieldDescription');var textBox=function(options,defaultParameters){var resource=defaultParameters,label=options.label||resource.id,canBeShown=!!options.show&&typeof options.show==='function',description=options.description;resource.html='<label for="acamunda-'+resource.id+'" '+(canBeShown?'data-show="isShown"':'')+'>'+label+'</label>'+'<div class="bpp-field-wrapper" '+(canBeShown?'data-show="isShown"':'')+'>'+'<div contenteditable="true" id="camunda-'+resource.id+'" '+'name="'+options.modelProperty+'" />'+'</div>';if(description){resource.html+=entryFieldDescription(description);}if(canBeShown){resource.isShown=function(){return options.show.apply(resource,arguments);};}resource.cssClasses=['bpp-textbox'];return resource;};module.exports=textBox;},{"./EntryFieldDescription":16}],22:[function(require,module,exports){'use strict';var domQuery=require('min-dom/lib/query');var entryFieldDescription=require('./EntryFieldDescription');var textField=function(options,defaultParameters){var defaultButtonAction=function(element,inputNode){var input=domQuery('input[name="'+options.modelProperty+'"]',inputNode);input.value='';return true;};var defaultButtonShow=function(element,inputNode){var input=domQuery('input[name="'+options.modelProperty+'"]',inputNode);return input.value!=='';};var resource=defaultParameters,label=options.label||resource.id,dataValueLabel=options.dataValueLabel,buttonLabel=(options.buttonLabel||'X'),actionName=(typeof options.buttonAction!='undefined')?options.buttonAction.name:'clear',actionMethod=(typeof options.buttonAction!='undefined')?options.buttonAction.method:defaultButtonAction,showName=(typeof options.buttonShow!='undefined')?options.buttonShow.name:'canClear',showMethod=(typeof options.buttonShow!='undefined')?options.buttonShow.method:defaultButtonShow,canBeDisabled=!!options.disabled&&typeof options.disabled==='function',canBeHidden=!!options.hidden&&typeof options.hidden==='function',description=options.description;var aljoin_it='<input id="camunda-'+resource.id+'" type="text" name="'+options.modelProperty+'" ';if(resource.id=="assignee"||resource.id=="candidateUsers"||resource.id=="candidateGroups"||resource.id=="assigneeDepartment"||resource.id=="assigneePosition"){aljoin_it='<textarea id="camunda-'+resource.id+'" type="text" name="'+options.modelProperty+'" ';}resource.html='<label for="camunda-'+resource.id+'" '+(canBeDisabled?'data-disable="isDisabled" ':'')+(canBeHidden?'data-show="isHidden" ':'')+(dataValueLabel?'data-value="'+dataValueLabel+'"':'')+'>'+label+'</label>'+'<div class="bpp-field-wrapper" '+(canBeDisabled?'data-disable="isDisabled"':'')+(canBeHidden?'data-show="isHidden"':'')+'>'+aljoin_it+' />'+'<button class="'+actionName+'" data-action="'+actionName+'" data-show="'+showName+'" '+(canBeDisabled?'data-disabled="isDisabled"':'')+(canBeHidden?' data-show="isHidden"':'')+'>'+'<span>'+buttonLabel+'</span>'+'</button>'+'</div>';if(description){resource.html+=entryFieldDescription(description);}resource[actionName]=actionMethod;resource[showName]=showMethod;if(canBeDisabled){resource.isDisabled=function(){return options.disabled.apply(resource,arguments);};}if(canBeHidden){resource.isHidden=function(){return!options.hidden.apply(resource,arguments);};}resource.cssClasses=['bpp-textfield'];return resource;};module.exports=textField;},{"./EntryFieldDescription":16,"min-dom/lib/query":569}],23:[function(require,module,exports){'use strict';var textField=require('./TextInputEntryFactory');var validationAwareTextField=function(options,defaultParameters){var modelProperty=options.modelProperty;defaultParameters.get=function(element,node){var value=this.__lastInvalidValue;delete this.__lastInvalidValue;var properties={};properties[modelProperty]=value!==undefined?value:options.getProperty(element,node);return properties;};defaultParameters.set=function(element,values,node){var validationErrors=validate.apply(this,[element,values,node]),propertyValue=values[modelProperty];if(validationErrors&&validationErrors[modelProperty]){this.__lastInvalidValue=propertyValue;return options.setProperty(element,{},node);}else{var properties={};properties[modelProperty]=propertyValue;return options.setProperty(element,properties,node);}};var validate=defaultParameters.validate=function(element,values,node){var value=values[modelProperty]||this.__lastInvalidValue;var property={};property[modelProperty]=value;return options.validate(element,property,node);};return textField(options,defaultParameters);};module.exports=validationAwareTextField;},{"./TextInputEntryFactory":22}],24:[function(require,module,exports){'use strict';var map=require('lodash/collection/map');var extensionElementsHelper=require('./ExtensionElementsHelper');function isAsyncBefore(bo){return!!(bo.get('camunda:asyncBefore')||bo.get('camunda:async'));}module.exports.isAsyncBefore=isAsyncBefore;function isAsyncAfter(bo){return!!bo.get('camunda:asyncAfter');}module.exports.isAsyncAfter=isAsyncAfter;function isExclusive(bo){return!!bo.get('camunda:exclusive');}module.exports.isExclusive=isExclusive;function getFailedJobRetryTimeCycle(bo){return(extensionElementsHelper.getExtensionElements(bo,'camunda:FailedJobRetryTimeCycle')||[])[0];}module.exports.getFailedJobRetryTimeCycle=getFailedJobRetryTimeCycle;function removeFailedJobRetryTimeCycle(bo,element){var retryTimeCycles=extensionElementsHelper.getExtensionElements(bo,'camunda:FailedJobRetryTimeCycle');return map(retryTimeCycles,function(cycle){return extensionElementsHelper.removeEntry(bo,element,cycle);});}module.exports.removeFailedJobRetryTimeCycle=removeFailedJobRetryTimeCycle;},{"./ExtensionElementsHelper":28,"lodash/collection/map":420}],25:[function(require,module,exports){'use strict';var CmdHelper={};module.exports=CmdHelper;CmdHelper.updateProperties=function(element,properties){return{cmd:'element.updateProperties',context:{element:element,properties:properties}};};CmdHelper.updateBusinessObject=function(element,businessObject,newProperties){return{cmd:'properties-panel.update-businessobject',context:{element:element,businessObject:businessObject,properties:newProperties}};};CmdHelper.addElementsTolist=function(element,businessObject,listPropertyName,objectsToAdd){return{cmd:'properties-panel.update-businessobject-list',context:{element:element,currentObject:businessObject,propertyName:listPropertyName,objectsToAdd:objectsToAdd}};};CmdHelper.removeElementsFromList=function(element,businessObject,listPropertyName,referencePropertyName,objectsToRemove){return{cmd:'properties-panel.update-businessobject-list',context:{element:element,currentObject:businessObject,propertyName:listPropertyName,referencePropertyName:referencePropertyName,objectsToRemove:objectsToRemove}};};CmdHelper.addAndRemoveElementsFromList=function(element,businessObject,listPropertyName,referencePropertyName,objectsToAdd,objectsToRemove){return{cmd:'properties-panel.update-businessobject-list',context:{element:element,currentObject:businessObject,propertyName:listPropertyName,referencePropertyName:referencePropertyName,objectsToAdd:objectsToAdd,objectsToRemove:objectsToRemove}};};CmdHelper.setList=function(element,businessObject,listPropertyName,updatedObjectList){return{cmd:'properties-panel.update-businessobject-list',context:{element:element,currentObject:businessObject,propertyName:listPropertyName,updatedObjectList:updatedObjectList}};};},{}],26:[function(require,module,exports){'use strict';var ElementHelper={};module.exports=ElementHelper;ElementHelper.createElement=function(elementType,properties,parent,factory){var element=factory.create(elementType,properties);element.$parent=parent;return element;};},{}],27:[function(require,module,exports){'use strict';var getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject,is=require('bpmn-js/lib/util/ModelUtil').is,forEach=require('lodash/collection/forEach');var EventDefinitionHelper={};module.exports=EventDefinitionHelper;EventDefinitionHelper.getEventDefinition=function(element,eventType){var bo=getBusinessObject(element),eventDefinition=null;if(bo.eventDefinitions){forEach(bo.eventDefinitions,function(event){if(is(event,eventType)){eventDefinition=event;}});}return eventDefinition;};EventDefinitionHelper.getTimerEventDefinition=function(element){return this.getEventDefinition(element,'bpmn:TimerEventDefinition');};EventDefinitionHelper.getMessageEventDefinition=function(element){return this.getEventDefinition(element,'bpmn:MessageEventDefinition');};EventDefinitionHelper.getSignalEventDefinition=function(element){return this.getEventDefinition(element,'bpmn:SignalEventDefinition');};EventDefinitionHelper.getErrorEventDefinition=function(element){return this.getEventDefinition(element,'bpmn:ErrorEventDefinition');};EventDefinitionHelper.getEscalationEventDefinition=function(element){return this.getEventDefinition(element,'bpmn:EscalationEventDefinition');};EventDefinitionHelper.getCompensateEventDefinition=function(element){return this.getEventDefinition(element,'bpmn:CompensateEventDefinition');};EventDefinitionHelper.getLinkEventDefinition=function(element){return this.getEventDefinition(element,'bpmn:LinkEventDefinition');};EventDefinitionHelper.getConditionalEventDefinition=function(element){return this.getEventDefinition(element,'bpmn:ConditionalEventDefinition');};},{"bpmn-js/lib/util/ModelUtil":197,"lodash/collection/forEach":417}],28:[function(require,module,exports){'use strict';var cmdHelper=require('./CmdHelper'),elementHelper=require('./ElementHelper');var is=require('bpmn-js/lib/util/ModelUtil').is;var ExtensionElementsHelper={};var getExtensionElements=function(bo){return bo.get('extensionElements');};ExtensionElementsHelper.getExtensionElements=function(bo,type){var extensionElements=getExtensionElements(bo);if(typeof extensionElements!=='undefined'){var extensionValues=extensionElements.get('values');if(typeof extensionValues!=='undefined'){var elements=extensionValues.filter(function(value){return is(value,type);});if(elements.length){return elements;}}}};ExtensionElementsHelper.addEntry=function(bo,element,entry,bpmnFactory){var extensionElements=bo.get('extensionElements');if(!extensionElements){extensionElements=elementHelper.createElement('bpmn:ExtensionElements',{values:[entry]},bo,bpmnFactory);return{extensionElements:extensionElements};}else{return cmdHelper.addElementsTolist(element,extensionElements,'values',[entry]);}};ExtensionElementsHelper.removeEntry=function(bo,element,entry){var extensionElements=bo.get('extensionElements');if(!extensionElements){return{};}return cmdHelper.removeElementsFromList(element,extensionElements,'values','extensionElements',[entry]);};module.exports=ExtensionElementsHelper;},{"./CmdHelper":25,"./ElementHelper":26,"bpmn-js/lib/util/ModelUtil":197}],29:[function(require,module,exports){'use strict';var getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject,getExtensionElements=require('./ExtensionElementsHelper').getExtensionElements;var FormHelper={};module.exports=FormHelper;FormHelper.getFormFields=function(element){var bo=getBusinessObject(element),formData=getExtensionElements(bo,'camunda:FormData');if(typeof formData!=='undefined'){return formData[0].fields;}else{return[];}};FormHelper.getFormField=function(element,idx){var formFields=this.getFormFields(element);return formFields[idx];};FormHelper.getConstraints=function(formField){if(formField&&formField.validation&&formField.validation.constraints){return formField.validation.constraints;}return[];};FormHelper.getEnumValues=function(formField){if(formField&&formField.values){return formField.values;}return[];};},{"./ExtensionElementsHelper":28,"bpmn-js/lib/util/ModelUtil":197}],30:[function(require,module,exports){'use strict';var ModelUtil=require('bpmn-js/lib/util/ModelUtil'),is=ModelUtil.is,getBusinessObject=ModelUtil.getBusinessObject;var eventDefinitionHelper=require('./EventDefinitionHelper');var extensionsElementHelper=require('./ExtensionElementsHelper');var ImplementationTypeHelper={};module.exports=ImplementationTypeHelper;ImplementationTypeHelper.isServiceTaskLike=function(element){return is(element,'camunda:ServiceTaskLike');};ImplementationTypeHelper.isDmnCapable=function(element){return is(element,'camunda:DmnCapable');};ImplementationTypeHelper.isExternalCapable=function(element){return is(element,'camunda:ExternalCapable');};ImplementationTypeHelper.isTaskListener=function(element){return is(element,'camunda:TaskListener');};ImplementationTypeHelper.isExecutionListener=function(element){return is(element,'camunda:ExecutionListener');};ImplementationTypeHelper.isListener=function(element){return this.isTaskListener(element)||this.isExecutionListener(element);};ImplementationTypeHelper.isSequenceFlow=function(element){return is(element,'bpmn:SequenceFlow');};ImplementationTypeHelper.getServiceTaskLikeBusinessObject=function(element){if(is(element,'bpmn:IntermediateThrowEvent')||is(element,'bpmn:EndEvent')){var messageEventDefinition=eventDefinitionHelper.getMessageEventDefinition(element);if(messageEventDefinition){element=messageEventDefinition;}}return this.isServiceTaskLike(element)&&getBusinessObject(element);};ImplementationTypeHelper.getImplementationType=function(element){var bo=this.getServiceTaskLikeBusinessObject(element);if(!bo){if(this.isListener(element)){bo=element;}else{return;}}if(this.isDmnCapable(bo)){var decisionRef=bo.get('camunda:decisionRef');if(typeof decisionRef!=='undefined'){return'dmn';}}if(this.isServiceTaskLike(bo)){var connectors=extensionsElementHelper.getExtensionElements(bo,'camunda:Connector');if(typeof connectors!=='undefined'){return'connector';}}if(this.isExternalCapable(bo)){var type=bo.get('camunda:type');if(type==='external'){return'external';}}var cls=bo.get('camunda:class');if(typeof cls!=='undefined'){return'class';}var expression=bo.get('camunda:expression');if(typeof expression!=='undefined'){return'expression';}var delegateExpression=bo.get('camunda:delegateExpression');if(typeof delegateExpression!=='undefined'){return'delegateExpression';}if(this.isListener(bo)){var script=bo.get('script');if(typeof script!=='undefined'){return'script';}}};},{"./EventDefinitionHelper":27,"./ExtensionElementsHelper":28,"bpmn-js/lib/util/ModelUtil":197}],31:[function(require,module,exports){'use strict';var ModelUtil=require('bpmn-js/lib/util/ModelUtil'),is=ModelUtil.is,getBusinessObject=ModelUtil.getBusinessObject;var extensionElementsHelper=require('./ExtensionElementsHelper'),implementationTypeHelper=require('./ImplementationTypeHelper');var InputOutputHelper={};module.exports=InputOutputHelper;function getElements(bo,type,prop){var elems=extensionElementsHelper.getExtensionElements(bo,type)||[];return!prop?elems:(elems[0]||{})[prop]||[];}function getParameters(element,prop,insideConnector){var inputOutput=InputOutputHelper.getInputOutput(element,insideConnector);return(inputOutput&&inputOutput.get(prop))||[];}InputOutputHelper.getInputOutput=function(element,insideConnector){if(!insideConnector){var bo=getBusinessObject(element);return(getElements(bo,'camunda:InputOutput')||[])[0];}var connector=this.getConnector(element);return connector&&connector.get('inputOutput');};InputOutputHelper.getConnector=function(element){var bo=implementationTypeHelper.getServiceTaskLikeBusinessObject(element);return bo&&(getElements(bo,'camunda:Connector')||[])[0];};InputOutputHelper.getInputParameters=function(element,insideConnector){return getParameters.apply(this,[element,'inputParameters',insideConnector]);};InputOutputHelper.getOutputParameters=function(element,insideConnector){return getParameters.apply(this,[element,'outputParameters',insideConnector]);};InputOutputHelper.getInputParameter=function(element,insideConnector,idx){return this.getInputParameters(element,insideConnector)[idx];};InputOutputHelper.getOutputParameter=function(element,insideConnector,idx){return this.getOutputParameters(element,insideConnector)[idx];};InputOutputHelper.isInputOutputSupported=function(element,insideConnector){var bo=getBusinessObject(element);return insideConnector||(is(bo,'bpmn:FlowNode')&&!is(bo,'bpmn:StartEvent')&&!is(bo,'bpmn:BoundaryEvent')&&!(is(bo,'bpmn:SubProcess')&&bo.get('triggeredByEvent')));};InputOutputHelper.areOutputParametersSupported=function(element,insideConnector){var bo=getBusinessObject(element);return insideConnector||(!is(bo,'bpmn:EndEvent')&&!bo.loopCharacteristics);};},{"./ExtensionElementsHelper":28,"./ImplementationTypeHelper":30,"bpmn-js/lib/util/ModelUtil":197}],32:[function(require,module,exports){'use strict';var is=require('bpmn-js/lib/util/ModelUtil').is,getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject,cmdHelper=require('./CmdHelper');var ParticipantHelper={};module.exports=ParticipantHelper;ParticipantHelper.modifyProcessBusinessObject=function(element,property,values){if(!is(element,'bpmn:Participant')){return{};}var bo=getBusinessObject(element).get('processRef'),properties={};properties[property]=values[property];return cmdHelper.updateBusinessObject(element,bo,properties);};ParticipantHelper.getProcessBusinessObject=function(element,propertyName){if(!is(element,'bpmn:Participant')){return{};}var bo=getBusinessObject(element).get('processRef'),properties={};properties[propertyName]=bo.get(propertyName);return properties;};},{"./CmdHelper":25,"bpmn-js/lib/util/ModelUtil":197}],33:[function(require,module,exports){module.exports={__depends__:[require('./cmd')],__init__:['propertiesPanel'],propertiesPanel:['type',require('./PropertiesPanel')]};},{"./PropertiesPanel":5,"./cmd":12}],34:[function(require,module,exports){'use strict';var entryFactory=require('../../../factory/EntryFactory'),cmdHelper=require('../../../helper/CmdHelper');var ModelUtil=require('bpmn-js/lib/util/ModelUtil'),is=ModelUtil.is,getBusinessObject=ModelUtil.getBusinessObject;module.exports=function(group,element,bpmnFactory){var getValue=function(businessObject){return function(element){var documentations=businessObject&&businessObject.get('documentation'),text=(documentations&&documentations.length>0)?documentations[0].text:'';return{documentation:text};};};var setValue=function(businessObject){return function(element,values){var newObjectList=[];if(typeof values.documentation!=='undefined'&&values.documentation!==''){newObjectList.push(bpmnFactory.create('bpmn:Documentation',{text:values.documentation}));}return cmdHelper.setList(element,businessObject,'documentation',newObjectList);};};var elementDocuEntry=entryFactory.textBox({id:'documentation',label:'Element Documentation',modelProperty:'documentation'});elementDocuEntry.set=setValue(getBusinessObject(element));elementDocuEntry.get=getValue(getBusinessObject(element));group.entries.push(elementDocuEntry);var processRef;if(is(element,'bpmn:Participant')){processRef=getBusinessObject(element).processRef;if(processRef){var processDocuEntry=entryFactory.textBox({id:'process-documentation',label:'Process Documentation',modelProperty:'documentation'});processDocuEntry.set=setValue(processRef);processDocuEntry.get=getValue(processRef);group.entries.push(processDocuEntry);}}};},{"../../../factory/EntryFactory":15,"../../../helper/CmdHelper":25,"bpmn-js/lib/util/ModelUtil":197}],35:[function(require,module,exports){'use strict';var is=require('bpmn-js/lib/util/ModelUtil').is,isAny=require('bpmn-js/lib/features/modeling/util/ModelingUtil').isAny,isEventSubProcess=require('bpmn-js/lib/util/DiUtil').isEventSubProcess,getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject,eventDefinitionHelper=require('../../../helper/EventDefinitionHelper');var forEach=require('lodash/collection/forEach');var message=require('./implementation/MessageEventDefinition'),signal=require('./implementation/SignalEventDefinition'),error=require('./implementation/ErrorEventDefinition'),escalation=require('./implementation/EscalationEventDefinition'),timer=require('./implementation/TimerEventDefinition'),compensation=require('./implementation/CompensateEventDefinition'),condition=require('./implementation/ConditionalEventDefinition');module.exports=function(group,element,bpmnFactory,elementRegistry){var events=['bpmn:StartEvent','bpmn:EndEvent','bpmn:IntermediateThrowEvent','bpmn:BoundaryEvent','bpmn:IntermediateCatchEvent'];forEach(events,function(event){if(is(element,event)){var messageEventDefinition=eventDefinitionHelper.getMessageEventDefinition(element),signalEventDefinition=eventDefinitionHelper.getSignalEventDefinition(element);if(messageEventDefinition){message(group,element,bpmnFactory,messageEventDefinition);}if(signalEventDefinition){signal(group,element,bpmnFactory,signalEventDefinition);}}});if(is(element,'bpmn:ReceiveTask')){message(group,element,bpmnFactory,getBusinessObject(element));}var errorEvents=['bpmn:StartEvent','bpmn:BoundaryEvent','bpmn:EndEvent'];forEach(errorEvents,function(event){if(is(element,event)){var errorEventDefinition=eventDefinitionHelper.getErrorEventDefinition(element);if(errorEventDefinition){var isCatchingErrorEvent=is(element,'bpmn:StartEvent')||is(element,'bpmn:BoundaryEvent');var showErrorCodeVariable=isCatchingErrorEvent,showErrorMessageVariable=isCatchingErrorEvent;error(group,element,bpmnFactory,errorEventDefinition,showErrorCodeVariable,showErrorMessageVariable);}}});var escalationEvents=['bpmn:StartEvent','bpmn:BoundaryEvent','bpmn:IntermediateThrowEvent','bpmn:EndEvent'];forEach(escalationEvents,function(event){if(is(element,event)){var showEscalationCodeVariable=is(element,'bpmn:StartEvent')||is(element,'bpmn:BoundaryEvent');var escalationEventDefinition=eventDefinitionHelper.getEscalationEventDefinition(element);if(escalationEventDefinition){escalation(group,element,bpmnFactory,escalationEventDefinition,showEscalationCodeVariable);}}});var timerEvents=['bpmn:StartEvent','bpmn:BoundaryEvent','bpmn:IntermediateCatchEvent'];forEach(timerEvents,function(event){if(is(element,event)){var timerEventDefinition=eventDefinitionHelper.getTimerEventDefinition(element);if(timerEventDefinition){timer(group,element,bpmnFactory,timerEventDefinition);}}});var compensationEvents=['bpmn:EndEvent','bpmn:IntermediateThrowEvent'];forEach(compensationEvents,function(event){if(is(element,event)){var compensateEventDefinition=eventDefinitionHelper.getCompensateEventDefinition(element);if(compensateEventDefinition){compensation(group,element,bpmnFactory,compensateEventDefinition,elementRegistry);}}});var conditionalEvents=['bpmn:BoundaryEvent','bpmn:IntermediateThrowEvent','bpmn:IntermediateCatchEvent'];if(isAny(element,conditionalEvents)||(is(element,'bpmn:StartEvent')&&isEventSubProcess(element.parent))){var conditionalEventDefinition=eventDefinitionHelper.getConditionalEventDefinition(element);if(conditionalEventDefinition){condition(group,element,bpmnFactory,conditionalEventDefinition,elementRegistry);}}};},{"../../../helper/EventDefinitionHelper":27,"./implementation/CompensateEventDefinition":41,"./implementation/ConditionalEventDefinition":42,"./implementation/ErrorEventDefinition":44,"./implementation/EscalationEventDefinition":45,"./implementation/MessageEventDefinition":47,"./implementation/SignalEventDefinition":49,"./implementation/TimerEventDefinition":50,"bpmn-js/lib/features/modeling/util/ModelingUtil":170,"bpmn-js/lib/util/DiUtil":195,"bpmn-js/lib/util/ModelUtil":197,"lodash/collection/forEach":417}],36:[function(require,module,exports){'use strict';var is=require('bpmn-js/lib/util/ModelUtil').is,getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject;var entryFactory=require('../../../factory/EntryFactory');var participantHelper=require('../../../helper/ParticipantHelper');module.exports=function(group,element){var bo=getBusinessObject(element);if(!bo){return;}if(is(element,'bpmn:Process')||(is(element,'bpmn:Participant')&&bo.get('processRef'))){var executableEntry=entryFactory.checkbox({id:'process-is-executable',label:'可执行',modelProperty:'isExecutable'});if(is(element,'bpmn:Participant')){executableEntry.get=function(element){return participantHelper.getProcessBusinessObject(element,'isExecutable');};executableEntry.set=function(element,values){return participantHelper.modifyProcessBusinessObject(element,'isExecutable',values);};}group.entries.push(executableEntry);}};},{"../../../factory/EntryFactory":15,"../../../helper/ParticipantHelper":32,"bpmn-js/lib/util/ModelUtil":197}],37:[function(require,module,exports){'use strict';var entryFactory=require('../../../factory/EntryFactory'),getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject,utils=require('../../../Utils'),cmdHelper=require('../../../helper/CmdHelper');module.exports=function(group,element){group.entries.push(entryFactory.validationAwareTextField({id:'id',label:'标识符',modelProperty:'id',getProperty:function(element){return getBusinessObject(element).id;},setProperty:function(element,properties){element=element.labelTarget||element;return cmdHelper.updateProperties(element,properties);},validate:function(element,values){var idValue=values.id;var bo=getBusinessObject(element);var idError=utils.isIdValid(bo,idValue);return idError?{id:idError}:{};}}));};},{"../../../Utils":6,"../../../factory/EntryFactory":15,"../../../helper/CmdHelper":25,"bpmn-js/lib/util/ModelUtil":197}],38:[function(require,module,exports){'use strict';var is=require('bpmn-js/lib/util/ModelUtil').is,getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject,entryFactory=require('../../../factory/EntryFactory'),cmdHelper=require('../../../helper/CmdHelper');var forEach=require('lodash/collection/forEach');function getLinkEventDefinition(element){var bo=getBusinessObject(element);var linkEventDefinition=null;if(bo.eventDefinitions){forEach(bo.eventDefinitions,function(eventDefinition){if(is(eventDefinition,'bpmn:LinkEventDefinition')){linkEventDefinition=eventDefinition;}});}return linkEventDefinition;}module.exports=function(group,element){var linkEvents=['bpmn:IntermediateThrowEvent','bpmn:IntermediateCatchEvent'];forEach(linkEvents,function(event){if(is(element,event)){var linkEventDefinition=getLinkEventDefinition(element);if(linkEventDefinition){var entry=entryFactory.textField({id:'link-event',label:'Link Name',modelProperty:'link-name'});entry.get=function(){return{'link-name':linkEventDefinition.get('name')};};entry.set=function(element,values){var newProperties={name:values['link-name']};return cmdHelper.updateBusinessObject(element,linkEventDefinition,newProperties);};group.entries.push(entry);}}});};},{"../../../factory/EntryFactory":15,"../../../helper/CmdHelper":25,"bpmn-js/lib/util/ModelUtil":197,"lodash/collection/forEach":417}],39:[function(require,module,exports){'use strict';var nameEntryFactory=require('./implementation/Name'),is=require('bpmn-js/lib/util/ModelUtil').is;module.exports=function(group,element){if(!is(element,'bpmn:Collaboration')){var options;if(is(element,'bpmn:TextAnnotation')){options={modelProperty:'text'};}group.entries=group.entries.concat(nameEntryFactory(element,options));}};},{"./implementation/Name":48,"bpmn-js/lib/util/ModelUtil":197}],40:[function(require,module,exports){'use strict';var is=require('bpmn-js/lib/util/ModelUtil').is,entryFactory=require('../../../factory/EntryFactory'),participantHelper=require('../../../helper/ParticipantHelper'),getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject,nameEntryFactory=require('./implementation/Name'),utils=require('../../../Utils');module.exports=function(group,element){var businessObject=getBusinessObject(element);if(is(element,'bpmn:Process')||(is(element,'bpmn:Participant')&&businessObject.get('processRef'))){if(is(element,'bpmn:Participant')){var idEntry=entryFactory.validationAwareTextField({id:'process-id',label:'Process Id',modelProperty:'processId'});idEntry.get=function(element){var properties=participantHelper.getProcessBusinessObject(element,'id');return{processId:properties.id};};idEntry.set=function(element,values){return participantHelper.modifyProcessBusinessObject(element,'id',{id:values.processId});};idEntry.validate=function(element,values){var idValue=values.processId;var bo=getBusinessObject(element);var processIdError=utils.isIdValid(bo.processRef,idValue);return processIdError?{processId:processIdError}:{};};group.entries.push(idEntry);var processNameEntry=nameEntryFactory(element,{id:'process-name',label:'Process Name'})[0];processNameEntry.get=function(element){return participantHelper.getProcessBusinessObject(element,'name');};processNameEntry.set=function(element,values){return participantHelper.modifyProcessBusinessObject(element,'name',values);};group.entries.push(processNameEntry);}}};},{"../../../Utils":6,"../../../factory/EntryFactory":15,"../../../helper/ParticipantHelper":32,"./implementation/Name":48,"bpmn-js/lib/util/ModelUtil":197}],41:[function(require,module,exports){'use strict';var entryFactory=require('../../../../factory/EntryFactory');var cmdHelper=require('../../../../helper/CmdHelper'),eventDefinitionHelper=require('../../../../helper/EventDefinitionHelper'),utils=require('../../../../Utils');var getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject,is=require('bpmn-js/lib/util/ModelUtil').is;var forEach=require('lodash/collection/forEach'),find=require('lodash/collection/find'),filter=require('lodash/collection/filter');function getContainedActivities(element){return getFlowElements(element,'bpmn:Activity');}function getContainedBoundaryEvents(element){return getFlowElements(element,'bpmn:BoundaryEvent');}function getFlowElements(element,type){return utils.filterElementsByType(element.flowElements,type);}function isCompensationEventAttachedToActivity(activity,boundaryEvents){var activityId=activity.id;var boundaryEvent=find(boundaryEvents,function(boundaryEvent){var compensateEventDefinition=eventDefinitionHelper.getCompensateEventDefinition(boundaryEvent);var attachedToRef=boundaryEvent.attachedToRef;return compensateEventDefinition&&attachedToRef&&attachedToRef.id===activityId;});return!!boundaryEvent;}function canActivityBeCompensated(activity,boundaryEvents){return(is(activity,'bpmn:SubProcess')&&!activity.triggeredByEvent)||is(activity,'bpmn:CallActivity')||isCompensationEventAttachedToActivity(activity,boundaryEvents);}function getActivitiesForCompensation(element){var boundaryEvents=getContainedBoundaryEvents(element);return filter(getContainedActivities(element),function(activity){return canActivityBeCompensated(activity,boundaryEvents);});}function getActivitiesForActivityRef(element){var bo=getBusinessObject(element);var parent=bo.$parent;var activitiesForActivityRef=getActivitiesForCompensation(parent);if(is(parent,'bpmn:SubProcess')&&parent.triggeredByEvent){parent=parent.$parent;if(parent){activitiesForActivityRef=activitiesForActivityRef.concat(getActivitiesForCompensation(parent));}}return activitiesForActivityRef;}function createActivityRefOptions(element){var options=[{value:''}];var activities=getActivitiesForActivityRef(element);forEach(activities,function(activity){var activityId=activity.id;var name=(activity.name?(activity.name+' '):'')+'(id='+activityId+')';options.push({value:activityId,name:name});});return options;}module.exports=function(group,element,bpmnFactory,compensateEventDefinition,elementRegistry){group.entries.push(entryFactory.checkbox({id:'wait-for-completion',label:'Wait for Completion',modelProperty:'waitForCompletion',get:function(element,node){return{waitForCompletion:compensateEventDefinition.waitForCompletion};},set:function(element,values){values.waitForCompletion=values.waitForCompletion||undefined;return cmdHelper.updateBusinessObject(element,compensateEventDefinition,values);}}));group.entries.push(entryFactory.selectBox({id:'activity-ref',label:'Activity Ref',selectOptions:createActivityRefOptions(element),modelProperty:'activityRef',get:function(element,node){var activityRef=compensateEventDefinition.activityRef;activityRef=activityRef&&activityRef.id;return{activityRef:activityRef||''};},set:function(element,values){var activityRef=values.activityRef||undefined;activityRef=activityRef&&getBusinessObject(elementRegistry.get(activityRef));return cmdHelper.updateBusinessObject(element,compensateEventDefinition,{activityRef:activityRef});}}));};},{"../../../../Utils":6,"../../../../factory/EntryFactory":15,"../../../../helper/CmdHelper":25,"../../../../helper/EventDefinitionHelper":27,"bpmn-js/lib/util/ModelUtil":197,"lodash/collection/filter":415,"lodash/collection/find":416,"lodash/collection/forEach":417}],42:[function(require,module,exports){'use strict';var entryFactory=require('../../../../factory/EntryFactory'),elementHelper=require('../../../../helper/ElementHelper'),cmdHelper=require('../../../../helper/CmdHelper');function createFormalExpression(parent,body,bpmnFactory){body=body||undefined;return elementHelper.createElement('bpmn:FormalExpression',{body:body},parent,bpmnFactory);}module.exports=function(group,element,bpmnFactory,conditionalEventDefinition){var getValue=function(modelProperty){return function(element){var modelPropertyValue=conditionalEventDefinition.get('camunda:'+modelProperty);var value={};value[modelProperty]=modelPropertyValue;return value;};};var setValue=function(modelProperty){return function(element,values){var props={};props['camunda:'+modelProperty]=values[modelProperty]||undefined;return cmdHelper.updateBusinessObject(element,conditionalEventDefinition,props);};};group.entries.push(entryFactory.textField({id:'condition',label:'Condition',modelProperty:'condition',get:function(element){var condition=conditionalEventDefinition.get('condition'),body=condition&&condition.get('body');return{condition:body||''};},set:function(element,values){var condition=conditionalEventDefinition.get('condition');if(values.condition===''){return cmdHelper.updateBusinessObject(element,conditionalEventDefinition,{condition:undefined});}if(!condition){condition=createFormalExpression(conditionalEventDefinition,values.condition,bpmnFactory);return cmdHelper.updateBusinessObject(element,conditionalEventDefinition,{condition:condition});}else{return cmdHelper.updateBusinessObject(element,condition,{body:values.condition||undefined});}},validate:function(element,values){if(values['condition']===''){return{condition:'Must provide a value'};}}}));group.entries.push(entryFactory.textField({id:'variableName',label:'Variable Name',modelProperty:'variableName',get:getValue('variableName'),set:setValue('variableName')}));group.entries.push(entryFactory.textField({id:'variableEvent',label:'Variable Event',description:'Specify more than one variable change event as a comma separated list.',modelProperty:'variableEvent',get:getValue('variableEvent'),set:setValue('variableEvent')}));};},{"../../../../factory/EntryFactory":15,"../../../../helper/CmdHelper":25,"../../../../helper/ElementHelper":26}],43:[function(require,module,exports){'use strict';var entryFactory=require('../../../../factory/EntryFactory');var cmdHelper=require('../../../../helper/CmdHelper');module.exports=function(element,definition,bpmnFactory,options){var id=options.id||'element-property';var label=options.label;var referenceProperty=options.referenceProperty;var modelProperty=options.modelProperty||'name';var shouldValidate=options.shouldValidate||false;var entry=entryFactory.textField({id:id,label:label,modelProperty:modelProperty,get:function(element,node){var reference=definition.get(referenceProperty);var props={};props[modelProperty]=reference&&reference.get(modelProperty);return props;},set:function(element,values,node){var reference=definition.get(referenceProperty);var props={};props[modelProperty]=values[modelProperty]||undefined;return cmdHelper.updateBusinessObject(element,reference,props);},hidden:function(element,node){return!definition.get(referenceProperty);}});if(shouldValidate){entry.validate=function(element,values,node){var reference=definition.get(referenceProperty);if(reference&&!values[modelProperty]){var validationErrors={};validationErrors[modelProperty]='Must provide a value';return validationErrors;}};}return[entry];};},{"../../../../factory/EntryFactory":15,"../../../../helper/CmdHelper":25}],44:[function(require,module,exports){'use strict';var entryFactory=require('../../../../factory/EntryFactory'),cmdHelper=require('../../../../helper/CmdHelper');var eventDefinitionReference=require('./EventDefinitionReference'),elementReferenceProperty=require('./ElementReferenceProperty');module.exports=function(group,element,bpmnFactory,errorEventDefinition,showErrorCodeVariable,showErrorMessageVariable){var getValue=function(modelProperty){return function(element){var modelPropertyValue=errorEventDefinition.get('camunda:'+modelProperty);var value={};value[modelProperty]=modelPropertyValue;return value;};};var setValue=function(modelProperty){return function(element,values){var props={};props['camunda:'+modelProperty]=values[modelProperty]||undefined;return cmdHelper.updateBusinessObject(element,errorEventDefinition,props);};};group.entries=group.entries.concat(eventDefinitionReference(element,errorEventDefinition,bpmnFactory,{label:'Error',elementName:'error',elementType:'bpmn:Error',referenceProperty:'errorRef',newElementIdPrefix:'Error_'}));group.entries=group.entries.concat(elementReferenceProperty(element,errorEventDefinition,bpmnFactory,{id:'error-element-name',label:'Error Name',referenceProperty:'errorRef',modelProperty:'name',shouldValidate:true}));group.entries=group.entries.concat(elementReferenceProperty(element,errorEventDefinition,bpmnFactory,{id:'error-element-code',label:'Error Code',referenceProperty:'errorRef',modelProperty:'errorCode'}));if(showErrorCodeVariable){group.entries.push(entryFactory.textField({id:'errorCodeVariable',label:'Error Code Variable',modelProperty:'errorCodeVariable',get:getValue('errorCodeVariable'),set:setValue('errorCodeVariable')}));}if(showErrorMessageVariable){group.entries.push(entryFactory.textField({id:'errorMessageVariable',label:'Error Message Variable',modelProperty:'errorMessageVariable',get:getValue('errorMessageVariable'),set:setValue('errorMessageVariable')}));}};},{"../../../../factory/EntryFactory":15,"../../../../helper/CmdHelper":25,"./ElementReferenceProperty":43,"./EventDefinitionReference":46}],45:[function(require,module,exports){'use strict';var entryFactory=require('../../../../factory/EntryFactory'),cmdHelper=require('../../../../helper/CmdHelper');var eventDefinitionReference=require('./EventDefinitionReference'),elementReferenceProperty=require('./ElementReferenceProperty');module.exports=function(group,element,bpmnFactory,escalationEventDefinition,showEscalationCodeVariable){group.entries=group.entries.concat(eventDefinitionReference(element,escalationEventDefinition,bpmnFactory,{label:'Escalation',elementName:'escalation',elementType:'bpmn:Escalation',referenceProperty:'escalationRef',newElementIdPrefix:'Escalation_'}));group.entries=group.entries.concat(elementReferenceProperty(element,escalationEventDefinition,bpmnFactory,{id:'escalation-element-name',label:'Escalation Name',referenceProperty:'escalationRef',modelProperty:'name',shouldValidate:true}));group.entries=group.entries.concat(elementReferenceProperty(element,escalationEventDefinition,bpmnFactory,{id:'escalation-element-code',label:'Escalation Code',referenceProperty:'escalationRef',modelProperty:'escalationCode'}));if(showEscalationCodeVariable){group.entries.push(entryFactory.textField({id:'escalationCodeVariable',label:'Escalation Code Variable',modelProperty:'escalationCodeVariable',get:function(element){var codeVariable=escalationEventDefinition.get('camunda:escalationCodeVariable');return{escalationCodeVariable:codeVariable};},set:function(element,values){return cmdHelper.updateBusinessObject(element,escalationEventDefinition,{'camunda:escalationCodeVariable':values.escalationCodeVariable||undefined});}}));}};},{"../../../../factory/EntryFactory":15,"../../../../helper/CmdHelper":25,"./ElementReferenceProperty":43,"./EventDefinitionReference":46}],46:[function(require,module,exports){'use strict';var cmdHelper=require('../../../../helper/CmdHelper');var domQuery=require('min-dom/lib/query'),domify=require('min-dom/lib/domify'),domAttr=require('min-dom/lib/attr');var forEach=require('lodash/collection/forEach'),find=require('lodash/collection/find');var elementHelper=require('../../../../helper/ElementHelper');var utils=require('../../../../Utils');var selector='select[name=selectedElement]';function getSelectBox(node){return domQuery(selector,node.parentElement);}function findElementById(eventDefinition,type,id){var elements=utils.findRootElementsByType(eventDefinition,type);return find(elements,function(element){return element.id===id;});}module.exports=function(element,definition,bpmnFactory,options){var elementName=options.elementName||'',elementType=options.elementType,referenceProperty=options.referenceProperty;var newElementIdPrefix=options.newElementIdPrefix||'elem_';var label=options.label||'',description=options.description||'';var entries=[];entries.push({id:'event-definitions-'+elementName,description:description,html:'<div class="bpp-row bpp-select">'+'<label for="camunda-'+elementName+'">'+label+'</label>'+'<div class="bpp-field-wrapper">'+'<select id="camunda-'+elementName+'" name="selectedElement" data-value>'+'</select>'+'<button class="add" id="addElement" data-action="addElement"><span>+</span></button>'+'</div>'+'</div>',get:function(element,entryNode){utils.updateOptionsDropDown(selector,definition,elementType,entryNode);var reference=definition.get(referenceProperty);return{selectedElement:(reference&&reference.id)||''};},set:function(element,values){var selection=values.selectedElement;var props={};if(!selection||typeof selection==='undefined'){props[referenceProperty]=undefined;return cmdHelper.updateBusinessObject(element,definition,props);}var commands=[];var selectedElement=findElementById(definition,elementType,selection);if(!selectedElement){var root=utils.getRoot(definition);selectedElement=elementHelper.createElement(elementType,{name:selection},root,bpmnFactory);commands.push(cmdHelper.addAndRemoveElementsFromList(element,root,'rootElements',null,[selectedElement]));}props[referenceProperty]=selectedElement;commands.push(cmdHelper.updateBusinessObject(element,definition,props));return commands;},addElement:function(element,inputNode){var id=utils.nextId(newElementIdPrefix);var optionTemplate=domify('<option value="'+id+'"> (id='+id+')'+'</option>');var selectBox=getSelectBox(inputNode);selectBox.insertBefore(optionTemplate,selectBox.firstChild);forEach(selectBox,function(option){if(option.value===id){domAttr(option,'selected','selected');}else{domAttr(option,'selected',null);}});return true;}});return entries;};},{"../../../../Utils":6,"../../../../helper/CmdHelper":25,"../../../../helper/ElementHelper":26,"lodash/collection/find":416,"lodash/collection/forEach":417,"min-dom/lib/attr":561,"min-dom/lib/domify":566,"min-dom/lib/query":569}],47:[function(require,module,exports){'use strict';var eventDefinitionReference=require('./EventDefinitionReference'),elementReferenceProperty=require('./ElementReferenceProperty');module.exports=function(group,element,bpmnFactory,messageEventDefinition){group.entries=group.entries.concat(eventDefinitionReference(element,messageEventDefinition,bpmnFactory,{label:'Message',elementName:'message',elementType:'bpmn:Message',referenceProperty:'messageRef',newElementIdPrefix:'Message_'}));group.entries=group.entries.concat(elementReferenceProperty(element,messageEventDefinition,bpmnFactory,{id:'message-element-name',label:'Message Name',referenceProperty:'messageRef',modelProperty:'name',shouldValidate:true}));};},{"./ElementReferenceProperty":43,"./EventDefinitionReference":46}],48:[function(require,module,exports){'use strict';var entryFactory=require('../../../../factory/EntryFactory');module.exports=function(element,options){options=options||{};var id=options.id||'name',label=options.label||'名称',modelProperty=options.modelProperty||'name';var nameEntry=entryFactory.textBox({id:id,label:label,modelProperty:modelProperty});return[nameEntry];};},{"../../../../factory/EntryFactory":15}],49:[function(require,module,exports){'use strict';var eventDefinitionReference=require('./EventDefinitionReference'),elementReferenceProperty=require('./ElementReferenceProperty');module.exports=function(group,element,bpmnFactory,signalEventDefinition){group.entries=group.entries.concat(eventDefinitionReference(element,signalEventDefinition,bpmnFactory,{label:'Signal',elementName:'signal',elementType:'bpmn:Signal',referenceProperty:'signalRef',newElementIdPrefix:'Signal_'}));group.entries=group.entries.concat(elementReferenceProperty(element,signalEventDefinition,bpmnFactory,{id:'signal-element-name',label:'Signal Name',referenceProperty:'signalRef',modelProperty:'name',shouldValidate:true}));};},{"./ElementReferenceProperty":43,"./EventDefinitionReference":46}],50:[function(require,module,exports){'use strict';var elementHelper=require('../../../../helper/ElementHelper'),cmdHelper=require('../../../../helper/CmdHelper');var entryFactory=require('../../../../factory/EntryFactory');function getTimerDefinitionType(timer){var timeDate=timer.get('timeDate');if(typeof timeDate!=='undefined'){return'timeDate';}var timeCycle=timer.get('timeCycle');if(typeof timeCycle!=='undefined'){return'timeCycle';}var timeDuration=timer.get('timeDuration');if(typeof timeDuration!=='undefined'){return'timeDuration';}}function createFormalExpression(parent,body,bpmnFactory){body=body||undefined;return elementHelper.createElement('bpmn:FormalExpression',{body:body},parent,bpmnFactory);}function TimerEventDefinition(group,element,bpmnFactory,timerEventDefinition){var selectOptions=[{value:'timeDate',name:'Date'},{value:'timeDuration',name:'Duration'},{value:'timeCycle',name:'Cycle'}];group.entries.push(entryFactory.selectBox({id:'timer-event-definition-type',label:'Timer Definition Type',selectOptions:selectOptions,emptyParameter:true,modelProperty:'timerDefinitionType',get:function(element,node){return{timerDefinitionType:getTimerDefinitionType(timerEventDefinition)||''};},set:function(element,values){var props={timeDuration:undefined,timeDate:undefined,timeCycle:undefined};var newType=values.timerDefinitionType;if(values.timerDefinitionType){var oldType=getTimerDefinitionType(timerEventDefinition);var value;if(oldType){var definition=timerEventDefinition.get(oldType);value=definition.get('body');}props[newType]=createFormalExpression(timerEventDefinition,value,bpmnFactory);}return cmdHelper.updateBusinessObject(element,timerEventDefinition,props);}}));group.entries.push(entryFactory.textField({id:'timer-event-definition',label:'Timer Definition',modelProperty:'timerDefinition',get:function(element,node){var type=getTimerDefinitionType(timerEventDefinition);var definition=type&&timerEventDefinition.get(type);var value=definition&&definition.get('body');return{timerDefinition:value};},set:function(element,values){var type=getTimerDefinitionType(timerEventDefinition);var definition=type&&timerEventDefinition.get(type);if(definition){return cmdHelper.updateBusinessObject(element,definition,{body:values.timerDefinition||undefined});}},validate:function(element){var type=getTimerDefinitionType(timerEventDefinition);var definition=type&&timerEventDefinition.get(type);if(definition){var value=definition.get('body');if(!value){return{timerDefinition:'Must provide a value'};}}},hidden:function(element){return!getTimerDefinitionType(timerEventDefinition);}}));}module.exports=TimerEventDefinition;},{"../../../../factory/EntryFactory":15,"../../../../helper/CmdHelper":25,"../../../../helper/ElementHelper":26}],51:[function(require,module,exports){'use strict';var inherits=require('inherits');var PropertiesActivator=require('../../PropertiesActivator');var asyncCapableHelper=require('../../helper/AsyncCapableHelper'),ImplementationTypeHelper=require('../../helper/ImplementationTypeHelper');var is=require('bpmn-js/lib/util/ModelUtil').is;var processProps=require('../bpmn/parts/ProcessProps'),eventProps=require('../bpmn/parts/EventProps'),linkProps=require('../bpmn/parts/LinkProps'),documentationProps=require('../bpmn/parts/DocumentationProps'),idProps=require('../bpmn/parts/IdProps'),nameProps=require('../bpmn/parts/NameProps'),executableProps=require('../bpmn/parts/ExecutableProps');var serviceTaskDelegateProps=require('./parts/ServiceTaskDelegateProps'),userTaskProps=require('./parts/UserTaskProps'),asynchronousContinuationProps=require('./parts/AsynchronousContinuationProps'),callActivityProps=require('./parts/CallActivityProps'),multiInstanceProps=require('./parts/MultiInstanceLoopProps'),sequenceFlowProps=require('./parts/SequenceFlowProps'),scriptProps=require('./parts/ScriptTaskProps'),formProps=require('./parts/FormProps'),startEventInitiator=require('./parts/StartEventInitiator'),variableMapping=require('./parts/VariableMappingProps'),versionTag=require('./parts/VersionTagProps');var listenerProps=require('./parts/ListenerProps'),listenerDetails=require('./parts/ListenerDetailProps'),listenerFields=require('./parts/ListenerFieldInjectionProps');var elementTemplateChooserProps=require('./element-templates/parts/ChooserProps'),elementTemplateCustomProps=require('./element-templates/parts/CustomProps');var inputOutput=require('./parts/InputOutputProps'),inputOutputParameter=require('./parts/InputOutputParameterProps');var connectorDetails=require('./parts/ConnectorDetailProps'),connectorInputOutput=require('./parts/ConnectorInputOutputProps'),connectorInputOutputParameter=require('./parts/ConnectorInputOutputParameterProps');var properties=require('./parts/PropertiesProps');var jobConfiguration=require('./parts/JobConfigurationProps');var externalTaskConfiguration=require('./parts/ExternalTaskConfigurationProps');var fieldInjections=require('./parts/FieldInjectionProps');var getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject,eventDefinitionHelper=require('../../helper/EventDefinitionHelper'),implementationTypeHelper=require('../../helper/ImplementationTypeHelper');var isExternalTaskPriorityEnabled=function(element){var businessObject=getBusinessObject(element);if(is(element,'bpmn:Process')||is(element,'bpmn:Participant')&&businessObject.get('processRef')){return true;}var externalBo=ImplementationTypeHelper.getServiceTaskLikeBusinessObject(element),isExternalTask=ImplementationTypeHelper.getImplementationType(externalBo)==='external';return!!ImplementationTypeHelper.isExternalCapable(externalBo)&&isExternalTask;};var isJobConfigEnabled=function(element){var businessObject=getBusinessObject(element);if(is(element,'bpmn:Process')||is(element,'bpmn:Participant')&&businessObject.get('processRef')){return true;}var bo=getBusinessObject(element);if(asyncCapableHelper.isAsyncBefore(bo)||asyncCapableHelper.isAsyncAfter(bo)){return true;}if(is(element,'bpmn:Event')){return!!eventDefinitionHelper.getTimerEventDefinition(element);}return false;};var getInputOutputParameterLabel=function(param){if(is(param,'camunda:InputParameter')){return'Input Parameter';}if(is(param,'camunda:OutputParameter')){return'Output Parameter';}return'';};var getListenerLabel=function(param){if(is(param,'camunda:ExecutionListener')){return'执行监听器';}if(is(param,'camunda:TaskListener')){return'Task Listener';}return'';};function createGeneralTabGroups(element,bpmnFactory,elementRegistry,elementTemplates){var generalGroup={id:'general',label:'常规',entries:[]};idProps(generalGroup,element,elementRegistry);nameProps(generalGroup,element);processProps(generalGroup,element);versionTag(generalGroup,element);executableProps(generalGroup,element);elementTemplateChooserProps(generalGroup,element,elementTemplates);var customFieldsGroup={id:'customField',label:'Custom Fields',entries:[]};elementTemplateCustomProps(customFieldsGroup,element,elementTemplates,bpmnFactory);var detailsGroup={id:'details',label:'配置明细',entries:[]};serviceTaskDelegateProps(detailsGroup,element,bpmnFactory);userTaskProps(detailsGroup,element);scriptProps(detailsGroup,element,bpmnFactory);linkProps(detailsGroup,element);callActivityProps(detailsGroup,element,bpmnFactory);eventProps(detailsGroup,element,bpmnFactory,elementRegistry);sequenceFlowProps(detailsGroup,element,bpmnFactory);startEventInitiator(detailsGroup,element);var multiInstanceGroup={id:'multiInstance',label:'Multi Instance',entries:[]};multiInstanceProps(multiInstanceGroup,element,bpmnFactory);var asyncGroup={id:'async',label:'异步扩展',entries:[]};asynchronousContinuationProps(asyncGroup,element,bpmnFactory);var jobConfigurationGroup={id:'jobConfiguration',label:'作业配置',entries:[],enabled:isJobConfigEnabled};jobConfiguration(jobConfigurationGroup,element,bpmnFactory);var externalTaskGroup={id:'externalTaskConfiguration',label:'外部任务配置',entries:[],enabled:isExternalTaskPriorityEnabled};externalTaskConfiguration(externalTaskGroup,element,bpmnFactory);var documentationGroup={id:'documentation',label:'文档',entries:[]};documentationProps(documentationGroup,element,bpmnFactory);return[generalGroup,customFieldsGroup,detailsGroup,externalTaskGroup,multiInstanceGroup,asyncGroup,jobConfigurationGroup,documentationGroup];}function createVariablesTabGroups(element,bpmnFactory,elementRegistry){var variablesGroup={id:'variables',label:'Variables',entries:[]};variableMapping(variablesGroup,element,bpmnFactory);return[variablesGroup];}function createFormsTabGroups(element,bpmnFactory,elementRegistry){var defaultFormName="表单";if(element.type=="bpmn:StartEvent"){defaultFormName="全局表单";}else if(element.type=="bpmn:UserTask"){defaultFormName="<a href='javascript:void(0);' onclick='setGlobalFormAuth(\""+element.id+"\")' style='color:blue;font-size:12px;font-style: normal;font-weight: bolder;'>全局表单权限设置</a><br>任务表单";}var formGroup={id:'forms',label:defaultFormName,entries:[]};formProps(formGroup,element,bpmnFactory);return[formGroup];}function createListenersTabGroups(element,bpmnFactory,elementRegistry){var listenersGroup={id:'listeners',label:'监听器',entries:[]};var options=listenerProps(listenersGroup,element,bpmnFactory);var listenerDetailsGroup={id:'listener-details',entries:[],enabled:function(element,node){return options.getSelectedListener(element,node);},label:function(element,node){var param=options.getSelectedListener(element,node);return getListenerLabel(param);}};listenerDetails(listenerDetailsGroup,element,bpmnFactory,options);var listenerFieldsGroup={id:'listener-fields',label:'Field Injection',entries:[],enabled:function(element,node){return options.getSelectedListener(element,node);}};listenerFields(listenerFieldsGroup,element,bpmnFactory,options);return[listenersGroup,listenerDetailsGroup,listenerFieldsGroup];}function createInputOutputTabGroups(element,bpmnFactory,elementRegistry){var inputOutputGroup={id:'input-output',label:'参数',entries:[]};var options=inputOutput(inputOutputGroup,element,bpmnFactory);var inputOutputParameterGroup={id:'input-output-parameter',entries:[],enabled:function(element,node){return options.getSelectedParameter(element,node);},label:function(element,node){var param=options.getSelectedParameter(element,node);return getInputOutputParameterLabel(param);}};inputOutputParameter(inputOutputParameterGroup,element,bpmnFactory,options);return[inputOutputGroup,inputOutputParameterGroup];}function createConnectorTabGroups(element,bpmnFactory,elementRegistry){var connectorDetailsGroup={id:'connector-details',label:'Details',entries:[]};connectorDetails(connectorDetailsGroup,element,bpmnFactory);var connectorInputOutputGroup={id:'connector-input-output',label:'Input/Output',entries:[]};var options=connectorInputOutput(connectorInputOutputGroup,element,bpmnFactory);var connectorInputOutputParameterGroup={id:'connector-input-output-parameter',entries:[],enabled:function(element,node){return options.getSelectedParameter(element,node);},label:function(element,node){var param=options.getSelectedParameter(element,node);return getInputOutputParameterLabel(param);}};connectorInputOutputParameter(connectorInputOutputParameterGroup,element,bpmnFactory,options);return[connectorDetailsGroup,connectorInputOutputGroup,connectorInputOutputParameterGroup];}function createFieldInjectionsTabGroups(element,bpmnFactory,elementRegistry){var fieldGroup={id:'field-injections-properties',label:'Field Injections',entries:[]};fieldInjections(fieldGroup,element,bpmnFactory);return[fieldGroup];}function createExtensionElementsGroups(element,bpmnFactory,elementRegistry){var propertiesGroup={id:'extensionElements-properties',label:'属性',entries:[]};properties(propertiesGroup,element,bpmnFactory);return[propertiesGroup];}function CamundaPropertiesProvider(eventBus,bpmnFactory,elementRegistry,elementTemplates){PropertiesActivator.call(this,eventBus);this.getTabs=function(element){var generalTab={id:'general',label:'常规',groups:createGeneralTabGroups(element,bpmnFactory,elementRegistry,elementTemplates)};var variablesTab={id:'variables',label:'变量',groups:createVariablesTabGroups(element,bpmnFactory,elementRegistry)};var formsTab={id:'forms',label:'表单',groups:createFormsTabGroups(element,bpmnFactory,elementRegistry)};var listenersTab={id:'listeners',label:'监听器',groups:createListenersTabGroups(element,bpmnFactory,elementRegistry),enabled:function(element){return!eventDefinitionHelper.getLinkEventDefinition(element)||(!is(element,'bpmn:IntermediateThrowEvent')&&eventDefinitionHelper.getLinkEventDefinition(element));}};var inputOutputTab={id:'input-output',label:'输入/输出',groups:createInputOutputTabGroups(element,bpmnFactory,elementRegistry)};var connectorTab={id:'connector',label:'连接器',groups:createConnectorTabGroups(element,bpmnFactory,elementRegistry),enabled:function(element){var bo=implementationTypeHelper.getServiceTaskLikeBusinessObject(element);return bo&&implementationTypeHelper.getImplementationType(bo)==='connector';}};var fieldInjectionsTab={id:'field-injections',label:'属性注入',groups:createFieldInjectionsTabGroups(element,bpmnFactory,elementRegistry)};var extensionsTab={id:'extensionElements',label:'扩展',groups:createExtensionElementsGroups(element,bpmnFactory,elementRegistry)};return[generalTab,variablesTab,connectorTab,formsTab,listenersTab,inputOutputTab,fieldInjectionsTab,extensionsTab];};}CamundaPropertiesProvider.$inject=['eventBus','bpmnFactory','elementRegistry','elementTemplates'];inherits(CamundaPropertiesProvider,PropertiesActivator);module.exports=CamundaPropertiesProvider;},{"../../PropertiesActivator":4,"../../helper/AsyncCapableHelper":24,"../../helper/EventDefinitionHelper":27,"../../helper/ImplementationTypeHelper":30,"../bpmn/parts/DocumentationProps":34,"../bpmn/parts/EventProps":35,"../bpmn/parts/ExecutableProps":36,"../bpmn/parts/IdProps":37,"../bpmn/parts/LinkProps":38,"../bpmn/parts/NameProps":39,"../bpmn/parts/ProcessProps":40,"./element-templates/parts/ChooserProps":61,"./element-templates/parts/CustomProps":62,"./parts/AsynchronousContinuationProps":64,"./parts/CallActivityProps":65,"./parts/ConnectorDetailProps":66,"./parts/ConnectorInputOutputParameterProps":67,"./parts/ConnectorInputOutputProps":68,"./parts/ExternalTaskConfigurationProps":69,"./parts/FieldInjectionProps":70,"./parts/FormProps":71,"./parts/InputOutputParameterProps":72,"./parts/InputOutputProps":73,"./parts/JobConfigurationProps":74,"./parts/ListenerDetailProps":75,"./parts/ListenerFieldInjectionProps":76,"./parts/ListenerProps":77,"./parts/MultiInstanceLoopProps":78,"./parts/PropertiesProps":79,"./parts/ScriptTaskProps":80,"./parts/SequenceFlowProps":81,"./parts/ServiceTaskDelegateProps":82,"./parts/StartEventInitiator":83,"./parts/UserTaskProps":84,"./parts/VariableMappingProps":85,"./parts/VersionTagProps":86,"bpmn-js/lib/util/ModelUtil":197,"inherits":398}],52:[function(require,module,exports){'use strict';function createInputParameter(binding,value,bpmnFactory){var scriptFormat=binding.scriptFormat,parameterValue,parameterDefinition;if(scriptFormat){parameterDefinition=bpmnFactory.create('camunda:Script',{scriptFormat:scriptFormat,value:value});}else{parameterValue=value;}return bpmnFactory.create('camunda:InputParameter',{name:binding.name,value:parameterValue,definition:parameterDefinition});}module.exports.createInputParameter=createInputParameter;function createOutputParameter(binding,value,bpmnFactory){var scriptFormat=binding.scriptFormat,parameterValue,parameterDefinition;if(scriptFormat){parameterDefinition=bpmnFactory.create('camunda:Script',{scriptFormat:scriptFormat,value:binding.source});}else{parameterValue=binding.source;}return bpmnFactory.create('camunda:OutputParameter',{name:value,value:parameterValue,definition:parameterDefinition});}module.exports.createOutputParameter=createOutputParameter;function createCamundaProperty(binding,value,bpmnFactory){return bpmnFactory.create('camunda:Property',{name:binding.name,value:value||''});}module.exports.createCamundaProperty=createCamundaProperty;function createCamundaIn(binding,value,bpmnFactory){var properties=createCamundaInOutAttrs(binding,value);return bpmnFactory.create('camunda:In',properties);}module.exports.createCamundaIn=createCamundaIn;function createCamundaInWithBusinessKey(binding,value,bpmnFactory){return bpmnFactory.create('camunda:In',{businessKey:value});}module.exports.createCamundaInWithBusinessKey=createCamundaInWithBusinessKey;function createCamundaOut(binding,value,bpmnFactory){var properties=createCamundaInOutAttrs(binding,value);return bpmnFactory.create('camunda:Out',properties);}module.exports.createCamundaOut=createCamundaOut;function createCamundaExecutionListenerScript(binding,value,bpmnFactory){var scriptFormat=binding.scriptFormat,parameterValue,parameterDefinition;if(scriptFormat){parameterDefinition=bpmnFactory.create('camunda:Script',{scriptFormat:scriptFormat,value:value});}else{parameterValue=value;}return bpmnFactory.create('camunda:ExecutionListener',{event:binding.event,value:parameterValue,script:parameterDefinition});}module.exports.createCamundaExecutionListenerScript=createCamundaExecutionListenerScript;function createCamundaInOutAttrs(binding,value){var properties={};if(binding.target){properties.target=binding.target;if(binding.expression){properties.sourceExpression=value;}else{properties.source=value;}}else
if(binding.variables){properties.variables='all';if(binding.variables==='local'){properties.local=true;}}else{properties.target=value;['source','sourceExpression'].forEach(function(k){if(binding[k]){properties[k]=binding[k];}});}return properties;}},{}],53:[function(require,module,exports){'use strict';var inherits=require('inherits');var getTemplate=require('./Helper').getTemplate;var PropertiesActivator=require('../../../PropertiesActivator');var HIGHER_PRIORITY=1100;function CustomElementsPropertiesActivator(eventBus,elementTemplates){PropertiesActivator.call(this,eventBus,HIGHER_PRIORITY);this.isEntryVisible=function(entry,element){var template=getTemplate(element,elementTemplates);if(template&&!isEntryVisible(entry,template)){return false;}};this.isPropertyEditable=function(entry,propertyName,element){var template=getTemplate(element,elementTemplates);if(template&&!isEntryEditable(entry,template)){return false;}};}CustomElementsPropertiesActivator.$inject=['eventBus','elementTemplates'];inherits(CustomElementsPropertiesActivator,PropertiesActivator);module.exports=CustomElementsPropertiesActivator;var CUSTOM_PROPERTIES_PATTERN=/^custom-/;var DEFAULT_ENTRIES_VISIBLE={_all:false,id:true,name:true};function isCustomEntry(entry){return CUSTOM_PROPERTIES_PATTERN.test(entry.id);}function isEntryVisible(entry,template){var entryId=entry.id;if(entryId==='elementTemplate-chooser'||isCustomEntry(entry)){return true;}var entriesVisible=template.entriesVisible||DEFAULT_ENTRIES_VISIBLE;if(typeof entriesVisible==='boolean'){return entriesVisible;}var defaultVisible=entriesVisible._all||false,entryVisible=entriesVisible[entryId];return((defaultVisible===true&&entryVisible!==false)||(defaultVisible===false&&entryVisible===true));}function isEntryEditable(entry,template){var property;if(isCustomEntry(entry)){property=getProperty(template,entry);return property&&property.editable!==false;}return true;}function getProperty(template,entry){var index=parseInt(entry.id.replace('custom-'+template.id+'-',''),10);if(isNaN(index)){throw new Error('cannot extract property index for entry <'+entry.id+'>');}return template.properties[index];}},{"../../../PropertiesActivator":4,"./Helper":56,"inherits":398}],54:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');function ElementTemplates(){this._templates={};this.set=function(descriptors){var templates=this._templates={};descriptors.forEach(function(descriptor){templates[descriptor.id]=descriptor;});return this;};this.get=function(id){return this._templates[id];};this.getAll=function(){return this._templates;};this.forEach=function(fn,context){return forEach(this._templates,fn,context);};}module.exports=ElementTemplates;},{"lodash/collection/forEach":417}],55:[function(require,module,exports){'use strict';var Validator=require('./Validator');function ElementTemplatesLoader(loadTemplates,eventBus,elementTemplates){this._loadTemplates=loadTemplates;this._eventBus=eventBus;this._elementTemplates=elementTemplates;var self=this;eventBus.on('diagram.init',function(){self.reload();});}module.exports=ElementTemplatesLoader;ElementTemplatesLoader.$inject=['config.elementTemplates','eventBus','elementTemplates'];ElementTemplatesLoader.prototype.reload=function(){var self=this;var loadTemplates=this._loadTemplates;if(typeof loadTemplates==='undefined'){return;}if(typeof loadTemplates==='function'){return loadTemplates(function(err,templates){if(err){return self.templateErrors([err]);}self.setTemplates(templates);});}if(loadTemplates.length){return this.setTemplates(loadTemplates);}};ElementTemplatesLoader.prototype.setTemplates=function(templates){var elementTemplates=this._elementTemplates;var validator=new Validator().addAll(templates);var errors=validator.getErrors(),validTemplates=validator.getValidTemplates();elementTemplates.set(validTemplates);if(errors.length){this.templateErrors(errors);}this.templatesChanged();};ElementTemplatesLoader.prototype.templatesChanged=function(){this._eventBus.fire('elementTemplates.changed');};ElementTemplatesLoader.prototype.templateErrors=function(errors){this._eventBus.fire('elementTemplates.errors',{errors:errors});};},{"./Validator":57}],56:[function(require,module,exports){'use strict';var getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject;var is=require('bpmn-js/lib/util/ModelUtil').is,isAny=require('bpmn-js/lib/features/modeling/util/ModelingUtil').isAny;var find=require('lodash/collection/find');var TEMPLATE_ATTR='camunda:modelerTemplate';module.exports.TEMPLATE_ATTR=TEMPLATE_ATTR;function getTemplateId(element){var bo=getBusinessObject(element);if(bo){return bo.get(TEMPLATE_ATTR);}}module.exports.getTemplateId=getTemplateId;function getTemplate(element,elementTemplates){var id=getTemplateId(element);return id&&elementTemplates.get(id);}module.exports.getTemplate=getTemplate;function getDefaultTemplate(element,elementTemplates){var defaultTemplate;elementTemplates.forEach(function(t){if(isAny(element,t.appliesTo)&&t.isDefault){defaultTemplate=t;}});return defaultTemplate;}module.exports.getDefaultTemplate=getDefaultTemplate;function findExtension(element,type){var bo=getBusinessObject(element);var extensionElements;if(is(bo,'bpmn:ExtensionElements')){extensionElements=bo;}else{extensionElements=bo.extensionElements;}if(!extensionElements){return null;}return find(extensionElements.get('values'),function(e){return is(e,type);});}module.exports.findExtension=findExtension;function findExtensions(element,types){var extensionElements=getExtensionElements(element);if(!extensionElements){return[];}return extensionElements.get('values').filter(function(e){return isAny(e,types);});}module.exports.findExtensions=findExtensions;function findCamundaInOut(element,binding){var extensionElements=getExtensionElements(element);if(!extensionElements){return;}var matcher;if(binding.type==='camunda:in'){matcher=function(e){return is(e,'camunda:In')&&isInOut(e,binding);};}else
if(binding.type==='camunda:out'){matcher=function(e){return is(e,'camunda:Out')&&isInOut(e,binding);};}else
if(binding.type==='camunda:in:businessKey'){matcher=function(e){return is(e,'camunda:In')&&'businessKey'in e;};}return find(extensionElements.get('values'),matcher);}module.exports.findCamundaInOut=findCamundaInOut;function findCamundaProperty(camundaProperties,binding){return find(camundaProperties.get('values'),function(p){return p.name===binding.name;});}module.exports.findCamundaProperty=findCamundaProperty;function findInputParameter(inputOutput,binding){var parameters=inputOutput.get('inputParameters');return find(parameters,function(p){return p.name===binding.name;});}module.exports.findInputParameter=findInputParameter;function findOutputParameter(inputOutput,binding){var parameters=inputOutput.get('outputParameters');return find(parameters,function(p){var value=p.value;if(!binding.scriptFormat){return value===binding.source;}var definition=p.definition;if(!definition||binding.scriptFormat!==definition.scriptFormat){return false;}return definition.value===binding.source;});}module.exports.findOutputParameter=findOutputParameter;function getExtensionElements(element){var bo=getBusinessObject(element);if(is(bo,'bpmn:ExtensionElements')){return bo;}else{return bo.extensionElements;}}function isInOut(element,binding){if(binding.type==='camunda:in'){if(binding.target){return element.target===binding.target;}}if(binding.type==='camunda:out'){if(binding.source){return element.source===binding.source;}if(binding.sourceExpression){return element.sourceExpression===binding.sourceExpression;}}if(binding.variables){return element.variables==='all'&&(binding.variables!=='local'||element.local);}}},{"bpmn-js/lib/features/modeling/util/ModelingUtil":170,"bpmn-js/lib/util/ModelUtil":197,"lodash/collection/find":416}],57:[function(require,module,exports){'use strict';var isArray=require('lodash/lang/isArray');var DROPDOWN_TYPE='Dropdown';var VALID_TYPES=['String','Text','Boolean','Hidden',DROPDOWN_TYPE];var PROPERTY_TYPE='property',CAMUNDA_PROPERTY_TYPE='camunda:property',CAMUNDA_INPUT_PARAMETER_TYPE='camunda:inputParameter',CAMUNDA_OUTPUT_PARAMETER_TYPE='camunda:outputParameter',CAMUNDA_IN_TYPE='camunda:in',CAMUNDA_OUT_TYPE='camunda:out',CAMUNDA_IN_BUSINESS_KEY_TYPE='camunda:in:businessKey',CAMUNDA_EXECUTION_LISTENER='camunda:executionListener';var VALID_BINDING_TYPES=[PROPERTY_TYPE,CAMUNDA_PROPERTY_TYPE,CAMUNDA_INPUT_PARAMETER_TYPE,CAMUNDA_OUTPUT_PARAMETER_TYPE,CAMUNDA_IN_TYPE,CAMUNDA_OUT_TYPE,CAMUNDA_IN_BUSINESS_KEY_TYPE,CAMUNDA_EXECUTION_LISTENER];function Validator(){this._templatesById={};this._validTemplates=[];this._errors=[];this.addAll=function(templates){if(!isArray(templates)){this._logError('templates must be []');}else{templates.forEach(this.add,this);}return this;};this.add=function(template){var err=this._validateTemplate(template);if(!err){this._templatesById[template.id]=template;this._validTemplates.push(template);}return this;};this._validateTemplate=function(template){var err,id=template.id,appliesTo=template.appliesTo,properties=template.properties;if(!id){return this._logError('missing template id');}if(id in this._templatesById){return this._logError('template id <'+id+'> already used');}if(!isArray(appliesTo)){err=this._logError('missing appliesTo=[]',template);}if(!isArray(properties)){err=this._logError('missing properties=[]',template);}else{if(!this._validateProperties(properties)){err=new Error('invalid properties');}}return err;};this._validateProperties=function(properties){var validProperties=properties.filter(this._validateProperty,this);return properties.length===validProperties.length;};this._validateProperty=function(property){var type=property.type,binding=property.binding;var err;var bindingType=binding.type;if(VALID_TYPES.indexOf(type)===-1){err=this._logError('invalid property type <'+type+'>; '+'must be any of { '+VALID_TYPES.join(', ')+' }');}if(type===DROPDOWN_TYPE&&bindingType!==CAMUNDA_EXECUTION_LISTENER){if(!isArray(property.choices)){err=this._logError('must provide choices=[] with '+DROPDOWN_TYPE+' type');}else
if(!property.choices.every(isDropdownChoiceValid)){err=this._logError('{ name, value } must be specified for '+DROPDOWN_TYPE+' choices');}}if(!binding){return this._logError('property missing binding');}if(VALID_BINDING_TYPES.indexOf(bindingType)===-1){err=this._logError('invalid property.binding type <'+bindingType+'>; '+'must be any of { '+VALID_BINDING_TYPES.join(', ')+' }');}if(bindingType===PROPERTY_TYPE||bindingType===CAMUNDA_PROPERTY_TYPE||bindingType===CAMUNDA_INPUT_PARAMETER_TYPE){if(!binding.name){err=this._logError('property.binding <'+bindingType+'> requires name');}}if(bindingType===CAMUNDA_OUTPUT_PARAMETER_TYPE){if(!binding.source){err=this._logError('property.binding <'+bindingType+'> requires source');}}if(bindingType===CAMUNDA_IN_TYPE){if(!binding.variables&&!binding.target){err=this._logError('property.binding <'+bindingType+'> requires '+'variables or target');}}if(bindingType===CAMUNDA_OUT_TYPE){if(!binding.variables&&!binding.source&&!binding.sourceExpression){err=this._logError('property.binding <'+bindingType+'> requires '+'variables, sourceExpression or source');}}if(bindingType===CAMUNDA_EXECUTION_LISTENER){if(type!=='Hidden'){err=this._logError('invalid property type <'+type+'> for '+CAMUNDA_EXECUTION_LISTENER+'; '+'must be <Hidden>');}}return!err;};this._logError=function(err,template){if(typeof err==='string'){if(template){err='template(id: '+template.id+') '+err;}err=new Error(err);}this._errors.push(err);return err;};this.getErrors=function(){return this._errors;};this.getValidTemplates=function(){return this._validTemplates;};}module.exports=Validator;function isDropdownChoiceValid(c){return'name'in c&&'value'in c;}},{"lodash/lang/isArray":537}],58:[function(require,module,exports){'use strict';var findExtension=require('../Helper').findExtension,findExtensions=require('../Helper').findExtensions;var createCamundaProperty=require('../CreateHelper').createCamundaProperty,createInputParameter=require('../CreateHelper').createInputParameter,createOutputParameter=require('../CreateHelper').createOutputParameter,createCamundaIn=require('../CreateHelper').createCamundaIn,createCamundaOut=require('../CreateHelper').createCamundaOut,createCamundaInWithBusinessKey=require('../CreateHelper').createCamundaInWithBusinessKey,createCamundaExecutionListenerScript=require('../CreateHelper').createCamundaExecutionListenerScript;var CAMUNDA_SERVICE_TASK_LIKE=['camunda:class','camunda:delegateExpression','camunda:expression'];function ChangeElementTemplateHandler(modeling,commandStack,bpmnFactory){function getOrCreateExtensionElements(element){var bo=element.businessObject;var extensionElements=bo.extensionElements;if(!extensionElements){extensionElements=bpmnFactory.create('bpmn:ExtensionElements',{values:[]});modeling.updateProperties(element,{extensionElements:extensionElements});}return extensionElements;}function updateModelerTemplate(element,newTemplate){modeling.updateProperties(element,{'camunda:modelerTemplate':newTemplate&&newTemplate.id});}function updateIoMappings(element,newTemplate){var extensionElements;var newMappings=createInputOutputMappings(newTemplate,bpmnFactory),oldMappings;if(newMappings){extensionElements=getOrCreateExtensionElements(element);oldMappings=findExtension(element,'camunda:InputOutput');commandStack.execute('properties-panel.update-businessobject-list',{element:element,currentObject:extensionElements,propertyName:'values',objectsToAdd:[newMappings],objectsToRemove:oldMappings?[oldMappings]:[]});}}function updateCamundaProperties(element,newTemplate){var extensionElements;var newProperties=createCamundaProperties(newTemplate,bpmnFactory),oldProperties;if(newProperties){extensionElements=getOrCreateExtensionElements(element);oldProperties=findExtension(element,'camunda:Properties');commandStack.execute('properties-panel.update-businessobject-list',{element:element,currentObject:extensionElements,propertyName:'values',objectsToAdd:[newProperties],objectsToRemove:oldProperties?[oldProperties]:[]});}}function updateProperties(element,newTemplate){var newProperties=createBpmnPropertyUpdates(newTemplate,bpmnFactory);if(Object.keys(newProperties).length>0){modeling.updateProperties(element,newProperties);}}function updateInOut(element,newTemplate){var extensionElements;var newInOut=createCamundaInOut(newTemplate,bpmnFactory),oldInOut;if(newInOut){extensionElements=getOrCreateExtensionElements(element);oldInOut=findExtensions(extensionElements,['camunda:In','camunda:Out']);commandStack.execute('properties-panel.update-businessobject-list',{element:element,currentObject:extensionElements,propertyName:'values',objectsToAdd:newInOut,objectsToRemove:oldInOut});}}function updateExecutionListener(element,newTemplate){var newExecutionListeners=createCamundaExecutionListener(newTemplate,bpmnFactory),oldExecutionsListeners;if(newExecutionListeners.length){var extensionElements=getOrCreateExtensionElements(element);oldExecutionsListeners=findExtensions(extensionElements,['camunda:ExecutionListener']);commandStack.execute('properties-panel.update-businessobject-list',{element:element,currentObject:extensionElements,propertyName:'values',objectsToAdd:newExecutionListeners,objectsToRemove:oldExecutionsListeners});}}this.preExecute=function(context){var element=context.element,newTemplate=context.newTemplate;updateModelerTemplate(element,newTemplate);if(newTemplate){updateIoMappings(element,newTemplate);updateCamundaProperties(element,newTemplate);updateProperties(element,newTemplate);updateInOut(element,newTemplate);updateExecutionListener(element,newTemplate);}};}ChangeElementTemplateHandler.$inject=['modeling','commandStack','bpmnFactory'];module.exports=ChangeElementTemplateHandler;function createBpmnPropertyUpdates(template,bpmnFactory){var propertyUpdates={};template.properties.forEach(function(p){var binding=p.binding,bindingTarget=binding.name,propertyValue;if(binding.type==='property'){if(bindingTarget==='conditionExpression'){propertyValue=bpmnFactory.create('bpmn:FormalExpression',{body:p.value,language:binding.scriptFormat});}else{propertyValue=p.value;}propertyUpdates[bindingTarget]=propertyValue;if(CAMUNDA_SERVICE_TASK_LIKE.indexOf(bindingTarget)!==-1){CAMUNDA_SERVICE_TASK_LIKE.forEach(function(prop){if(prop!==bindingTarget){propertyUpdates[prop]=undefined;}});}}});return propertyUpdates;}function createCamundaProperties(template,bpmnFactory){var properties=[];template.properties.forEach(function(p){var binding=p.binding,bindingType=binding.type;if(bindingType==='camunda:property'){properties.push(createCamundaProperty(binding,p.value,bpmnFactory));}});if(properties.length){return bpmnFactory.create('camunda:Properties',{values:properties});}}function createInputOutputMappings(template,bpmnFactory){var inputParameters=[],outputParameters=[];template.properties.forEach(function(p){var binding=p.binding,bindingType=binding.type;if(bindingType==='camunda:inputParameter'){inputParameters.push(createInputParameter(binding,p.value,bpmnFactory));}if(bindingType==='camunda:outputParameter'){outputParameters.push(createOutputParameter(binding,p.value,bpmnFactory));}});if(outputParameters.length||inputParameters.length){return bpmnFactory.create('camunda:InputOutput',{inputParameters:inputParameters,outputParameters:outputParameters});}}function createCamundaInOut(template,bpmnFactory){var inOuts=[];template.properties.forEach(function(p){var binding=p.binding,bindingType=binding.type;if(bindingType==='camunda:in'){inOuts.push(createCamundaIn(binding,p.value,bpmnFactory));}else
if(bindingType==='camunda:out'){inOuts.push(createCamundaOut(binding,p.value,bpmnFactory));}else
if(bindingType==='camunda:in:businessKey'){inOuts.push(createCamundaInWithBusinessKey(binding,p.value,bpmnFactory));}});return inOuts;}function createCamundaExecutionListener(template,bpmnFactory){var executionListener=[];template.properties.forEach(function(p){var binding=p.binding,bindingType=binding.type;if(bindingType==='camunda:executionListener'){executionListener.push(createCamundaExecutionListenerScript(binding,p.value,bpmnFactory));}});return executionListener;}},{"../CreateHelper":52,"../Helper":56}],59:[function(require,module,exports){'use strict';var ChangeElementTemplateHandler=require('./ChangeElementTemplateHandler');var getTemplate=require('../Helper').getTemplate,getDefaultTemplate=require('../Helper').getDefaultTemplate;function registerHandlers(commandStack,elementTemplates,eventBus,elementRegistry){commandStack.registerHandler('propertiesPanel.camunda.changeTemplate',ChangeElementTemplateHandler);eventBus.on(['commandStack.shape.create.postExecuted'],function(context){applyDefaultTemplate(context.context.shape,elementTemplates,commandStack);});eventBus.on(['commandStack.connection.create.postExecuted'],function(context){applyDefaultTemplate(context.context.connection,elementTemplates,commandStack);});}registerHandlers.$inject=['commandStack','elementTemplates','eventBus','elementRegistry'];module.exports={__init__:[registerHandlers]};function applyDefaultTemplate(element,elementTemplates,commandStack){if(!getTemplate(element,elementTemplates)&&getDefaultTemplate(element,elementTemplates)){var command='propertiesPanel.camunda.changeTemplate';var commandContext={element:element,newTemplate:getDefaultTemplate(element,elementTemplates)};commandStack.execute(command,commandContext);}}},{"../Helper":56,"./ChangeElementTemplateHandler":58}],60:[function(require,module,exports){module.exports={__depends__:[require('./cmd')],__init__:['customElementsPropertiesActivator','elementTemplatesLoader'],customElementsPropertiesActivator:['type',require('./CustomElementsPropertiesActivator')],elementTemplates:['type',require('./ElementTemplates')],elementTemplatesLoader:['type',require('./ElementTemplatesLoader')]};},{"./CustomElementsPropertiesActivator":53,"./ElementTemplates":54,"./ElementTemplatesLoader":55,"./cmd":59}],61:[function(require,module,exports){'use strict';var entryFactory=require('../../../../factory/EntryFactory'),is=require('bpmn-js/lib/util/ModelUtil').is,getTemplate=require('../Helper').getTemplate,getTemplateId=require('../Helper').getTemplateId;var find=require('lodash/collection/find');var TEMPLATE_ATTR=require('../Helper').TEMPLATE_ATTR;function isAny(element,types){return types.reduce(function(result,type){return result||is(element,type);},false);}module.exports=function(group,element,elementTemplates){var options=getTemplateOptions(element,elementTemplates);if(options.length===1&&!options[0].isDefault){return;}group.entries.push(entryFactory.selectBox({id:'elementTemplate-chooser',label:'Element Template',modelProperty:'camunda:modelerTemplate',selectOptions:options,set:function(element,properties){return applyTemplate(element,properties[TEMPLATE_ATTR],elementTemplates);},disabled:function(){return options.length&&options.length<2&&options[0].isDefault;}}));};function applyTemplate(element,newTemplateId,elementTemplates){var oldTemplate=getTemplate(element,elementTemplates),newTemplate=elementTemplates.get(newTemplateId);if(oldTemplate===newTemplate){return;}return{cmd:'propertiesPanel.camunda.changeTemplate',context:{element:element,oldTemplate:oldTemplate,newTemplate:newTemplate}};}function getTemplateOptions(element,elementTemplates){var currentTemplateId=getTemplateId(element);var options=[{name:'',value:''}];var found;var defaultFound;elementTemplates.forEach(function(t){if(isAny(element,t.appliesTo)){if(t.id===currentTemplateId){found=true;}if(t.isDefault){defaultFound=true;}options.push({name:t.name,value:t.id,isDefault:t.isDefault});}});if(defaultFound){var defaultOption=find(options,function(option){return option.isDefault;});var currentOption;if(currentTemplateId&&currentTemplateId!==defaultOption.value){if(found){currentOption=find(options,function(option){return option.value===currentTemplateId;});}else{currentOption={name:'[unknown template: '+currentTemplateId+']',value:currentTemplateId};}}options=[defaultOption];if(currentOption){options.push(currentOption);}}if(currentTemplateId&&!found){options.push({name:'[unknown template: '+currentTemplateId+']',value:currentTemplateId});}return options;}},{"../../../../factory/EntryFactory":15,"../Helper":56,"bpmn-js/lib/util/ModelUtil":197,"lodash/collection/find":416}],62:[function(require,module,exports){'use strict';var entryFactory=require('../../../../factory/EntryFactory'),getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject,getTemplate=require('../Helper').getTemplate,cmdHelper=require('../../../../helper/CmdHelper');var findExtension=require('../Helper').findExtension,findInputParameter=require('../Helper').findInputParameter,findOutputParameter=require('../Helper').findOutputParameter,findCamundaProperty=require('../Helper').findCamundaProperty,findCamundaInOut=require('../Helper').findCamundaInOut;var createCamundaProperty=require('../CreateHelper').createCamundaProperty,createInputParameter=require('../CreateHelper').createInputParameter,createOutputParameter=require('../CreateHelper').createOutputParameter,createCamundaIn=require('../CreateHelper').createCamundaIn,createCamundaOut=require('../CreateHelper').createCamundaOut,createCamundaInWithBusinessKey=require('../CreateHelper').createCamundaInWithBusinessKey;var CAMUNDA_PROPERTY_TYPE='camunda:property',CAMUNDA_INPUT_PARAMETER_TYPE='camunda:inputParameter',CAMUNDA_OUTPUT_PARAMETER_TYPE='camunda:outputParameter',CAMUNDA_IN_TYPE='camunda:in',CAMUNDA_OUT_TYPE='camunda:out',CAMUNDA_IN_BUSINESS_KEY_TYPE='camunda:in:businessKey',CAMUNDA_EXECUTION_LISTENER_TYPE='camunda:executionListener';var BASIC_MODDLE_TYPES=['Boolean','Integer','String'];var EXTENSION_BINDING_TYPES=[CAMUNDA_PROPERTY_TYPE,CAMUNDA_INPUT_PARAMETER_TYPE,CAMUNDA_OUTPUT_PARAMETER_TYPE,CAMUNDA_IN_TYPE,CAMUNDA_OUT_TYPE,CAMUNDA_IN_BUSINESS_KEY_TYPE];var IO_BINDING_TYPES=[CAMUNDA_INPUT_PARAMETER_TYPE,CAMUNDA_OUTPUT_PARAMETER_TYPE];var IN_OUT_BINDING_TYPES=[CAMUNDA_IN_TYPE,CAMUNDA_OUT_TYPE,CAMUNDA_IN_BUSINESS_KEY_TYPE];module.exports=function(group,element,elementTemplates,bpmnFactory){var template=getTemplate(element,elementTemplates);if(!template){return;}template.properties.forEach(function(p,idx){var id='custom-'+template.id+'-'+idx;var propertyType=p.type;var entryOptions={id:id,description:p.description,label:p.label,modelProperty:id,get:propertyGetter(id,p),set:propertySetter(id,p,bpmnFactory),validate:propertyValidator(id,p)};var entry;if(propertyType==='Boolean'){entry=entryFactory.checkbox(entryOptions);}if(propertyType==='String'){entry=entryFactory.textField(entryOptions);}if(propertyType==='Text'){entry=entryFactory.textBox(entryOptions);}if(propertyType==='Dropdown'){entryOptions.selectOptions=p.choices;entry=entryFactory.selectBox(entryOptions);}if(entry){group.entries.push(entry);}});};function propertyGetter(name,property){return function get(element){var value=getPropertyValue(element,property);return objectWithKey(name,value);};}function propertySetter(name,property,bpmnFactory){return function set(element,values){var value=values[name];return setPropertyValue(element,property,value,bpmnFactory);};}function propertyValidator(name,property){return function validate(element,values){var value=values[name];var error=validateValue(value,property);if(error){return objectWithKey(name,error);}};}function getPropertyValue(element,property){var bo=getBusinessObject(element);var binding=property.binding;var bindingType=binding.type,bindingName=binding.name;var propertyValue=property.value||'';if(bindingType==='property'){var value=bo.get(bindingName);if(bindingName==='conditionExpression'){if(value){return value.body;}else{return propertyValue;}}else{return typeof value!=='undefined'?value:propertyValue;}}var camundaProperties,camundaProperty;if(bindingType===CAMUNDA_PROPERTY_TYPE){camundaProperties=findExtension(bo,'camunda:Properties');if(camundaProperties){camundaProperty=findCamundaProperty(camundaProperties,binding);if(camundaProperty){return camundaProperty.value;}}return propertyValue;}var inputOutput,ioParameter;if(IO_BINDING_TYPES.indexOf(bindingType)!==-1){inputOutput=findExtension(bo,'camunda:InputOutput');if(!inputOutput){return propertyValue;}}if(bindingType===CAMUNDA_INPUT_PARAMETER_TYPE){ioParameter=findInputParameter(inputOutput,binding);if(ioParameter){if(binding.scriptFormat){if(ioParameter.definition){return ioParameter.definition.value;}}else{return ioParameter.value;}}return propertyValue;}if(binding.type===CAMUNDA_OUTPUT_PARAMETER_TYPE){ioParameter=findOutputParameter(inputOutput,binding);if(ioParameter){return ioParameter.name;}return propertyValue;}var ioElement;if(IN_OUT_BINDING_TYPES.indexOf(bindingType)!=-1){ioElement=findCamundaInOut(bo,binding);if(ioElement){if(bindingType===CAMUNDA_IN_BUSINESS_KEY_TYPE){return ioElement.businessKey;}else
if(bindingType===CAMUNDA_OUT_TYPE){return ioElement.target;}else
if(bindingType===CAMUNDA_IN_TYPE){return ioElement[binding.expression?'sourceExpression':'source'];}}return propertyValue;}if(bindingType===CAMUNDA_EXECUTION_LISTENER_TYPE){var executionListener=findExtension(bo,'camunda:ExecutionListener');return executionListener.script.value;}throw unknownPropertyBinding(property);}module.exports.getPropertyValue=getPropertyValue;function setPropertyValue(element,property,value,bpmnFactory){var bo=getBusinessObject(element);var binding=property.binding;var bindingType=binding.type,bindingName=binding.name;var propertyValue;var updates=[];if(bindingType==='property'){if(bindingName==='conditionExpression'){propertyValue=bpmnFactory.create('bpmn:FormalExpression',{body:value,language:binding.scriptFormat});}else{var moddlePropertyDescriptor=bo.$descriptor.propertiesByName[bindingName];var moddleType=moddlePropertyDescriptor.type;if(BASIC_MODDLE_TYPES.indexOf(moddleType)===-1){throw new Error('cannot set moddle type <'+moddleType+'>');}if(moddleType==='Boolean'){propertyValue=!!value;}else
if(moddleType==='Integer'){propertyValue=parseInt(value,10);if(isNaN(propertyValue)){propertyValue=undefined;}}else{propertyValue=value;}}if(propertyValue!==undefined){updates.push(cmdHelper.updateBusinessObject(element,bo,objectWithKey(bindingName,propertyValue)));}}var extensionElements;if(EXTENSION_BINDING_TYPES.indexOf(bindingType)!==-1){extensionElements=bo.get('extensionElements');if(!extensionElements){extensionElements=bpmnFactory.create('bpmn:ExtensionElements');updates.push(cmdHelper.updateBusinessObject(element,bo,objectWithKey('extensionElements',extensionElements)));}}var camundaProperties,existingCamundaProperty,newCamundaProperty;if(bindingType===CAMUNDA_PROPERTY_TYPE){camundaProperties=findExtension(extensionElements,'camunda:Properties');if(!camundaProperties){camundaProperties=bpmnFactory.create('camunda:Properties');updates.push(cmdHelper.addElementsTolist(element,extensionElements,'values',[camundaProperties]));}existingCamundaProperty=findCamundaProperty(camundaProperties,binding);newCamundaProperty=createCamundaProperty(binding,value,bpmnFactory);updates.push(cmdHelper.addAndRemoveElementsFromList(element,camundaProperties,'values',null,[newCamundaProperty],existingCamundaProperty?[existingCamundaProperty]:[]));}var inputOutput,existingIoParameter,newIoParameter;if(IO_BINDING_TYPES.indexOf(bindingType)!==-1){inputOutput=findExtension(extensionElements,'camunda:InputOutput');if(!inputOutput){inputOutput=bpmnFactory.create('camunda:InputOutput');updates.push(cmdHelper.addElementsTolist(element,extensionElements,'values',inputOutput));}}if(bindingType===CAMUNDA_INPUT_PARAMETER_TYPE){existingIoParameter=findInputParameter(inputOutput,binding);newIoParameter=createInputParameter(binding,value,bpmnFactory);updates.push(cmdHelper.addAndRemoveElementsFromList(element,inputOutput,'inputParameters',null,[newIoParameter],existingIoParameter?[existingIoParameter]:[]));}if(bindingType===CAMUNDA_OUTPUT_PARAMETER_TYPE){existingIoParameter=findOutputParameter(inputOutput,binding);newIoParameter=createOutputParameter(binding,value,bpmnFactory);updates.push(cmdHelper.addAndRemoveElementsFromList(element,inputOutput,'outputParameters',null,[newIoParameter],existingIoParameter?[existingIoParameter]:[]));}var existingInOut,newInOut;if(IN_OUT_BINDING_TYPES.indexOf(bindingType)!==-1){existingInOut=findCamundaInOut(bo,binding);if(bindingType===CAMUNDA_IN_TYPE){newInOut=createCamundaIn(binding,value,bpmnFactory);}else
if(bindingType===CAMUNDA_OUT_TYPE){newInOut=createCamundaOut(binding,value,bpmnFactory);}else{newInOut=createCamundaInWithBusinessKey(binding,value,bpmnFactory);}updates.push(cmdHelper.addAndRemoveElementsFromList(element,extensionElements,'values',null,[newInOut],existingInOut?[existingInOut]:[]));}if(updates.length){return updates;}console.warn('no update',element,property,value);}function validateValue(value,property){var constraints=property.constraints||{};if(constraints.notEmpty&&isEmpty(value)){return'Must not be empty';}if(constraints.maxLength&&value.length>constraints.maxLength){return'Must have max length '+constraints.maxLength;}if(constraints.minLength&&value.length<constraints.minLength){return'Must have min length '+constraints.minLength;}var pattern=constraints.pattern,message;if(pattern){if(typeof pattern!=='string'){message=pattern.message;pattern=pattern.value;}if(!matchesPattern(value,pattern)){return message||'Must match pattern '+pattern;}}}function objectWithKey(key,value){var obj={};obj[key]=value;return obj;}function matchesPattern(str,pattern){var regexp=new RegExp(pattern);return regexp.test(str);}function isEmpty(str){return!str||/^\s*$/.test(str);}function unknownPropertyBinding(property){var binding=property.binding;return new Error('unknown binding: <'+binding.type+'>');}},{"../../../../factory/EntryFactory":15,"../../../../helper/CmdHelper":25,"../CreateHelper":52,"../Helper":56,"bpmn-js/lib/util/ModelUtil":197}],63:[function(require,module,exports){module.exports={__depends__:[require('./element-templates')],__init__:['propertiesProvider'],propertiesProvider:['type',require('./CamundaPropertiesProvider')]};},{"./CamundaPropertiesProvider":51,"./element-templates":60}],64:[function(require,module,exports){'use strict';var getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject,is=require('bpmn-js/lib/util/ModelUtil').is,asyncContinuation=require('./implementation/AsyncContinuation');module.exports=function(group,element,bpmnFactory){if(is(element,'camunda:AsyncCapable')){group.entries=group.entries.concat(asyncContinuation(element,bpmnFactory,{getBusinessObject:getBusinessObject}));}};},{"./implementation/AsyncContinuation":87,"bpmn-js/lib/util/ModelUtil":197}],65:[function(require,module,exports){'use strict';var getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject,is=require('bpmn-js/lib/util/ModelUtil').is;var entryFactory=require('../../../factory/EntryFactory');var callable=require('./implementation/Callable');var cmdHelper=require('../../../helper/CmdHelper');var flattenDeep=require('lodash/array/flattenDeep');var assign=require('lodash/object/assign');function getCallableType(element){var bo=getBusinessObject(element);var boCalledElement=bo.get('calledElement'),boCaseRef=bo.get('camunda:caseRef');var callActivityType='';if(typeof boCalledElement!=='undefined'){callActivityType='bpmn';}else
if(typeof boCaseRef!=='undefined'){callActivityType='cmmn';}return callActivityType;}var DEFAULT_PROPS={calledElement:undefined,'camunda:calledElementBinding':'latest','camunda:calledElementVersion':undefined,'camunda:calledElementTenantId':undefined,'camunda:variableMappingClass':undefined,'camunda:variableMappingDelegateExpression':undefined,'camunda:caseRef':undefined,'camunda:caseBinding':'latest','camunda:caseVersion':undefined,'camunda:caseTenantId':undefined};module.exports=function(group,element,bpmnFactory){if(!is(element,'camunda:CallActivity')){return;}group.entries.push(entryFactory.selectBox({id:'callActivity',label:'CallActivity Type',selectOptions:[{name:'BPMN',value:'bpmn'},{name:'CMMN',value:'cmmn'}],emptyParameter:true,modelProperty:'callActivityType',get:function(element,node){return{callActivityType:getCallableType(element)};},set:function(element,values,node){var type=values.callActivityType;var props=assign({},DEFAULT_PROPS);if(type==='bpmn'){props.calledElement='';}else if(type==='cmmn'){props['camunda:caseRef']='';}return cmdHelper.updateProperties(element,props);}}));group.entries.push(callable(element,bpmnFactory,{getCallableType:getCallableType}));group.entries=flattenDeep(group.entries);};},{"../../../factory/EntryFactory":15,"../../../helper/CmdHelper":25,"./implementation/Callable":88,"bpmn-js/lib/util/ModelUtil":197,"lodash/array/flattenDeep":404,"lodash/object/assign":547}],66:[function(require,module,exports){'use strict';var ImplementationTypeHelper=require('../../../helper/ImplementationTypeHelper'),InputOutputHelper=require('../../../helper/InputOutputHelper');var entryFactory=require('../../../factory/EntryFactory'),cmdHelper=require('../../../helper/CmdHelper');function getImplementationType(element){return ImplementationTypeHelper.getImplementationType(element);}function getBusinessObject(element){return ImplementationTypeHelper.getServiceTaskLikeBusinessObject(element);}function getConnector(bo){return InputOutputHelper.getConnector(bo);}function isConnector(element){return getImplementationType(element)==='connector';}module.exports=function(group,element,bpmnFactory){group.entries.push(entryFactory.textField({id:'connectorId',label:'Connector Id',modelProperty:'connectorId',get:function(element,node){var bo=getBusinessObject(element);var connector=bo&&getConnector(bo);var value=connector&&connector.get('connectorId');return{connectorId:value};},set:function(element,values,node){var bo=getBusinessObject(element);var connector=getConnector(bo);return cmdHelper.updateBusinessObject(element,connector,{connectorId:values.connectorId||undefined});},validate:function(element,values,node){return isConnector(element)&&!values.connectorId?{connectorId:'Must provide a value'}:{};},hidden:function(element,node){return!isConnector(element);}}));};},{"../../../factory/EntryFactory":15,"../../../helper/CmdHelper":25,"../../../helper/ImplementationTypeHelper":30,"../../../helper/InputOutputHelper":31}],67:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign');var inputOutputParameter=require('./implementation/InputOutputParameter');module.exports=function(group,element,bpmnFactory,options){options=assign({idPrefix:'connector-',insideConnector:true},options);group.entries=group.entries.concat(inputOutputParameter(element,bpmnFactory,options));};},{"./implementation/InputOutputParameter":96,"lodash/object/assign":547}],68:[function(require,module,exports){'use strict';var inputOutput=require('./implementation/InputOutput');module.exports=function(group,element,bpmnFactory){var inputOutputEntry=inputOutput(element,bpmnFactory,{idPrefix:'connector-',insideConnector:true});group.entries=group.entries.concat(inputOutputEntry.entries);return{getSelectedParameter:inputOutputEntry.getSelectedParameter};};},{"./implementation/InputOutput":95}],69:[function(require,module,exports){'use strict';var is=require('bpmn-js/lib/util/ModelUtil').is,getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject;var ImplementationTypeHelper=require('../../../helper/ImplementationTypeHelper');var externalTaskPriority=require('./implementation/ExternalTaskPriority');function getServiceTaskLikeBusinessObject(element){var bo=ImplementationTypeHelper.getServiceTaskLikeBusinessObject(element);if(!bo){bo=getBusinessObject(element);}return bo;}module.exports=function(group,element,bpmnFactory){var bo=getServiceTaskLikeBusinessObject(element);if(!bo){return;}if(is(bo,'camunda:TaskPriorized')||(is(bo,'bpmn:Participant'))&&bo.get('processRef')){group.entries=group.entries.concat(externalTaskPriority(element,bpmnFactory,{getBusinessObject:function(element){if(!is(bo,'bpmn:Participant')){return bo;}return bo.get('processRef');}}));}};},{"../../../helper/ImplementationTypeHelper":30,"./implementation/ExternalTaskPriority":92,"bpmn-js/lib/util/ModelUtil":197}],70:[function(require,module,exports){'use strict';var ImplementationTypeHelper=require('../../../helper/ImplementationTypeHelper');var fieldInjection=require('./implementation/FieldInjection');module.exports=function(group,element,bpmnFactory){if(!ImplementationTypeHelper.getServiceTaskLikeBusinessObject(element)){return;}var fieldInjectionEntry=fieldInjection(element,bpmnFactory);if(fieldInjectionEntry&&fieldInjectionEntry.length>0){group.entries=group.entries.concat(fieldInjectionEntry);}};},{"../../../helper/ImplementationTypeHelper":30,"./implementation/FieldInjection":93}],71:[function(require,module,exports){'use strict';var getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject,getExtensionElements=require('../../../helper/ExtensionElementsHelper').getExtensionElements,extensionElements=require('./implementation/ExtensionElements'),properties=require('./implementation/Properties'),entryFactory=require('../../../factory/EntryFactory'),elementHelper=require('../../../helper/ElementHelper'),cmdHelper=require('../../../helper/CmdHelper'),formHelper=require('../../../helper/FormHelper'),utils=require('../../../Utils'),is=require('bpmn-js/lib/util/ModelUtil').is,find=require('lodash/collection/find'),each=require('lodash/collection/forEach');function generateValueId(){return utils.nextId('Value_');}function formFieldTextField(options,getSelectedFormField){var id=options.id,label=options.label,modelProperty=options.modelProperty,validate=options.validate;return entryFactory.textField({id:id,label:label,modelProperty:modelProperty,get:function(element,node){var selectedFormField=getSelectedFormField(element,node)||{},values={};values[modelProperty]=selectedFormField[modelProperty];return values;},set:function(element,values,node){var commands=[];if(typeof options.set==='function'){var cmd=options.set(element,values,node);if(cmd){commands.push(cmd);}}var formField=getSelectedFormField(element,node),properties={};properties[modelProperty]=values[modelProperty]||undefined;commands.push(cmdHelper.updateBusinessObject(element,formField,properties));return commands;},hidden:function(element,node){return!getSelectedFormField(element,node);},validate:validate});}function ensureFormKeyAndDataSupported(element){return(is(element,'bpmn:StartEvent')&&!is(element.parent,'bpmn:SubProcess'))||is(element,'bpmn:UserTask');}module.exports=function(group,element,bpmnFactory){if(!ensureFormKeyAndDataSupported(element)){return;}function getSelectedFormField(element,node){var selected=formFieldsEntry.getSelected(element,node.parentNode);if(selected.idx===-1){return;}return formHelper.getFormField(element,selected.idx);}group.entries.push(entryFactory.textField({id:'form-key',label:'Form Key',modelProperty:'formKey',get:function(element,node){var bo=getBusinessObject(element);return{formKey:bo.get('camunda:formKey')};},set:function(element,values,node){var bo=getBusinessObject(element),formKey=values.formKey||undefined;return cmdHelper.updateBusinessObject(element,bo,{'camunda:formKey':formKey});}}));var formFieldsEntry=extensionElements(element,bpmnFactory,{id:'form-fields',label:'Form Fields',modelProperty:'id',prefix:'FormField',createExtensionElement:function(element,extensionElements,value){var bo=getBusinessObject(element),commands=[];if(!extensionElements){extensionElements=elementHelper.createElement('bpmn:ExtensionElements',{values:[]},bo,bpmnFactory);commands.push(cmdHelper.updateProperties(element,{extensionElements:extensionElements}));}var formData=extensionElements.values[0];if(!formData){formData=elementHelper.createElement('camunda:FormData',{fields:[]},extensionElements,bpmnFactory);commands.push(cmdHelper.addAndRemoveElementsFromList(element,extensionElements,'values','extensionElements',[formData],[]));}var field=elementHelper.createElement('camunda:FormField',{id:value},formData,bpmnFactory);if(typeof formData.fields!=='undefined'){commands.push(cmdHelper.addElementsTolist(element,formData,'fields',[field]));}else{commands.push(cmdHelper.updateBusinessObject(element,formData,{fields:[field]}));}return commands;},removeExtensionElement:function(element,extensionElements,value,idx){var formData=getExtensionElements(getBusinessObject(element),'camunda:FormData')[0],entry=formData.fields[idx],commands=[];commands.push(cmdHelper.removeElementsFromList(element,formData,'fields',null,[entry]));if(entry.id===formData.get('businessKey')){commands.push(cmdHelper.updateBusinessObject(element,formData,{'businessKey':undefined}));}return commands;},getExtensionElements:function(element){return formHelper.getFormFields(element);},hideExtensionElements:function(element,node){return false;}});group.entries.push(formFieldsEntry);var formBusinessKeyFormFieldEntry=entryFactory.selectBox({id:'form-business-key',label:'Business Key',modelProperty:'businessKey',selectOptions:function(element,inputNode){var selectOptions=[{name:'',value:''}];var formFields=formHelper.getFormFields(element);each(formFields,function(field){if(field.type!=='boolean'){selectOptions.push({name:field.id,value:field.id});}});return selectOptions;},get:function(element,node){var result={businessKey:''};var bo=getBusinessObject(element);var formDataExtension=getExtensionElements(bo,'camunda:FormData');if(formDataExtension){var formData=formDataExtension[0];var storedValue=formData.get('businessKey');result={businessKey:storedValue};}return result;},set:function(element,values,node){var formData=getExtensionElements(getBusinessObject(element),'camunda:FormData')[0];return cmdHelper.updateBusinessObject(element,formData,{'businessKey':values.businessKey||undefined});},hidden:function(element,node){var isStartEvent=is(element,'bpmn:StartEvent');return!(isStartEvent&&formHelper.getFormFields(element).length>0);}});group.entries.push(formBusinessKeyFormFieldEntry);group.entries.push(entryFactory.label({id:'form-field-header',labelText:'Form Field',showLabel:function(element,node){return!!getSelectedFormField(element,node);}}));group.entries.push(entryFactory.validationAwareTextField({id:'form-field-id',label:'ID',modelProperty:'id',getProperty:function(element,node){var selectedFormField=getSelectedFormField(element,node)||{};return selectedFormField.id;},setProperty:function(element,properties,node){var formField=getSelectedFormField(element,node);return cmdHelper.updateBusinessObject(element,formField,properties);},hidden:function(element,node){return!getSelectedFormField(element,node);},validate:function(element,values,node){var formField=getSelectedFormField(element,node);if(formField){var idValue=values.id;if(!idValue||idValue.trim()===''){return{id:'Form field id must not be empty'};}var formFields=formHelper.getFormFields(element);var existingFormField=find(formFields,function(f){return f!==formField&&f.id===idValue;});if(existingFormField){return{id:'Form field id already used in form data.'};}}}}));group.entries.push(entryFactory.comboBox({id:'form-field-type',label:'Type',selectOptions:[{name:'string',value:'string'},{name:'long',value:'long'},{name:'boolean',value:'boolean'},{name:'date',value:'date'},{name:'enum',value:'enum'}],modelProperty:'type',emptyParameter:true,get:function(element,node){var selectedFormField=getSelectedFormField(element,node);if(selectedFormField){return{type:selectedFormField.type};}else{return{};}},set:function(element,values,node){var selectedFormField=getSelectedFormField(element,node),formData=getExtensionElements(getBusinessObject(element),'camunda:FormData')[0],commands=[];if(selectedFormField.type==='enum'&&values.type!=='enum'){commands.push(cmdHelper.updateBusinessObject(element,selectedFormField,{values:undefined}));}if(values.type==='boolean'&&selectedFormField.get('id')===formData.get('businessKey')){commands.push(cmdHelper.updateBusinessObject(element,formData,{'businessKey':undefined}));}commands.push(cmdHelper.updateBusinessObject(element,selectedFormField,values));return commands;},hidden:function(element,node){return!getSelectedFormField(element,node);}}));group.entries.push(formFieldTextField({id:'form-field-label',label:'Label',modelProperty:'label'},getSelectedFormField));group.entries.push(formFieldTextField({id:'form-field-defaultValue',label:'Default Value',modelProperty:'defaultValue'},getSelectedFormField));group.entries.push(entryFactory.label({id:'form-field-enum-values-header',labelText:'Values',divider:true,showLabel:function(element,node){var selectedFormField=getSelectedFormField(element,node);return selectedFormField&&selectedFormField.type==='enum';}}));group.entries.push(entryFactory.table({id:'form-field-enum-values',labels:['Id','Name'],modelProperties:['id','name'],show:function(element,node){var selectedFormField=getSelectedFormField(element,node);return selectedFormField&&selectedFormField.type==='enum';},getElements:function(element,node){var selectedFormField=getSelectedFormField(element,node);return formHelper.getEnumValues(selectedFormField);},addElement:function(element,node){var selectedFormField=getSelectedFormField(element,node),id=generateValueId();var enumValue=elementHelper.createElement('camunda:Value',{id:id,name:undefined},getBusinessObject(element),bpmnFactory);return cmdHelper.addElementsTolist(element,selectedFormField,'values',[enumValue]);},removeElement:function(element,node,idx){var selectedFormField=getSelectedFormField(element,node),enumValue=selectedFormField.values[idx];return cmdHelper.removeElementsFromList(element,selectedFormField,'values',null,[enumValue]);},updateElement:function(element,value,node,idx){var selectedFormField=getSelectedFormField(element,node),enumValue=selectedFormField.values[idx];value.name=value.name||undefined;return cmdHelper.updateBusinessObject(element,enumValue,value);},validate:function(element,value,node,idx){var selectedFormField=getSelectedFormField(element,node),enumValue=selectedFormField.values[idx];if(enumValue){var validationError=utils.isIdValid(enumValue,value.id);if(validationError){return{id:validationError};}}}}));group.entries.push(entryFactory.label({id:'form-field-validation-header',labelText:'Validation',divider:true,showLabel:function(element,node){return!!getSelectedFormField(element,node);}}));group.entries.push(entryFactory.table({id:'constraints-list',modelProperties:['name','config'],labels:['Name','Config'],addLabel:'Add Constraint',getElements:function(element,node){var formField=getSelectedFormField(element,node);return formHelper.getConstraints(formField);},addElement:function(element,node){var commands=[],formField=getSelectedFormField(element,node),validation=formField.validation;if(!validation){validation=elementHelper.createElement('camunda:Validation',{},getBusinessObject(element),bpmnFactory);commands.push(cmdHelper.updateBusinessObject(element,formField,{'validation':validation}));}var newConstraint=elementHelper.createElement('camunda:Constraint',{name:undefined,config:undefined},validation,bpmnFactory);commands.push(cmdHelper.addElementsTolist(element,validation,'constraints',[newConstraint]));return commands;},updateElement:function(element,value,node,idx){var formField=getSelectedFormField(element,node),constraint=formHelper.getConstraints(formField)[idx];value.name=value.name||undefined;value.config=value.config||undefined;return cmdHelper.updateBusinessObject(element,constraint,value);},removeElement:function(element,node,idx){var commands=[],formField=getSelectedFormField(element,node),constraints=formHelper.getConstraints(formField),currentConstraint=constraints[idx];commands.push(cmdHelper.removeElementsFromList(element,formField.validation,'constraints',null,[currentConstraint]));if(constraints.length===1){commands.push(cmdHelper.updateBusinessObject(element,formField,{validation:undefined}));}return commands;},show:function(element,node){return!!getSelectedFormField(element,node);}}));group.entries.push(entryFactory.label({id:'form-field-properties-header',labelText:'Properties',divider:true,showLabel:function(element,node){return!!getSelectedFormField(element,node);}}));group.entries.push(properties(element,bpmnFactory,{id:'form-field-properties',modelProperties:['id','value'],labels:['Id','Value'],getParent:function(element,node){return getSelectedFormField(element,node);},show:function(element,node){return!!getSelectedFormField(element,node);}}));};},{"../../../Utils":6,"../../../factory/EntryFactory":15,"../../../helper/CmdHelper":25,"../../../helper/ElementHelper":26,"../../../helper/ExtensionElementsHelper":28,"../../../helper/FormHelper":29,"./implementation/ExtensionElements":90,"./implementation/Properties":101,"bpmn-js/lib/util/ModelUtil":197,"lodash/collection/find":416,"lodash/collection/forEach":417}],72:[function(require,module,exports){'use strict';var inputOutputParameter=require('./implementation/InputOutputParameter');var assign=require('lodash/object/assign');module.exports=function(group,element,bpmnFactory,options){group.entries=group.entries.concat(inputOutputParameter(element,bpmnFactory,assign({},options)));};},{"./implementation/InputOutputParameter":96,"lodash/object/assign":547}],73:[function(require,module,exports){'use strict';var inputOutput=require('./implementation/InputOutput');module.exports=function(group,element,bpmnFactory){var inputOutputEntry=inputOutput(element,bpmnFactory);group.entries=group.entries.concat(inputOutputEntry.entries);return{getSelectedParameter:inputOutputEntry.getSelectedParameter};};},{"./implementation/InputOutput":95}],74:[function(require,module,exports){'use strict';var is=require('bpmn-js/lib/util/ModelUtil').is,getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject;var jobPriority=require('./implementation/JobPriority'),jobRetryTimeCycle=require('./implementation/JobRetryTimeCycle');module.exports=function(group,element,bpmnFactory){var businessObject=getBusinessObject(element);if(is(element,'camunda:JobPriorized')||is(element,'bpmn:Participant')&&businessObject.get('processRef')){group.entries=group.entries.concat(jobPriority(element,bpmnFactory,{getBusinessObject:function(element){var bo=getBusinessObject(element);if(!is(bo,'bpmn:Participant')){return bo;}return bo.get('processRef');}}));}if(is(element,'camunda:AsyncCapable')){group.entries=group.entries.concat(jobRetryTimeCycle(element,bpmnFactory,{getBusinessObject:getBusinessObject}));}};},{"./implementation/JobPriority":97,"./implementation/JobRetryTimeCycle":98,"bpmn-js/lib/util/ModelUtil":197}],75:[function(require,module,exports){'use strict';var entryFactory=require('../../../factory/EntryFactory');var cmdHelper=require('../../../helper/CmdHelper'),ImplementationTypeHelper=require('../../../helper/ImplementationTypeHelper'),script=require('./implementation/Script')('scriptFormat','value',true);var LISTENER_TYPE_LABEL={class:'Java Class',expression:'Expression',delegateExpression:'Delegate Expression',script:'Script'};module.exports=function(group,element,bpmnFactory,options){options=options||{};var getSelectedListener=options.getSelectedListener;var classProp='class',expressionProp='expression',delegateExpressionProp='delegateExpression',scriptProp='script';var executionListenerEventTypeOptions=ImplementationTypeHelper.isSequenceFlow(element)?[{name:'take',value:'take'}]:[{name:'start',value:'start'},{name:'end',value:'end'}];var taskListenerEventTypeOptions=[{name:'create',value:'create'},{name:'assignment',value:'assignment'},{name:'complete',value:'complete'},{name:'delete',value:'delete'}];var isSelected=function(element,node){return getSelectedListener(element,node);};group.entries.push(entryFactory.selectBox({id:'listener-event-type',label:'事件类型',modelProperty:'eventType',emptyParameter:false,get:function(element,node){var listener=getSelectedListener(element,node);var eventType=listener&&listener.get('event');return{eventType:eventType};},set:function(element,values,node){var eventType=values.eventType;return cmdHelper.updateBusinessObject(element,getSelectedListener(element,node),{event:eventType});},selectOptions:function(element,node){var eventTypeOptions;var selectedListener=getSelectedListener(element,node);if(ImplementationTypeHelper.isTaskListener(selectedListener)){eventTypeOptions=taskListenerEventTypeOptions;}else if(ImplementationTypeHelper.isExecutionListener(selectedListener)){eventTypeOptions=executionListenerEventTypeOptions;}return eventTypeOptions;},hidden:function(element,node){return!isSelected(element,node);}}));group.entries.push(entryFactory.selectBox({id:'listener-type',label:'监听器类型',selectOptions:[{value:classProp,name:'Java Class'},{value:expressionProp,name:'Expression'},{value:delegateExpressionProp,name:'Delegate Expression'},{value:scriptProp,name:'Script'}],modelProperty:'listenerType',emptyParameter:false,get:function(element,node){var listener=getSelectedListener(element,node);return{listenerType:ImplementationTypeHelper.getImplementationType(listener)};},set:function(element,values,node){var listener=getSelectedListener(element,node),listenerType=values.listenerType||undefined,update={};update[classProp]=listenerType===classProp?'':undefined;update[expressionProp]=listenerType===expressionProp?'':undefined;update[delegateExpressionProp]=listenerType===delegateExpressionProp?'':undefined;update[scriptProp]=listenerType===scriptProp?bpmnFactory.create('camunda:Script'):undefined;return cmdHelper.updateBusinessObject(element,listener,update);},hidden:function(element,node){return!isSelected(element,node);}}));group.entries.push(entryFactory.textField({id:'listener-value',dataValueLabel:'listenerValueLabel',modelProperty:'listenerValue',get:function(element,node){var value={},listener=getSelectedListener(element,node),listenerType=ImplementationTypeHelper.getImplementationType(listener);value.listenerValueLabel=LISTENER_TYPE_LABEL[listenerType]||'';value.listenerValue=(listener&&listener.get(listenerType))||undefined;return value;},set:function(element,values,node){var update={},listener=getSelectedListener(element,node),listenerType=ImplementationTypeHelper.getImplementationType(listener);update[listenerType]=values.listenerValue||'';return cmdHelper.updateBusinessObject(element,listener,update);},hidden:function(element,node){var listener=getSelectedListener(element,node);return!listener||listener.script;},validate:function(element,values){var value=values.listenerValue,validate={};if(!value){validate.listenerValue='Must provide a value';}return validate;}}));group.entries.push({id:'listener-script-value',html:'<div data-show="isScript">'+script.template+'</div>',get:function(element,node){var listener=getSelectedListener(element,node);return listener&&listener.script?script.get(element,listener.script):{};},set:function(element,values,node){var listener=getSelectedListener(element,node);var update=script.set(element,values,listener);return cmdHelper.updateBusinessObject(element,listener.script,update);},validate:function(element,values,node){var listener=getSelectedListener(element,node);return listener&&listener.script?script.validate(element,values):{};},isScript:function(element,node){var listener=getSelectedListener(element,node);return listener&&listener.script;},script:script});};},{"../../../factory/EntryFactory":15,"../../../helper/CmdHelper":25,"../../../helper/ImplementationTypeHelper":30,"./implementation/Script":103}],76:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign');var fieldInjection=require('./implementation/FieldInjection');module.exports=function(group,element,bpmnFactory,options){options=assign({idPrefix:'listener-',insideListener:true},options);var fieldInjectionEntry=fieldInjection(element,bpmnFactory,options);if(fieldInjectionEntry&&fieldInjectionEntry.length>0){group.entries=group.entries.concat(fieldInjectionEntry);}};},{"./implementation/FieldInjection":93,"lodash/object/assign":547}],77:[function(require,module,exports){'use strict';var listener=require('./implementation/Listener');module.exports=function(group,element,bpmnFactory){var listenerEntry=listener(element,bpmnFactory);group.entries=group.entries.concat(listenerEntry.entries);return{getSelectedListener:listenerEntry.getSelectedListener};};},{"./implementation/Listener":99}],78:[function(require,module,exports){'use strict';var getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject,is=require('bpmn-js/lib/util/ModelUtil').is;var multiInstanceLoopCharacteristics=require('./implementation/MultiInstanceLoopCharacteristics');var jobRetryTimeCycle=require('./implementation/JobRetryTimeCycle'),asyncContinuation=require('./implementation/AsyncContinuation');function getLoopCharacteristics(element){var bo=getBusinessObject(element);return bo.loopCharacteristics;}function ensureMultiInstanceSupported(element){var loopCharacteristics=getLoopCharacteristics(element);return!!loopCharacteristics&&is(loopCharacteristics,'camunda:Collectable');}module.exports=function(group,element,bpmnFactory){if(!ensureMultiInstanceSupported(element)){return;}group.entries=group.entries.concat(multiInstanceLoopCharacteristics(element,bpmnFactory));group.entries=group.entries.concat(asyncContinuation(element,bpmnFactory,{getBusinessObject:getLoopCharacteristics,idPrefix:'multiInstance-',labelPrefix:'Multi Instance '}));group.entries=group.entries.concat(jobRetryTimeCycle(element,bpmnFactory,{getBusinessObject:getLoopCharacteristics,idPrefix:'multiInstance-',labelPrefix:'Multi Instance '}));};},{"./implementation/AsyncContinuation":87,"./implementation/JobRetryTimeCycle":98,"./implementation/MultiInstanceLoopCharacteristics":100,"bpmn-js/lib/util/ModelUtil":197}],79:[function(require,module,exports){'use strict';var properties=require('./implementation/Properties'),elementHelper=require('../../../helper/ElementHelper'),cmdHelper=require('../../../helper/CmdHelper');module.exports=function(group,element,bpmnFactory){var propertiesEntry=properties(element,bpmnFactory,{id:'properties',modelProperties:['name','value'],labels:['Name','Value'],getParent:function(element,node,bo){return bo.extensionElements;},createParent:function(element,bo){var parent=elementHelper.createElement('bpmn:ExtensionElements',{values:[]},bo,bpmnFactory);var cmd=cmdHelper.updateBusinessObject(element,bo,{extensionElements:parent});return{cmd:cmd,parent:parent};}});if(propertiesEntry){group.entries.push(propertiesEntry);}};},{"../../../helper/CmdHelper":25,"../../../helper/ElementHelper":26,"./implementation/Properties":101}],80:[function(require,module,exports){'use strict';var getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject,is=require('bpmn-js/lib/util/ModelUtil').is,entryFactory=require('../../../factory/EntryFactory'),cmdHelper=require('../../../helper/CmdHelper'),script=require('./implementation/Script')('scriptFormat','script',false);module.exports=function(group,element,bpmnFactory){var bo;if(is(element,'bpmn:ScriptTask')){bo=getBusinessObject(element);}if(!bo){return;}group.entries.push({id:'script-implementation',label:'Script',html:script.template,get:function(element){return script.get(element,bo);},set:function(element,values,containerElement){var properties=script.set(element,values,containerElement);return cmdHelper.updateProperties(element,properties);},validate:function(element,values){return script.validate(element,values);},script:script,cssClasses:['bpp-textfield']});group.entries.push(entryFactory.textField({id:'scriptResultVariable',label:'Result Variable',modelProperty:'scriptResultVariable',get:function(element,propertyName){var boResultVariable=bo.get('camunda:resultVariable');return{scriptResultVariable:boResultVariable};},set:function(element,values,containerElement){return cmdHelper.updateProperties(element,{'camunda:resultVariable':values.scriptResultVariable});}}));};},{"../../../factory/EntryFactory":15,"../../../helper/CmdHelper":25,"./implementation/Script":103,"bpmn-js/lib/util/ModelUtil":197}],81:[function(require,module,exports){'use strict';var is=require('bpmn-js/lib/util/ModelUtil').is,isAny=require('bpmn-js/lib/features/modeling/util/ModelingUtil').isAny,getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject,domQuery=require('min-dom/lib/query'),cmdHelper=require('../../../helper/CmdHelper'),elementHelper=require('../../../helper/ElementHelper'),script=require('./implementation/Script')('language','body',true);module.exports=function(group,element,bpmnFactory){var bo;if(is(element,'bpmn:SequenceFlow')){bo=getBusinessObject(element);}if(!bo){return;}if(!isConditionalSource(element.source)){return;}group.entries.push({id:'condition',label:'Condition',html:'<div class="bpp-row">'+'<label for="cam-condition-type">Condition Type</label>'+'<div class="bpp-field-wrapper">'+'<select id="cam-condition-type" name="conditionType" data-value>'+'<option value="expression">Expression</option>'+'<option value="script">Script</option>'+'<option value="" selected></option>'+'</select>'+'</div>'+'</div>'+'<div class="bpp-row">'+'<label for="cam-condition" data-show="isExpression">Expression</label>'+'<div class="bpp-field-wrapper" data-show="isExpression">'+'<input id="cam-condition" type="text" name="condition" />'+'<button class="clear" data-action="clear" data-show="canClear">'+'<span>X</span>'+'</button>'+'</div>'+'<div data-show="isScript">'+script.template+'</div>'+'</div>',get:function(element,propertyName){var conditionExpression=bo.conditionExpression;var values={},conditionType='';if(conditionExpression){var conditionLanguage=conditionExpression.language;if(typeof conditionLanguage!=='undefined'){conditionType='script';values=script.get(element,conditionExpression);}else{conditionType='expression';values.condition=conditionExpression.get('body');}}values.conditionType=conditionType;return values;},set:function(element,values,containerElement){var conditionType=values.conditionType;var commands=[];var conditionProps={body:undefined};if(conditionType==='script'){conditionProps=script.set(element,values,containerElement);}else{var condition=values.condition;conditionProps.body=condition;}var update={'conditionExpression':undefined};if(conditionType){update.conditionExpression=elementHelper.createElement('bpmn:FormalExpression',conditionProps,bo,bpmnFactory);var source=element.source;if(source.businessObject.default===bo){commands.push(cmdHelper.updateProperties(source,{'default':undefined}));}}commands.push(cmdHelper.updateBusinessObject(element,bo,update));return commands;},validate:function(element,values){var validationResult={};if(!values.condition&&values.conditionType==='expression'){validationResult.condition='Must provide a value';}else if(values.conditionType==='script'){validationResult=script.validate(element,values);}return validationResult;},isExpression:function(element,inputNode){var conditionType=domQuery('select[name=conditionType]',inputNode);if(conditionType.selectedIndex>=0){return conditionType.options[conditionType.selectedIndex].value==='expression';}},isScript:function(element,inputNode){var conditionType=domQuery('select[name=conditionType]',inputNode);if(conditionType.selectedIndex>=0){return conditionType.options[conditionType.selectedIndex].value==='script';}},clear:function(element,inputNode){domQuery('input[name=condition]',inputNode).value='';return true;},canClear:function(element,inputNode){var input=domQuery('input[name=condition]',inputNode);return input.value!=='';},script:script,cssClasses:['bpp-textfield']});};var CONDITIONAL_SOURCES=['bpmn:Activity','bpmn:ExclusiveGateway','bpmn:InclusiveGateway','bpmn:ComplexGateway'];function isConditionalSource(element){return isAny(element,CONDITIONAL_SOURCES);}},{"../../../helper/CmdHelper":25,"../../../helper/ElementHelper":26,"./implementation/Script":103,"bpmn-js/lib/features/modeling/util/ModelingUtil":170,"bpmn-js/lib/util/ModelUtil":197,"min-dom/lib/query":569}],82:[function(require,module,exports){'use strict';var ImplementationTypeHelper=require('../../../helper/ImplementationTypeHelper'),InputOutputHelper=require('../../../helper/InputOutputHelper');var implementationType=require('./implementation/ImplementationType'),delegate=require('./implementation/Delegate'),external=require('./implementation/External'),callable=require('./implementation/Callable'),resultVariable=require('./implementation/ResultVariable');var entryFactory=require('../../../factory/EntryFactory');var domQuery=require('min-dom/lib/query'),domClosest=require('min-dom/lib/closest'),domClasses=require('min-dom/lib/classes');function getImplementationType(element){return ImplementationTypeHelper.getImplementationType(element);}function getBusinessObject(element){return ImplementationTypeHelper.getServiceTaskLikeBusinessObject(element);}function isDmnCapable(element){return ImplementationTypeHelper.isDmnCapable(element);}function isExternalCapable(element){return ImplementationTypeHelper.isExternalCapable(element);}function isServiceTaskLike(element){return ImplementationTypeHelper.isServiceTaskLike(element);}module.exports=function(group,element,bpmnFactory){if(!isServiceTaskLike(getBusinessObject(element))){return;}var hasDmnSupport=isDmnCapable(element);var hasExternalSupport=isExternalCapable(getBusinessObject(element));group.entries=group.entries.concat(implementationType(element,bpmnFactory,{getBusinessObject:getBusinessObject,getImplementationType:getImplementationType,hasDmnSupport:hasDmnSupport,hasExternalSupport:hasExternalSupport,hasServiceTaskLikeSupport:true}));group.entries=group.entries.concat(delegate(element,bpmnFactory,{getBusinessObject:getBusinessObject,getImplementationType:getImplementationType}));group.entries=group.entries.concat(resultVariable(element,bpmnFactory,{getBusinessObject:getBusinessObject,getImplementationType:getImplementationType,hideResultVariable:function(element,node){return getImplementationType(element)!=='expression';}}));if(hasExternalSupport){group.entries=group.entries.concat(external(element,bpmnFactory,{getBusinessObject:getBusinessObject,getImplementationType:getImplementationType}));}if(hasDmnSupport){group.entries=group.entries.concat(callable(element,bpmnFactory,{getCallableType:getImplementationType}));}var isConnector=function(element){return getImplementationType(element)==='connector';};group.entries.push(entryFactory.link({id:'configureConnectorLink',label:'Configure Connector',getClickableElement:function(element,node){var panel=domClosest(node,'div.bpp-properties-panel');return domQuery('a[data-tab-target="connector"]',panel);},hideLink:function(element,node){var link=domQuery('a',node);link.innerHTML=link.textContent='';domClasses(link).remove('bpp-error-message');if(isConnector(element)){var connectorId=InputOutputHelper.getConnector(element).get('connectorId');if(connectorId){link.textContent='Configure Connector';}else{link.innerHTML='<span class="bpp-icon-warning"></span> Must configure Connector';domClasses(link).add('bpp-error-message');}return false;}return true;}}));};},{"../../../factory/EntryFactory":15,"../../../helper/ImplementationTypeHelper":30,"../../../helper/InputOutputHelper":31,"./implementation/Callable":88,"./implementation/Delegate":89,"./implementation/External":91,"./implementation/ImplementationType":94,"./implementation/ResultVariable":102,"min-dom/lib/classes":562,"min-dom/lib/closest":564,"min-dom/lib/query":569}],83:[function(require,module,exports){'use strict';var entryFactory=require('../../../factory/EntryFactory'),is=require('bpmn-js/lib/util/ModelUtil').is,getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject;module.exports=function(group,element){var bo=getBusinessObject(element);if(!bo){return;}if(is(element,'camunda:Initiator')&&!is(element.parent,'bpmn:SubProcess')){group.entries.push(entryFactory.textField({id:'initiator',label:'Initiator',modelProperty:'initiator'}));}};},{"../../../factory/EntryFactory":15,"bpmn-js/lib/util/ModelUtil":197}],84:[function(require,module,exports){'use strict';var is=require('bpmn-js/lib/util/ModelUtil').is,entryFactory=require('../../../factory/EntryFactory');module.exports=function(group,element){if(is(element,'camunda:Assignable')){group.entries.push(entryFactory.textField({id:'dueDate',description:'任务到期时间(例如 ${someDate}或者是一个ISO日期(例如 2015-06-26T09:54:00)',label:'任务到期时间',modelProperty:'dueDate'}));group.entries.push(entryFactory.textField({id:'followUpDate',description:'任务跟进时间(例如 ${someDate}或者是一个ISO日期(例如 2015-06-26T09:54:00)',label:'任务跟进时间',modelProperty:'followUpDate'}));group.entries.push(entryFactory.textField({id:'priority',label:'优先级',modelProperty:'priority'}));}};},{"../../../factory/EntryFactory":15,"bpmn-js/lib/util/ModelUtil":197}],85:[function(require,module,exports){'use strict';var is=require('bpmn-js/lib/util/ModelUtil').is,getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject;var filter=require('lodash/collection/filter');var extensionElementsHelper=require('../../../helper/ExtensionElementsHelper'),cmdHelper=require('../../../helper/CmdHelper'),elementHelper=require('../../../helper/ElementHelper');var extensionElementsEntry=require('./implementation/ExtensionElements');var entryFactory=require('../../../factory/EntryFactory');var inOutTypeOptions=[{name:'Source',value:'source'},{name:'Source Expression',value:'sourceExpression'},{name:'All',value:'variables'}];function getCamundaInOutMappings(element,type){var bo=getBusinessObject(element);return extensionElementsHelper.getExtensionElements(bo,type)||[];}function getVariableMappings(element,type){var camundaMappings=getCamundaInOutMappings(element,type);return filter(camundaMappings,function(mapping){return!mapping.businessKey;});}function getInOutType(mapping){var inOutType='source';if(mapping.variables==='all'){inOutType='variables';}else if(typeof mapping.source!=='undefined'){inOutType='source';}else if(typeof mapping.sourceExpression!=='undefined'){inOutType='sourceExpression';}return inOutType;}var CAMUNDA_IN_EXTENSION_ELEMENT='camunda:In',CAMUNDA_OUT_EXTENSION_ELEMENT='camunda:Out';module.exports=function(group,element,bpmnFactory){if(!is(element,'camunda:CallActivity')){return;}var isSelected=function(element,node){return!!getSelected(element,node);};var getSelected=function(element,node){var parentNode=node.parentNode;var selection=inEntry.getSelected(element,parentNode);var parameter=getVariableMappings(element,CAMUNDA_IN_EXTENSION_ELEMENT)[selection.idx];if(!parameter&&outEntry){selection=outEntry.getSelected(element,parentNode);parameter=getVariableMappings(element,CAMUNDA_OUT_EXTENSION_ELEMENT)[selection.idx];}return parameter;};var setOptionLabelValue=function(type){return function(element,node,option,property,value,idx){var label=idx+' : ';var variableMappings=getVariableMappings(element,type);var mappingValue=variableMappings[idx];var mappingType=getInOutType(mappingValue);if(mappingType==='variables'){label=label+'all';}else if(mappingType==='source'){label=label+(mappingValue.source||'<empty>');}else if(mappingType==='sourceExpression'){label=label+(mappingValue.sourceExpression||'<empty>');}else{label=label+'<empty>';}option.text=label;};};var newElement=function(type){return function(element,extensionElements,value){var newElem=elementHelper.createElement(type,{source:''},extensionElements,bpmnFactory);return cmdHelper.addElementsTolist(element,extensionElements,'values',[newElem]);};};var removeElement=function(type){return function(element,extensionElements,value,idx){var variablesMappings=getVariableMappings(element,type);var mapping=variablesMappings[idx];if(mapping){return extensionElementsHelper.removeEntry(getBusinessObject(element),element,mapping);}};};var inEntry=extensionElementsEntry(element,bpmnFactory,{id:'variableMapping-in',label:'In Mapping',modelProperty:'source',prefix:'In',idGeneration:false,resizable:true,createExtensionElement:newElement(CAMUNDA_IN_EXTENSION_ELEMENT),removeExtensionElement:removeElement(CAMUNDA_IN_EXTENSION_ELEMENT),getExtensionElements:function(element){return getVariableMappings(element,CAMUNDA_IN_EXTENSION_ELEMENT);},onSelectionChange:function(element,node,event,scope){outEntry&&outEntry.deselect(element,node.parentNode);},setOptionLabelValue:setOptionLabelValue(CAMUNDA_IN_EXTENSION_ELEMENT)});group.entries.push(inEntry);var outEntry=extensionElementsEntry(element,bpmnFactory,{id:'variableMapping-out',label:'Out Mapping',modelProperty:'source',prefix:'Out',idGeneration:false,resizable:true,createExtensionElement:newElement(CAMUNDA_OUT_EXTENSION_ELEMENT),removeExtensionElement:removeElement(CAMUNDA_OUT_EXTENSION_ELEMENT),getExtensionElements:function(element){return getVariableMappings(element,CAMUNDA_OUT_EXTENSION_ELEMENT);},onSelectionChange:function(element,node,event,scope){inEntry.deselect(element,node.parentNode);},setOptionLabelValue:setOptionLabelValue(CAMUNDA_OUT_EXTENSION_ELEMENT)});group.entries.push(outEntry);group.entries.push(entryFactory.label({id:'variableMapping-typeLabel',get:function(element,node){var mapping=getSelected(element,node);var value='';if(is(mapping,CAMUNDA_IN_EXTENSION_ELEMENT)){value='In Mapping';}else if(is(mapping,CAMUNDA_OUT_EXTENSION_ELEMENT)){value='Out Mapping';}return{label:value};},showLabel:function(element,node){return isSelected(element,node);}}));group.entries.push(entryFactory.selectBox({id:'variableMapping-inOutType',label:'Type',selectOptions:inOutTypeOptions,modelProperty:'inOutType',get:function(element,node){var mapping=getSelected(element,node)||{};return{inOutType:getInOutType(mapping)};},set:function(element,values,node){var inOutType=values.inOutType;var props={'source':undefined,'sourceExpression':undefined,'variables':undefined};if(inOutType==='source'){props.source='';}else if(inOutType==='sourceExpression'){props.sourceExpression='';}else if(inOutType==='variables'){props.variables='all';}var mapping=getSelected(element,node);return cmdHelper.updateBusinessObject(element,mapping,props);},hidden:function(element,node){return!isSelected(element,node);}}));group.entries.push(entryFactory.textField({id:'variableMapping-source',dataValueLabel:'sourceLabel',modelProperty:'source',get:function(element,node){var mapping=getSelected(element,node)||{};var label='';var inOutType=getInOutType(mapping);if(inOutType==='source'){label='Source';}else if(inOutType==='sourceExpression'){label='Source Expression';}return{source:mapping[inOutType],sourceLabel:label};},set:function(element,values,node){values.source=values.source||undefined;var mapping=getSelected(element,node);var inOutType=getInOutType(mapping);var props={};props[inOutType]=values.source||'';return cmdHelper.updateBusinessObject(element,mapping,props);},validate:function(element,values,node){var mapping=getSelected(element,node);var validation={};if(mapping){if(!values.source){validation.source='Mapping must have a '+values.sourceLabel.toLowerCase()||'value';}}return validation;},hidden:function(element,node){var selectedMapping=getSelected(element,node);return!selectedMapping||(selectedMapping&&selectedMapping.variables);}}));group.entries.push(entryFactory.textField({id:'variableMapping-target',label:'Target',modelProperty:'target',get:function(element,node){return{target:(getSelected(element,node)||{}).target};},set:function(element,values,node){values.target=values.target||undefined;var mapping=getSelected(element,node);return cmdHelper.updateBusinessObject(element,mapping,values);},validate:function(element,values,node){var mapping=getSelected(element,node);var validation={};if(mapping){var mappingType=getInOutType(mapping);if(!values.target&&mappingType!=='variables'){validation.target='Mapping must have a target';}}return validation;},hidden:function(element,node){var selectedMapping=getSelected(element,node);return!selectedMapping||(selectedMapping&&selectedMapping.variables);}}));group.entries.push(entryFactory.checkbox({id:'variableMapping-local',label:'Local',modelProperty:'local',get:function(element,node){return{local:(getSelected(element,node)||{}).local};},set:function(element,values,node){values.local=values.local||false;var mapping=getSelected(element,node);return cmdHelper.updateBusinessObject(element,mapping,values);},hidden:function(element,node){return!isSelected(element,node);}}));};},{"../../../factory/EntryFactory":15,"../../../helper/CmdHelper":25,"../../../helper/ElementHelper":26,"../../../helper/ExtensionElementsHelper":28,"./implementation/ExtensionElements":90,"bpmn-js/lib/util/ModelUtil":197,"lodash/collection/filter":415}],86:[function(require,module,exports){'use strict';var entryFactory=require('../../../factory/EntryFactory'),cmdHelper=require('../../../helper/CmdHelper'),is=require('bpmn-js/lib/util/ModelUtil').is,getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject;module.exports=function(group,element){var bo=getBusinessObject(element);if(!bo){return;}if(is(element,'bpmn:Process')||is(element,'bpmn:Participant')&&bo.get('processRef')){var versionTagEntry=entryFactory.textField({id:'versionTag',label:'版本标签',modelProperty:'versionTag'});if(is(element,'bpmn:Participant')){versionTagEntry.get=function(element){var processBo=bo.get('processRef');return{versionTag:processBo.get('camunda:versionTag')};};versionTagEntry.set=function(element,values){var processBo=bo.get('processRef');return cmdHelper.updateBusinessObject(element,processBo,{'camunda:versionTag':values.versionTag||undefined});};}group.entries.push(versionTagEntry);}};},{"../../../factory/EntryFactory":15,"../../../helper/CmdHelper":25,"bpmn-js/lib/util/ModelUtil":197}],87:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign');var entryFactory=require('../../../../factory/EntryFactory');var asyncCapableHelper=require('../../../../helper/AsyncCapableHelper'),eventDefinitionHelper=require('../../../../helper/EventDefinitionHelper'),cmdHelper=require('../../../../helper/CmdHelper');function isAsyncBefore(bo){return asyncCapableHelper.isAsyncBefore(bo);}function isAsyncAfter(bo){return asyncCapableHelper.isAsyncAfter(bo);}function isExclusive(bo){return asyncCapableHelper.isExclusive(bo);}function removeFailedJobRetryTimeCycle(bo,element){return asyncCapableHelper.removeFailedJobRetryTimeCycle(bo,element);}function canRemoveFailedJobRetryTimeCycle(element){return!eventDefinitionHelper.getTimerEventDefinition(element);}module.exports=function(element,bpmnFactory,options){var getBusinessObject=options.getBusinessObject;var idPrefix=options.idPrefix||'',labelPrefix=options.labelPrefix||'';var asyncBeforeEntry=entryFactory.checkbox({id:idPrefix+'asyncBefore',label:labelPrefix+'Asynchronous Before',modelProperty:'asyncBefore',get:function(element,node){var bo=getBusinessObject(element);return{asyncBefore:isAsyncBefore(bo)};},set:function(element,values){var bo=getBusinessObject(element);var asyncBefore=!!values.asyncBefore;var props={'camunda:asyncBefore':asyncBefore,'camunda:async':false};var commands=[];if(!isAsyncAfter(bo)&&!asyncBefore){props=assign({'camunda:exclusive':true},props);if(canRemoveFailedJobRetryTimeCycle(element)){commands.push(removeFailedJobRetryTimeCycle(bo,element));}}commands.push(cmdHelper.updateBusinessObject(element,bo,props));return commands;}});var asyncAfterEntry=entryFactory.checkbox({id:idPrefix+'asyncAfter',label:labelPrefix+'Asynchronous After',modelProperty:'asyncAfter',get:function(element,node){var bo=getBusinessObject(element);return{asyncAfter:isAsyncAfter(bo)};},set:function(element,values){var bo=getBusinessObject(element);var asyncAfter=!!values.asyncAfter;var props={'camunda:asyncAfter':asyncAfter};var commands=[];if(!isAsyncBefore(bo)&&!asyncAfter){props=assign({'camunda:exclusive':true},props);if(canRemoveFailedJobRetryTimeCycle(element)){commands.push(removeFailedJobRetryTimeCycle(bo,element));}}commands.push(cmdHelper.updateBusinessObject(element,bo,props));return commands;}});var exclusiveEntry=entryFactory.checkbox({id:idPrefix+'exclusive',label:labelPrefix+'Exclusive',modelProperty:'exclusive',get:function(element,node){var bo=getBusinessObject(element);return{exclusive:isExclusive(bo)};},set:function(element,values){var bo=getBusinessObject(element);return cmdHelper.updateBusinessObject(element,bo,{'camunda:exclusive':!!values.exclusive});},hidden:function(element){var bo=getBusinessObject(element);return bo&&!isAsyncAfter(bo)&&!isAsyncBefore(bo);}});return[asyncBeforeEntry,asyncAfterEntry,exclusiveEntry];};},{"../../../../factory/EntryFactory":15,"../../../../helper/AsyncCapableHelper":24,"../../../../helper/CmdHelper":25,"../../../../helper/EventDefinitionHelper":27,"lodash/object/assign":547}],88:[function(require,module,exports){'use strict';var cmdHelper=require('../../../../helper/CmdHelper'),entryFactory=require('../../../../factory/EntryFactory'),elementHelper=require('../../../../helper/ElementHelper'),extensionElementsHelper=require('../../../../helper/ExtensionElementsHelper');var resultVariable=require('./ResultVariable');var getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject;var is=require('bpmn-js/lib/util/ModelUtil').is;var forEach=require('lodash/collection/forEach');var attributeInfo={bpmn:{element:'calledElement',binding:'camunda:calledElementBinding',version:'camunda:calledElementVersion',tenantId:'camunda:calledElementTenantId'},cmmn:{element:'camunda:caseRef',binding:'camunda:caseBinding',version:'camunda:caseVersion',tenantId:'camunda:caseTenantId'},dmn:{element:'camunda:decisionRef',binding:'camunda:decisionRefBinding',version:'camunda:decisionRefVersion',tenantId:'camunda:decisionRefTenantId'}};var bindingOptions=[{name:'latest',value:'latest'},{name:'deployment',value:'deployment'},{name:'version',value:'version'}];var mapDecisionResultOptions=[{name:'singleEntry',value:'singleEntry'},{name:'singleResult',value:'singleResult'},{name:'collectEntries',value:'collectEntries'},{name:'resultList',value:'resultList'}];var delegateVariableMappingOptions=[{name:'variableMappingClass',value:'variableMappingClass'},{name:'variableMappingDelegateExpression',value:'variableMappingDelegateExpression'}];function getCamundaInWithBusinessKey(element){var camundaIn=[],bo=getBusinessObject(element);var camundaInParams=extensionElementsHelper.getExtensionElements(bo,'camunda:In');if(camundaInParams){forEach(camundaInParams,function(param){if(param.businessKey){camundaIn.push(param);}});}return camundaIn;}function setBusinessKey(element,bpmnFactory){var bo=getBusinessObject(element);var commands=[];var extensionElements=bo.extensionElements;if(!extensionElements){extensionElements=elementHelper.createElement('bpmn:ExtensionElements',{values:[]},bo,bpmnFactory);commands.push(cmdHelper.updateProperties(element,{extensionElements:extensionElements}));}var camundaIn=elementHelper.createElement('camunda:In',{'businessKey':'#{execution.processBusinessKey}'},extensionElements,bpmnFactory);commands.push(cmdHelper.addAndRemoveElementsFromList(element,extensionElements,'values','extensionElements',[camundaIn],[]));return commands;}function deleteBusinessKey(element){var camundaInExtensions=getCamundaInWithBusinessKey(element);var commands=[];forEach(camundaInExtensions,function(elem){commands.push(extensionElementsHelper.removeEntry(getBusinessObject(element),element,elem));});return commands;}function isSupportedCallableType(type){return['bpmn','cmmn','dmn'].indexOf(type)!==-1;}module.exports=function(element,bpmnFactory,options){var getCallableType=options.getCallableType;var entries=[];function getAttribute(element,prop){var type=getCallableType(element);return(attributeInfo[type]||{})[prop];}function getCallActivityBindingValue(element){var type=getCallableType(element);var bo=getBusinessObject(element);var attr=(attributeInfo[type]||{}).binding;return bo.get(attr);}function getDelegateVariableMappingType(element){var bo=getBusinessObject(element);var boVariableMappingClass=bo.get('camunda:variableMappingClass'),boVariableMappingDelegateExpression=bo.get('camunda:variableMappingDelegateExpression');var delegateVariableMappingType='';if(typeof boVariableMappingClass!=='undefined'){delegateVariableMappingType='variableMappingClass';}else
if(typeof boVariableMappingDelegateExpression!=='undefined'){delegateVariableMappingType='variableMappingDelegateExpression';}return delegateVariableMappingType;}entries.push(entryFactory.textField({id:'callable-element-ref',dataValueLabel:'callableElementLabel',modelProperty:'callableElementRef',get:function(element,node){var callableElementRef;var attr=getAttribute(element,'element');if(attr){var bo=getBusinessObject(element);callableElementRef=bo.get(attr);}var label='';var type=getCallableType(element);if(type==='bpmn'){label='Called Element';}else if(type==='cmmn'){label='Case Ref';}else if(type==='dmn'){label='Decision Ref';}return{callableElementRef:callableElementRef,callableElementLabel:label};},set:function(element,values,node){var newCallableElementRef=values.callableElementRef;var attr=getAttribute(element,'element');var props={};props[attr]=newCallableElementRef||'';return cmdHelper.updateProperties(element,props);},validate:function(element,values,node){var elementRef=values.callableElementRef;var type=getCallableType(element);return isSupportedCallableType(type)&&!elementRef?{callableElementRef:'Value must provide a value.'}:{};},hidden:function(element,node){return!isSupportedCallableType(getCallableType(element));}}));entries.push(entryFactory.selectBox({id:'callable-binding',label:'Binding',selectOptions:bindingOptions,modelProperty:'callableBinding',get:function(element,node){var callableBinding;var attr=getAttribute(element,'binding');if(attr){var bo=getBusinessObject(element);callableBinding=bo.get(attr)||'latest';}return{callableBinding:callableBinding};},set:function(element,values,node){var binding=values.callableBinding;var attr=getAttribute(element,'binding'),attrVer=getAttribute(element,'version');var props={};props[attr]=binding;props[attrVer]=undefined;return cmdHelper.updateProperties(element,props);},hidden:function(element,node){return!isSupportedCallableType(getCallableType(element));}}));entries.push(entryFactory.textField({id:'callable-version',label:'Version',modelProperty:'callableVersion',get:function(element,node){var callableVersion;var attr=getAttribute(element,'version');if(attr){var bo=getBusinessObject(element);callableVersion=bo.get(attr);}return{callableVersion:callableVersion};},set:function(element,values,node){var version=values.callableVersion;var attr=getAttribute(element,'version');var props={};props[attr]=version||undefined;return cmdHelper.updateProperties(element,props);},validate:function(element,values,node){var version=values.callableVersion;var type=getCallableType(element);return isSupportedCallableType(type)&&(getCallActivityBindingValue(element)==='version')&&!version?{callableVersion:'Value must provide a value.'}:{};},hidden:function(element,node){var type=getCallableType(element);return!isSupportedCallableType(type)||getCallActivityBindingValue(element)!=='version';}}));entries.push(entryFactory.textField({id:'tenant-id',label:'Tenant Id',modelProperty:'tenantId',get:function(element,node){var tenantId;var attr=getAttribute(element,'tenantId');if(attr){var bo=getBusinessObject(element);tenantId=bo.get(attr);}return{tenantId:tenantId};},set:function(element,values,node){var tenantId=values.tenantId;var attr=getAttribute(element,'tenantId');var props={};props[attr]=tenantId||undefined;return cmdHelper.updateProperties(element,props);},hidden:function(element,node){var type=getCallableType(element);return!isSupportedCallableType(type);}}));if(is(getBusinessObject(element),'bpmn:CallActivity')){entries.push(entryFactory.checkbox({id:'callable-business-key',label:'Business Key',modelProperty:'callableBusinessKey',get:function(element,node){var camundaIn=getCamundaInWithBusinessKey(element);return{callableBusinessKey:!!(camundaIn&&camundaIn.length>0)};},set:function(element,values,node){if(values.callableBusinessKey){return setBusinessKey(element,bpmnFactory);}else{return deleteBusinessKey(element);}}}));}entries=entries.concat(resultVariable(element,bpmnFactory,{id:'dmn-resultVariable',getBusinessObject:getBusinessObject,getImplementationType:getCallableType,hideResultVariable:function(element,node){return getCallableType(element)!=='dmn';}}));entries.push(entryFactory.selectBox({id:'dmn-map-decision-result',label:'Map Decision Result',selectOptions:mapDecisionResultOptions,modelProperty:'mapDecisionResult',get:function(element,node){var bo=getBusinessObject(element);return{mapDecisionResult:bo.get('camunda:mapDecisionResult')||'resultList'};},set:function(element,values,node){return cmdHelper.updateProperties(element,{'camunda:mapDecisionResult':values.mapDecisionResult||'resultList'});},hidden:function(element,node){var bo=getBusinessObject(element);var resultVariable=bo.get('camunda:resultVariable');return!(getCallableType(element)==='dmn'&&typeof resultVariable!=='undefined');}}));entries.push(entryFactory.selectBox({id:'delegateVariableMappingType',label:'Delegate Variable Mapping',selectOptions:delegateVariableMappingOptions,emptyParameter:true,modelProperty:'delegateVariableMappingType',get:function(element,node){return{delegateVariableMappingType:getDelegateVariableMappingType(element)};},set:function(element,values,node){var delegateVariableMappingType=values.delegateVariableMappingType;var props={'camunda:variableMappingClass':undefined,'camunda:variableMappingDelegateExpression':undefined};if(delegateVariableMappingType==='variableMappingClass'){props['camunda:variableMappingClass']='';}else if(delegateVariableMappingType==='variableMappingDelegateExpression'){props['camunda:variableMappingDelegateExpression']='';}return cmdHelper.updateProperties(element,props);},hidden:function(element,node){return(getCallableType(element)!=='bpmn');}}));entries.push(entryFactory.textField({id:'delegateVariableMapping',dataValueLabel:'delegateVariableMappingLabel',modelProperty:'delegateVariableMapping',get:function(element,node){var bo=getBusinessObject(element);var label='';var delegateVariableMapping=undefined;var type=getDelegateVariableMappingType(element);if(type==='variableMappingClass'){label='Class';delegateVariableMapping=bo.get('camunda:variableMappingClass');}else if(type==='variableMappingDelegateExpression'){label='Delegate Expression';delegateVariableMapping=bo.get('camunda:variableMappingDelegateExpression');}return{delegateVariableMapping:delegateVariableMapping,delegateVariableMappingLabel:label};},set:function(element,values,node){var delegateVariableMapping=values.delegateVariableMapping;var attr='camunda:'+getDelegateVariableMappingType(element);var props={};props[attr]=delegateVariableMapping||undefined;return cmdHelper.updateProperties(element,props);},validate:function(element,values,node){var delegateVariableMapping=values.delegateVariableMapping;return(getCallableType(element)==='bpmn')&&!delegateVariableMapping?{delegateVariableMapping:'Must provide a value.'}:{};},hidden:function(element,node){return!(getCallableType(element)==='bpmn'&&getDelegateVariableMappingType(element)!=='');}}));return entries;};},{"../../../../factory/EntryFactory":15,"../../../../helper/CmdHelper":25,"../../../../helper/ElementHelper":26,"../../../../helper/ExtensionElementsHelper":28,"./ResultVariable":102,"bpmn-js/lib/util/ModelUtil":197,"lodash/collection/forEach":417}],89:[function(require,module,exports){'use strict';var entryFactory=require('../../../../factory/EntryFactory'),cmdHelper=require('../../../../helper/CmdHelper');var DELEGATE_TYPES=['class','expression','delegateExpression'];var PROPERTIES={class:'camunda:class',expression:'camunda:expression',delegateExpression:'camunda:delegateExpression'};function isDelegate(type){return DELEGATE_TYPES.indexOf(type)!==-1;}function getAttribute(type){return PROPERTIES[type];}function getDelegationLabel(type){switch(type){case'class':return'Java Class';case'expression':return'Expression';case'delegateExpression':return'Delegate Expression';default:return'';}}module.exports=function(element,bpmnFactory,options){var getImplementationType=options.getImplementationType,getBusinessObject=options.getBusinessObject;var delegateEntry=entryFactory.textField({id:'delegate',label:'Value',dataValueLabel:'delegationLabel',modelProperty:'delegate',get:function(element,node){var bo=getBusinessObject(element);var type=getImplementationType(element);var attr=getAttribute(type);var label=getDelegationLabel(type);return{delegate:bo.get(attr),delegationLabel:label};},set:function(element,values,node){var bo=getBusinessObject(element);var type=getImplementationType(element);var attr=getAttribute(type);var prop={};prop[attr]=values.delegate||'';return cmdHelper.updateBusinessObject(element,bo,prop);},validate:function(element,values,node){return isDelegate(getImplementationType(element))&&!values.delegate?{delegate:'Must provide a value'}:{};},hidden:function(element,node){return!isDelegate(getImplementationType(element));}});return[delegateEntry];};},{"../../../../factory/EntryFactory":15,"../../../../helper/CmdHelper":25}],90:[function(require,module,exports){'use strict';var getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject;var domQuery=require('min-dom/lib/query'),domClosest=require('min-dom/lib/closest'),domify=require('min-dom/lib/domify'),forEach=require('lodash/collection/forEach');var elementHelper=require('../../../../helper/ElementHelper'),cmdHelper=require('../../../../helper/CmdHelper'),utils=require('../../../../Utils');function getSelectBox(node,id){var currentTab=domClosest(node,'div.bpp-properties-tab');var query='select[name=selectedExtensionElement]'+(id?'[id=cam-extensionElements-'+id+']':'');return domQuery(query,currentTab);}function getSelected(node,id){var selectBox=getSelectBox(node,id);return{value:(selectBox||{}).value,idx:(selectBox||{}).selectedIndex};}function generateElementId(prefix){prefix=prefix+'_';return utils.nextId(prefix);}var CREATE_EXTENSION_ELEMENT_ACTION='create-extension-element',REMOVE_EXTENSION_ELEMENT_ACTION='remove-extension-element';module.exports=function(element,bpmnFactory,options){var id=options.id,prefix=options.prefix||'elem',label=options.label||id,idGeneration=(options.idGeneration===false)?options.idGeneration:true;var modelProperty=options.modelProperty||'id';var getElements=options.getExtensionElements;var createElement=options.createExtensionElement,canCreate=typeof createElement==='function';var removeElement=options.removeExtensionElement,canRemove=typeof removeElement==='function';var onSelectionChange=options.onSelectionChange;var hideElements=options.hideExtensionElements,canBeHidden=typeof hideElements==='function';var setOptionLabelValue=options.setOptionLabelValue;var defaultSize=options.size||5,resizable=options.resizable;var reference=options.reference||undefined;var selectionChanged=function(element,node,event,scope){if(typeof onSelectionChange==='function'){return onSelectionChange(element,node,event,scope);}};var createOption=function(value){return'<option value="'+value+'" data-value data-name="extensionElementValue">'+value+'</option>';};var initSelectionSize=function(selectBox,optionsLength){if(resizable){selectBox.size=optionsLength>defaultSize?optionsLength:defaultSize;}};return{id:id,html:'<div class="bpp-row bpp-element-list" '+(canBeHidden?'data-show="hideElements"':'')+'>'+'<label for="cam-extensionElements-'+id+'">'+label+'</label>'+'<div class="bpp-field-wrapper">'+'<select id="cam-extensionElements-'+id+'"'+'name="selectedExtensionElement" '+'size="'+defaultSize+'" '+'data-list-entry-container '+'data-on-change="selectElement">'+'</select>'+(canCreate?'<button class="add" '+'id="cam-extensionElements-create-'+id+'" '+'data-action="createElement">'+'<span>+</span>'+'</button>':'')+(canRemove?'<button class="clear" '+'id="cam-extensionElements-remove-'+id+'" '+'data-action="removeElement" '+'data-disable="disableRemove">'+'<span>-</span>'+'</button>':'')+'</div>'+'</div>',get:function(element,node){var elements=getElements(element,node);var result=[];forEach(elements,function(elem){result.push({extensionElementValue:elem.get(modelProperty)});});var selectBox=getSelectBox(node.parentNode,id);initSelectionSize(selectBox,result.length);return result;},set:function(element,values,node){var action=this.__action;delete this.__action;var bo=(reference&&getBusinessObject(element).get(reference))?getBusinessObject(element).get(reference):getBusinessObject(element);var extensionElements=bo.get('extensionElements');if(action.id===CREATE_EXTENSION_ELEMENT_ACTION){var commands=[];if(!extensionElements){extensionElements=elementHelper.createElement('bpmn:ExtensionElements',{values:[]},bo,bpmnFactory);commands.push(cmdHelper.updateBusinessObject(element,bo,{extensionElements:extensionElements}));}commands.push(createElement(element,extensionElements,action.value,node));return commands;}else if(action.id===REMOVE_EXTENSION_ELEMENT_ACTION){return removeElement(element,extensionElements,action.value,action.idx,node);}},createListEntryTemplate:function(value,index,selectBox){initSelectionSize(selectBox,selectBox.options.length+1);return createOption(value.extensionElementValue);},deselect:function(element,node){var selectBox=getSelectBox(node,id);selectBox.selectedIndex=-1;},getSelected:function(element,node){return getSelected(node,id);},setControlValue:function(element,node,option,property,value,idx){node.value=value;if(!setOptionLabelValue){node.text=value;}else{setOptionLabelValue(element,node,option,property,value,idx);}},createElement:function(element,node){var generatedId;if(idGeneration){generatedId=generateElementId(prefix);}var selectBox=getSelectBox(node,id);var template=domify(createOption(generatedId));selectBox.appendChild(template);selectBox.lastChild.selected='selected';selectionChanged(element,node);initSelectionSize(selectBox,selectBox.options.length);this.__action={id:CREATE_EXTENSION_ELEMENT_ACTION,value:generatedId};return true;},removeElement:function(element,node){var selection=getSelected(node,id);var selectBox=getSelectBox(node,id);selectBox.removeChild(selectBox.options[selection.idx]);initSelectionSize(selectBox,selectBox.options.length);this.__action={id:REMOVE_EXTENSION_ELEMENT_ACTION,value:selection.value,idx:selection.idx};return true;},hideElements:function(element,entryNode,node,scopeNode){return!hideElements(element,entryNode,node,scopeNode);},disableRemove:function(element,entryNode,node,scopeNode){return(getSelected(entryNode,id)||{}).idx<0;},selectElement:selectionChanged};};},{"../../../../Utils":6,"../../../../helper/CmdHelper":25,"../../../../helper/ElementHelper":26,"bpmn-js/lib/util/ModelUtil":197,"lodash/collection/forEach":417,"min-dom/lib/closest":564,"min-dom/lib/domify":566,"min-dom/lib/query":569}],91:[function(require,module,exports){'use strict';var entryFactory=require('../../../../factory/EntryFactory'),cmdHelper=require('../../../../helper/CmdHelper');module.exports=function(element,bpmnFactory,options){var getImplementationType=options.getImplementationType,getBusinessObject=options.getBusinessObject;function isExternal(element){return getImplementationType(element)==='external';}var topicEntry=entryFactory.textField({id:'externalTopic',label:'Topic',modelProperty:'externalTopic',get:function(element,node){var bo=getBusinessObject(element);return{externalTopic:bo.get('camunda:topic')};},set:function(element,values,node){var bo=getBusinessObject(element);return cmdHelper.updateBusinessObject(element,bo,{'camunda:topic':values.externalTopic});},validate:function(element,values,node){return isExternal(element)&&!values.externalTopic?{externalTopic:'Must provide a value'}:{};},hidden:function(element,node){return!isExternal(element);}});return[topicEntry];};},{"../../../../factory/EntryFactory":15,"../../../../helper/CmdHelper":25}],92:[function(require,module,exports){'use strict';var entryFactory=require('../../../../factory/EntryFactory');var cmdHelper=require('../../../../helper/CmdHelper');module.exports=function(element,bpmnFactory,options){var getBusinessObject=options.getBusinessObject;var externalTaskPriorityEntry=entryFactory.textField({id:'externalTaskPriority',label:'任务优先级',modelProperty:'taskPriority',get:function(element,node){var bo=getBusinessObject(element);return{taskPriority:bo.get('camunda:taskPriority')};},set:function(element,values){var bo=getBusinessObject(element);return cmdHelper.updateBusinessObject(element,bo,{'camunda:taskPriority':values.taskPriority||undefined});}});return[externalTaskPriorityEntry];};},{"../../../../factory/EntryFactory":15,"../../../../helper/CmdHelper":25}],93:[function(require,module,exports){'use strict';var extensionElementsHelper=require('../../../../helper/ExtensionElementsHelper'),elementHelper=require('../../../../helper/ElementHelper'),cmdHelper=require('../../../../helper/CmdHelper');var utils=require('../../../../Utils');var entryFactory=require('../../../../factory/EntryFactory');var extensionElementsEntry=require('./ExtensionElements');var ModelUtil=require('bpmn-js/lib/util/ModelUtil'),getBusinessObject=ModelUtil.getBusinessObject;var assign=require('lodash/object/assign');var DEFAULT_PROPS={'stringValue':undefined,'string':undefined,'expression':undefined};var fieldTypeOptions=[{name:'String',value:'string'},{name:'Expression',value:'expression'}];var CAMUNDA_FIELD_EXTENSION_ELEMENT='camunda:Field';module.exports=function(element,bpmnFactory,options){options=options||{};var insideListener=!!options.insideListener,idPrefix=options.idPrefix||'',getSelectedListener=options.getSelectedListener;var entries=[];var isSelected=function(element,node){return getSelectedField(element,node);};function getSelectedField(element,node){var selected=fieldEntry.getSelected(element,node.parentNode);if(selected.idx===-1){return;}var formFields=getCamundaFields(element,node);return formFields[selected.idx];}function getCamundaFields(element,node){if(!insideListener){var bo=getBusinessObject(element);return bo&&extensionElementsHelper.getExtensionElements(bo,CAMUNDA_FIELD_EXTENSION_ELEMENT)||[];}return getCamundaListenerFields(element,node);}function getCamundaListenerFields(element,node){var selectedListener=getSelectedListener(element,node);return selectedListener&&selectedListener.fields||[];}function getFieldType(bo){var fieldType='string';var expressionValue=bo&&bo.expression;var stringValue=bo&&(bo.string||bo.stringValue);if(typeof stringValue!=='undefined'){fieldType='string';}else if(typeof expressionValue!=='undefined'){fieldType='expression';}return fieldType;}var setOptionLabelValue=function(){return function(element,node,option,property,value,idx){var camundaFields=getCamundaFields(element,node);var field=camundaFields[idx];value=(field.name)?field.name:'<empty>';var label=idx+' : '+value;option.text=label;};};var newElement=function(){return function(element,extensionElements,value,node){var props={name:'',string:''};var newFieldElem;if(!insideListener){newFieldElem=elementHelper.createElement(CAMUNDA_FIELD_EXTENSION_ELEMENT,props,extensionElements,bpmnFactory);return cmdHelper.addElementsTolist(element,extensionElements,'values',[newFieldElem]);}else{var selectedListener=getSelectedListener(element,node);newFieldElem=elementHelper.createElement(CAMUNDA_FIELD_EXTENSION_ELEMENT,props,selectedListener,bpmnFactory);return cmdHelper.addElementsTolist(element,selectedListener,'fields',[newFieldElem]);}};};var removeElement=function(){return function(element,extensionElements,value,idx,node){var camundaFields=getCamundaFields(element,node);var field=camundaFields[idx];if(field){if(!insideListener){return extensionElementsHelper.removeEntry(getBusinessObject(element),element,field);}var selectedListener=getSelectedListener(element,node);return cmdHelper.removeElementsFromList(element,selectedListener,'fields',null,[field]);}};};var fieldEntry=extensionElementsEntry(element,bpmnFactory,{id:idPrefix+'fields',label:'Fields',modelProperty:'fieldName',idGeneration:'false',createExtensionElement:newElement(),removeExtensionElement:removeElement(),getExtensionElements:function(element,node){return getCamundaFields(element,node);},setOptionLabelValue:setOptionLabelValue()});entries.push(fieldEntry);entries.push(entryFactory.validationAwareTextField({id:idPrefix+'field-name',label:'Name',modelProperty:'fieldName',getProperty:function(element,node){return(getSelectedField(element,node)||{}).name;},setProperty:function(element,values,node){var selectedField=getSelectedField(element,node);return cmdHelper.updateBusinessObject(element,selectedField,{name:values.fieldName});},validate:function(element,values,node){var bo=getSelectedField(element,node);var validation={};if(bo){var nameValue=values.fieldName;if(nameValue){if(utils.containsSpace(nameValue)){validation.fieldName='Name must not contain spaces';}}else{validation.fieldName='Parameter must have a name';}}return validation;},hidden:function(element,node){return!isSelected(element,node);}}));entries.push(entryFactory.selectBox({id:idPrefix+'field-type',label:'Type',selectOptions:fieldTypeOptions,modelProperty:'fieldType',get:function(element,node){var bo=getSelectedField(element,node);var fieldType=getFieldType(bo);return{fieldType:fieldType};},set:function(element,values,node){var props=assign({},DEFAULT_PROPS);var fieldType=values.fieldType;if(fieldType==='string'){props.string='';}else if(fieldType==='expression'){props.expression='';}return cmdHelper.updateBusinessObject(element,getSelectedField(element,node),props);},hidden:function(element,node){return!isSelected(element,node);}}));entries.push(entryFactory.textBox({id:idPrefix+'field-value',label:'Value',modelProperty:'fieldValue',get:function(element,node){var bo=getSelectedField(element,node);var fieldType=getFieldType(bo);var fieldValue;if(fieldType==='string'){fieldValue=bo&&(bo.string||bo.stringValue);}else if(fieldType==='expression'){fieldValue=bo&&bo.expression;}return{fieldValue:fieldValue};},set:function(element,values,node){var bo=getSelectedField(element,node);var fieldType=getFieldType(bo);var props=assign({},DEFAULT_PROPS);var fieldValue=values.fieldValue||undefined;if(fieldType==='string'){props.string=fieldValue;}else if(fieldType==='expression'){props.expression=fieldValue;}return cmdHelper.updateBusinessObject(element,bo,props);},validate:function(element,values,node){var bo=getSelectedField(element,node);var validation={};if(bo){if(!values.fieldValue){validation.fieldValue='Must provide a value';}}return validation;},show:function(element,node){return isSelected(element,node);}}));return entries;};},{"../../../../Utils":6,"../../../../factory/EntryFactory":15,"../../../../helper/CmdHelper":25,"../../../../helper/ElementHelper":26,"../../../../helper/ExtensionElementsHelper":28,"./ExtensionElements":90,"bpmn-js/lib/util/ModelUtil":197,"lodash/object/assign":547}],94:[function(require,module,exports){'use strict';var entryFactory=require('../../../../factory/EntryFactory'),cmdHelper=require('../../../../helper/CmdHelper'),extensionElementsHelper=require('../../../../helper/ExtensionElementsHelper'),elementHelper=require('../../../../helper/ElementHelper');var assign=require('lodash/object/assign');var map=require('lodash/collection/map');var DEFAULT_DELEGATE_PROPS=['class','expression','delegateExpression'];var DELEGATE_PROPS={'camunda:class':undefined,'camunda:expression':undefined,'camunda:delegateExpression':undefined,'camunda:resultVariable':undefined};var DMN_CAPABLE_PROPS={'camunda:decisionRef':undefined,'camunda:decisionRefBinding':'latest','camunda:decisionRefVersion':undefined,'camunda:mapDecisionResult':'resultList','camunda:decisionRefTenantId':undefined};var EXTERNAL_CAPABLE_PROPS={'camunda:type':undefined,'camunda:topic':undefined};var DEFAULT_OPTIONS=[{value:'class',name:'Java Class'},{value:'expression',name:'Expression'},{value:'delegateExpression',name:'Delegate Expression'}];var DMN_OPTION=[{value:'dmn',name:'DMN'}];var EXTERNAL_OPTION=[{value:'external',name:'External'}];var CONNECTOR_OPTION=[{value:'connector',name:'Connector'}];var SCRIPT_OPTION=[{value:'script',name:'Script'}];module.exports=function(element,bpmnFactory,options){var getType=options.getImplementationType,getBusinessObject=options.getBusinessObject;var hasDmnSupport=options.hasDmnSupport,hasExternalSupport=options.hasExternalSupport,hasServiceTaskLikeSupport=options.hasServiceTaskLikeSupport,hasScriptSupport=options.hasScriptSupport;var entries=[];var selectOptions=DEFAULT_OPTIONS.concat([]);if(hasDmnSupport){selectOptions=selectOptions.concat(DMN_OPTION);}if(hasExternalSupport){selectOptions=selectOptions.concat(EXTERNAL_OPTION);}if(hasServiceTaskLikeSupport){selectOptions=selectOptions.concat(CONNECTOR_OPTION);}if(hasScriptSupport){selectOptions=selectOptions.concat(SCRIPT_OPTION);}selectOptions.push({value:''});entries.push(entryFactory.selectBox({id:'implementation',label:'Implementation',selectOptions:selectOptions,modelProperty:'implType',get:function(element,node){return{implType:getType(element)||''};},set:function(element,values,node){var bo=getBusinessObject(element);var oldType=getType(element);var newType=values.implType;var props=assign({},DELEGATE_PROPS);if(DEFAULT_DELEGATE_PROPS.indexOf(newType)!==-1){var newValue='';if(DEFAULT_DELEGATE_PROPS.indexOf(oldType)!==-1){newValue=bo.get('camunda:'+oldType);}props['camunda:'+newType]=newValue;}if(hasDmnSupport){props=assign(props,DMN_CAPABLE_PROPS);if(newType==='dmn'){props['camunda:decisionRef']='';}}if(hasExternalSupport){props=assign(props,EXTERNAL_CAPABLE_PROPS);if(newType==='external'){props['camunda:type']='external';props['camunda:topic']='';}}if(hasScriptSupport){props['camunda:script']=undefined;if(newType==='script'){props['camunda:script']=elementHelper.createElement('camunda:Script',{},bo,bpmnFactory);}}var commands=[];commands.push(cmdHelper.updateBusinessObject(element,bo,props));if(hasServiceTaskLikeSupport){var connectors=extensionElementsHelper.getExtensionElements(bo,'camunda:Connector');commands.push(map(connectors,function(connector){return extensionElementsHelper.removeEntry(bo,element,connector);}));if(newType==='connector'){var extensionElements=bo.get('extensionElements');if(!extensionElements){extensionElements=elementHelper.createElement('bpmn:ExtensionElements',{values:[]},bo,bpmnFactory);commands.push(cmdHelper.updateBusinessObject(element,bo,{extensionElements:extensionElements}));}var connector=elementHelper.createElement('camunda:Connector',{},extensionElements,bpmnFactory);commands.push(cmdHelper.addAndRemoveElementsFromList(element,extensionElements,'values','extensionElements',[connector],[]));}}return commands;}}));return entries;};},{"../../../../factory/EntryFactory":15,"../../../../helper/CmdHelper":25,"../../../../helper/ElementHelper":26,"../../../../helper/ExtensionElementsHelper":28,"lodash/collection/map":420,"lodash/object/assign":547}],95:[function(require,module,exports){'use strict';var getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject;var elementHelper=require('../../../../helper/ElementHelper'),extensionElementsHelper=require('../../../../helper/ExtensionElementsHelper'),inputOutputHelper=require('../../../../helper/InputOutputHelper'),cmdHelper=require('../../../../helper/CmdHelper');var extensionElementsEntry=require('./ExtensionElements');function getInputOutput(element,insideConnector){return inputOutputHelper.getInputOutput(element,insideConnector);}function getConnector(element){return inputOutputHelper.getConnector(element);}function getInputParameters(element,insideConnector){return inputOutputHelper.getInputParameters(element,insideConnector);}function getOutputParameters(element,insideConnector){return inputOutputHelper.getOutputParameters(element,insideConnector);}function getInputParameter(element,insideConnector,idx){return inputOutputHelper.getInputParameter(element,insideConnector,idx);}function getOutputParameter(element,insideConnector,idx){return inputOutputHelper.getOutputParameter(element,insideConnector,idx);}function createElement(type,parent,factory,properties){return elementHelper.createElement(type,properties,parent,factory);}function createInputOutput(parent,bpmnFactory,properties){return createElement('camunda:InputOutput',parent,bpmnFactory,properties);}function createParameter(type,parent,bpmnFactory,properties){return createElement(type,parent,bpmnFactory,properties);}function ensureInputOutputSupported(element,insideConnector){return inputOutputHelper.isInputOutputSupported(element,insideConnector);}function ensureOutparameterSupported(element,insideConnector){return inputOutputHelper.areOutputParametersSupported(element,insideConnector);}var TYPE_LABEL={'camunda:Map':'Map','camunda:List':'List','camunda:Script':'Script'};module.exports=function(element,bpmnFactory,options){options=options||{};var insideConnector=!!options.insideConnector,idPrefix=options.idPrefix||'';var getSelected=function(element,node){var selection=(inputEntry&&inputEntry.getSelected(element,node))||{idx:-1};var parameter=getInputParameter(element,insideConnector,selection.idx);if(!parameter&&outputEntry){selection=outputEntry.getSelected(element,node);parameter=getOutputParameter(element,insideConnector,selection.idx);}return parameter;};var result={getSelectedParameter:getSelected};var entries=result.entries=[];if(!ensureInputOutputSupported(element)){return result;}var newElement=function(type,prop,factory){return function(element,extensionElements,value){var commands=[];var inputOutput=getInputOutput(element,insideConnector);if(!inputOutput){var parent=!insideConnector?extensionElements:getConnector(element);inputOutput=createInputOutput(parent,bpmnFactory,{inputParameters:[],outputParameters:[]});if(!insideConnector){commands.push(cmdHelper.addAndRemoveElementsFromList(element,extensionElements,'values','extensionElements',[inputOutput],[]));}else{commands.push(cmdHelper.updateBusinessObject(element,parent,{inputOutput:inputOutput}));}}var newElem=createParameter(type,inputOutput,bpmnFactory,{name:value});commands.push(cmdHelper.addElementsTolist(element,inputOutput,prop,[newElem]));return commands;};};var removeElement=function(getter,prop,otherProp){return function(element,extensionElements,value,idx){var inputOutput=getInputOutput(element,insideConnector);var parameter=getter(element,insideConnector,idx);var commands=[];commands.push(cmdHelper.removeElementsFromList(element,inputOutput,prop,null,[parameter]));var firstLength=inputOutput.get(prop).length-1;var secondLength=(inputOutput.get(otherProp)||[]).length;if(!firstLength&&!secondLength){if(!insideConnector){commands.push(extensionElementsHelper.removeEntry(getBusinessObject(element),element,inputOutput));}else{var connector=getConnector(element);commands.push(cmdHelper.updateBusinessObject(element,connector,{inputOutput:undefined}));}}return commands;};};var setOptionLabelValue=function(getter){return function(element,node,option,property,value,idx){var parameter=getter(element,insideConnector,idx);var suffix='Text';var definition=parameter.get('definition');if(typeof definition!=='undefined'){var type=definition.$type;suffix=TYPE_LABEL[type];}option.text=(value||'')+' : '+suffix;};};var inputEntry=extensionElementsEntry(element,bpmnFactory,{id:idPrefix+'inputs',label:'Input Parameters',modelProperty:'name',prefix:'Input',resizable:true,createExtensionElement:newElement('camunda:InputParameter','inputParameters'),removeExtensionElement:removeElement(getInputParameter,'inputParameters','outputParameters'),getExtensionElements:function(element){return getInputParameters(element,insideConnector);},onSelectionChange:function(element,node,event,scope){outputEntry&&outputEntry.deselect(element,node);},setOptionLabelValue:setOptionLabelValue(getInputParameter)});entries.push(inputEntry);if(ensureOutparameterSupported(element,insideConnector)){var outputEntry=extensionElementsEntry(element,bpmnFactory,{id:idPrefix+'outputs',label:'Output Parameters',modelProperty:'name',prefix:'Output',resizable:true,createExtensionElement:newElement('camunda:OutputParameter','outputParameters'),removeExtensionElement:removeElement(getOutputParameter,'outputParameters','inputParameters'),getExtensionElements:function(element){return getOutputParameters(element,insideConnector);},onSelectionChange:function(element,node,event,scope){inputEntry.deselect(element,node);},setOptionLabelValue:setOptionLabelValue(getOutputParameter)});entries.push(outputEntry);}return result;};},{"../../../../helper/CmdHelper":25,"../../../../helper/ElementHelper":26,"../../../../helper/ExtensionElementsHelper":28,"../../../../helper/InputOutputHelper":31,"./ExtensionElements":90,"bpmn-js/lib/util/ModelUtil":197}],96:[function(require,module,exports){'use strict';var is=require('bpmn-js/lib/util/ModelUtil').is;var elementHelper=require('../../../../helper/ElementHelper'),inputOutputHelper=require('../../../../helper/InputOutputHelper'),cmdHelper=require('../../../../helper/CmdHelper'),utils=require('../../../../Utils');var entryFactory=require('../../../../factory/EntryFactory'),script=require('./Script')('scriptFormat','value',true);function createElement(type,parent,factory,properties){return elementHelper.createElement(type,properties,parent,factory);}function isScript(elem){return is(elem,'camunda:Script');}function isList(elem){return is(elem,'camunda:List');}function isMap(elem){return is(elem,'camunda:Map');}function ensureInputOutputSupported(element,insideConnector){return inputOutputHelper.isInputOutputSupported(element,insideConnector);}var typeInfo={'camunda:Map':{value:'map',label:'Map'},'camunda:List':{value:'list',label:'List'},'camunda:Script':{value:'script',label:'Script'}};module.exports=function(element,bpmnFactory,options){options=options||{};var insideConnector=!!options.insideConnector,idPrefix=options.idPrefix||'';var getSelected=options.getSelectedParameter;if(!ensureInputOutputSupported(element,insideConnector)){return[];}var entries=[];var isSelected=function(element,node){return getSelected(element,node);};entries.push(entryFactory.validationAwareTextField({id:idPrefix+'parameterName',label:'Name',modelProperty:'name',getProperty:function(element,node){return(getSelected(element,node)||{}).name;},setProperty:function(element,values,node){var param=getSelected(element,node);return cmdHelper.updateBusinessObject(element,param,values);},validate:function(element,values,node){var bo=getSelected(element,node);var validation={};if(bo){var nameValue=values.name;if(nameValue){if(utils.containsSpace(nameValue)){validation.name='Name must not contain spaces';}}else{validation.name='Parameter must have a name';}}return validation;},hidden:function(element,node){return!isSelected(element,node);}}));var selectOptions=[{value:'text',name:'Text'},{value:'script',name:'Script'},{value:'list',name:'List'},{value:'map',name:'Map'}];entries.push(entryFactory.selectBox({id:idPrefix+'parameterType',label:'Type',selectOptions:selectOptions,modelProperty:'parameterType',get:function(element,node){var bo=getSelected(element,node);var parameterType='text';if(typeof bo!=='undefined'){var definition=bo.get('definition');if(typeof definition!=='undefined'){var type=definition.$type;parameterType=typeInfo[type].value;}}return{parameterType:parameterType};},set:function(element,values,node){var bo=getSelected(element,node);var properties={value:undefined,definition:undefined};var createParameterTypeElem=function(type){return createElement(type,bo,bpmnFactory);};var parameterType=values.parameterType;if(parameterType==='script'){properties.definition=createParameterTypeElem('camunda:Script');}else if(parameterType==='list'){properties.definition=createParameterTypeElem('camunda:List');}else if(parameterType==='map'){properties.definition=createParameterTypeElem('camunda:Map');}return cmdHelper.updateBusinessObject(element,bo,properties);},show:function(element,node){return isSelected(element,node);}}));entries.push(entryFactory.textBox({id:idPrefix+'parameterType-text',label:'Value',modelProperty:'value',get:function(element,node){return{value:(getSelected(element,node)||{}).value};},set:function(element,values,node){var param=getSelected(element,node);values.value=values.value||undefined;return cmdHelper.updateBusinessObject(element,param,values);},show:function(element,node){var bo=getSelected(element,node);return bo&&!bo.definition;}}));entries.push({id:idPrefix+'parameterType-script',html:'<div data-show="isScript">'+script.template+'</div>',get:function(element,node){var bo=getSelected(element,node);return bo&&isScript(bo.definition)?script.get(element,bo.definition):{};},set:function(element,values,node){var bo=getSelected(element,node);var update=script.set(element,values);return cmdHelper.updateBusinessObject(element,bo.definition,update);},validate:function(element,values,node){var bo=getSelected(element,node);return bo&&isScript(bo.definition)?script.validate(element,bo.definition):{};},isScript:function(element,node){var bo=getSelected(element,node);return bo&&isScript(bo.definition);},script:script});entries.push(entryFactory.table({id:idPrefix+'parameterType-list',modelProperties:['value'],labels:['Value'],getElements:function(element,node){var bo=getSelected(element,node);if(bo&&isList(bo.definition)){return bo.definition.items;}return[];},updateElement:function(element,values,node,idx){var bo=getSelected(element,node);var item=bo.definition.items[idx];return cmdHelper.updateBusinessObject(element,item,values);},addElement:function(element,node){var bo=getSelected(element,node);var newValue=createElement('camunda:Value',bo.definition,bpmnFactory,{value:undefined});return cmdHelper.addElementsTolist(element,bo.definition,'items',[newValue]);},removeElement:function(element,node,idx){var bo=getSelected(element,node);return cmdHelper.removeElementsFromList(element,bo.definition,'items',null,[bo.definition.items[idx]]);},editable:function(element,node,prop,idx){var bo=getSelected(element,node);var item=bo.definition.items[idx];return!isMap(item)&&!isList(item)&&!isScript(item);},setControlValue:function(element,node,input,prop,value,idx){var bo=getSelected(element,node);var item=bo.definition.items[idx];if(!isMap(item)&&!isList(item)&&!isScript(item)){input.value=value;}else{input.value=typeInfo[item.$type].label;}},show:function(element,node){var bo=getSelected(element,node);return bo&&bo.definition&&isList(bo.definition);}}));entries.push(entryFactory.table({id:idPrefix+'parameterType-map',modelProperties:['key','value'],labels:['Key','Value'],addLabel:'Add Entry',getElements:function(element,node){var bo=getSelected(element,node);if(bo&&isMap(bo.definition)){return bo.definition.entries;}return[];},updateElement:function(element,values,node,idx){var bo=getSelected(element,node);var entry=bo.definition.entries[idx];if(isMap(entry.definition)||isList(entry.definition)||isScript(entry.definition)){values={key:values.key};}return cmdHelper.updateBusinessObject(element,entry,values);},addElement:function(element,node){var bo=getSelected(element,node);var newEntry=createElement('camunda:Entry',bo.definition,bpmnFactory,{key:undefined,value:undefined});return cmdHelper.addElementsTolist(element,bo.definition,'entries',[newEntry]);},removeElement:function(element,node,idx){var bo=getSelected(element,node);return cmdHelper.removeElementsFromList(element,bo.definition,'entries',null,[bo.definition.entries[idx]]);},editable:function(element,node,prop,idx){var bo=getSelected(element,node);var entry=bo.definition.entries[idx];return prop==='key'||(!isMap(entry.definition)&&!isList(entry.definition)&&!isScript(entry.definition));},setControlValue:function(element,node,input,prop,value,idx){var bo=getSelected(element,node);var entry=bo.definition.entries[idx];if(prop==='key'||(!isMap(entry.definition)&&!isList(entry.definition)&&!isScript(entry.definition))){input.value=value;}else{input.value=typeInfo[entry.definition.$type].label;}},show:function(element,node){var bo=getSelected(element,node);return bo&&bo.definition&&isMap(bo.definition);}}));return entries;};},{"../../../../Utils":6,"../../../../factory/EntryFactory":15,"../../../../helper/CmdHelper":25,"../../../../helper/ElementHelper":26,"../../../../helper/InputOutputHelper":31,"./Script":103,"bpmn-js/lib/util/ModelUtil":197}],97:[function(require,module,exports){'use strict';var entryFactory=require('../../../../factory/EntryFactory');var cmdHelper=require('../../../../helper/CmdHelper');module.exports=function(element,bpmnFactory,options){var getBusinessObject=options.getBusinessObject;var jobPriorityEntry=entryFactory.textField({id:'jobPriority',label:'工作优先级',modelProperty:'jobPriority',get:function(element,node){var bo=getBusinessObject(element);return{jobPriority:bo.get('camunda:jobPriority')};},set:function(element,values){var bo=getBusinessObject(element);return cmdHelper.updateBusinessObject(element,bo,{'camunda:jobPriority':values.jobPriority||undefined});}});return[jobPriorityEntry];};},{"../../../../factory/EntryFactory":15,"../../../../helper/CmdHelper":25}],98:[function(require,module,exports){'use strict';var is=require('bpmn-js/lib/util/ModelUtil').is;var entryFactory=require('../../../../factory/EntryFactory');var asyncCapableHelper=require('../../../../helper/AsyncCapableHelper');var elementHelper=require('../../../../helper/ElementHelper'),eventDefinitionHelper=require('../../../../helper/EventDefinitionHelper'),cmdHelper=require('../../../../helper/CmdHelper');function isAsyncBefore(bo){return asyncCapableHelper.isAsyncBefore(bo);}function isAsyncAfter(bo){return asyncCapableHelper.isAsyncAfter(bo);}function getFailedJobRetryTimeCycle(bo){return asyncCapableHelper.getFailedJobRetryTimeCycle(bo);}function removeFailedJobRetryTimeCycle(bo,element){return asyncCapableHelper.removeFailedJobRetryTimeCycle(bo,element);}function createExtensionElements(parent,bpmnFactory){return elementHelper.createElement('bpmn:ExtensionElements',{values:[]},parent,bpmnFactory);}function createFailedJobRetryTimeCycle(parent,bpmnFactory,cycle){return elementHelper.createElement('camunda:FailedJobRetryTimeCycle',{body:cycle},parent,bpmnFactory);}module.exports=function(element,bpmnFactory,options){var getBusinessObject=options.getBusinessObject;var idPrefix=options.idPrefix||'',labelPrefix=options.labelPrefix||'';var retryTimeCycleEntry=entryFactory.textField({id:idPrefix+'retryTimeCycle',label:labelPrefix+'Retry Time Cycle',modelProperty:'cycle',get:function(element,node){var retryTimeCycle=getFailedJobRetryTimeCycle(getBusinessObject(element));var value=retryTimeCycle&&retryTimeCycle.get('body');return{cycle:value};},set:function(element,values,node){var newCycle=values.cycle;var bo=getBusinessObject(element);if(newCycle===''||typeof newCycle==='undefined'){return removeFailedJobRetryTimeCycle(bo,element);}var retryTimeCycle=getFailedJobRetryTimeCycle(bo);if(!retryTimeCycle){var commands=[];var extensionElements=bo.get('extensionElements');if(!extensionElements){extensionElements=createExtensionElements(bo,bpmnFactory);commands.push(cmdHelper.updateBusinessObject(element,bo,{extensionElements:extensionElements}));}retryTimeCycle=createFailedJobRetryTimeCycle(extensionElements,bpmnFactory,newCycle);commands.push(cmdHelper.addAndRemoveElementsFromList(element,extensionElements,'values','extensionElements',[retryTimeCycle],[]));return commands;}return cmdHelper.updateBusinessObject(element,retryTimeCycle,{body:newCycle});},hidden:function(element){var bo=getBusinessObject(element);if(bo&&(isAsyncBefore(bo)||isAsyncAfter(bo))){return false;}if(is(element,'bpmn:Event')){return!eventDefinitionHelper.getTimerEventDefinition(element);}return true;}});return[retryTimeCycleEntry];};},{"../../../../factory/EntryFactory":15,"../../../../helper/AsyncCapableHelper":24,"../../../../helper/CmdHelper":25,"../../../../helper/ElementHelper":26,"../../../../helper/EventDefinitionHelper":27,"bpmn-js/lib/util/ModelUtil":197}],99:[function(require,module,exports){'use strict';var is=require('bpmn-js/lib/util/ModelUtil').is,getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject;var extensionElementsEntry=require('./ExtensionElements'),extensionElementsHelper=require('../../../../helper/ExtensionElementsHelper'),cmdHelper=require('../../../../helper/CmdHelper'),elementHelper=require('../../../../helper/ElementHelper'),ImplementationTypeHelper=require('../../../../helper/ImplementationTypeHelper');function getListeners(bo,type){return bo&&extensionElementsHelper.getExtensionElements(bo,type)||[];}var LISTENER_TYPE_LABEL={class:'Java Class',expression:'Expression',delegateExpression:'Delegate Expression',script:'Script'};var CAMUNDA_EXECUTION_LISTENER_ELEMENT='camunda:ExecutionListener';var CAMUNDA_TASK_LISTENER_ELEMENT='camunda:TaskListener';module.exports=function(element,bpmnFactory,options){var bo;var result={getSelectedListener:getSelectedListener};var entries=result.entries=[];var isSequenceFlow=ImplementationTypeHelper.isSequenceFlow(element);function getSelectedListener(element,node){var selection=(executionListenerEntry&&executionListenerEntry.getSelected(element,node))||{idx:-1};var listener=getListeners(bo,CAMUNDA_EXECUTION_LISTENER_ELEMENT)[selection.idx];if(!listener&&taskListenerEntry){selection=taskListenerEntry.getSelected(element,node);listener=getListeners(bo,CAMUNDA_TASK_LISTENER_ELEMENT)[selection.idx];}return listener;}var setOptionLabelValue=function(type){return function(element,node,option,property,value,idx){var listeners=getListeners(bo,type);var listener=listeners[idx];var listenerType=ImplementationTypeHelper.getImplementationType(listener);var event=(listener.get('event'))?listener.get('event'):'<empty>';var label=(event||'*')+' : '+(LISTENER_TYPE_LABEL[listenerType]||'');option.text=label;};};var newElement=function(element,type,initialEvent){return function(element,extensionElements,value){var props={event:initialEvent,class:''};var newElem=elementHelper.createElement(type,props,extensionElements,bpmnFactory);return cmdHelper.addElementsTolist(element,extensionElements,'values',[newElem]);};};var removeElement=function(element,type){return function(element,extensionElements,value,idx){var listeners=getListeners(bo,type);var listener=listeners[idx];if(listener){return extensionElementsHelper.removeEntry(bo,element,listener);}};};if(is(element,'bpmn:FlowElement')||is(element,'bpmn:Process')||is(element,'bpmn:Participant')){bo=getBusinessObject(element);if(is(element,'bpmn:Participant')){element=element.processRef;bo=bo.get('processRef');}if(bo){var executionListenerEntry=extensionElementsEntry(element,bpmnFactory,{id:'executionListeners',label:'执行监听器',modelProperty:'name',idGeneration:'false',reference:'processRef',createExtensionElement:newElement(element,CAMUNDA_EXECUTION_LISTENER_ELEMENT,(isSequenceFlow)?'take':'start'),removeExtensionElement:removeElement(element,CAMUNDA_EXECUTION_LISTENER_ELEMENT),getExtensionElements:function(element){return getListeners(bo,CAMUNDA_EXECUTION_LISTENER_ELEMENT);},onSelectionChange:function(element,node,event,scope){taskListenerEntry&&taskListenerEntry.deselect(element,node);},setOptionLabelValue:setOptionLabelValue(CAMUNDA_EXECUTION_LISTENER_ELEMENT)});entries.push(executionListenerEntry);}}if(is(element,'bpmn:UserTask')){bo=getBusinessObject(element);var taskListenerEntry=extensionElementsEntry(element,bpmnFactory,{id:'taskListeners',label:'Task Listener',modelProperty:'name',idGeneration:'false',createExtensionElement:newElement(element,CAMUNDA_TASK_LISTENER_ELEMENT,'create'),removeExtensionElement:removeElement(element,CAMUNDA_TASK_LISTENER_ELEMENT),getExtensionElements:function(element){return getListeners(bo,CAMUNDA_TASK_LISTENER_ELEMENT);},onSelectionChange:function(element,node,event,scope){executionListenerEntry.deselect(element,node);},setOptionLabelValue:setOptionLabelValue(CAMUNDA_TASK_LISTENER_ELEMENT)});entries.push(taskListenerEntry);}return result;};},{"../../../../helper/CmdHelper":25,"../../../../helper/ElementHelper":26,"../../../../helper/ExtensionElementsHelper":28,"../../../../helper/ImplementationTypeHelper":30,"./ExtensionElements":90,"bpmn-js/lib/util/ModelUtil":197}],100:[function(require,module,exports){'use strict';var getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject;var entryFactory=require('../../../../factory/EntryFactory');var elementHelper=require('../../../../helper/ElementHelper'),cmdHelper=require('../../../../helper/CmdHelper');var domClasses=require('min-dom/lib/classes');function getProperty(element,propertyName){var loopCharacteristics=getLoopCharacteristics(element);return loopCharacteristics&&loopCharacteristics.get(propertyName);}function getBody(expression){return expression&&expression.get('body');}function getLoopCharacteristics(element){var bo=getBusinessObject(element);return bo.loopCharacteristics;}function getLoopCardinality(element){return getProperty(element,'loopCardinality');}function getLoopCardinalityValue(element){var loopCardinality=getLoopCardinality(element);return getBody(loopCardinality);}function getCompletionCondition(element){return getProperty(element,'completionCondition');}function getCompletionConditionValue(element){var completionCondition=getCompletionCondition(element);return getBody(completionCondition);}function getCollection(element){return getProperty(element,'camunda:collection');}function getElementVariable(element){return getProperty(element,'camunda:elementVariable');}function createFormalExpression(parent,body,bpmnFactory){return elementHelper.createElement('bpmn:FormalExpression',{body:body},parent,bpmnFactory);}function updateFormalExpression(element,propertyName,newValue,bpmnFactory){var loopCharacteristics=getLoopCharacteristics(element);var expressionProps={};if(!newValue){expressionProps[propertyName]=undefined;return cmdHelper.updateBusinessObject(element,loopCharacteristics,expressionProps);}var existingExpression=loopCharacteristics.get(propertyName);if(!existingExpression){expressionProps[propertyName]=createFormalExpression(loopCharacteristics,newValue,bpmnFactory);return cmdHelper.updateBusinessObject(element,loopCharacteristics,expressionProps);}return cmdHelper.updateBusinessObject(element,existingExpression,{body:newValue});}module.exports=function(element,bpmnFactory){var entries=[];entries.push({id:'multiInstance-errorMessage',html:'<div data-show="isValid">'+'<span class="bpp-icon-warning"></span> '+'Must provide either loop cardinality or collection'+'</div>',isValid:function(element,node,notification,scope){var loopCharacteristics=getLoopCharacteristics(element);var isValid=true;if(loopCharacteristics){var loopCardinality=getLoopCardinalityValue(element);var collection=getCollection(element);isValid=!loopCardinality&&!collection;}domClasses(node).toggle('bpp-hidden',!isValid);domClasses(notification).toggle('bpp-error-message',isValid);return isValid;}});entries.push(entryFactory.textField({id:'multiInstance-loopCardinality',label:'Loop Cardinality',modelProperty:'loopCardinality',get:function(element,node){return{loopCardinality:getLoopCardinalityValue(element)};},set:function(element,values){return updateFormalExpression(element,'loopCardinality',values.loopCardinality,bpmnFactory);}}));entries.push(entryFactory.textField({id:'multiInstance-collection',label:'Collection',modelProperty:'collection',get:function(element,node){return{collection:getCollection(element)};},set:function(element,values){var loopCharacteristics=getLoopCharacteristics(element);return cmdHelper.updateBusinessObject(element,loopCharacteristics,{'camunda:collection':values.collection||undefined});},validate:function(element,values,node){var collection=getCollection(element);var elementVariable=getElementVariable(element);if(!collection&&elementVariable){return{collection:'Must provide a value'};}}}));entries.push(entryFactory.textField({id:'multiInstance-elementVariable',label:'Element Variable',modelProperty:'elementVariable',get:function(element,node){return{elementVariable:getElementVariable(element)};},set:function(element,values){var loopCharacteristics=getLoopCharacteristics(element);return cmdHelper.updateBusinessObject(element,loopCharacteristics,{'camunda:elementVariable':values.elementVariable||undefined});}}));entries.push(entryFactory.textField({id:'multiInstance-completionCondition',label:'Completion Condition',modelProperty:'completionCondition',get:function(element){return{completionCondition:getCompletionConditionValue(element)};},set:function(element,values){return updateFormalExpression(element,'completionCondition',values.completionCondition,bpmnFactory);}}));return entries;};},{"../../../../factory/EntryFactory":15,"../../../../helper/CmdHelper":25,"../../../../helper/ElementHelper":26,"bpmn-js/lib/util/ModelUtil":197,"min-dom/lib/classes":562}],101:[function(require,module,exports){'use strict';var getBusinessObject=require('bpmn-js/lib/util/ModelUtil').getBusinessObject,is=require('bpmn-js/lib/util/ModelUtil').is;var factory=require('../../../../factory/EntryFactory');var elementHelper=require('../../../../helper/ElementHelper'),extensionElementsHelper=require('../../../../helper/ExtensionElementsHelper'),cmdHelper=require('../../../../helper/CmdHelper'),utils=require('../../../../Utils');var assign=require('lodash/object/assign'),forEach=require('lodash/collection/forEach'),find=require('lodash/collection/find');function generatePropertyId(){return utils.nextId('Property_');}function getPropertyValues(parent){var properties=parent&&getPropertiesElement(parent);if(properties&&properties.values){return properties.values;}return[];}function getPropertiesElement(element){if(!isExtensionElements(element)){return element.properties;}else{return getPropertiesElementInsideExtensionElements(element);}}function getPropertiesElementInsideExtensionElements(extensionElements){return find(extensionElements.values,function(elem){return is(elem,'camunda:Properties');});}function isExtensionElements(element){return is(element,'bpmn:ExtensionElements');}module.exports=function(element,bpmnFactory,options){var getParent=options.getParent;var modelProperties=options.modelProperties,createParent=options.createParent;var bo=getBusinessObject(element);if(is(element,'bpmn:Participant')){bo=bo.get('processRef');}if(!bo){return;}assign(options,{addLabel:'增加属性',getElements:function(element,node){var parent=getParent(element,node,bo);return getPropertyValues(parent);},addElement:function(element,node){var commands=[],parent=getParent(element,node,bo);if(!parent&&typeof createParent==='function'){var result=createParent(element,bo);parent=result.parent;commands.push(result.cmd);}var properties=getPropertiesElement(parent);if(!properties){properties=elementHelper.createElement('camunda:Properties',{},parent,bpmnFactory);if(!isExtensionElements(parent)){commands.push(cmdHelper.updateBusinessObject(element,parent,{'properties':properties}));}else{commands.push(cmdHelper.addAndRemoveElementsFromList(element,parent,'values','extensionElements',[properties],[]));}}var propertyProps={};forEach(modelProperties,function(prop){propertyProps[prop]=undefined;});if(modelProperties.indexOf('id')>=0){propertyProps.id=generatePropertyId();}var property=elementHelper.createElement('camunda:Property',propertyProps,properties,bpmnFactory);commands.push(cmdHelper.addElementsTolist(element,properties,'values',[property]));return commands;},updateElement:function(element,value,node,idx){var parent=getParent(element,node,bo),property=getPropertyValues(parent)[idx];forEach(modelProperties,function(prop){value[prop]=value[prop]||undefined;});return cmdHelper.updateBusinessObject(element,property,value);},validate:function(element,value,node,idx){if(modelProperties.indexOf('id')>=0){var parent=getParent(element,node,bo),properties=getPropertyValues(parent),property=properties[idx];if(property){var validationError=utils.isIdValid(property,value.id);if(validationError){return{id:validationError};}}}},removeElement:function(element,node,idx){var commands=[],parent=getParent(element,node,bo),properties=getPropertiesElement(parent),propertyValues=getPropertyValues(parent),currentProperty=propertyValues[idx];commands.push(cmdHelper.removeElementsFromList(element,properties,'values',null,[currentProperty]));if(propertyValues.length===1){if(!isExtensionElements(parent)){commands.push(cmdHelper.updateBusinessObject(element,parent,{properties:undefined}));}else{forEach(parent.values,function(value){if(is(value,'camunda:Properties')){commands.push(extensionElementsHelper.removeEntry(bo,element,value));}});}}return commands;}});return factory.table(options);};},{"../../../../Utils":6,"../../../../factory/EntryFactory":15,"../../../../helper/CmdHelper":25,"../../../../helper/ElementHelper":26,"../../../../helper/ExtensionElementsHelper":28,"bpmn-js/lib/util/ModelUtil":197,"lodash/collection/find":416,"lodash/collection/forEach":417,"lodash/object/assign":547}],102:[function(require,module,exports){'use strict';var is=require('bpmn-js/lib/util/ModelUtil').is;var assign=require('lodash/object/assign');var entryFactory=require('../../../../factory/EntryFactory'),cmdHelper=require('../../../../helper/CmdHelper');module.exports=function(element,bpmnFactory,options){var getBusinessObject=options.getBusinessObject,hideResultVariable=options.hideResultVariable,id=options.id||'resultVariable';var resultVariableEntry=entryFactory.textField({id:id,label:'Result Variable',modelProperty:'resultVariable',get:function(element,node){var bo=getBusinessObject(element);return{resultVariable:bo.get('camunda:resultVariable')};},set:function(element,values,node){var bo=getBusinessObject(element);var resultVariable=values.resultVariable||undefined;var props={'camunda:resultVariable':resultVariable};if(is(bo,'camunda:DmnCapable')&&!resultVariable){props=assign({'camunda:mapDecisionResult':'resultList'},props);}return cmdHelper.updateBusinessObject(element,bo,props);},hidden:function(element,node){if(typeof hideResultVariable==='function'){return hideResultVariable.apply(resultVariableEntry,arguments);}}});return[resultVariableEntry];};},{"../../../../factory/EntryFactory":15,"../../../../helper/CmdHelper":25,"bpmn-js/lib/util/ModelUtil":197,"lodash/object/assign":547}],103:[function(require,module,exports){'use strict';var domQuery=require('min-dom/lib/query'),utils=require('../../../../Utils');function getScriptType(node){return utils.selectedType('select[name=scriptType]',node.parentElement);}module.exports=function(scriptLanguagePropName,scriptValuePropName,isFormatRequired){return{template:'<div class="bpp-row bpp-textfield">'+'<label for="cam-script-format">Script Format</label>'+'<div class="bpp-field-wrapper">'+'<input id="cam-script-format" type="text" name="scriptFormat" />'+'<button class="clear" data-action="script.clearScriptFormat" data-show="script.canClearScriptFormat">'+'<span>X</span>'+'</button>'+'</div>'+'</div>'+'<div class="bpp-row">'+'<label for="cam-script-type">Script Type</label>'+'<div class="bpp-field-wrapper">'+'<select id="cam-script-type" name="scriptType" data-value>'+'<option value="script" selected>Inline Script</option>'+'<option value="scriptResource">External Resource</option>'+'</select>'+'</div>'+'</div>'+'<div class="bpp-row bpp-textfield">'+'<label for="cam-script-resource-val" data-show="script.isScriptResource">Resource</label>'+'<div class="bpp-field-wrapper" data-show="script.isScriptResource">'+'<input id="cam-script-resource-val" type="text" name="scriptResourceValue" />'+'<button class="clear" data-action="script.clearScriptResource" data-show="script.canClearScriptResource">'+'<span>X</span>'+'</button>'+'</div>'+'</div>'+'<div class="bpp-row">'+'<label for="cam-script-val" data-show="script.isScript">Script</label>'+'<div class="bpp-field-wrapper" data-show="script.isScript">'+'<textarea id="cam-script-val" type="text" name="scriptValue"></textarea>'+'</div>'+'</div>',get:function(element,bo){var values={};var boScriptResource=bo.get('camunda:resource'),boScript=bo.get(scriptValuePropName),boScriptFormat=bo.get(scriptLanguagePropName);if(typeof boScriptResource!=='undefined'){values.scriptResourceValue=boScriptResource;values.scriptType='scriptResource';}else{values.scriptValue=boScript;values.scriptType='script';}values.scriptFormat=boScriptFormat;return values;},set:function(element,values,containerElement){var scriptFormat=values.scriptFormat,scriptType=values.scriptType,scriptResourceValue=values.scriptResourceValue,scriptValue=values.scriptValue;var update={'camunda:resource':undefined};update[scriptValuePropName]=undefined;update[scriptLanguagePropName]=undefined;if(isFormatRequired){update[scriptLanguagePropName]=scriptFormat||'';}else
if(scriptFormat!==''){update[scriptLanguagePropName]=scriptFormat;}if('scriptResource'===scriptType){update['camunda:resource']=scriptResourceValue||'';}else{update[scriptValuePropName]=scriptValue||'';}return update;},validate:function(element,values){var validationResult={};if(values.scriptType==='script'&&!values.scriptValue){validationResult.scriptValue='Must provide a value';}if(values.scriptType==='scriptResource'&&!values.scriptResourceValue){validationResult.scriptResourceValue='Must provide a value';}if(isFormatRequired&&(!values.scriptFormat||values.scriptFormat.length===0)){validationResult.scriptFormat='Must provide a value';}return validationResult;},clearScriptFormat:function(element,inputNode,btnNode,scopeNode){domQuery('input[name=scriptFormat]',scopeNode).value='';return true;},canClearScriptFormat:function(element,inputNode,btnNode,scopeNode){var input=domQuery('input[name=scriptFormat]',scopeNode);return input.value!=='';},clearScriptResource:function(element,inputNode,btnNode,scopeNode){domQuery('input[name=scriptResourceValue]',scopeNode).value='';return true;},canClearScriptResource:function(element,inputNode,btnNode,scopeNode){var input=domQuery('input[name=scriptResourceValue]',scopeNode);return input.value!=='';},clearScript:function(element,inputNode,btnNode,scopeNode){domQuery('textarea[name=scriptValue]',scopeNode).value='';return true;},canClearScript:function(element,inputNode,btnNode,scopeNode){var input=domQuery('textarea[name=scriptValue]',scopeNode);return input.value!=='';},isScriptResource:function(element,inputNode,btnNode,scopeNode){var scriptType=getScriptType(scopeNode);return scriptType==='scriptResource';},isScript:function(element,inputNode,btnNode,scopeNode){var scriptType=getScriptType(scopeNode);return scriptType==='script';}};};},{"../../../../Utils":6,"min-dom/lib/query":569}],104:[function(require,module,exports){'use strict';var inherits=require('inherits');var Ids=require('ids');var Viewer=require('./Viewer');var NavigatedViewer=require('./NavigatedViewer');var initialDiagram='<?xml version="1.0" encoding="UTF-8"?>'+'<bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" '+'xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" '+'xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" '+'xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" '+'targetNamespace="http://bpmn.io/schema/bpmn" '+'id="Definitions_1">'+'<bpmn:process id="Process_1" isExecutable="false">'+'<bpmn:startEvent id="StartEvent_1"/>'+'</bpmn:process>'+'<bpmndi:BPMNDiagram id="BPMNDiagram_1">'+'<bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1">'+'<bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">'+'<dc:Bounds height="36.0" width="36.0" x="173.0" y="102.0"/>'+'</bpmndi:BPMNShape>'+'</bpmndi:BPMNPlane>'+'</bpmndi:BPMNDiagram>'+'</bpmn:definitions>';function Modeler(options){Viewer.call(this,options);this.on('import.parse.complete',function(event){if(!event.error){this._collectIds(event.definitions,event.context);}},this);this.on('diagram.destroy',function(){this.moddle.ids.clear();},this);}inherits(Modeler,Viewer);module.exports=Modeler;module.exports.Viewer=Viewer;module.exports.NavigatedViewer=NavigatedViewer;Modeler.prototype.createDiagram=function(done){return this.importXML(initialDiagram,done);};Modeler.prototype._createModdle=function(options){var moddle=Viewer.prototype._createModdle.call(this,options);moddle.ids=new Ids([32,36,1]);return moddle;};Modeler.prototype._collectIds=function(definitions,context){var moddle=definitions.$model,ids=moddle.ids,id;ids.clear();for(id in context.elementsById){ids.claim(id,context.elementsById[id]);}};Modeler.prototype._interactionModules=[require('diagram-js/lib/navigation/movecanvas'),require('diagram-js/lib/navigation/touch'),require('diagram-js/lib/navigation/zoomscroll')];Modeler.prototype._modelingModules=[require('diagram-js/lib/features/auto-scroll'),require('diagram-js/lib/features/bendpoints'),require('diagram-js/lib/features/move'),require('diagram-js/lib/features/resize'),require('./features/auto-resize'),require('./features/editor-actions'),require('./features/context-pad'),require('./features/keyboard'),require('./features/label-editing'),require('./features/modeling'),require('./features/palette'),require('./features/replace-preview'),require('./features/snapping')];Modeler.prototype._modules=[].concat(Modeler.prototype._modules,Modeler.prototype._interactionModules,Modeler.prototype._modelingModules);},{"./NavigatedViewer":105,"./Viewer":106,"./features/auto-resize":113,"./features/context-pad":115,"./features/editor-actions":121,"./features/keyboard":125,"./features/label-editing":129,"./features/modeling":168,"./features/palette":174,"./features/replace-preview":179,"./features/snapping":189,"diagram-js/lib/features/auto-scroll":246,"diagram-js/lib/features/bendpoints":252,"diagram-js/lib/features/move":313,"diagram-js/lib/features/resize":331,"diagram-js/lib/navigation/movecanvas":363,"diagram-js/lib/navigation/touch":364,"diagram-js/lib/navigation/zoomscroll":367,"ids":396,"inherits":398}],105:[function(require,module,exports){'use strict';var inherits=require('inherits');var Viewer=require('./Viewer');function NavigatedViewer(options){Viewer.call(this,options);}inherits(NavigatedViewer,Viewer);module.exports=NavigatedViewer;NavigatedViewer.prototype._navigationModules=[require('diagram-js/lib/navigation/zoomscroll'),require('diagram-js/lib/navigation/movecanvas')];NavigatedViewer.prototype._modules=[].concat(NavigatedViewer.prototype._modules,NavigatedViewer.prototype._navigationModules);},{"./Viewer":106,"diagram-js/lib/navigation/movecanvas":363,"diagram-js/lib/navigation/zoomscroll":367,"inherits":398}],106:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign'),omit=require('lodash/object/omit'),isNumber=require('lodash/lang/isNumber');var domify=require('min-dom/lib/domify'),domQuery=require('min-dom/lib/query'),domRemove=require('min-dom/lib/remove');var innerSVG=require('tiny-svg/lib/innerSVG');var Diagram=require('diagram-js'),BpmnModdle=require('bpmn-moddle');var inherits=require('inherits');var Importer=require('./import/Importer');function checkValidationError(err){var pattern=/unparsable content <([^>]+)> detected([\s\S]*)$/;var match=pattern.exec(err.message);if(match){err.message='unparsable content <'+match[1]+'> detected; '+'this may indicate an invalid BPMN 2.0 diagram file'+match[2];}return err;}var DEFAULT_OPTIONS={width:'100%',height:'100%',position:'relative'};function ensureUnit(val){return val+(isNumber(val)?'px':'');}function Viewer(options){options=assign({},DEFAULT_OPTIONS,options);this.moddle=this._createModdle(options);this.container=this._createContainer(options);addProjectLogo(this.container);this._init(this.container,this.moddle,options);}inherits(Viewer,Diagram);module.exports=Viewer;Viewer.prototype.importXML=function(xml,done){done=done||function(){};var self=this;xml=this._emit('import.parse.start',{xml:xml})||xml;this.moddle.fromXML(xml,'bpmn:Definitions',function(err,definitions,context){definitions=self._emit('import.parse.complete',{error:err,definitions:definitions,context:context})||definitions;if(err){err=checkValidationError(err);self._emit('import.done',{error:err});return done(err);}var parseWarnings=context.warnings;self.importDefinitions(definitions,function(err,importWarnings){var allWarnings=[].concat(parseWarnings,importWarnings||[]);self._emit('import.done',{error:err,warnings:allWarnings});done(err,allWarnings);});});};Viewer.prototype.saveXML=function(options,done){if(!done){done=options;options={};}var definitions=this.definitions;if(!definitions){return done(new Error('no definitions loaded'));}this.moddle.toXML(definitions,options,done);};Viewer.prototype.saveSVG=function(options,done){if(!done){done=options;options={};}var canvas=this.get('canvas');var contentNode=canvas.getDefaultLayer(),defsNode=domQuery('defs',canvas._svg);var contents=innerSVG(contentNode),defs=(defsNode&&defsNode.outerHTML)||'';var bbox=contentNode.getBBox();var svg='<?xml version="1.0" encoding="utf-8"?>\n'+'<!-- created with bpmn-js / http://bpmn.io -->\n'+'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n'+'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" '+'width="'+bbox.width+'" height="'+bbox.height+'" '+'viewBox="'+bbox.x+' '+bbox.y+' '+bbox.width+' '+bbox.height+'" version="1.1">'+defs+contents+'</svg>';done(null,svg);};Viewer.prototype.importDefinitions=function(definitions,done){try{if(this.definitions){this.clear();}this.definitions=definitions;Importer.importBpmnDiagram(this,definitions,done);}catch(e){done(e);}};Viewer.prototype.getModules=function(){return this._modules;};Viewer.prototype.destroy=function(){Diagram.prototype.destroy.call(this);domRemove(this.container);};Viewer.prototype.on=function(event,priority,callback,target){return this.get('eventBus').on(event,priority,callback,target);};Viewer.prototype.off=function(event,callback){this.get('eventBus').off(event,callback);};Viewer.prototype.attachTo=function(parentNode){if(!parentNode){throw new Error('parentNode required');}this.detach();if(parentNode.get&&parentNode.constructor.prototype.jquery){parentNode=parentNode.get(0);}if(typeof parentNode==='string'){parentNode=domQuery(parentNode);}var container=this._container;parentNode.appendChild(container);this._emit('attach',{});};Viewer.prototype.detach=function(){var container=this._container,parentNode=container.parentNode;if(!parentNode){return;}this._emit('detach',{});parentNode.removeChild(container);};Viewer.prototype._init=function(container,moddle,options){this._container=container;var baseModules=options.modules||this.getModules(),additionalModules=options.additionalModules||[],staticModules=[{bpmnjs:['value',this],moddle:['value',moddle]}];var diagramModules=[].concat(staticModules,baseModules,additionalModules);var diagramOptions=assign(omit(options,'additionalModules'),{canvas:assign({},options.canvas,{container:container}),modules:diagramModules});Diagram.call(this,diagramOptions);if(options&&options.container){this.attachTo(options.container);}};Viewer.prototype._emit=function(type,event){return this.get('eventBus').fire(type,event);};Viewer.prototype._createContainer=function(options){var container=domify('<div class="bjs-container"></div>');assign(container.style,{width:ensureUnit(options.width),height:ensureUnit(options.height),position:options.position});return container;};Viewer.prototype._createModdle=function(options){var moddleOptions=assign({},this._moddleExtensions,options.moddleExtensions);return new BpmnModdle(moddleOptions);};Viewer.prototype._modules=[require('./core'),require('diagram-js/lib/i18n/translate'),require('diagram-js/lib/features/selection'),require('diagram-js/lib/features/overlays')];Viewer.prototype._moddleExtensions={};var PoweredBy=require('./util/PoweredByUtil'),domEvent=require('min-dom/lib/event');function addProjectLogo(container){var logoData=PoweredBy.BPMNIO_LOGO;var linkMarkup='';var linkElement=domify(linkMarkup);container.appendChild(linkElement);domEvent.bind(linkElement,'click',function(event){PoweredBy.open();event.preventDefault();});}},{"./core":107,"./import/Importer":192,"./util/PoweredByUtil":198,"bpmn-moddle":201,"diagram-js":224,"diagram-js/lib/features/overlays":318,"diagram-js/lib/features/selection":340,"diagram-js/lib/i18n/translate":355,"inherits":398,"lodash/lang/isNumber":541,"lodash/object/assign":547,"lodash/object/omit":553,"min-dom/lib/domify":566,"min-dom/lib/event":567,"min-dom/lib/query":569,"min-dom/lib/remove":570,"tiny-svg/lib/innerSVG":615}],107:[function(require,module,exports){module.exports={__depends__:[require('../draw'),require('../import')]};},{"../draw":110,"../import":194}],108:[function(require,module,exports){'use strict';var inherits=require('inherits'),isObject=require('lodash/lang/isObject'),assign=require('lodash/object/assign'),forEach=require('lodash/collection/forEach'),every=require('lodash/collection/every'),some=require('lodash/collection/some');var BaseRenderer=require('diagram-js/lib/draw/BaseRenderer'),TextUtil=require('diagram-js/lib/util/Text'),DiUtil=require('../util/DiUtil');var getBusinessObject=require('../util/ModelUtil').getBusinessObject,is=require('../util/ModelUtil').is;var RenderUtil=require('diagram-js/lib/util/RenderUtil');var componentsToPath=RenderUtil.componentsToPath,createLine=RenderUtil.createLine;var domQuery=require('min-dom/lib/query');var svgAppend=require('tiny-svg/lib/append'),svgAttr=require('tiny-svg/lib/attr'),svgCreate=require('tiny-svg/lib/create'),svgClasses=require('tiny-svg/lib/classes');var rotate=require('diagram-js/lib/util/SvgTransformUtil').rotate,transform=require('diagram-js/lib/util/SvgTransformUtil').transform,translate=require('diagram-js/lib/util/SvgTransformUtil').translate;var TASK_BORDER_RADIUS=10;var INNER_OUTER_DIST=3;var LABEL_STYLE={fontFamily:'Arial, sans-serif',fontSize:12};function BpmnRenderer(eventBus,styles,pathMap,canvas,priority){BaseRenderer.call(this,eventBus,priority);var textUtil=new TextUtil({style:LABEL_STYLE,size:{width:100}});var markers={};var computeStyle=styles.computeStyle;function addMarker(id,options){var attrs=assign({fill:'black',strokeWidth:1,strokeLinecap:'round',strokeDasharray:'none'},options.attrs);var ref=options.ref||{x:0,y:0};var scale=options.scale||1;if(attrs.strokeDasharray==='none'){attrs.strokeDasharray=[10000,1];}var marker=svgCreate('marker');svgAttr(options.element,attrs);svgAppend(marker,options.element);svgAttr(marker,{id:id,viewBox:'0 0 20 20',refX:ref.x,refY:ref.y,markerWidth:20*scale,markerHeight:20*scale,orient:'auto'});var defs=domQuery('defs',canvas._svg);if(!defs){defs=svgCreate('defs');svgAppend(canvas._svg,defs);}svgAppend(defs,marker);markers[id]=marker;}function marker(type,fill,stroke){var id=type+'-'+fill+'-'+stroke;if(!markers[id]){createMarker(type,fill,stroke);}return'url(#'+id+')';}function createMarker(type,fill,stroke){var id=type+'-'+fill+'-'+stroke;if(type==='sequenceflow-end'){var sequenceflowEnd=svgCreate('path');svgAttr(sequenceflowEnd,{d:'M 1 5 L 11 10 L 1 15 Z'});addMarker(id,{element:sequenceflowEnd,ref:{x:11,y:10},scale:0.5,attrs:{fill:stroke,stroke:stroke}});}if(type==='messageflow-start'){var messageflowStart=svgCreate('circle');svgAttr(messageflowStart,{cx:6,cy:6,r:3.5});addMarker(id,{element:messageflowStart,attrs:{fill:fill,stroke:stroke},ref:{x:6,y:6}});}if(type==='messageflow-end'){var messageflowEnd=svgCreate('path');svgAttr(messageflowEnd,{d:'m 1 5 l 0 -3 l 7 3 l -7 3 z'});addMarker(id,{element:messageflowEnd,attrs:{fill:fill,stroke:stroke,strokeLinecap:'butt'},ref:{x:8.5,y:5}});}if(type==='association-start'){var associationStart=svgCreate('path');svgAttr(associationStart,{d:'M 11 5 L 1 10 L 11 15'});addMarker(id,{element:associationStart,attrs:{fill:'none',stroke:stroke,strokeWidth:1.5},ref:{x:1,y:10},scale:0.5});}if(type==='association-end'){var associationEnd=svgCreate('path');svgAttr(associationEnd,{d:'M 1 5 L 11 10 L 1 15'});addMarker(id,{element:associationEnd,attrs:{fill:'none',stroke:stroke,strokeWidth:1.5},ref:{x:12,y:10},scale:0.5});}if(type==='conditional-flow-marker'){var conditionalflowMarker=svgCreate('path');svgAttr(conditionalflowMarker,{d:'M 0 10 L 8 6 L 16 10 L 8 14 Z'});addMarker(id,{element:conditionalflowMarker,attrs:{fill:fill,stroke:stroke},ref:{x:-1,y:10},scale:0.5});}if(type==='conditional-default-flow-marker'){var conditionaldefaultflowMarker=svgCreate('path');svgAttr(conditionaldefaultflowMarker,{d:'M 6 4 L 10 16'});addMarker(id,{element:conditionaldefaultflowMarker,attrs:{stroke:stroke},ref:{x:0,y:10},scale:0.5});}}function drawCircle(parentGfx,width,height,offset,attrs){if(isObject(offset)){attrs=offset;offset=0;}offset=offset||0;attrs=computeStyle(attrs,{stroke:'black',strokeWidth:2,fill:'white'});var cx=width/2,cy=height/2;var circle=svgCreate('circle');svgAttr(circle,{cx:cx,cy:cy,r:Math.round((width+height)/4-offset)});svgAttr(circle,attrs);svgAppend(parentGfx,circle);return circle;}function drawRect(parentGfx,width,height,r,offset,attrs){if(isObject(offset)){attrs=offset;offset=0;}offset=offset||0;attrs=computeStyle(attrs,{stroke:'black',strokeWidth:2,fill:'white'});var rect=svgCreate('rect');svgAttr(rect,{x:offset,y:offset,width:width-offset*2,height:height-offset*2,rx:r,ry:r});svgAttr(rect,attrs);svgAppend(parentGfx,rect);return rect;}function drawDiamond(parentGfx,width,height,attrs){var x_2=width/2;var y_2=height/2;var points=[{x:x_2,y:0},{x:width,y:y_2},{x:x_2,y:height},{x:0,y:y_2}];var pointsString=points.map(function(point){return point.x+','+point.y;}).join(' ');attrs=computeStyle(attrs,{stroke:'black',strokeWidth:2,fill:'white'});var polygon=svgCreate('polygon');svgAttr(polygon,{points:pointsString});svgAttr(polygon,attrs);svgAppend(parentGfx,polygon);return polygon;}function drawLine(parentGfx,waypoints,attrs){attrs=computeStyle(attrs,['no-fill'],{stroke:'black',strokeWidth:2,fill:'none'});var line=createLine(waypoints,attrs);svgAppend(parentGfx,line);return line;}function drawPath(parentGfx,d,attrs){attrs=computeStyle(attrs,['no-fill'],{strokeWidth:2,stroke:'black'});var path=svgCreate('path');svgAttr(path,{d:d});svgAttr(path,attrs);svgAppend(parentGfx,path);return path;}function drawMarker(type,parentGfx,path,attrs){return drawPath(parentGfx,path,assign({'data-marker':type},attrs));}function as(type){return function(parentGfx,element){return handlers[type](parentGfx,element);};}function renderer(type){return handlers[type];}function renderEventContent(element,parentGfx){var event=getSemantic(element);var isThrowing=isThrowEvent(event);if(isTypedEvent(event,'bpmn:MessageEventDefinition')){return renderer('bpmn:MessageEventDefinition')(parentGfx,element,isThrowing);}if(isTypedEvent(event,'bpmn:TimerEventDefinition')){return renderer('bpmn:TimerEventDefinition')(parentGfx,element,isThrowing);}if(isTypedEvent(event,'bpmn:ConditionalEventDefinition')){return renderer('bpmn:ConditionalEventDefinition')(parentGfx,element);}if(isTypedEvent(event,'bpmn:SignalEventDefinition')){return renderer('bpmn:SignalEventDefinition')(parentGfx,element,isThrowing);}if(isTypedEvent(event,'bpmn:CancelEventDefinition')&&isTypedEvent(event,'bpmn:TerminateEventDefinition',{parallelMultiple:false})){return renderer('bpmn:MultipleEventDefinition')(parentGfx,element,isThrowing);}if(isTypedEvent(event,'bpmn:CancelEventDefinition')&&isTypedEvent(event,'bpmn:TerminateEventDefinition',{parallelMultiple:true})){return renderer('bpmn:ParallelMultipleEventDefinition')(parentGfx,element,isThrowing);}if(isTypedEvent(event,'bpmn:EscalationEventDefinition')){return renderer('bpmn:EscalationEventDefinition')(parentGfx,element,isThrowing);}if(isTypedEvent(event,'bpmn:LinkEventDefinition')){return renderer('bpmn:LinkEventDefinition')(parentGfx,element,isThrowing);}if(isTypedEvent(event,'bpmn:ErrorEventDefinition')){return renderer('bpmn:ErrorEventDefinition')(parentGfx,element,isThrowing);}if(isTypedEvent(event,'bpmn:CancelEventDefinition')){return renderer('bpmn:CancelEventDefinition')(parentGfx,element,isThrowing);}if(isTypedEvent(event,'bpmn:CompensateEventDefinition')){return renderer('bpmn:CompensateEventDefinition')(parentGfx,element,isThrowing);}if(isTypedEvent(event,'bpmn:TerminateEventDefinition')){return renderer('bpmn:TerminateEventDefinition')(parentGfx,element,isThrowing);}return null;}function renderLabel(parentGfx,label,options){var text=textUtil.createText(label||'',options);svgClasses(text).add('djs-label');svgAppend(parentGfx,text);return text;}function renderEmbeddedLabel(parentGfx,element,align){var semantic=getSemantic(element);return renderLabel(parentGfx,semantic.name,{box:element,align:align,padding:5,style:{fill:getStrokeColor(element)}});}function renderExternalLabel(parentGfx,element){var semantic=getSemantic(element);var box={width:90,height:30,x:element.width/2+element.x,y:element.height/2+element.y};return renderLabel(parentGfx,semantic.name,{box:box,fitBox:true,style:{fontSize:'11px'}});}function renderLaneLabel(parentGfx,text,element){var textBox=renderLabel(parentGfx,text,{box:{height:30,width:element.height},align:'center-middle',style:{fill:getStrokeColor(element)}});var top=-1*element.height;transform(textBox,0,-top,270);}function createPathFromConnection(connection){var waypoints=connection.waypoints;var pathData='m  '+waypoints[0].x+','+waypoints[0].y;for(var i=1;i<waypoints.length;i++){pathData+='L'+waypoints[i].x+','+waypoints[i].y+' ';}return pathData;}var handlers=this.handlers={'bpmn:Event':function(parentGfx,element,attrs){return drawCircle(parentGfx,element.width,element.height,attrs);},'bpmn:StartEvent':function(parentGfx,element){var attrs={fill:getFillColor(element),stroke:getStrokeColor(element)};var semantic=getSemantic(element);if(!semantic.isInterrupting){attrs={strokeDasharray:'6',strokeLinecap:'round'};}var circle=renderer('bpmn:Event')(parentGfx,element,attrs);renderEventContent(element,parentGfx);return circle;},'bpmn:MessageEventDefinition':function(parentGfx,element,isThrowing){var pathData=pathMap.getScaledPath('EVENT_MESSAGE',{xScaleFactor:0.9,yScaleFactor:0.9,containerWidth:element.width,containerHeight:element.height,position:{mx:0.235,my:0.315}});var fill=isThrowing?getStrokeColor(element):getFillColor(element);var stroke=isThrowing?getFillColor(element):getStrokeColor(element);var messagePath=drawPath(parentGfx,pathData,{strokeWidth:1,fill:fill,stroke:stroke});return messagePath;},'bpmn:TimerEventDefinition':function(parentGfx,element){var circle=drawCircle(parentGfx,element.width,element.height,0.2*element.height,{strokeWidth:2,fill:getFillColor(element),stroke:getStrokeColor(element)});var pathData=pathMap.getScaledPath('EVENT_TIMER_WH',{xScaleFactor:0.75,yScaleFactor:0.75,containerWidth:element.width,containerHeight:element.height,position:{mx:0.5,my:0.5}});drawPath(parentGfx,pathData,{strokeWidth:2,strokeLinecap:'square',stroke:getStrokeColor(element)});for(var i=0;i<12;i++){var linePathData=pathMap.getScaledPath('EVENT_TIMER_LINE',{xScaleFactor:0.75,yScaleFactor:0.75,containerWidth:element.width,containerHeight:element.height,position:{mx:0.5,my:0.5}});var width=element.width/2;var height=element.height/2;drawPath(parentGfx,linePathData,{strokeWidth:1,strokeLinecap:'square',transform:'rotate('+(i*30)+','+height+','+width+')',stroke:getStrokeColor(element)});}return circle;},'bpmn:EscalationEventDefinition':function(parentGfx,event,isThrowing){var pathData=pathMap.getScaledPath('EVENT_ESCALATION',{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:0.5,my:0.2}});var fill=isThrowing?getStrokeColor(event):'none';return drawPath(parentGfx,pathData,{strokeWidth:1,fill:fill,stroke:getStrokeColor(event)});},'bpmn:ConditionalEventDefinition':function(parentGfx,event){var pathData=pathMap.getScaledPath('EVENT_CONDITIONAL',{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:0.5,my:0.222}});return drawPath(parentGfx,pathData,{strokeWidth:1,stroke:getStrokeColor(event)});},'bpmn:LinkEventDefinition':function(parentGfx,event,isThrowing){var pathData=pathMap.getScaledPath('EVENT_LINK',{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:0.57,my:0.263}});var fill=isThrowing?getStrokeColor(event):'none';return drawPath(parentGfx,pathData,{strokeWidth:1,fill:fill,stroke:getStrokeColor(event)});},'bpmn:ErrorEventDefinition':function(parentGfx,event,isThrowing){var pathData=pathMap.getScaledPath('EVENT_ERROR',{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:event.width,containerHeight:event.height,position:{mx:0.2,my:0.722}});var fill=isThrowing?getStrokeColor(event):'none';return drawPath(parentGfx,pathData,{strokeWidth:1,fill:fill,stroke:getStrokeColor(event)});},'bpmn:CancelEventDefinition':function(parentGfx,event,isThrowing){var pathData=pathMap.getScaledPath('EVENT_CANCEL_45',{xScaleFactor:1.0,yScaleFactor:1.0,containerWidth:event.width,containerHeight:event.height,position:{mx:0.638,my:-0.055}});var fill=isThrowing?'black':'none';var path=drawPath(parentGfx,pathData,{strokeWidth:1,fill:fill});rotate(path,45);return path;},'bpmn:CompensateEventDefinition':function(parentGfx,event,isThrowing){var pathData=pathMap.getScaledPath('EVENT_COMPENSATION',{xScaleFactor:1,yScaleFactor:1,containerWidth:event.width,containerHeight:event.height,position:{mx:0.22,my:0.5}});var fill=isThrowing?getStrokeColor(event):'none';return drawPath(parentGfx,pathData,{strokeWidth:1,fill:fill,stroke:getStrokeColor(event)});},'bpmn:SignalEventDefinition':function(parentGfx,event,isThrowing){var pathData=pathMap.getScaledPath('EVENT_SIGNAL',{xScaleFactor:0.9,yScaleFactor:0.9,containerWidth:event.width,containerHeight:event.height,position:{mx:0.5,my:0.2}});var fill=isThrowing?getStrokeColor(event):'none';return drawPath(parentGfx,pathData,{strokeWidth:1,fill:fill,stroke:getStrokeColor(event)});},'bpmn:MultipleEventDefinition':function(parentGfx,event,isThrowing){var pathData=pathMap.getScaledPath('EVENT_MULTIPLE',{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:event.width,containerHeight:event.height,position:{mx:0.222,my:0.36}});var fill=isThrowing?'black':'none';return drawPath(parentGfx,pathData,{strokeWidth:1,fill:fill});},'bpmn:ParallelMultipleEventDefinition':function(parentGfx,event){var pathData=pathMap.getScaledPath('EVENT_PARALLEL_MULTIPLE',{xScaleFactor:1.2,yScaleFactor:1.2,containerWidth:event.width,containerHeight:event.height,position:{mx:0.458,my:0.194}});return drawPath(parentGfx,pathData,{strokeWidth:1,fill:getStrokeColor(event),stroke:getStrokeColor(event)});},'bpmn:EndEvent':function(parentGfx,element){var circle=renderer('bpmn:Event')(parentGfx,element,{strokeWidth:4,fill:getFillColor(element),stroke:getStrokeColor(element)});renderEventContent(element,parentGfx,true);return circle;},'bpmn:TerminateEventDefinition':function(parentGfx,element){var circle=drawCircle(parentGfx,element.width,element.height,8,{strokeWidth:4,fill:getStrokeColor(element),stroke:getStrokeColor(element)});return circle;},'bpmn:IntermediateEvent':function(parentGfx,element){var outer=renderer('bpmn:Event')(parentGfx,element,{strokeWidth:1,fill:getFillColor(element),stroke:getStrokeColor(element)});drawCircle(parentGfx,element.width,element.height,INNER_OUTER_DIST,{strokeWidth:1,fill:getFillColor(element,'none'),stroke:getStrokeColor(element)});renderEventContent(element,parentGfx);return outer;},'bpmn:IntermediateCatchEvent':as('bpmn:IntermediateEvent'),'bpmn:IntermediateThrowEvent':as('bpmn:IntermediateEvent'),'bpmn:Activity':function(parentGfx,element,attrs){return drawRect(parentGfx,element.width,element.height,TASK_BORDER_RADIUS,attrs);},'bpmn:Task':function(parentGfx,element){var attrs={fill:getFillColor(element),stroke:getStrokeColor(element)};var rect=renderer('bpmn:Activity')(parentGfx,element,attrs);renderEmbeddedLabel(parentGfx,element,'center-middle');attachTaskMarkers(parentGfx,element);return rect;},'bpmn:ServiceTask':function(parentGfx,element){var task=renderer('bpmn:Task')(parentGfx,element);var pathDataBG=pathMap.getScaledPath('TASK_TYPE_SERVICE',{abspos:{x:12,y:18}});drawPath(parentGfx,pathDataBG,{strokeWidth:1,fill:getFillColor(element),stroke:getStrokeColor(element)});var fillPathData=pathMap.getScaledPath('TASK_TYPE_SERVICE_FILL',{abspos:{x:17.2,y:18}});drawPath(parentGfx,fillPathData,{strokeWidth:0,fill:getFillColor(element)});var pathData=pathMap.getScaledPath('TASK_TYPE_SERVICE',{abspos:{x:17,y:22}});drawPath(parentGfx,pathData,{strokeWidth:1,fill:getFillColor(element),stroke:getStrokeColor(element)});return task;},'bpmn:UserTask':function(parentGfx,element){var task=renderer('bpmn:Task')(parentGfx,element);var x=15;var y=12;var pathData=pathMap.getScaledPath('TASK_TYPE_USER_1',{abspos:{x:x,y:y}});drawPath(parentGfx,pathData,{strokeWidth:0.5,fill:getFillColor(element),stroke:getStrokeColor(element)});var pathData2=pathMap.getScaledPath('TASK_TYPE_USER_2',{abspos:{x:x,y:y}});drawPath(parentGfx,pathData2,{strokeWidth:0.5,fill:getFillColor(element),stroke:getStrokeColor(element)});var pathData3=pathMap.getScaledPath('TASK_TYPE_USER_3',{abspos:{x:x,y:y}});drawPath(parentGfx,pathData3,{strokeWidth:0.5,fill:getStrokeColor(element),stroke:getStrokeColor(element)});return task;},'bpmn:ManualTask':function(parentGfx,element){var task=renderer('bpmn:Task')(parentGfx,element);var pathData=pathMap.getScaledPath('TASK_TYPE_MANUAL',{abspos:{x:17,y:15}});drawPath(parentGfx,pathData,{strokeWidth:0.5,fill:getFillColor(element),stroke:getStrokeColor(element)});return task;},'bpmn:SendTask':function(parentGfx,element){var task=renderer('bpmn:Task')(parentGfx,element);var pathData=pathMap.getScaledPath('TASK_TYPE_SEND',{xScaleFactor:1,yScaleFactor:1,containerWidth:21,containerHeight:14,position:{mx:0.285,my:0.357}});drawPath(parentGfx,pathData,{strokeWidth:1,fill:getStrokeColor(element),stroke:getFillColor(element)});return task;},'bpmn:ReceiveTask':function(parentGfx,element){var semantic=getSemantic(element);var task=renderer('bpmn:Task')(parentGfx,element);var pathData;if(semantic.instantiate){drawCircle(parentGfx,28,28,20*0.22,{strokeWidth:1});pathData=pathMap.getScaledPath('TASK_TYPE_INSTANTIATING_SEND',{abspos:{x:7.77,y:9.52}});}else{pathData=pathMap.getScaledPath('TASK_TYPE_SEND',{xScaleFactor:0.9,yScaleFactor:0.9,containerWidth:21,containerHeight:14,position:{mx:0.3,my:0.4}});}drawPath(parentGfx,pathData,{strokeWidth:1,fill:getFillColor(element),stroke:getStrokeColor(element)});return task;},'bpmn:ScriptTask':function(parentGfx,element){var task=renderer('bpmn:Task')(parentGfx,element);var pathData=pathMap.getScaledPath('TASK_TYPE_SCRIPT',{abspos:{x:15,y:20}});drawPath(parentGfx,pathData,{strokeWidth:1,stroke:getStrokeColor(element)});return task;},'bpmn:BusinessRuleTask':function(parentGfx,element){var task=renderer('bpmn:Task')(parentGfx,element);var headerPathData=pathMap.getScaledPath('TASK_TYPE_BUSINESS_RULE_HEADER',{abspos:{x:8,y:8}});var businessHeaderPath=drawPath(parentGfx,headerPathData);svgAttr(businessHeaderPath,{strokeWidth:1,fill:getFillColor(element,'#aaaaaa'),stroke:getStrokeColor(element)});var headerData=pathMap.getScaledPath('TASK_TYPE_BUSINESS_RULE_MAIN',{abspos:{x:8,y:8}});var businessPath=drawPath(parentGfx,headerData);svgAttr(businessPath,{strokeWidth:1,stroke:getStrokeColor(element)});return task;},'bpmn:SubProcess':function(parentGfx,element,attrs){attrs=assign({fillOpacity:0.95,fill:getFillColor(element),stroke:getStrokeColor(element)},attrs);var rect=renderer('bpmn:Activity')(parentGfx,element,attrs);var expanded=DiUtil.isExpanded(element);var isEventSubProcess=DiUtil.isEventSubProcess(element);if(isEventSubProcess){svgAttr(rect,{strokeDasharray:'1,2'});}renderEmbeddedLabel(parentGfx,element,expanded?'center-top':'center-middle');if(expanded){attachTaskMarkers(parentGfx,element);}else{attachTaskMarkers(parentGfx,element,['SubProcessMarker']);}return rect;},'bpmn:AdHocSubProcess':function(parentGfx,element){return renderer('bpmn:SubProcess')(parentGfx,element);},'bpmn:Transaction':function(parentGfx,element){var outer=renderer('bpmn:SubProcess')(parentGfx,element);var innerAttrs=styles.style(['no-fill','no-events'],{stroke:getStrokeColor(element)});drawRect(parentGfx,element.width,element.height,TASK_BORDER_RADIUS-2,INNER_OUTER_DIST,innerAttrs);return outer;},'bpmn:CallActivity':function(parentGfx,element){return renderer('bpmn:SubProcess')(parentGfx,element,{strokeWidth:5});},'bpmn:Participant':function(parentGfx,element){var attrs={fillOpacity:0.95,fill:getFillColor(element),stroke:getStrokeColor(element)};var lane=renderer('bpmn:Lane')(parentGfx,element,attrs);var expandedPool=DiUtil.isExpanded(element);if(expandedPool){drawLine(parentGfx,[{x:30,y:0},{x:30,y:element.height}],{stroke:getStrokeColor(element)});var text=getSemantic(element).name;renderLaneLabel(parentGfx,text,element);}else{var text2=getSemantic(element).name;renderLabel(parentGfx,text2,{box:element,align:'center-middle',style:{fill:getStrokeColor(element)}});}var participantMultiplicity=!!(getSemantic(element).participantMultiplicity);if(participantMultiplicity){renderer('ParticipantMultiplicityMarker')(parentGfx,element);}return lane;},'bpmn:Lane':function(parentGfx,element,attrs){var rect=drawRect(parentGfx,element.width,element.height,0,assign({fill:getFillColor(element),stroke:getStrokeColor(element)},attrs));var semantic=getSemantic(element);if(semantic.$type==='bpmn:Lane'){var text=semantic.name;renderLaneLabel(parentGfx,text,element);}return rect;},'bpmn:InclusiveGateway':function(parentGfx,element){var attrs={fill:getFillColor(element),stroke:getStrokeColor(element)};var diamond=drawDiamond(parentGfx,element.width,element.height,attrs);drawCircle(parentGfx,element.width,element.height,element.height*0.24,{strokeWidth:2.5,fill:getFillColor(element),stroke:getStrokeColor(element)});return diamond;},'bpmn:ExclusiveGateway':function(parentGfx,element){var attrs={fill:getFillColor(element),stroke:getStrokeColor(element)};var diamond=drawDiamond(parentGfx,element.width,element.height,attrs);var pathData=pathMap.getScaledPath('GATEWAY_EXCLUSIVE',{xScaleFactor:0.4,yScaleFactor:0.4,containerWidth:element.width,containerHeight:element.height,position:{mx:0.32,my:0.3}});if((getDi(element).isMarkerVisible)){drawPath(parentGfx,pathData,{strokeWidth:1,fill:getStrokeColor(element),stroke:getStrokeColor(element)});}return diamond;},'bpmn:ComplexGateway':function(parentGfx,element){var attrs={fill:getFillColor(element),stroke:getStrokeColor(element)};var diamond=drawDiamond(parentGfx,element.width,element.height,attrs);var pathData=pathMap.getScaledPath('GATEWAY_COMPLEX',{xScaleFactor:0.5,yScaleFactor:0.5,containerWidth:element.width,containerHeight:element.height,position:{mx:0.46,my:0.26}});drawPath(parentGfx,pathData,{strokeWidth:1,fill:getStrokeColor(element),stroke:getStrokeColor(element)});return diamond;},'bpmn:ParallelGateway':function(parentGfx,element){var attrs={fill:getFillColor(element),stroke:getStrokeColor(element)};var diamond=drawDiamond(parentGfx,element.width,element.height,attrs);var pathData=pathMap.getScaledPath('GATEWAY_PARALLEL',{xScaleFactor:0.6,yScaleFactor:0.6,containerWidth:element.width,containerHeight:element.height,position:{mx:0.46,my:0.2}});drawPath(parentGfx,pathData,{strokeWidth:1,fill:getStrokeColor(element),stroke:getStrokeColor(element)});return diamond;},'bpmn:EventBasedGateway':function(parentGfx,element){var semantic=getSemantic(element);var attrs={fill:getFillColor(element),stroke:getStrokeColor(element)};var diamond=drawDiamond(parentGfx,element.width,element.height,attrs);drawCircle(parentGfx,element.width,element.height,element.height*0.20,{strokeWidth:1,fill:'none',stroke:getStrokeColor(element)});var type=semantic.eventGatewayType;var instantiate=!!semantic.instantiate;function drawEvent(){var pathData=pathMap.getScaledPath('GATEWAY_EVENT_BASED',{xScaleFactor:0.18,yScaleFactor:0.18,containerWidth:element.width,containerHeight:element.height,position:{mx:0.36,my:0.44}});var attrs={strokeWidth:2,fill:getFillColor(element,'none'),stroke:getStrokeColor(element)};drawPath(parentGfx,pathData,attrs);}if(type==='Parallel'){var pathData=pathMap.getScaledPath('GATEWAY_PARALLEL',{xScaleFactor:0.4,yScaleFactor:0.4,containerWidth:element.width,containerHeight:element.height,position:{mx:0.474,my:0.296}});var parallelPath=drawPath(parentGfx,pathData);svgAttr(parallelPath,{strokeWidth:1,fill:'none'});}else if(type==='Exclusive'){if(!instantiate){var innerCircle=drawCircle(parentGfx,element.width,element.height,element.height*0.26);svgAttr(innerCircle,{strokeWidth:1,fill:'none',stroke:getStrokeColor(element)});}drawEvent();}return diamond;},'bpmn:Gateway':function(parentGfx,element){return drawDiamond(parentGfx,element.width,element.height);},'bpmn:SequenceFlow':function(parentGfx,element){var pathData=createPathFromConnection(element);var fill=getFillColor(element),stroke=getStrokeColor(element);var attrs={strokeLinejoin:'round',markerEnd:marker('sequenceflow-end',fill,stroke),stroke:getStrokeColor(element)};var path=drawPath(parentGfx,pathData,attrs);var sequenceFlow=getSemantic(element);var source=element.source.businessObject;if(sequenceFlow.conditionExpression&&source.$instanceOf('bpmn:Activity')){svgAttr(path,{markerStart:marker('conditional-flow-marker',fill,stroke)});}if(source.default&&(source.$instanceOf('bpmn:Gateway')||source.$instanceOf('bpmn:Activity'))&&source.default===sequenceFlow){svgAttr(path,{markerStart:marker('conditional-default-flow-marker',fill,stroke)});}return path;},'bpmn:Association':function(parentGfx,element,attrs){var semantic=getSemantic(element);var fill=getFillColor(element),stroke=getStrokeColor(element);attrs=assign({strokeDasharray:'0.5, 5',strokeLinecap:'round',strokeLinejoin:'round',stroke:getStrokeColor(element)},attrs||{});if(semantic.associationDirection==='One'||semantic.associationDirection==='Both'){attrs.markerEnd=marker('association-end',fill,stroke);}if(semantic.associationDirection==='Both'){attrs.markerStart=marker('association-start',fill,stroke);}return drawLine(parentGfx,element.waypoints,attrs);},'bpmn:DataInputAssociation':function(parentGfx,element){var fill=getFillColor(element),stroke=getStrokeColor(element);return renderer('bpmn:Association')(parentGfx,element,{markerEnd:marker('association-end',fill,stroke)});},'bpmn:DataOutputAssociation':function(parentGfx,element){var fill=getFillColor(element),stroke=getStrokeColor(element);return renderer('bpmn:Association')(parentGfx,element,{markerEnd:marker('association-end',fill,stroke)});},'bpmn:MessageFlow':function(parentGfx,element){var semantic=getSemantic(element),di=getDi(element);var fill=getFillColor(element),stroke=getStrokeColor(element);var pathData=createPathFromConnection(element);var attrs={markerEnd:marker('messageflow-end',fill,stroke),markerStart:marker('messageflow-start',fill,stroke),strokeDasharray:'10, 12',strokeLinecap:'round',strokeLinejoin:'round',strokeWidth:'1.5px',stroke:getStrokeColor(element)};var path=drawPath(parentGfx,pathData,attrs);if(semantic.messageRef){var midPoint=path.getPointAtLength(path.getTotalLength()/2);var markerPathData=pathMap.getScaledPath('MESSAGE_FLOW_MARKER',{abspos:{x:midPoint.x,y:midPoint.y}});var messageAttrs={strokeWidth:1};if(di.messageVisibleKind==='initiating'){messageAttrs.fill='white';messageAttrs.stroke='black';}else{messageAttrs.fill='#888';messageAttrs.stroke='white';}drawPath(parentGfx,markerPathData,messageAttrs);}return path;},'bpmn:DataObject':function(parentGfx,element){var pathData=pathMap.getScaledPath('DATA_OBJECT_PATH',{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:0.474,my:0.296}});var elementObject=drawPath(parentGfx,pathData,{fill:getFillColor(element),stroke:getStrokeColor(element)});var semantic=getSemantic(element);if(isCollection(semantic)){renderDataItemCollection(parentGfx,element);}return elementObject;},'bpmn:DataObjectReference':as('bpmn:DataObject'),'bpmn:DataInput':function(parentGfx,element){var arrowPathData=pathMap.getRawPath('DATA_ARROW');var elementObject=renderer('bpmn:DataObject')(parentGfx,element);drawPath(parentGfx,arrowPathData,{strokeWidth:1});return elementObject;},'bpmn:DataOutput':function(parentGfx,element){var arrowPathData=pathMap.getRawPath('DATA_ARROW');var elementObject=renderer('bpmn:DataObject')(parentGfx,element);drawPath(parentGfx,arrowPathData,{strokeWidth:1,fill:'black'});return elementObject;},'bpmn:DataStoreReference':function(parentGfx,element){var DATA_STORE_PATH=pathMap.getScaledPath('DATA_STORE',{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:0,my:0.133}});var elementStore=drawPath(parentGfx,DATA_STORE_PATH,{strokeWidth:2,fill:getFillColor(element),stroke:getStrokeColor(element)});return elementStore;},'bpmn:BoundaryEvent':function(parentGfx,element){var semantic=getSemantic(element),cancel=semantic.cancelActivity;var attrs={strokeWidth:1,fill:getFillColor(element),stroke:getStrokeColor(element)};if(!cancel){attrs.strokeDasharray='6';attrs.strokeLinecap='round';}var outer=renderer('bpmn:Event')(parentGfx,element,attrs);drawCircle(parentGfx,element.width,element.height,INNER_OUTER_DIST,assign(attrs,{fill:'none'}));renderEventContent(element,parentGfx);return outer;},'bpmn:Group':function(parentGfx,element){return drawRect(parentGfx,element.width,element.height,TASK_BORDER_RADIUS,{strokeWidth:1,strokeDasharray:'8,3,1,3',fill:'none',pointerEvents:'none'});},'label':function(parentGfx,element){return renderExternalLabel(parentGfx,element);},'bpmn:TextAnnotation':function(parentGfx,element){var style={'fill':'none','stroke':'none'};var textElement=drawRect(parentGfx,element.width,element.height,0,0,style);var textPathData=pathMap.getScaledPath('TEXT_ANNOTATION',{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:0.0,my:0.0}});drawPath(parentGfx,textPathData,{stroke:getStrokeColor(element)});var text=getSemantic(element).text||'';renderLabel(parentGfx,text,{box:element,align:'left-middle',padding:5});return textElement;},'ParticipantMultiplicityMarker':function(parentGfx,element){var markerPath=pathMap.getScaledPath('MARKER_PARALLEL',{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:((element.width/2)/element.width),my:(element.height-15)/element.height}});drawMarker('participant-multiplicity',parentGfx,markerPath);},'SubProcessMarker':function(parentGfx,element){var markerRect=drawRect(parentGfx,14,14,0,{strokeWidth:1,fill:getFillColor(element),stroke:getStrokeColor(element)});translate(markerRect,element.width/2-7.5,element.height-20);var markerPath=pathMap.getScaledPath('MARKER_SUB_PROCESS',{xScaleFactor:1.5,yScaleFactor:1.5,containerWidth:element.width,containerHeight:element.height,position:{mx:(element.width/2-7.5)/element.width,my:(element.height-20)/element.height}});drawMarker('sub-process',parentGfx,markerPath,{fill:getFillColor(element),stroke:getStrokeColor(element)});},'ParallelMarker':function(parentGfx,element,position){var markerPath=pathMap.getScaledPath('MARKER_PARALLEL',{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:((element.width/2+position.parallel)/element.width),my:(element.height-20)/element.height}});drawMarker('parallel',parentGfx,markerPath);},'SequentialMarker':function(parentGfx,element,position){var markerPath=pathMap.getScaledPath('MARKER_SEQUENTIAL',{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:((element.width/2+position.seq)/element.width),my:(element.height-19)/element.height}});drawMarker('sequential',parentGfx,markerPath);},'CompensationMarker':function(parentGfx,element,position){var markerMath=pathMap.getScaledPath('MARKER_COMPENSATION',{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:((element.width/2+position.compensation)/element.width),my:(element.height-13)/element.height}});drawMarker('compensation',parentGfx,markerMath,{strokeWidth:1});},'LoopMarker':function(parentGfx,element,position){var markerPath=pathMap.getScaledPath('MARKER_LOOP',{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:((element.width/2+position.loop)/element.width),my:(element.height-7)/element.height}});drawMarker('loop',parentGfx,markerPath,{strokeWidth:1,fill:'none',strokeLinecap:'round',strokeMiterlimit:0.5});},'AdhocMarker':function(parentGfx,element,position){var markerPath=pathMap.getScaledPath('MARKER_ADHOC',{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:((element.width/2+position.adhoc)/element.width),my:(element.height-15)/element.height}});drawMarker('adhoc',parentGfx,markerPath,{strokeWidth:1,fill:'black'});}};function attachTaskMarkers(parentGfx,element,taskMarkers){var obj=getSemantic(element);var subprocess=taskMarkers&&taskMarkers.indexOf('SubProcessMarker')!==-1;var position;if(subprocess){position={seq:-21,parallel:-22,compensation:-42,loop:-18,adhoc:10};}else{position={seq:-3,parallel:-6,compensation:-27,loop:0,adhoc:10};}forEach(taskMarkers,function(marker){renderer(marker)(parentGfx,element,position);});if(obj.isForCompensation){renderer('CompensationMarker')(parentGfx,element,position);}if(obj.$type==='bpmn:AdHocSubProcess'){renderer('AdhocMarker')(parentGfx,element,position);}var loopCharacteristics=obj.loopCharacteristics,isSequential=loopCharacteristics&&loopCharacteristics.isSequential;if(loopCharacteristics){if(isSequential===undefined){renderer('LoopMarker')(parentGfx,element,position);}if(isSequential===false){renderer('ParallelMarker')(parentGfx,element,position);}if(isSequential===true){renderer('SequentialMarker')(parentGfx,element,position);}}}function renderDataItemCollection(parentGfx,element){var yPosition=(element.height-16)/element.height;var pathData=pathMap.getScaledPath('DATA_OBJECT_COLLECTION_PATH',{xScaleFactor:1,yScaleFactor:1,containerWidth:element.width,containerHeight:element.height,position:{mx:0.451,my:yPosition}});drawPath(parentGfx,pathData,{strokeWidth:2});}}inherits(BpmnRenderer,BaseRenderer);BpmnRenderer.$inject=['eventBus','styles','pathMap','canvas'];module.exports=BpmnRenderer;BpmnRenderer.prototype.canRender=function(element){return is(element,'bpmn:BaseElement');};BpmnRenderer.prototype.drawShape=function(parentGfx,element){var type=element.type;var h=this.handlers[type];return h(parentGfx,element);};BpmnRenderer.prototype.drawConnection=function(parentGfx,element){var type=element.type;var h=this.handlers[type];return h(parentGfx,element);};BpmnRenderer.prototype.getShapePath=function(element){if(is(element,'bpmn:Event')){return getCirclePath(element);}if(is(element,'bpmn:Activity')){return getRoundRectPath(element,TASK_BORDER_RADIUS);}if(is(element,'bpmn:Gateway')){return getDiamondPath(element);}return getRectPath(element);};function isTypedEvent(event,eventDefinitionType,filter){function matches(definition,filter){return every(filter,function(val,key){return definition[key]==val;});}return some(event.eventDefinitions,function(definition){return definition.$type===eventDefinitionType&&matches(event,filter);});}function isThrowEvent(event){return(event.$type==='bpmn:IntermediateThrowEvent')||(event.$type==='bpmn:EndEvent');}function isCollection(element){var dataObject=element.dataObjectRef;return element.isCollection||(dataObject&&dataObject.isCollection);}function getDi(element){return element.businessObject.di;}function getSemantic(element){return element.businessObject;}function getCirclePath(shape){var cx=shape.x+shape.width/2,cy=shape.y+shape.height/2,radius=shape.width/2;var circlePath=[['M',cx,cy],['m',0,-radius],['a',radius,radius,0,1,1,0,2*radius],['a',radius,radius,0,1,1,0,-2*radius],['z']];return componentsToPath(circlePath);}function getRoundRectPath(shape,borderRadius){var x=shape.x,y=shape.y,width=shape.width,height=shape.height;var roundRectPath=[['M',x+borderRadius,y],['l',width-borderRadius*2,0],['a',borderRadius,borderRadius,0,0,1,borderRadius,borderRadius],['l',0,height-borderRadius*2],['a',borderRadius,borderRadius,0,0,1,-borderRadius,borderRadius],['l',borderRadius*2-width,0],['a',borderRadius,borderRadius,0,0,1,-borderRadius,-borderRadius],['l',0,borderRadius*2-height],['a',borderRadius,borderRadius,0,0,1,borderRadius,-borderRadius],['z']];return componentsToPath(roundRectPath);}function getDiamondPath(shape){var width=shape.width,height=shape.height,x=shape.x,y=shape.y,halfWidth=width/2,halfHeight=height/2;var diamondPath=[['M',x+halfWidth,y],['l',halfWidth,halfHeight],['l',-halfWidth,halfHeight],['l',-halfWidth,-halfHeight],['z']];return componentsToPath(diamondPath);}function getRectPath(shape){var x=shape.x,y=shape.y,width=shape.width,height=shape.height;var rectPath=[['M',x,y],['l',width,0],['l',0,height],['l',-width,0],['z']];return componentsToPath(rectPath);}function getFillColor(element,defaultColor){var bo=getBusinessObject(element);return bo.di.get('fill')||defaultColor||'white';}function getStrokeColor(element,defaultColor){var bo=getBusinessObject(element);return bo.di.get('stroke')||defaultColor||'black';}},{"../util/DiUtil":195,"../util/ModelUtil":197,"diagram-js/lib/draw/BaseRenderer":235,"diagram-js/lib/util/RenderUtil":385,"diagram-js/lib/util/SvgTransformUtil":386,"diagram-js/lib/util/Text":387,"inherits":398,"lodash/collection/every":414,"lodash/collection/forEach":417,"lodash/collection/some":424,"lodash/lang/isObject":542,"lodash/object/assign":547,"min-dom/lib/query":569,"tiny-svg/lib/append":607,"tiny-svg/lib/attr":609,"tiny-svg/lib/classes":610,"tiny-svg/lib/create":613}],109:[function(require,module,exports){'use strict';function PathMap(){this.pathMap={'EVENT_MESSAGE':{d:'m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}',height:36,width:36,heightElements:[6,14],widthElements:[10.5,21]},'EVENT_SIGNAL':{d:'M {mx},{my} l {e.x0},{e.y0} l -{e.x1},0 Z',height:36,width:36,heightElements:[18],widthElements:[10,20]},'EVENT_ESCALATION':{d:'M {mx},{my} l {e.x0},{e.y0} l -{e.x0},-{e.y1} l -{e.x0},{e.y1} Z',height:36,width:36,heightElements:[20,7],widthElements:[8]},'EVENT_CONDITIONAL':{d:'M {e.x0},{e.y0} l {e.x1},0 l 0,{e.y2} l -{e.x1},0 Z '+'M {e.x2},{e.y3} l {e.x0},0 '+'M {e.x2},{e.y4} l {e.x0},0 '+'M {e.x2},{e.y5} l {e.x0},0 '+'M {e.x2},{e.y6} l {e.x0},0 '+'M {e.x2},{e.y7} l {e.x0},0 '+'M {e.x2},{e.y8} l {e.x0},0 ',height:36,width:36,heightElements:[8.5,14.5,18,11.5,14.5,17.5,20.5,23.5,26.5],widthElements:[10.5,14.5,12.5]},'EVENT_LINK':{d:'m {mx},{my} 0,{e.y0} -{e.x1},0 0,{e.y1} {e.x1},0 0,{e.y0} {e.x0},-{e.y2} -{e.x0},-{e.y2} z',height:36,width:36,heightElements:[4.4375,6.75,7.8125],widthElements:[9.84375,13.5]},'EVENT_ERROR':{d:'m {mx},{my} {e.x0},-{e.y0} {e.x1},-{e.y1} {e.x2},{e.y2} {e.x3},-{e.y3} -{e.x4},{e.y4} -{e.x5},-{e.y5} z',height:36,width:36,heightElements:[0.023,8.737,8.151,16.564,10.591,8.714],widthElements:[0.085,6.672,6.97,4.273,5.337,6.636]},'EVENT_CANCEL_45':{d:'m {mx},{my} -{e.x1},0 0,{e.x0} {e.x1},0 0,{e.y1} {e.x0},0 '+'0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z',height:36,width:36,heightElements:[4.75,8.5],widthElements:[4.75,8.5]},'EVENT_COMPENSATION':{d:'m {mx},{my} {e.x0},-{e.y0} 0,{e.y1} z m {e.x1},-{e.y2} {e.x2},-{e.y3} 0,{e.y1} -{e.x2},-{e.y3} z',height:36,width:36,heightElements:[6.5,13,0.4,6.1],widthElements:[9,9.3,8.7]},'EVENT_TIMER_WH':{d:'M {mx},{my} l {e.x0},-{e.y0} m -{e.x0},{e.y0} l {e.x1},{e.y1} ',height:36,width:36,heightElements:[10,2],widthElements:[3,7]},'EVENT_TIMER_LINE':{d:'M {mx},{my} '+'m {e.x0},{e.y0} l -{e.x1},{e.y1} ',height:36,width:36,heightElements:[10,3],widthElements:[0,0]},'EVENT_MULTIPLE':{d:'m {mx},{my} {e.x1},-{e.y0} {e.x1},{e.y0} -{e.x0},{e.y1} -{e.x2},0 z',height:36,width:36,heightElements:[6.28099,12.56199],widthElements:[3.1405,9.42149,12.56198]},'EVENT_PARALLEL_MULTIPLE':{d:'m {mx},{my} {e.x0},0 0,{e.y1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} '+'-{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z',height:36,width:36,heightElements:[2.56228,7.68683],widthElements:[2.56228,7.68683]},'GATEWAY_EXCLUSIVE':{d:'m {mx},{my} {e.x0},{e.y0} {e.x1},{e.y0} {e.x2},0 {e.x4},{e.y2} '+'{e.x4},{e.y1} {e.x2},0 {e.x1},{e.y3} {e.x0},{e.y3} '+'{e.x3},0 {e.x5},{e.y1} {e.x5},{e.y2} {e.x3},0 z',height:17.5,width:17.5,heightElements:[8.5,6.5312,-6.5312,-8.5],widthElements:[6.5,-6.5,3,-3,5,-5]},'GATEWAY_PARALLEL':{d:'m {mx},{my} 0,{e.y1} -{e.x1},0 0,{e.y0} {e.x1},0 0,{e.y1} {e.x0},0 '+'0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z',height:30,width:30,heightElements:[5,12.5],widthElements:[5,12.5]},'GATEWAY_EVENT_BASED':{d:'m {mx},{my} {e.x0},{e.y0} {e.x0},{e.y1} {e.x1},{e.y2} {e.x2},0 z',height:11,width:11,heightElements:[-6,6,12,-12],widthElements:[9,-3,-12]},'GATEWAY_COMPLEX':{d:'m {mx},{my} 0,{e.y0} -{e.x0},-{e.y1} -{e.x1},{e.y2} {e.x0},{e.y1} -{e.x2},0 0,{e.y3} '+'{e.x2},0  -{e.x0},{e.y1} l {e.x1},{e.y2} {e.x0},-{e.y1} 0,{e.y0} {e.x3},0 0,-{e.y0} {e.x0},{e.y1} '+'{e.x1},-{e.y2} -{e.x0},-{e.y1} {e.x2},0 0,-{e.y3} -{e.x2},0 {e.x0},-{e.y1} -{e.x1},-{e.y2} '+'-{e.x0},{e.y1} 0,-{e.y0} -{e.x3},0 z',height:17.125,width:17.125,heightElements:[4.875,3.4375,2.125,3],widthElements:[3.4375,2.125,4.875,3]},'DATA_OBJECT_PATH':{d:'m 0,0 {e.x1},0 {e.x0},{e.y0} 0,{e.y1} -{e.x2},0 0,-{e.y2} {e.x1},0 0,{e.y0} {e.x0},0',height:61,width:51,heightElements:[10,50,60],widthElements:[10,40,50,60]},'DATA_OBJECT_COLLECTION_PATH':{d:'m {mx}, {my} '+'m  0 15  l 0 -15 '+'m  4 15  l 0 -15 '+'m  4 15  l 0 -15 ',height:61,width:51,heightElements:[12],widthElements:[1,6,12,15]},'DATA_ARROW':{d:'m 5,9 9,0 0,-3 5,5 -5,5 0,-3 -9,0 z',height:61,width:51,heightElements:[],widthElements:[]},'DATA_STORE':{d:'m  {mx},{my} '+'l  0,{e.y2} '+'c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 '+'l  0,-{e.y2} '+'c -{e.x0},-{e.y1} -{e.x1},-{e.y1} -{e.x2},0'+'c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 '+'m  -{e.x2},{e.y0}'+'c  {e.x0},{e.y1} {e.x1},{e.y1} {e.x2},0'+'m  -{e.x2},{e.y0}'+'c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0',height:61,width:61,heightElements:[7,10,45],widthElements:[2,58,60]},'TEXT_ANNOTATION':{d:'m {mx}, {my} m 10,0 l -10,0 l 0,{e.y0} l 10,0',height:30,width:10,heightElements:[30],widthElements:[10]},'MARKER_SUB_PROCESS':{d:'m{mx},{my} m 7,2 l 0,10 m -5,-5 l 10,0',height:10,width:10,heightElements:[],widthElements:[]},'MARKER_PARALLEL':{d:'m{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10',height:10,width:10,heightElements:[],widthElements:[]},'MARKER_SEQUENTIAL':{d:'m{mx},{my} m 0,3 l 10,0 m -10,3 l 10,0 m -10,3 l 10,0',height:10,width:10,heightElements:[],widthElements:[]},'MARKER_COMPENSATION':{d:'m {mx},{my} 7,-5 0,10 z m 7.1,-0.3 6.9,-4.7 0,10 -6.9,-4.7 z',height:10,width:21,heightElements:[],widthElements:[]},'MARKER_LOOP':{d:'m {mx},{my} c 3.526979,0 6.386161,-2.829858 6.386161,-6.320661 0,-3.490806 -2.859182,-6.320661 '+'-6.386161,-6.320661 -3.526978,0 -6.38616,2.829855 -6.38616,6.320661 0,1.745402 '+'0.714797,3.325567 1.870463,4.469381 0.577834,0.571908 1.265885,1.034728 2.029916,1.35457 '+'l -0.718163,-3.909793 m 0.718163,3.909793 -3.885211,0.802902',height:13.9,width:13.7,heightElements:[],widthElements:[]},'MARKER_ADHOC':{d:'m {mx},{my} m 0.84461,2.64411 c 1.05533,-1.23780996 2.64337,-2.07882 4.29653,-1.97997996 2.05163,0.0805 '+'3.85579,1.15803 5.76082,1.79107 1.06385,0.34139996 2.24454,0.1438 3.18759,-0.43767 0.61743,-0.33642 '+'1.2775,-0.64078 1.7542,-1.17511 0,0.56023 0,1.12046 0,1.6807 -0.98706,0.96237996 -2.29792,1.62393996 '+'-3.6918,1.66181996 -1.24459,0.0927 -2.46671,-0.2491 -3.59505,-0.74812 -1.35789,-0.55965 '+'-2.75133,-1.33436996 -4.27027,-1.18121996 -1.37741,0.14601 -2.41842,1.13685996 -3.44288,1.96782996 z',height:4,width:15,heightElements:[],widthElements:[]},'TASK_TYPE_SEND':{d:'m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}',height:14,width:21,heightElements:[6,14],widthElements:[10.5,21]},'TASK_TYPE_SCRIPT':{d:'m {mx},{my} c 9.966553,-6.27276 -8.000926,-7.91932 2.968968,-14.938 l -8.802728,0 '+'c -10.969894,7.01868 6.997585,8.66524 -2.968967,14.938 z '+'m -7,-12 l 5,0 '+'m -4.5,3 l 4.5,0 '+'m -3,3 l 5,0'+'m -4,3 l 5,0',height:15,width:12.6,heightElements:[6,14],widthElements:[10.5,21]},'TASK_TYPE_USER_1':{d:'m {mx},{my} c 0.909,-0.845 1.594,-2.049 1.594,-3.385 0,-2.554 -1.805,-4.62199999 '+'-4.357,-4.62199999 -2.55199998,0 -4.28799998,2.06799999 -4.28799998,4.62199999 0,1.348 '+'0.974,2.562 1.89599998,3.405 -0.52899998,0.187 -5.669,2.097 -5.794,4.7560005 v 6.718 '+'h 17 v -6.718 c 0,-2.2980005 -5.5279996,-4.5950005 -6.0509996,-4.7760005 z'+'m -8,6 l 0,5.5 m 11,0 l 0,-5'},'TASK_TYPE_USER_2':{d:'m {mx},{my} m 2.162,1.009 c 0,2.4470005 -2.158,4.4310005 -4.821,4.4310005 '+'-2.66499998,0 -4.822,-1.981 -4.822,-4.4310005 '},'TASK_TYPE_USER_3':{d:'m {mx},{my} m -6.9,-3.80 c 0,0 2.25099998,-2.358 4.27399998,-1.177 2.024,1.181 4.221,1.537 '+'4.124,0.965 -0.098,-0.57 -0.117,-3.79099999 -4.191,-4.13599999 -3.57499998,0.001 '+'-4.20799998,3.36699999 -4.20699998,4.34799999 z'},'TASK_TYPE_MANUAL':{d:'m {mx},{my} c 0.234,-0.01 5.604,0.008 8.029,0.004 0.808,0 1.271,-0.172 1.417,-0.752 0.227,-0.898 '+'-0.334,-1.314 -1.338,-1.316 -2.467,-0.01 -7.886,-0.004 -8.108,-0.004 -0.014,-0.079 0.016,-0.533 0,-0.61 '+'0.195,-0.042 8.507,0.006 9.616,0.002 0.877,-0.007 1.35,-0.438 1.353,-1.208 0.003,-0.768 -0.479,-1.09 '+'-1.35,-1.091 -2.968,-0.002 -9.619,-0.013 -9.619,-0.013 v -0.591 c 0,0 5.052,-0.016 7.225,-0.016 '+'0.888,-0.002 1.354,-0.416 1.351,-1.193 -0.006,-0.761 -0.492,-1.196 -1.361,-1.196 -3.473,-0.005 '+'-10.86,-0.003 -11.0829995,-0.003 -0.022,-0.047 -0.045,-0.094 -0.069,-0.139 0.3939995,-0.319 '+'2.0409995,-1.626 2.4149995,-2.017 0.469,-0.4870005 0.519,-1.1650005 0.162,-1.6040005 -0.414,-0.511 '+'-0.973,-0.5 -1.48,-0.236 -1.4609995,0.764 -6.5999995,3.6430005 -7.7329995,4.2710005 -0.9,0.499 '+'-1.516,1.253 -1.882,2.19 -0.37000002,0.95 -0.17,2.01 -0.166,2.979 0.004,0.718 -0.27300002,1.345 '+'-0.055,2.063 0.629,2.087 2.425,3.312 4.859,3.318 4.6179995,0.014 9.2379995,-0.139 13.8569995,-0.158 '+'0.755,-0.004 1.171,-0.301 1.182,-1.033 0.012,-0.754 -0.423,-0.969 -1.183,-0.973 -1.778,-0.01 '+'-5.824,-0.004 -6.04,-0.004 10e-4,-0.084 0.003,-0.586 10e-4,-0.67 z'},'TASK_TYPE_INSTANTIATING_SEND':{d:'m {mx},{my} l 0,8.4 l 12.6,0 l 0,-8.4 z l 6.3,3.6 l 6.3,-3.6'},'TASK_TYPE_SERVICE':{d:'m {mx},{my} v -1.71335 c 0.352326,-0.0705 0.703932,-0.17838 1.047628,-0.32133 '+'0.344416,-0.14465 0.665822,-0.32133 0.966377,-0.52145 l 1.19431,1.18005 1.567487,-1.57688 '+'-1.195028,-1.18014 c 0.403376,-0.61394 0.683079,-1.29908 0.825447,-2.01824 l 1.622133,-0.01 '+'v -2.2196 l -1.636514,0.01 c -0.07333,-0.35153 -0.178319,-0.70024 -0.323564,-1.04372 '+'-0.145244,-0.34406 -0.321407,-0.6644 -0.522735,-0.96217 l 1.131035,-1.13631 -1.583305,-1.56293 '+'-1.129598,1.13589 c -0.614052,-0.40108 -1.302883,-0.68093 -2.022633,-0.82247 l 0.0093,-1.61852 '+'h -2.241173 l 0.0042,1.63124 c -0.353763,0.0736 -0.705369,0.17977 -1.049785,0.32371 -0.344415,0.14437 '+'-0.665102,0.32092 -0.9635006,0.52046 l -1.1698628,-1.15823 -1.5667691,1.5792 1.1684265,1.15669 '+'c -0.4026573,0.61283 -0.68308,1.29797 -0.8247287,2.01713 l -1.6588041,0.003 v 2.22174 '+'l 1.6724648,-0.006 c 0.073327,0.35077 0.1797598,0.70243 0.3242851,1.04472 0.1452428,0.34448 '+'0.3214064,0.6644 0.5227339,0.96066 l -1.1993431,1.19723 1.5840256,1.56011 1.1964668,-1.19348 '+'c 0.6140517,0.40346 1.3028827,0.68232 2.0233517,0.82331 l 7.19e-4,1.69892 h 2.226848 z '+'m 0.221462,-3.9957 c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 '+'0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 '+'0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z'},'TASK_TYPE_SERVICE_FILL':{d:'m {mx},{my} c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 '+'0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 '+'0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z'},'TASK_TYPE_BUSINESS_RULE_HEADER':{d:'m {mx},{my} 0,4 20,0 0,-4 z'},'TASK_TYPE_BUSINESS_RULE_MAIN':{d:'m {mx},{my} 0,12 20,0 0,-12 z'+'m 0,8 l 20,0 '+'m -13,-4 l 0,8'},'MESSAGE_FLOW_MARKER':{d:'m {mx},{my} m -10.5 ,-7 l 0,14 l 21,0 l 0,-14 z l 10.5,6 l 10.5,-6'}};this.getRawPath=function getRawPath(pathId){return this.pathMap[pathId].d;};this.getScaledPath=function getScaledPath(pathId,param){var rawPath=this.pathMap[pathId];var mx,my;if(param.abspos){mx=param.abspos.x;my=param.abspos.y;}else{mx=param.containerWidth*param.position.mx;my=param.containerHeight*param.position.my;}var coordinates={};if(param.position){var heightRatio=(param.containerHeight/rawPath.height)*param.yScaleFactor;var widthRatio=(param.containerWidth/rawPath.width)*param.xScaleFactor;for(var heightIndex=0;heightIndex<rawPath.heightElements.length;heightIndex++){coordinates['y'+heightIndex]=rawPath.heightElements[heightIndex]*heightRatio;}for(var widthIndex=0;widthIndex<rawPath.widthElements.length;widthIndex++){coordinates['x'+widthIndex]=rawPath.widthElements[widthIndex]*widthRatio;}}var path=format(rawPath.d,{mx:mx,my:my,e:coordinates});return path;};}module.exports=PathMap;var tokenRegex=/\{([^\}]+)\}/g,objNotationRegex=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g;function replacer(all,key,obj){var res=obj;key.replace(objNotationRegex,function(all,name,quote,quotedName,isFunc){name=name||quotedName;if(res){if(name in res){res=res[name];}typeof res=='function'&&isFunc&&(res=res());}});res=(res==null||res==obj?all:res)+'';return res;}function format(str,obj){return String(str).replace(tokenRegex,function(all,key){return replacer(all,key,obj);});}},{}],110:[function(require,module,exports){module.exports={__init__:['bpmnRenderer'],bpmnRenderer:['type',require('./BpmnRenderer')],pathMap:['type',require('./PathMap')]};},{"./BpmnRenderer":108,"./PathMap":109}],111:[function(require,module,exports){var AutoResize=require('diagram-js/lib/features/auto-resize/AutoResize');var inherits=require('inherits');var is=require('../../util/ModelUtil').is;function BpmnAutoResize(eventBus,elementRegistry,modeling,rules){AutoResize.call(this,eventBus,elementRegistry,modeling,rules);}BpmnAutoResize.$inject=['eventBus','elementRegistry','modeling','rules'];inherits(BpmnAutoResize,AutoResize);module.exports=BpmnAutoResize;BpmnAutoResize.prototype.resize=function(target,newBounds){if(is(target,'bpmn:Participant')){this._modeling.resizeLane(target,newBounds);}else{this._modeling.resizeShape(target,newBounds);}};},{"../../util/ModelUtil":197,"diagram-js/lib/features/auto-resize/AutoResize":243,"inherits":398}],112:[function(require,module,exports){'use strict';var is=require('../../util/ModelUtil').is;var inherits=require('inherits');var forEach=require('lodash/collection/forEach');var AutoResizeProvider=require('diagram-js/lib/features/auto-resize/AutoResizeProvider');function BpmnAutoResizeProvider(eventBus,modeling){AutoResizeProvider.call(this,eventBus);this._modeling=modeling;}inherits(BpmnAutoResizeProvider,AutoResizeProvider);BpmnAutoResizeProvider.$inject=['eventBus','modeling'];module.exports=BpmnAutoResizeProvider;BpmnAutoResizeProvider.prototype.canResize=function(elements,target){if(!is(target,'bpmn:Participant')&&!is(target,'bpmn:Lane')&&!(is(target,'bpmn:SubProcess'))){return false;}var canResize=true;forEach(elements,function(element){if(is(element,'bpmn:Lane')||element.labelTarget){canResize=false;return;}});return canResize;};},{"../../util/ModelUtil":197,"diagram-js/lib/features/auto-resize/AutoResizeProvider":244,"inherits":398,"lodash/collection/forEach":417}],113:[function(require,module,exports){module.exports={__init__:['bpmnAutoResize','bpmnAutoResizeProvider'],bpmnAutoResize:['type',require('./BpmnAutoResize')],bpmnAutoResizeProvider:['type',require('./BpmnAutoResizeProvider')]};},{"./BpmnAutoResize":111,"./BpmnAutoResizeProvider":112}],114:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign'),forEach=require('lodash/collection/forEach'),isArray=require('lodash/lang/isArray'),is=require('../../util/ModelUtil').is,isExpanded=require('../../util/DiUtil').isExpanded,isAny=require('../modeling/util/ModelingUtil').isAny,getChildLanes=require('../modeling/util/LaneUtil').getChildLanes,isEventSubProcess=require('../../util/DiUtil').isEventSubProcess,hasPrimaryModifier=require('diagram-js/lib/util/Mouse').hasPrimaryModifier;function ContextPadProvider(eventBus,contextPad,modeling,elementFactory,connect,create,popupMenu,canvas,rules,translate){contextPad.registerProvider(this);this._contextPad=contextPad;this._modeling=modeling;this._elementFactory=elementFactory;this._connect=connect;this._create=create;this._popupMenu=popupMenu;this._canvas=canvas;this._rules=rules;this._translate=translate;eventBus.on('create.end',250,function(event){var shape=event.context.shape;if(!hasPrimaryModifier(event)){return;}var entries=contextPad.getEntries(shape);if(entries.replace){entries.replace.action.click(event,shape);}});}ContextPadProvider.$inject=['eventBus','contextPad','modeling','elementFactory','connect','create','popupMenu','canvas','rules','translate'];module.exports=ContextPadProvider;ContextPadProvider.prototype.getContextPadEntries=function(element){var contextPad=this._contextPad,modeling=this._modeling,elementFactory=this._elementFactory,connect=this._connect,create=this._create,popupMenu=this._popupMenu,canvas=this._canvas,rules=this._rules,translate=this._translate;var actions={};if(element.type==='label'){return actions;}var businessObject=element.businessObject;function startConnect(event,element,autoActivate){connect.start(event,element,autoActivate);}function removeElement(e){modeling.removeElements([element]);}function getReplaceMenuPosition(element){var Y_OFFSET=5;var diagramContainer=canvas.getContainer(),pad=contextPad.getPad(element).html;var diagramRect=diagramContainer.getBoundingClientRect(),padRect=pad.getBoundingClientRect();var top=padRect.top-diagramRect.top;var left=padRect.left-diagramRect.left;var pos={x:left,y:top+padRect.height+Y_OFFSET};return pos;}function chineseFanYi(t){var t=t.replace(/^bpmn\:/,'');if(t=="ReceiveTask"){t="接收任务";}else if(t=="IntermediateCatchEvent"){t="中间捕获事件";}else if(t=="Task"){t="任务";}else if(t=="EndEvent"){t="结束事件";}else if(t=="ExclusiveGateway"){t="排他网关";}else if(t=="IntermediateThrowEvent"){t="中间抛出事件";}else if(t=="TextAnnotation"){t="文本注解";}return t;}function appendAction(type,className,title,options){if(typeof title!=='string'){options=title;title=translate('添加{type}',{type:chineseFanYi(type)});}function appendListener(event,element){var shape=elementFactory.createShape(assign({type:type},options));create.start(event,shape,element);}return{group:'model',className:className,title:title,action:{dragstart:appendListener,click:appendListener}};}function splitLaneHandler(count){return function(event,element){modeling.splitLane(element,count);contextPad.open(element,true);};}if(isAny(businessObject,['bpmn:Lane','bpmn:Participant'])&&isExpanded(businessObject)){var childLanes=getChildLanes(element);assign(actions,{'lane-insert-above':{group:'lane-insert-above',className:'bpmn-icon-lane-insert-above',title:translate('Add Lane above'),action:{click:function(event,element){modeling.addLane(element,'top');}}}});if(childLanes.length<2){if(element.height>=120){assign(actions,{'lane-divide-two':{group:'lane-divide',className:'bpmn-icon-lane-divide-two',title:translate('Divide into two Lanes'),action:{click:splitLaneHandler(2)}}});}if(element.height>=180){assign(actions,{'lane-divide-three':{group:'lane-divide',className:'bpmn-icon-lane-divide-three',title:translate('Divide into three Lanes'),action:{click:splitLaneHandler(3)}}});}}assign(actions,{'lane-insert-below':{group:'lane-insert-below',className:'bpmn-icon-lane-insert-below',title:translate('Add Lane below'),action:{click:function(event,element){modeling.addLane(element,'bottom');}}}});}if(is(businessObject,'bpmn:FlowNode')){if(is(businessObject,'bpmn:EventBasedGateway')){assign(actions,{'append.receive-task':appendAction('bpmn:ReceiveTask','bpmn-icon-receive-task'),'append.message-intermediate-event':appendAction('bpmn:IntermediateCatchEvent','bpmn-icon-intermediate-event-catch-message',{eventDefinitionType:'bpmn:MessageEventDefinition'}),'append.timer-intermediate-event':appendAction('bpmn:IntermediateCatchEvent','bpmn-icon-intermediate-event-catch-timer',{eventDefinitionType:'bpmn:TimerEventDefinition'}),'append.condtion-intermediate-event':appendAction('bpmn:IntermediateCatchEvent','bpmn-icon-intermediate-event-catch-condition',{eventDefinitionType:'bpmn:ConditionalEventDefinition'}),'append.signal-intermediate-event':appendAction('bpmn:IntermediateCatchEvent','bpmn-icon-intermediate-event-catch-signal',{eventDefinitionType:'bpmn:SignalEventDefinition'})});}else
if(isEventType(businessObject,'bpmn:BoundaryEvent','bpmn:CompensateEventDefinition')){assign(actions,{'append.compensation-activity':appendAction('bpmn:Task','bpmn-icon-task',translate('Append compensation activity'),{isForCompensation:true})});}else
if(!is(businessObject,'bpmn:EndEvent')&&!businessObject.isForCompensation&&!isEventType(businessObject,'bpmn:IntermediateThrowEvent','bpmn:LinkEventDefinition')&&!isEventSubProcess(businessObject)){assign(actions,{'append.end-event':appendAction('bpmn:EndEvent','bpmn-icon-end-event-none'),'append.gateway':appendAction('bpmn:ExclusiveGateway','bpmn-icon-gateway-xor'),'append.append-task':appendAction('bpmn:Task','bpmn-icon-task'),'append.intermediate-event':appendAction('bpmn:IntermediateThrowEvent','bpmn-icon-intermediate-event-none')});}}var replaceMenu;if(popupMenu._providers['bpmn-replace']){replaceMenu=popupMenu.create('bpmn-replace',element);}if(replaceMenu&&!replaceMenu.isEmpty()){assign(actions,{'replace':{group:'edit',className:'bpmn-icon-screw-wrench',title:translate('修改类型'),action:{click:function(event,element){replaceMenu.open(assign(getReplaceMenuPosition(element),{cursor:{x:event.x,y:event.y}}),element);}}}});}if(isAny(businessObject,['bpmn:FlowNode','bpmn:InteractionNode','bpmn:DataObjectReference','bpmn:DataStoreReference'])){assign(actions,{'append.text-annotation':appendAction('bpmn:TextAnnotation','bpmn-icon-text-annotation'),'connect':{group:'connect',className:'bpmn-icon-connection-multi',title:translate('通过'+(businessObject.isForCompensation?'':'顺序流/消息流或')+'关联连接'),action:{click:startConnect,dragstart:startConnect}}});}if(isAny(businessObject,['bpmn:DataObjectReference','bpmn:DataStoreReference'])){assign(actions,{'connect':{group:'connect',className:'bpmn-icon-connection-multi',title:translate('Connect using DataInputAssociation'),action:{click:startConnect,dragstart:startConnect}}});}var deleteAllowed=rules.allowed('elements.delete',{elements:[element]});if(isArray(deleteAllowed)){deleteAllowed=deleteAllowed[0]===element;}if(deleteAllowed){assign(actions,{'delete':{group:'edit',className:'bpmn-icon-trash',title:translate('删除'),action:{click:removeElement,dragstart:removeElement}}});}return actions;};function isEventType(eventBo,type,definition){var isType=eventBo.$instanceOf(type);var isDefinition=false;var definitions=eventBo.eventDefinitions||[];forEach(definitions,function(def){if(def.$type===definition){isDefinition=true;}});return isType&&isDefinition;}},{"../../util/DiUtil":195,"../../util/ModelUtil":197,"../modeling/util/LaneUtil":169,"../modeling/util/ModelingUtil":170,"diagram-js/lib/util/Mouse":381,"lodash/collection/forEach":417,"lodash/lang/isArray":537,"lodash/object/assign":547}],115:[function(require,module,exports){module.exports={__depends__:[require('diagram-js-direct-editing'),require('diagram-js/lib/features/context-pad'),require('diagram-js/lib/features/selection'),require('diagram-js/lib/features/connect'),require('diagram-js/lib/features/create'),require('../popup-menu')],__init__:['contextPadProvider'],contextPadProvider:['type',require('./ContextPadProvider')]};},{"../popup-menu":176,"./ContextPadProvider":114,"diagram-js-direct-editing":221,"diagram-js/lib/features/connect":258,"diagram-js/lib/features/context-pad":260,"diagram-js/lib/features/create":264,"diagram-js/lib/features/selection":340}],116:[function(require,module,exports){'use strict';var ModelUtil=require('../../util/ModelUtil'),getBusinessObject=ModelUtil.getBusinessObject,is=ModelUtil.is;var ModelCloneHelper=require('../../util/model/ModelCloneHelper');var ModelCloneUtils=require('../../util/model/ModelCloneUtils'),getProperties=ModelCloneUtils.getProperties;var IGNORED_PROPERTIES=ModelCloneUtils.IGNORED_PROPERTIES;var filter=require('lodash/collection/filter'),forEach=require('lodash/collection/forEach');function setProperties(descriptor,data,properties){forEach(properties,function(property){if(data[property]!==undefined){descriptor[property]=data[property];}});}function removeProperties(element,properties){forEach(properties,function(prop){if(element[prop]){delete element[prop];}});}function BpmnCopyPaste(bpmnFactory,eventBus,copyPaste,clipboard,canvas,bpmnRules){var helper=new ModelCloneHelper(eventBus);copyPaste.registerDescriptor(function(element,descriptor){var businessObject=getBusinessObject(element),newBusinessObject=bpmnFactory.create(businessObject.$type);var properties=getProperties(businessObject.$descriptor),colors={};properties=filter(properties,function(property){return IGNORED_PROPERTIES.indexOf(property.replace(/bpmn:/,''))===-1;});descriptor.businessObject=helper.clone(businessObject,newBusinessObject,properties);descriptor.type=element.type;setProperties(descriptor,businessObject.di,['isExpanded']);setProperties(colors,businessObject.di,['fill','stroke']);descriptor.colors=colors;if(element.type==='label'){return descriptor;}setProperties(descriptor,businessObject,['type','processRef','triggeredByEvent']);if(businessObject.default){descriptor.default=businessObject.default.id;}return descriptor;});eventBus.on('element.paste',function(context){var descriptor=context.descriptor,createdElements=context.createdElements,parent=descriptor.parent,rootElement=canvas.getRootElement(),businessObject,source,target,canConnect;if(descriptor.type==='label'){return;}if(is(parent,'bpmn:Process')){descriptor.parent=is(rootElement,'bpmn:Collaboration')?rootElement:parent;}if(descriptor.type==='bpmn:DataOutputAssociation'||descriptor.type==='bpmn:DataInputAssociation'||descriptor.type==='bpmn:MessageFlow'){descriptor.parent=rootElement;}if(is(parent,'bpmn:Lane')){descriptor.parent=parent.parent;}if(descriptor.waypoints){source=createdElements[descriptor.source];target=createdElements[descriptor.target];if(source&&target){source=source.element;target=target.element;}canConnect=bpmnRules.canConnect(source,target);if(canConnect){descriptor.type=canConnect.type;}}businessObject=descriptor.businessObject;delete businessObject.id;bpmnFactory._ensureId(businessObject);if(descriptor.type==='bpmn:Participant'&&descriptor.processRef){descriptor.processRef=businessObject.processRef=bpmnFactory.create('bpmn:Process');}setProperties(businessObject,descriptor,['isExpanded','triggeredByEvent']);removeProperties(descriptor,['triggeredByEvent']);});eventBus.on('commandStack.elements.paste.postExecuted',function(){clipboard.clear();});}BpmnCopyPaste.$inject=['bpmnFactory','eventBus','copyPaste','clipboard','canvas','bpmnRules'];module.exports=BpmnCopyPaste;},{"../../util/ModelUtil":197,"../../util/model/ModelCloneHelper":199,"../../util/model/ModelCloneUtils":200,"lodash/collection/filter":415,"lodash/collection/forEach":417}],117:[function(require,module,exports){module.exports={__depends__:[require('diagram-js/lib/features/copy-paste')],__init__:['bpmnCopyPaste'],bpmnCopyPaste:['type',require('./BpmnCopyPaste')]};},{"./BpmnCopyPaste":116,"diagram-js/lib/features/copy-paste":262}],118:[function(require,module,exports){'use strict';var filter=require('lodash/collection/filter');var isAny=require('../modeling/util/ModelingUtil').isAny;function BpmnDistributeElements(distributeElements){distributeElements.registerFilter(function(elements){return filter(elements,function(element){var cannotDistribute=isAny(element,['bpmn:Association','bpmn:BoundaryEvent','bpmn:DataInputAssociation','bpmn:DataOutputAssociation','bpmn:Lane','bpmn:MessageFlow','bpmn:Participant','bpmn:SequenceFlow','bpmn:TextAnnotation']);return!(element.labelTarget||cannotDistribute);});});}BpmnDistributeElements.$inject=['distributeElements'];module.exports=BpmnDistributeElements;},{"../modeling/util/ModelingUtil":170,"lodash/collection/filter":415}],119:[function(require,module,exports){module.exports={__depends__:[require('diagram-js/lib/features/distribute-elements')],__init__:['bpmnDistributeElements'],bpmnDistributeElements:['type',require('./BpmnDistributeElements')]};},{"./BpmnDistributeElements":118,"diagram-js/lib/features/distribute-elements":266}],120:[function(require,module,exports){'use strict';var inherits=require('inherits');var EditorActions=require('diagram-js/lib/features/editor-actions/EditorActions');var filter=require('lodash/collection/filter');var is=require('../../util/ModelUtil').is;var getBBox=require('diagram-js/lib/util/Elements').getBBox;function BpmnEditorActions(injector,canvas,elementRegistry,selection,spaceTool,lassoTool,handTool,globalConnect,distributeElements,alignElements,directEditing,searchPad,modeling){injector.invoke(EditorActions,this);this.register({selectElements:function(){var rootElement=canvas.getRootElement();var elements=elementRegistry.filter(function(element){return element!==rootElement;});selection.select(elements);return elements;},spaceTool:function(){spaceTool.toggle();},lassoTool:function(){lassoTool.toggle();},handTool:function(){handTool.toggle();},globalConnectTool:function(){globalConnect.toggle();},distributeElements:function(opts){var currentSelection=selection.get(),type=opts.type;if(currentSelection.length){distributeElements.trigger(currentSelection,type);}},alignElements:function(opts){var currentSelection=selection.get(),aligneableElements=[],type=opts.type;if(currentSelection.length){aligneableElements=filter(currentSelection,function(element){return!is(element,'bpmn:Lane');});alignElements.trigger(aligneableElements,type);}},setColor:function(opts){var currentSelection=selection.get();if(currentSelection.length){modeling.setColor(currentSelection,opts);}},directEditing:function(){var currentSelection=selection.get();if(currentSelection.length){directEditing.activate(currentSelection[0]);}},find:function(){searchPad.toggle();},moveToOrigin:function(){var rootElement=canvas.getRootElement(),boundingBox,elements;if(is(rootElement,'bpmn:Collaboration')){elements=elementRegistry.filter(function(element){return is(element.parent,'bpmn:Collaboration');});}else{elements=elementRegistry.filter(function(element){return element!==rootElement&&!is(element.parent,'bpmn:SubProcess');});}boundingBox=getBBox(elements);modeling.moveElements(elements,{x:-boundingBox.x,y:-boundingBox.y},rootElement);}});}inherits(BpmnEditorActions,EditorActions);BpmnEditorActions.$inject=['injector','canvas','elementRegistry','selection','spaceTool','lassoTool','handTool','globalConnect','distributeElements','alignElements','directEditing','searchPad','modeling'];module.exports=BpmnEditorActions;},{"../../util/ModelUtil":197,"diagram-js/lib/features/editor-actions/EditorActions":270,"diagram-js/lib/util/Elements":373,"inherits":398,"lodash/collection/filter":415}],121:[function(require,module,exports){module.exports={__depends__:[require('diagram-js/lib/features/align-elements'),require('diagram-js/lib/features/editor-actions'),require('diagram-js/lib/features/hand-tool'),require('diagram-js/lib/features/lasso-tool'),require('diagram-js/lib/features/space-tool'),require('../global-connect'),require('../copy-paste'),require('../distribute-elements'),require('../search'),require('../modeling')],editorActions:['type',require('./BpmnEditorActions')]};},{"../copy-paste":117,"../distribute-elements":119,"../global-connect":123,"../modeling":168,"../search":186,"./BpmnEditorActions":120,"diagram-js/lib/features/align-elements":240,"diagram-js/lib/features/editor-actions":271,"diagram-js/lib/features/hand-tool":275,"diagram-js/lib/features/lasso-tool":283,"diagram-js/lib/features/space-tool":347}],122:[function(require,module,exports){'use strict';var isAny=require('../modeling/util/ModelingUtil').isAny;function BpmnGlobalConnect(globalConnect){globalConnect.registerProvider(this);}BpmnGlobalConnect.$inject=['globalConnect'];module.exports=BpmnGlobalConnect;BpmnGlobalConnect.prototype.canStartConnect=function(source){if(nonExistantOrLabel(source)){return null;}var businessObject=source.businessObject;return isAny(businessObject,['bpmn:FlowNode','bpmn:InteractionNode','bpmn:DataObjectReference','bpmn:DataStoreReference']);};function nonExistantOrLabel(element){return!element||isLabel(element);}function isLabel(element){return element.labelTarget;}},{"../modeling/util/ModelingUtil":170}],123:[function(require,module,exports){module.exports={__depends__:[require('diagram-js/lib/features/global-connect')],__init__:['bpmnGlobalConnect'],bpmnGlobalConnect:['type',require('./BpmnGlobalConnect')]};},{"./BpmnGlobalConnect":122,"diagram-js/lib/features/global-connect":273}],124:[function(require,module,exports){'use strict';function BpmnKeyBindings(keyboard,editorActions){keyboard.addListener(function(key,modifiers){if(key===65&&keyboard.isCmd(modifiers)){editorActions.trigger('selectElements');return true;}if(key===70&&keyboard.isCmd(modifiers)){editorActions.trigger('find');return true;}if(keyboard.hasModifier(modifiers)){return;}if(key===83){editorActions.trigger('spaceTool');return true;}if(key===76){editorActions.trigger('lassoTool');return true;}if(key===72){editorActions.trigger('handTool');return true;}if(key===67){editorActions.trigger('globalConnectTool');return true;}if(key===69){editorActions.trigger('directEditing');return true;}});}BpmnKeyBindings.$inject=['keyboard','editorActions'];module.exports=BpmnKeyBindings;},{}],125:[function(require,module,exports){module.exports={__depends__:[require('diagram-js/lib/features/keyboard')],__init__:['bpmnKeyBindings'],bpmnKeyBindings:['type',require('./BpmnKeyBindings')]};},{"./BpmnKeyBindings":124,"diagram-js/lib/features/keyboard":279}],126:[function(require,module,exports){'use strict';var UpdateLabelHandler=require('./cmd/UpdateLabelHandler');var LabelUtil=require('./LabelUtil');var is=require('../../util/ModelUtil').is,isExpanded=require('../../util/DiUtil').isExpanded;var LINE_HEIGHT=14,PADDING=6;function LabelEditingProvider(eventBus,canvas,directEditing,commandStack){this._canvas=canvas;this._commandStack=commandStack;directEditing.registerProvider(this);commandStack.registerHandler('element.updateLabel',UpdateLabelHandler);eventBus.on('element.dblclick',function(event){directEditing.activate(event.element);});eventBus.on(['element.mousedown','drag.init','canvas.viewbox.changed'],function(event){directEditing.complete();});eventBus.on(['commandStack.changed'],function(){directEditing.cancel();});if('ontouchstart'in document.documentElement){}else{eventBus.on('create.end',500,function(e){var element=e.shape,canExecute=e.context.canExecute;if(!canExecute){return;}if(is(element,'bpmn:Task')||is(element,'bpmn:TextAnnotation')||(is(element,'bpmn:SubProcess')&&!isExpanded(element))){directEditing.activate(element);}});}}LabelEditingProvider.$inject=['eventBus','canvas','directEditing','commandStack'];module.exports=LabelEditingProvider;LabelEditingProvider.prototype.activate=function(element){var text=LabelUtil.getLabel(element);if(text===undefined){return;}var properties=this.getEditingBBox(element);properties.text=text;return properties;};LabelEditingProvider.prototype.getEditingBBox=function(element){var canvas=this._canvas;var target=element.label||element;var bbox=canvas.getAbsoluteBBox(target);var mid={x:bbox.x+bbox.width/2,y:bbox.y+bbox.height/2};var bounds={x:bbox.x,y:bbox.y};var style={},zoom;if((is(element,'bpmn:Participant')&&isExpanded(element))||is(element,'bpmn:Lane')){bounds.width=150;bounds.minHeight=LINE_HEIGHT+PADDING;bounds.maxHeight=LINE_HEIGHT*2+PADDING;bounds.x=bbox.x-bounds.width/2;bounds.y=mid.y-bounds.minHeight/2;}if(is(element,'bpmn:Task')||(is(element,'bpmn:CallActivity')&&!isExpanded(element))||(is(element,'bpmn:SubProcess')&&!isExpanded(element))||(is(element,'bpmn:Participant')&&!isExpanded(element))){zoom=canvas.zoom();if(zoom>1){bounds.width=bbox.width;bounds.height=bbox.height;}else{bounds.width=bbox.width/zoom;bounds.height=bbox.height/zoom;}if(zoom<1){bounds.x=bbox.x-(bounds.width/2-bbox.width/2);bounds.y=bbox.y-(bounds.height/2-bbox.height/2);}}if(is(element,'bpmn:SubProcess')&&isExpanded(element)){bounds.width=element.width;bounds.maxHeight=3*LINE_HEIGHT+PADDING;bounds.x=mid.x-element.width/2;}if(target.labelTarget){bounds.width=150;bounds.minHeight=LINE_HEIGHT+PADDING;bounds.x=mid.x-bounds.width/2;}if(is(element,'bpmn:TextAnnotation')){bounds.minWidth=100;bounds.height=element.height;style.textAlign='left';}return{bounds:bounds,style:style};};LabelEditingProvider.prototype.update=function(element,newLabel){this._commandStack.execute('element.updateLabel',{element:element,newLabel:newLabel});};},{"../../util/DiUtil":195,"../../util/ModelUtil":197,"./LabelUtil":127,"./cmd/UpdateLabelHandler":128}],127:[function(require,module,exports){'use strict';var is=require('../../util/ModelUtil').is;function getLabelAttr(semantic){if(is(semantic,'bpmn:FlowElement')||is(semantic,'bpmn:Participant')||is(semantic,'bpmn:Lane')||is(semantic,'bpmn:SequenceFlow')||is(semantic,'bpmn:MessageFlow')){return'name';}if(is(semantic,'bpmn:TextAnnotation')){return'text';}}module.exports.getLabel=function(element){var semantic=element.businessObject,attr=getLabelAttr(semantic);if(attr){return semantic[attr]||'';}};module.exports.setLabel=function(element,text,isExternal){var semantic=element.businessObject,attr=getLabelAttr(semantic);if(attr){semantic[attr]=text;}if(isExternal){element.hidden=!text;}return element;};},{"../../util/ModelUtil":197}],128:[function(require,module,exports){'use strict';var LabelUtil=require('../LabelUtil');var TextUtil=require('diagram-js/lib/util/Text');var hasExternalLabel=require('../../../util/LabelUtil').hasExternalLabel;var getBusinessObject=require('../../../util/ModelUtil').getBusinessObject;var NULL_DIMENSIONS={width:0,height:0};function UpdateLabelHandler(modeling){var textUtil=new TextUtil();function setText(element,text){var label=element.label||element;var labelTarget=element.labelTarget||element;LabelUtil.setLabel(label,text,labelTarget!==label);return[label,labelTarget];}function execute(ctx){ctx.oldLabel=LabelUtil.getLabel(ctx.element);return setText(ctx.element,ctx.newLabel);}function revert(ctx){return setText(ctx.element,ctx.oldLabel);}function postExecute(ctx){var element=ctx.element,label=element.label||element;if(!hasExternalLabel(element)){return;}var text=getBusinessObject(label).name;if(!text){return;}var newBounds=getLayoutedBounds(label,text,textUtil);modeling.resizeShape(label,newBounds,NULL_DIMENSIONS);}this.execute=execute;this.revert=revert;this.postExecute=postExecute;}UpdateLabelHandler.$inject=['modeling'];module.exports=UpdateLabelHandler;var EXTERNAL_LABEL_STYLE={fontFamily:'Arial, sans-serif',fontSize:'11px'};function getLayoutedBounds(bounds,text,textUtil){var layoutedLabelDimensions=textUtil.getDimensions(text,{box:{width:90,height:30,x:bounds.width/2+bounds.x,y:bounds.height/2+bounds.y},style:EXTERNAL_LABEL_STYLE});return{x:Math.round(bounds.x+bounds.width/2-layoutedLabelDimensions.width/2),y:Math.round(bounds.y),width:Math.ceil(layoutedLabelDimensions.width),height:Math.ceil(layoutedLabelDimensions.height)};}},{"../../../util/LabelUtil":196,"../../../util/ModelUtil":197,"../LabelUtil":127,"diagram-js/lib/util/Text":387}],129:[function(require,module,exports){module.exports={__depends__:[require('diagram-js/lib/command'),require('diagram-js/lib/features/change-support'),require('diagram-js-direct-editing')],__init__:['labelEditingProvider'],labelEditingProvider:['type',require('./LabelEditingProvider')]};},{"./LabelEditingProvider":126,"diagram-js-direct-editing":221,"diagram-js/lib/command":228,"diagram-js/lib/features/change-support":254}],130:[function(require,module,exports){'use strict';var map=require('lodash/collection/map'),assign=require('lodash/object/assign'),pick=require('lodash/object/pick');function BpmnFactory(moddle){this._model=moddle;}BpmnFactory.$inject=['moddle'];BpmnFactory.prototype._needsId=function(element){return element.$instanceOf('bpmn:RootElement')||element.$instanceOf('bpmn:FlowElement')||element.$instanceOf('bpmn:MessageFlow')||element.$instanceOf('bpmn:DataAssociation')||element.$instanceOf('bpmn:Artifact')||element.$instanceOf('bpmn:Participant')||element.$instanceOf('bpmn:Lane')||element.$instanceOf('bpmn:Process')||element.$instanceOf('bpmn:Collaboration')||element.$instanceOf('bpmndi:BPMNShape')||element.$instanceOf('bpmndi:BPMNEdge')||element.$instanceOf('bpmndi:BPMNDiagram')||element.$instanceOf('bpmndi:BPMNPlane')||element.$instanceOf('bpmn:Property');};BpmnFactory.prototype._ensureId=function(element){var prefix=(element.$type||'').replace(/^[^:]*:/g,'')+'_';if(!element.id&&this._needsId(element)){element.id=this._model.ids.nextPrefixed(prefix,element);}};BpmnFactory.prototype.create=function(type,attrs){var element=this._model.create(type,attrs||{});this._ensureId(element);return element;};BpmnFactory.prototype.createDiLabel=function(){return this.create('bpmndi:BPMNLabel',{bounds:this.createDiBounds()});};BpmnFactory.prototype.createDiShape=function(semantic,bounds,attrs){return this.create('bpmndi:BPMNShape',assign({bpmnElement:semantic,bounds:this.createDiBounds(bounds)},attrs));};BpmnFactory.prototype.createDiBounds=function(bounds){return this.create('dc:Bounds',bounds);};BpmnFactory.prototype.createDiWaypoints=function(waypoints){return map(waypoints,function(pos){return this.createDiWaypoint(pos);},this);};BpmnFactory.prototype.createDiWaypoint=function(point){return this.create('dc:Point',pick(point,['x','y']));};BpmnFactory.prototype.createDiEdge=function(semantic,waypoints,attrs){return this.create('bpmndi:BPMNEdge',assign({bpmnElement:semantic},attrs));};BpmnFactory.prototype.createDiPlane=function(semantic){return this.create('bpmndi:BPMNPlane',{bpmnElement:semantic});};module.exports=BpmnFactory;},{"lodash/collection/map":420,"lodash/object/assign":547,"lodash/object/pick":555}],131:[function(require,module,exports){'use strict';var inherits=require('inherits');var assign=require('lodash/object/assign');var BaseLayouter=require('diagram-js/lib/layout/BaseLayouter'),ManhattanLayout=require('diagram-js/lib/layout/ManhattanLayout');var LayoutUtil=require('diagram-js/lib/layout/LayoutUtil');var isExpanded=require('../../util/DiUtil').isExpanded;var getMid=LayoutUtil.getMid,getOrientation=LayoutUtil.getOrientation;var is=require('../../util/ModelUtil').is;function BpmnLayouter(){}inherits(BpmnLayouter,BaseLayouter);module.exports=BpmnLayouter;BpmnLayouter.prototype.layoutConnection=function(connection,hints){hints=hints||{};var source=connection.source,target=connection.target,waypoints=connection.waypoints,start=hints.connectionStart,end=hints.connectionEnd;var manhattanOptions,updatedWaypoints;if(!start){start=getConnectionDocking(waypoints&&waypoints[0],source);}if(!end){end=getConnectionDocking(waypoints&&waypoints[waypoints.length-1],target);}if(is(connection,'bpmn:Association')||is(connection,'bpmn:DataAssociation')){if(waypoints&&!isCompensationAssociation(connection)){return[].concat([start],waypoints.slice(1,-1),[end]);}}if(is(connection,'bpmn:MessageFlow')){manhattanOptions={preferredLayouts:['v:v']};if(is(target,'bpmn:Participant')){manhattanOptions={preferredLayouts:['straight','v:v']};}if(isExpandedSubProcess(target)){manhattanOptions={preferredLayouts:['straight','v:v']};}if(isExpandedSubProcess(source)&&is(target,'bpmn:FlowNode')){manhattanOptions={preferredLayouts:['straight','v:v'],preserveDocking:isExpandedSubProcess(target)?'source':'target'};}if(is(source,'bpmn:Participant')&&is(target,'bpmn:FlowNode')){manhattanOptions={preferredLayouts:['straight','v:v'],preserveDocking:'target'};}if(is(target,'bpmn:Event')){manhattanOptions={preferredLayouts:['v:v']};}}else
if(is(connection,'bpmn:SequenceFlow')||isCompensationAssociation(connection)){if(is(source,'bpmn:BoundaryEvent')){var orientation=getAttachOrientation(source);if(/left|right/.test(orientation)){manhattanOptions={preferredLayouts:['h:v']};}else
if(/top|bottom/.test(orientation)){manhattanOptions={preferredLayouts:['v:h']};}}else
if(is(source,'bpmn:Gateway')){manhattanOptions={preferredLayouts:['v:h']};}else
if(is(target,'bpmn:Gateway')){manhattanOptions={preferredLayouts:['h:v']};}else{manhattanOptions={preferredLayouts:['h:h']};}}if(manhattanOptions){manhattanOptions=assign(manhattanOptions,hints);updatedWaypoints=ManhattanLayout.repairConnection(source,target,start,end,waypoints,manhattanOptions);}return updatedWaypoints||[start,end];};function getAttachOrientation(attachedElement){var hostElement=attachedElement.host,padding=-10;return getOrientation(getMid(attachedElement),hostElement,padding);}function getConnectionDocking(point,shape){return point?(point.original||point):getMid(shape);}function isCompensationAssociation(connection){var source=connection.source,target=connection.target;return is(target,'bpmn:Activity')&&is(source,'bpmn:BoundaryEvent')&&target.businessObject.isForCompensation;}function isExpandedSubProcess(element){return is(element,'bpmn:SubProcess')&&isExpanded(element);}},{"../../util/DiUtil":195,"../../util/ModelUtil":197,"diagram-js/lib/layout/BaseLayouter":357,"diagram-js/lib/layout/LayoutUtil":359,"diagram-js/lib/layout/ManhattanLayout":360,"inherits":398,"lodash/object/assign":547}],132:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign'),forEach=require('lodash/collection/forEach'),inherits=require('inherits');var Collections=require('diagram-js/lib/util/Collections'),Model=require('diagram-js/lib/model');var getBusinessObject=require('../../util/ModelUtil').getBusinessObject,is=require('../../util/ModelUtil').is;var CommandInterceptor=require('diagram-js/lib/command/CommandInterceptor');function BpmnUpdater(eventBus,bpmnFactory,connectionDocking,translate){CommandInterceptor.call(this,eventBus);this._bpmnFactory=bpmnFactory;this._translate=translate;var self=this;function cropConnection(e){var context=e.context,connection;if(!context.cropped){connection=context.connection;connection.waypoints=connectionDocking.getCroppedWaypoints(connection);context.cropped=true;}}this.executed(['connection.layout','connection.create','connection.reconnectEnd','connection.reconnectStart'],cropConnection);this.reverted(['connection.layout'],function(e){delete e.context.cropped;});function updateParent(e){var context=e.context;self.updateParent(context.shape||context.connection,context.oldParent);}function reverseUpdateParent(e){var context=e.context;var element=context.shape||context.connection,oldParent=context.parent||context.newParent;self.updateParent(element,oldParent);}this.executed(['shape.move','shape.create','shape.delete','connection.create','connection.move','connection.delete'],ifBpmn(updateParent));this.reverted(['shape.move','shape.create','shape.delete','connection.create','connection.move','connection.delete'],ifBpmn(reverseUpdateParent));function updateRoot(event){var context=event.context,oldRoot=context.oldRoot,children=oldRoot.children;forEach(children,function(child){if(is(child,'bpmn:BaseElement')){self.updateParent(child);}});}this.executed(['canvas.updateRoot'],updateRoot);this.reverted(['canvas.updateRoot'],updateRoot);function updateBounds(e){var shape=e.context.shape;if(!is(shape,'bpmn:BaseElement')){return;}self.updateBounds(shape);}this.executed(['shape.move','shape.create','shape.resize'],ifBpmn(function(event){if(event.context.shape.type==='label'){return;}updateBounds(event);}));this.reverted(['shape.move','shape.create','shape.resize'],ifBpmn(function(event){if(event.context.shape.type==='label'){return;}updateBounds(event);}));eventBus.on('shape.changed',function(event){if(event.element.type==='label'){updateBounds({context:{shape:event.element}});}});function updateConnection(e){self.updateConnection(e.context);}this.executed(['connection.create','connection.move','connection.delete','connection.reconnectEnd','connection.reconnectStart'],ifBpmn(updateConnection));this.reverted(['connection.create','connection.move','connection.delete','connection.reconnectEnd','connection.reconnectStart'],ifBpmn(updateConnection));function updateConnectionWaypoints(e){self.updateConnectionWaypoints(e.context.connection);}this.executed(['connection.layout','connection.move','connection.updateWaypoints','connection.reconnectEnd','connection.reconnectStart'],ifBpmn(updateConnectionWaypoints));this.reverted(['connection.layout','connection.move','connection.updateWaypoints','connection.reconnectEnd','connection.reconnectStart'],ifBpmn(updateConnectionWaypoints));this.executed(['connection.reconnectEnd','connection.reconnectStart'],ifBpmn(function(e){var context=e.context,connection=context.connection,businessObject=getBusinessObject(connection),oldSource=getBusinessObject(context.oldSource),oldTarget=getBusinessObject(context.oldTarget),newSource=getBusinessObject(connection.source),newTarget=getBusinessObject(connection.target);if(oldSource===newSource||oldTarget===newTarget){return;}if(oldSource&&oldSource.default===businessObject){context.default=oldSource.default;oldSource.default=undefined;}if((businessObject.sourceRef&&businessObject.sourceRef.default)&&!(is(newTarget,'bpmn:Activity')||is(newTarget,'bpmn:EndEvent')||is(newTarget,'bpmn:Gateway')||is(newTarget,'bpmn:IntermediateThrowEvent'))){context.default=businessObject.sourceRef.default;businessObject.sourceRef.default=undefined;}if(oldSource&&(businessObject.conditionExpression)&&!(is(newSource,'bpmn:Activity')||is(newSource,'bpmn:Gateway'))){context.conditionExpression=businessObject.conditionExpression;businessObject.conditionExpression=undefined;}if(oldTarget&&(businessObject.conditionExpression)&&!(is(newTarget,'bpmn:Activity')||is(newTarget,'bpmn:EndEvent')||is(newTarget,'bpmn:Gateway')||is(newTarget,'bpmn:IntermediateThrowEvent'))){context.conditionExpression=businessObject.conditionExpression;businessObject.conditionExpression=undefined;}}));this.reverted(['connection.reconnectEnd','connection.reconnectStart'],ifBpmn(function(e){var context=e.context,connection=context.connection,businessObject=getBusinessObject(connection),newSource=getBusinessObject(connection.source);if(context.default){if(is(newSource,'bpmn:ExclusiveGateway')||is(newSource,'bpmn:InclusiveGateway')||is(newSource,'bpmn:Activity')){newSource.default=context.default;}}if(context.conditionExpression&&is(newSource,'bpmn:Activity')){businessObject.conditionExpression=context.conditionExpression;}}));function updateAttachment(e){self.updateAttachment(e.context);}this.executed(['element.updateAttachment'],ifBpmn(updateAttachment));this.reverted(['element.updateAttachment'],ifBpmn(updateAttachment));}inherits(BpmnUpdater,CommandInterceptor);module.exports=BpmnUpdater;BpmnUpdater.$inject=['eventBus','bpmnFactory','connectionDocking','translate'];BpmnUpdater.prototype.updateAttachment=function(context){var shape=context.shape,businessObject=shape.businessObject,host=shape.host;businessObject.attachedToRef=host&&host.businessObject;};BpmnUpdater.prototype.updateParent=function(element,oldParent){if(element instanceof Model.Label){return;}var parentShape=element.parent;var businessObject=element.businessObject,parentBusinessObject=parentShape&&parentShape.businessObject,parentDi=parentBusinessObject&&parentBusinessObject.di;if(is(element,'bpmn:FlowNode')){this.updateFlowNodeRefs(businessObject,parentBusinessObject,oldParent&&oldParent.businessObject);}if(is(element,'bpmn:DataOutputAssociation')){if(element.source){parentBusinessObject=element.source.businessObject;}else{parentBusinessObject=null;}}if(is(element,'bpmn:DataInputAssociation')){if(element.target){parentBusinessObject=element.target.businessObject;}else{parentBusinessObject=null;}}this.updateSemanticParent(businessObject,parentBusinessObject);if(is(element,'bpmn:DataObjectReference')&&businessObject.dataObjectRef){this.updateSemanticParent(businessObject.dataObjectRef,parentBusinessObject);}this.updateDiParent(businessObject.di,parentDi);};BpmnUpdater.prototype.updateBounds=function(shape){var di=shape.businessObject.di;var bounds=(shape instanceof Model.Label)?this._getLabel(di).bounds:di.bounds;assign(bounds,{x:shape.x,y:shape.y,width:shape.width,height:shape.height});};BpmnUpdater.prototype.updateFlowNodeRefs=function(businessObject,newContainment,oldContainment){if(oldContainment===newContainment){return;}var oldRefs,newRefs;if(is(oldContainment,'bpmn:Lane')){oldRefs=oldContainment.get('flowNodeRef');Collections.remove(oldRefs,businessObject);}if(is(newContainment,'bpmn:Lane')){newRefs=newContainment.get('flowNodeRef');Collections.add(newRefs,businessObject);}};BpmnUpdater.prototype.updateDiConnection=function(di,newSource,newTarget){if(di.sourceElement&&di.sourceElement.bpmnElement!==newSource){di.sourceElement=newSource&&newSource.di;}if(di.targetElement&&di.targetElement.bpmnElement!==newTarget){di.targetElement=newTarget&&newTarget.di;}};BpmnUpdater.prototype.updateDiParent=function(di,parentDi){if(parentDi&&!is(parentDi,'bpmndi:BPMNPlane')){parentDi=parentDi.$parent;}if(di.$parent===parentDi){return;}var planeElements=(parentDi||di.$parent).get('planeElement');if(parentDi){planeElements.push(di);di.$parent=parentDi;}else{Collections.remove(planeElements,di);di.$parent=null;}};function getDefinitions(element){while(element&&!is(element,'bpmn:Definitions')){element=element.$parent;}return element;}BpmnUpdater.prototype.getLaneSet=function(container){var laneSet,laneSets;if(is(container,'bpmn:Lane')){laneSet=container.childLaneSet;if(!laneSet){laneSet=this._bpmnFactory.create('bpmn:LaneSet');container.childLaneSet=laneSet;laneSet.$parent=container;}return laneSet;}if(is(container,'bpmn:Participant')){container=container.processRef;}laneSets=container.get('laneSets');laneSet=laneSets[0];if(!laneSet){laneSet=this._bpmnFactory.create('bpmn:LaneSet');laneSet.$parent=container;laneSets.push(laneSet);}return laneSet;};BpmnUpdater.prototype.updateSemanticParent=function(businessObject,newParent,visualParent){var containment,translate=this._translate;if(businessObject.$parent===newParent){return;}if(is(businessObject,'bpmn:Lane')){if(newParent){newParent=this.getLaneSet(newParent);}containment='lanes';}else
if(is(businessObject,'bpmn:FlowElement')){if(newParent){if(is(newParent,'bpmn:Participant')){newParent=newParent.processRef;}else
if(is(newParent,'bpmn:Lane')){do{newParent=newParent.$parent.$parent;}while(is(newParent,'bpmn:Lane'));}}containment='flowElements';}else
if(is(businessObject,'bpmn:Artifact')){while(newParent&&!is(newParent,'bpmn:Process')&&!is(newParent,'bpmn:SubProcess')&&!is(newParent,'bpmn:Collaboration')){if(is(newParent,'bpmn:Participant')){newParent=newParent.processRef;break;}else{newParent=newParent.$parent;}}containment='artifacts';}else
if(is(businessObject,'bpmn:MessageFlow')){containment='messageFlows';}else
if(is(businessObject,'bpmn:Participant')){containment='participants';var process=businessObject.processRef,definitions;if(process){definitions=getDefinitions(businessObject.$parent||newParent);if(businessObject.$parent){Collections.remove(definitions.get('rootElements'),process);process.$parent=null;}if(newParent){Collections.add(definitions.get('rootElements'),process);process.$parent=definitions;}}}else
if(is(businessObject,'bpmn:DataOutputAssociation')){containment='dataOutputAssociations';}else
if(is(businessObject,'bpmn:DataInputAssociation')){containment='dataInputAssociations';}if(!containment){throw new Error(translate('no parent for {element} in {parent}',{element:businessObject.id,parent:newParent.id}));}var children;if(businessObject.$parent){children=businessObject.$parent.get(containment);Collections.remove(children,businessObject);}if(!newParent){businessObject.$parent=null;}else{children=newParent.get(containment);children.push(businessObject);businessObject.$parent=newParent;}if(visualParent){var diChildren=visualParent.get(containment);Collections.remove(children,businessObject);if(newParent){if(!diChildren){diChildren=[];newParent.set(containment,diChildren);}diChildren.push(businessObject);}}};BpmnUpdater.prototype.updateConnectionWaypoints=function(connection){connection.businessObject.di.set('waypoint',this._bpmnFactory.createDiWaypoints(connection.waypoints));};BpmnUpdater.prototype.updateConnection=function(context){var connection=context.connection,businessObject=getBusinessObject(connection),newSource=getBusinessObject(connection.source),newTarget=getBusinessObject(connection.target),visualParent;if(!is(businessObject,'bpmn:DataAssociation')){var inverseSet=is(businessObject,'bpmn:SequenceFlow');if(businessObject.sourceRef!==newSource){if(inverseSet){Collections.remove(businessObject.sourceRef&&businessObject.sourceRef.get('outgoing'),businessObject);if(newSource&&newSource.get('outgoing')){newSource.get('outgoing').push(businessObject);}}businessObject.sourceRef=newSource;}if(businessObject.targetRef!==newTarget){if(inverseSet){Collections.remove(businessObject.targetRef&&businessObject.targetRef.get('incoming'),businessObject);if(newTarget&&newTarget.get('incoming')){newTarget.get('incoming').push(businessObject);}}businessObject.targetRef=newTarget;}}else
if(is(businessObject,'bpmn:DataInputAssociation')){businessObject.get('sourceRef')[0]=newSource;visualParent=context.parent||context.newParent||newTarget;this.updateSemanticParent(businessObject,newTarget,parent.businessObject);}else
if(is(businessObject,'bpmn:DataOutputAssociation')){visualParent=context.parent||context.newParent||newSource;this.updateSemanticParent(businessObject,newSource,visualParent);businessObject.targetRef=newTarget;}this.updateConnectionWaypoints(connection);this.updateDiConnection(businessObject.di,newSource,newTarget);};BpmnUpdater.prototype._getLabel=function(di){if(!di.label){di.label=this._bpmnFactory.createDiLabel();}return di.label;};function ifBpmn(fn){return function(event){var context=event.context,element=context.shape||context.connection;if(is(element,'bpmn:BaseElement')){fn(event);}};}},{"../../util/ModelUtil":197,"diagram-js/lib/command/CommandInterceptor":226,"diagram-js/lib/model":361,"diagram-js/lib/util/Collections":370,"inherits":398,"lodash/collection/forEach":417,"lodash/object/assign":547}],133:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign'),forEach=require('lodash/collection/forEach'),inherits=require('inherits');var is=require('../../util/ModelUtil').is;var isExpanded=require('../../util/DiUtil').isExpanded;var BaseElementFactory=require('diagram-js/lib/core/ElementFactory'),LabelUtil=require('../../util/LabelUtil');function ElementFactory(bpmnFactory,moddle,translate){BaseElementFactory.call(this);this._bpmnFactory=bpmnFactory;this._moddle=moddle;this._translate=translate;}inherits(ElementFactory,BaseElementFactory);ElementFactory.$inject=['bpmnFactory','moddle','translate'];module.exports=ElementFactory;ElementFactory.prototype.baseCreate=BaseElementFactory.prototype.create;ElementFactory.prototype.create=function(elementType,attrs){if(elementType==='label'){return this.baseCreate(elementType,assign({type:'label'},LabelUtil.DEFAULT_LABEL_SIZE,attrs));}return this.createBpmnElement(elementType,attrs);};ElementFactory.prototype.createBpmnElement=function(elementType,attrs){var size,translate=this._translate;attrs=attrs||{};var businessObject=attrs.businessObject;if(!businessObject){if(!attrs.type){throw new Error(translate('no shape type specified'));}businessObject=this._bpmnFactory.create(attrs.type);}if(!businessObject.di){if(elementType==='root'){businessObject.di=this._bpmnFactory.createDiPlane(businessObject,[],{id:businessObject.id+'_di'});}else
if(elementType==='connection'){businessObject.di=this._bpmnFactory.createDiEdge(businessObject,[],{id:businessObject.id+'_di'});}else{businessObject.di=this._bpmnFactory.createDiShape(businessObject,{},{id:businessObject.id+'_di'});}}if(attrs.colors){assign(businessObject.di,attrs.colors);delete attrs.colors;}applyAttributes(businessObject,attrs,['processRef','isInterrupting','associationDirection','isForCompensation']);if(attrs.isExpanded){applyAttribute(businessObject.di,attrs,'isExpanded');}if(is(businessObject,'bpmn:ExclusiveGateway')){businessObject.di.isMarkerVisible=true;}var eventDefinitions,newEventDefinition;if(attrs.eventDefinitionType){eventDefinitions=businessObject.get('eventDefinitions')||[];newEventDefinition=this._moddle.create(attrs.eventDefinitionType);eventDefinitions.push(newEventDefinition);newEventDefinition.$parent=businessObject;businessObject.eventDefinitions=eventDefinitions;delete attrs.eventDefinitionType;}size=this._getDefaultSize(businessObject);attrs=assign({businessObject:businessObject,id:businessObject.id},size,attrs);return this.baseCreate(elementType,attrs);};ElementFactory.prototype._getDefaultSize=function(semantic){if(is(semantic,'bpmn:SubProcess')){if(isExpanded(semantic)){return{width:350,height:200};}else{return{width:100,height:80};}}if(is(semantic,'bpmn:Task')){return{width:100,height:80};}if(is(semantic,'bpmn:Gateway')){return{width:50,height:50};}if(is(semantic,'bpmn:Event')){return{width:36,height:36};}if(is(semantic,'bpmn:Participant')){if(!isExpanded(semantic)){return{width:400,height:100};}else{return{width:600,height:250};}}if(is(semantic,'bpmn:Lane')){return{width:400,height:100};}if(is(semantic,'bpmn:DataObjectReference')){return{width:36,height:50};}if(is(semantic,'bpmn:DataStoreReference')){return{width:50,height:50};}if(is(semantic,'bpmn:TextAnnotation')){return{width:100,height:30};}return{width:100,height:80};};ElementFactory.prototype.createParticipantShape=function(collapsed){var attrs={type:'bpmn:Participant'};if(!collapsed){attrs.processRef=this._bpmnFactory.create('bpmn:Process');}return this.createShape(attrs);};function applyAttributes(element,attrs,attributeNames){forEach(attributeNames,function(property){if(attrs[property]!==undefined){applyAttribute(element,attrs,property);}});}function applyAttribute(element,attrs,attributeName){element[attributeName]=attrs[attributeName];delete attrs[attributeName];}},{"../../util/DiUtil":195,"../../util/LabelUtil":196,"../../util/ModelUtil":197,"diagram-js/lib/core/ElementFactory":230,"inherits":398,"lodash/collection/forEach":417,"lodash/object/assign":547}],134:[function(require,module,exports){'use strict';var inherits=require('inherits');var BaseModeling=require('diagram-js/lib/features/modeling/Modeling');var UpdatePropertiesHandler=require('./cmd/UpdatePropertiesHandler'),UpdateCanvasRootHandler=require('./cmd/UpdateCanvasRootHandler'),AddLaneHandler=require('./cmd/AddLaneHandler'),SplitLaneHandler=require('./cmd/SplitLaneHandler'),ResizeLaneHandler=require('./cmd/ResizeLaneHandler'),UpdateFlowNodeRefsHandler=require('./cmd/UpdateFlowNodeRefsHandler'),IdClaimHandler=require('./cmd/IdClaimHandler'),SetColorHandler=require('./cmd/SetColorHandler');function Modeling(eventBus,elementFactory,commandStack,bpmnRules){BaseModeling.call(this,eventBus,elementFactory,commandStack);this._bpmnRules=bpmnRules;}inherits(Modeling,BaseModeling);Modeling.$inject=['eventBus','elementFactory','commandStack','bpmnRules'];module.exports=Modeling;Modeling.prototype.getHandlers=function(){var handlers=BaseModeling.prototype.getHandlers.call(this);handlers['element.updateProperties']=UpdatePropertiesHandler;handlers['canvas.updateRoot']=UpdateCanvasRootHandler;handlers['lane.add']=AddLaneHandler;handlers['lane.resize']=ResizeLaneHandler;handlers['lane.split']=SplitLaneHandler;handlers['lane.updateRefs']=UpdateFlowNodeRefsHandler;handlers['id.updateClaim']=IdClaimHandler;handlers['element.setColor']=SetColorHandler;return handlers;};Modeling.prototype.updateLabel=function(element,newLabel){this._commandStack.execute('element.updateLabel',{element:element,newLabel:newLabel});};Modeling.prototype.connect=function(source,target,attrs,hints){var bpmnRules=this._bpmnRules;if(!attrs){attrs=bpmnRules.canConnect(source,target);}if(!attrs){return;}return this.createConnection(source,target,attrs,source.parent,hints);};Modeling.prototype.updateProperties=function(element,properties){this._commandStack.execute('element.updateProperties',{element:element,properties:properties});};Modeling.prototype.resizeLane=function(laneShape,newBounds,balanced){this._commandStack.execute('lane.resize',{shape:laneShape,newBounds:newBounds,balanced:balanced});};Modeling.prototype.addLane=function(targetLaneShape,location){var context={shape:targetLaneShape,location:location};this._commandStack.execute('lane.add',context);return context.newLane;};Modeling.prototype.splitLane=function(targetLane,count){this._commandStack.execute('lane.split',{shape:targetLane,count:count});};Modeling.prototype.makeCollaboration=function(){var collaborationElement=this._create('root',{type:'bpmn:Collaboration'});var context={newRoot:collaborationElement};this._commandStack.execute('canvas.updateRoot',context);return collaborationElement;};Modeling.prototype.updateLaneRefs=function(flowNodeShapes,laneShapes){this._commandStack.execute('lane.updateRefs',{flowNodeShapes:flowNodeShapes,laneShapes:laneShapes});};Modeling.prototype.makeProcess=function(){var processElement=this._create('root',{type:'bpmn:Process'});var context={newRoot:processElement};this._commandStack.execute('canvas.updateRoot',context);};Modeling.prototype.claimId=function(id,moddleElement){this._commandStack.execute('id.updateClaim',{id:id,element:moddleElement,claiming:true});};Modeling.prototype.unclaimId=function(id,moddleElement){this._commandStack.execute('id.updateClaim',{id:id,element:moddleElement});};Modeling.prototype.setColor=function(elements,colors){if(!elements.length){elements=[elements];}this._commandStack.execute('element.setColor',{elements:elements,colors:colors});};},{"./cmd/AddLaneHandler":160,"./cmd/IdClaimHandler":161,"./cmd/ResizeLaneHandler":162,"./cmd/SetColorHandler":163,"./cmd/SplitLaneHandler":164,"./cmd/UpdateCanvasRootHandler":165,"./cmd/UpdateFlowNodeRefsHandler":166,"./cmd/UpdatePropertiesHandler":167,"diagram-js/lib/features/modeling/Modeling":284,"inherits":398}],135:[function(require,module,exports){'use strict';var inherits=require('inherits');var is=require('../../../util/ModelUtil').is;var CommandInterceptor=require('diagram-js/lib/command/CommandInterceptor');function AppendBehavior(eventBus,elementFactory,bpmnRules){CommandInterceptor.call(this,eventBus);this.preExecute('shape.append',function(context){var source=context.source,shape=context.shape;if(!context.position){if(is(shape,'bpmn:TextAnnotation')){context.position={x:source.x+source.width/2+75,y:source.y-(50)-shape.height/2};}else{context.position={x:source.x+source.width+80+shape.width/2,y:source.y+source.height/2};}}},true);}AppendBehavior.$inject=['eventBus','elementFactory','bpmnRules'];inherits(AppendBehavior,CommandInterceptor);module.exports=AppendBehavior;},{"../../../util/ModelUtil":197,"diagram-js/lib/command/CommandInterceptor":226,"inherits":398}],136:[function(require,module,exports){'use strict';var inherits=require('inherits');var forEach=require('lodash/collection/forEach');var is=require('../../../util/ModelUtil').is;var CommandInterceptor=require('diagram-js/lib/command/CommandInterceptor');function CopyPasteBehavior(eventBus,modeling,canvas){CommandInterceptor.call(this,eventBus);this.preExecute('elements.paste',1500,function(context){var topParent=context.topParent;if(!topParent.parent){context.topParent=canvas.getRootElement();}if(is(topParent,'bpmn:Lane')){do{topParent=context.topParent=topParent.parent;}while(is(topParent,'bpmn:Lane')||!is(topParent,'bpmn:Participant'));}},true);this.postExecute('elements.paste',function(context){var tree=context.tree,createdElements=tree.createdElements;forEach(createdElements,function(data){var element=data.element,businessObject=element.businessObject,descriptor=data.descriptor,defaultFlow;if((is(businessObject,'bpmn:ExclusiveGateway')||is(businessObject,'bpmn:InclusiveGateway')||is(businessObject,'bpmn:Activity'))&&descriptor.default){defaultFlow=createdElements[descriptor.default];if(defaultFlow){defaultFlow=defaultFlow.element;}else{defaultFlow=undefined;}delete element.default;modeling.updateProperties(element,{default:defaultFlow});}});},true);}CopyPasteBehavior.$inject=['eventBus','modeling','canvas'];inherits(CopyPasteBehavior,CommandInterceptor);module.exports=CopyPasteBehavior;},{"../../../util/ModelUtil":197,"diagram-js/lib/command/CommandInterceptor":226,"inherits":398,"lodash/collection/forEach":417}],137:[function(require,module,exports){'use strict';var inherits=require('inherits');var CommandInterceptor=require('diagram-js/lib/command/CommandInterceptor');var is=require('../../../util/ModelUtil').is;function CreateBoundaryEventBehavior(eventBus,modeling,elementFactory,bpmnFactory){CommandInterceptor.call(this,eventBus);this.preExecute('shape.create',function(context){var shape=context.shape,host=context.host,businessObject,boundaryEvent;var attrs={cancelActivity:true};if(host&&is(shape,'bpmn:IntermediateThrowEvent')){attrs.attachedToRef=host.businessObject;businessObject=bpmnFactory.create('bpmn:BoundaryEvent',attrs);boundaryEvent={type:'bpmn:BoundaryEvent',businessObject:businessObject};context.shape=elementFactory.createShape(boundaryEvent);}},true);}CreateBoundaryEventBehavior.$inject=['eventBus','modeling','elementFactory','bpmnFactory'];inherits(CreateBoundaryEventBehavior,CommandInterceptor);module.exports=CreateBoundaryEventBehavior;},{"../../../util/ModelUtil":197,"diagram-js/lib/command/CommandInterceptor":226,"inherits":398}],138:[function(require,module,exports){'use strict';var inherits=require('inherits');var CommandInterceptor=require('diagram-js/lib/command/CommandInterceptor');var is=require('../../../util/ModelUtil').is;function CreateDataObjectBehavior(eventBus,bpmnFactory,moddle){CommandInterceptor.call(this,eventBus);this.preExecute('shape.create',function(event){var context=event.context,shape=context.shape;if(is(shape,'bpmn:DataObjectReference')&&shape.type!=='label'){var dataObject=bpmnFactory.create('bpmn:DataObject');shape.businessObject.dataObjectRef=dataObject;}});}CreateDataObjectBehavior.$inject=['eventBus','bpmnFactory','moddle'];inherits(CreateDataObjectBehavior,CommandInterceptor);module.exports=CreateDataObjectBehavior;},{"../../../util/ModelUtil":197,"diagram-js/lib/command/CommandInterceptor":226,"inherits":398}],139:[function(require,module,exports){'use strict';var inherits=require('inherits');var CommandInterceptor=require('diagram-js/lib/command/CommandInterceptor');var is=require('../../../util/ModelUtil').is;function CreateParticipantBehavior(eventBus,modeling,elementFactory,bpmnFactory,canvas){CommandInterceptor.call(this,eventBus);this.preExecute('shape.create',function(context){var parent=context.parent,shape=context.shape,position=context.position;var rootElement=canvas.getRootElement();if(is(parent,'bpmn:Process')&&is(shape,'bpmn:Participant')&&!is(rootElement,'bpmn:Collaboration')){var collaborationElement=modeling.makeCollaboration();context.position=position;context.parent=collaborationElement;context.processRoot=parent;}},true);this.execute('shape.create',function(context){var processRoot=context.processRoot,shape=context.shape;if(processRoot){context.oldProcessRef=shape.businessObject.processRef;shape.businessObject.processRef=processRoot.businessObject;}},true);this.revert('shape.create',function(context){var processRoot=context.processRoot,shape=context.shape;if(processRoot){shape.businessObject.processRef=context.oldProcessRef;}},true);this.postExecute('shape.create',function(context){var processRoot=context.processRoot,shape=context.shape;if(processRoot){var processChildren=processRoot.children.slice();modeling.moveElements(processChildren,{x:0,y:0},shape);}},true);}CreateParticipantBehavior.$inject=['eventBus','modeling','elementFactory','bpmnFactory','canvas'];inherits(CreateParticipantBehavior,CommandInterceptor);module.exports=CreateParticipantBehavior;},{"../../../util/ModelUtil":197,"diagram-js/lib/command/CommandInterceptor":226,"inherits":398}],140:[function(require,module,exports){'use strict';var inherits=require('inherits');var CommandInterceptor=require('diagram-js/lib/command/CommandInterceptor');var Collections=require('diagram-js/lib/util/Collections');var find=require('lodash/collection/find');var is=require('../../../util/ModelUtil').is;var TARGET_REF_PLACEHOLDER_NAME='__targetRef_placeholder';function DataInputAssociationBehavior(eventBus,bpmnFactory){CommandInterceptor.call(this,eventBus);this.executed(['connection.create','connection.delete','connection.move','connection.reconnectEnd'],ifDataInputAssociation(fixTargetRef));this.reverted(['connection.create','connection.delete','connection.move','connection.reconnectEnd'],ifDataInputAssociation(fixTargetRef));function usesTargetRef(element,targetRef,removedConnection){var inputAssociations=element.get('dataInputAssociations');return find(inputAssociations,function(association){return association!==removedConnection&&association.targetRef===targetRef;});}function getTargetRef(element,create){var properties=element.get('properties');var targetRefProp=find(properties,function(p){return p.name===TARGET_REF_PLACEHOLDER_NAME;});if(!targetRefProp&&create){targetRefProp=bpmnFactory.create('bpmn:Property',{name:TARGET_REF_PLACEHOLDER_NAME});Collections.add(properties,targetRefProp);}return targetRefProp;}function cleanupTargetRef(element,connection){var targetRefProp=getTargetRef(element);if(!targetRefProp){return;}if(!usesTargetRef(element,targetRefProp,connection)){Collections.remove(element.get('properties'),targetRefProp);}}function fixTargetRef(event){var context=event.context,connection=context.connection,connectionBo=connection.businessObject,target=connection.target,targetBo=target&&target.businessObject,newTarget=context.newTarget,newTargetBo=newTarget&&newTarget.businessObject,oldTarget=context.oldTarget||context.target,oldTargetBo=oldTarget&&oldTarget.businessObject;var dataAssociation=connection.businessObject,targetRefProp;if(oldTargetBo&&oldTargetBo!==targetBo){cleanupTargetRef(oldTargetBo,connectionBo);}if(newTargetBo&&newTargetBo!==targetBo){cleanupTargetRef(newTargetBo,connectionBo);}if(targetBo){targetRefProp=getTargetRef(targetBo,true);dataAssociation.targetRef=targetRefProp;}else{dataAssociation.targetRef=null;}}}DataInputAssociationBehavior.$inject=['eventBus','bpmnFactory'];inherits(DataInputAssociationBehavior,CommandInterceptor);module.exports=DataInputAssociationBehavior;function ifDataInputAssociation(fn){return function(event){var context=event.context,connection=context.connection;if(is(connection,'bpmn:DataInputAssociation')){return fn(event);}};}},{"../../../util/ModelUtil":197,"diagram-js/lib/command/CommandInterceptor":226,"diagram-js/lib/util/Collections":370,"inherits":398,"lodash/collection/find":416}],141:[function(require,module,exports){'use strict';var inherits=require('inherits');var CommandInterceptor=require('diagram-js/lib/command/CommandInterceptor');var is=require('../../../util/ModelUtil').is;var getChildLanes=require('../util/LaneUtil').getChildLanes;var eachElement=require('diagram-js/lib/util/Elements').eachElement;var LOW_PRIORITY=500;function DeleteLaneBehavior(eventBus,modeling,spaceTool){CommandInterceptor.call(this,eventBus);function compensateLaneDelete(shape,oldParent){var siblings=getChildLanes(oldParent);var topAffected=[];var bottomAffected=[];eachElement(siblings,function(element){if(element.y>shape.y){bottomAffected.push(element);}else{topAffected.push(element);}return element.children;});if(!siblings.length){return;}var offset;if(bottomAffected.length&&topAffected.length){offset=shape.height/2;}else{offset=shape.height;}var topAdjustments,bottomAdjustments;if(topAffected.length){topAdjustments=spaceTool.calculateAdjustments(topAffected,'y',offset,shape.y-10);spaceTool.makeSpace(topAdjustments.movingShapes,topAdjustments.resizingShapes,{x:0,y:offset},'s');}if(bottomAffected.length){bottomAdjustments=spaceTool.calculateAdjustments(bottomAffected,'y',-offset,shape.y+shape.height+10);spaceTool.makeSpace(bottomAdjustments.movingShapes,bottomAdjustments.resizingShapes,{x:0,y:-offset},'n');}}this.postExecuted('shape.delete',LOW_PRIORITY,function(event){var context=event.context,hints=context.hints,shape=context.shape,oldParent=context.oldParent;if(!is(shape,'bpmn:Lane')){return;}if(hints&&hints.nested){return;}compensateLaneDelete(shape,oldParent);});}DeleteLaneBehavior.$inject=['eventBus','modeling','spaceTool'];inherits(DeleteLaneBehavior,CommandInterceptor);module.exports=DeleteLaneBehavior;},{"../../../util/ModelUtil":197,"../util/LaneUtil":169,"diagram-js/lib/command/CommandInterceptor":226,"diagram-js/lib/util/Elements":373,"inherits":398}],142:[function(require,module,exports){'use strict';var inherits=require('inherits');var assign=require('lodash/object/assign');var CommandInterceptor=require('diagram-js/lib/command/CommandInterceptor');var getApproxIntersection=require('diagram-js/lib/util/LineIntersection').getApproxIntersection;function copy(obj){return assign({},obj);}function getMid(bounds){return{x:Math.round(bounds.x+bounds.width/2),y:Math.round(bounds.y+bounds.height/2)};}function DropOnFlow(eventBus,bpmnRules,modeling){CommandInterceptor.call(this,eventBus);function insertShape(shape,targetFlow,position){var waypoints=targetFlow.waypoints,waypointsBefore,waypointsAfter,dockingPoint,source,target,reconnected;var intersection=getApproxIntersection(waypoints,position);if(intersection){waypointsBefore=waypoints.slice(0,intersection.index);waypointsAfter=waypoints.slice(intersection.index+(intersection.bendpoint?1:0));dockingPoint=intersection.bendpoint?waypoints[intersection.index]:position;waypointsBefore.push(copy(dockingPoint));waypointsAfter.unshift(copy(dockingPoint));}source=targetFlow.source;target=targetFlow.target;if(bpmnRules.canConnect(source,shape,targetFlow)){modeling.reconnectEnd(targetFlow,shape,waypointsBefore||position);reconnected=true;}if(bpmnRules.canConnect(shape,target,targetFlow)){if(!reconnected){modeling.reconnectStart(targetFlow,shape,waypointsAfter||position);}else{modeling.connect(shape,target,{type:targetFlow.type,waypoints:waypointsAfter});}}}this.preExecute('elements.move',function(context){var parent=context.newParent,shapes=context.shapes,shape,shapeMid,delta=context.delta;if(bpmnRules.canInsert(shapes,parent)){shape=shapes[0];shapeMid=getMid(shape);context.targetFlow=parent;context.newParent=parent.parent;context.position={x:shapeMid.x+delta.x,y:shapeMid.y+delta.y};}},true);this.postExecuted('elements.move',function(context){var shapes=context.shapes,targetFlow=context.targetFlow,position=context.position;if(targetFlow){insertShape(shapes[0],targetFlow,position);}},true);this.preExecute('shape.create',function(context){var parent=context.parent,shape=context.shape;if(bpmnRules.canInsert(shape,parent)){context.targetFlow=parent;context.parent=parent.parent;}},true);this.postExecute('shape.create',function(context){var shape=context.shape,targetFlow=context.targetFlow,position=context.position;if(targetFlow){insertShape(shape,targetFlow,position);}},true);}inherits(DropOnFlow,CommandInterceptor);DropOnFlow.$inject=['eventBus','bpmnRules','modeling'];module.exports=DropOnFlow;},{"diagram-js/lib/command/CommandInterceptor":226,"diagram-js/lib/util/LineIntersection":379,"inherits":398,"lodash/object/assign":547}],143:[function(require,module,exports){'use strict';var getMid=require('diagram-js/lib/layout/LayoutUtil').getMid;var lineIntersect=require('./util/LineIntersect');function ImportDockingFix(eventBus){function adjustDocking(startPoint,nextPoint,elementMid){var elementTop={x:elementMid.x,y:elementMid.y-50};var elementLeft={x:elementMid.x-50,y:elementMid.y};var verticalIntersect=lineIntersect(startPoint,nextPoint,elementMid,elementTop),horizontalIntersect=lineIntersect(startPoint,nextPoint,elementMid,elementLeft);var centerIntersect;if(verticalIntersect&&horizontalIntersect){if(getDistance(verticalIntersect,elementMid)>getDistance(horizontalIntersect,elementMid)){centerIntersect=horizontalIntersect;}else{centerIntersect=verticalIntersect;}}else{centerIntersect=verticalIntersect||horizontalIntersect;}startPoint.original=centerIntersect;}function fixDockings(connection){var waypoints=connection.waypoints;adjustDocking(waypoints[0],waypoints[1],getMid(connection.source));adjustDocking(waypoints[waypoints.length-1],waypoints[waypoints.length-2],getMid(connection.target));}eventBus.on('bpmnElement.added',function(e){var element=e.element;if(element.waypoints){fixDockings(element);}});}ImportDockingFix.$inject=['eventBus'];module.exports=ImportDockingFix;function getDistance(p1,p2){return Math.sqrt(Math.pow(p1.x-p2.x,2)+Math.pow(p1.y-p2.y,2));}},{"./util/LineIntersect":159,"diagram-js/lib/layout/LayoutUtil":359}],144:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign'),inherits=require('inherits');var LabelUtil=require('../../../util/LabelUtil'),LabelLayoutUtil=require('./util/LabelLayoutUtil'),ModelUtil=require('../../../util/ModelUtil'),is=ModelUtil.is,getBusinessObject=ModelUtil.getBusinessObject;var hasExternalLabel=LabelUtil.hasExternalLabel,getExternalLabelMid=LabelUtil.getExternalLabelMid,getLabelAdjustment=LabelLayoutUtil.getLabelAdjustment;var CommandInterceptor=require('diagram-js/lib/command/CommandInterceptor');var TextUtil=require('diagram-js/lib/util/Text');var DEFAULT_LABEL_DIMENSIONS={width:90,height:20};function LabelSupport(eventBus,modeling,bpmnFactory){CommandInterceptor.call(this,eventBus);var textUtil=new TextUtil();this.postExecute(['shape.create','connection.create'],function(e){var context=e.context;var element=context.shape||context.connection,businessObject=element.businessObject;if(!hasExternalLabel(businessObject)){return;}var labelCenter=getExternalLabelMid(element);var labelDimensions=getLayoutedBounds(DEFAULT_LABEL_DIMENSIONS,businessObject.name||'',textUtil);modeling.createLabel(element,labelCenter,{id:businessObject.id+'_label',hidden:!businessObject.name,businessObject:businessObject,width:labelDimensions.width,height:labelDimensions.height});});this.executed(['label.create'],function(event){var element=event.context.shape,businessObject,di;if(!element.labelTarget){return;}if(!is(element.labelTarget||element,'bpmn:BaseElement')){return;}businessObject=element.businessObject,di=businessObject.di;if(!di.label){di.label=bpmnFactory.create('bpmndi:BPMNLabel',{bounds:bpmnFactory.create('dc:Bounds')});}assign(di.label.bounds,{x:element.x,y:element.y,width:element.width,height:element.height});});function getHiddenLabelAdjustment(event){var context=event.context,connection=context.connection,label=connection.label;var labelPosition=getExternalLabelMid(connection);return{x:labelPosition.x-label.x-label.width/2,y:labelPosition.y-label.y-label.height/2};}function getVisibleLabelAdjustment(event){var command=event.command,context=event.context,connection=context.connection,label=connection.label,hints=assign({},context.hints),newWaypoints=context.newWaypoints||connection.waypoints,oldWaypoints=context.oldWaypoints;if(typeof hints.startChanged==='undefined'){hints.startChanged=(command==='connection.reconnectStart');}if(typeof hints.endChanged==='undefined'){hints.endChanged=(command==='connection.reconnectEnd');}return getLabelAdjustment(label,newWaypoints,oldWaypoints,hints);}this.postExecute(['connection.layout','connection.reconnectEnd','connection.reconnectStart','connection.updateWaypoints'],function(event){var label=event.context.connection.label,labelAdjustment;if(!label){return;}if(label.hidden){labelAdjustment=getHiddenLabelAdjustment(event);}else{labelAdjustment=getVisibleLabelAdjustment(event);}modeling.moveShape(label,labelAdjustment);});this.postExecute(['shape.replace'],function(event){var context=event.context,newShape=context.newShape,oldShape=context.oldShape;var businessObject=getBusinessObject(newShape);if(businessObject&&hasExternalLabel(businessObject)){newShape.label.x=oldShape.label.x;newShape.label.y=oldShape.label.y;}});}inherits(LabelSupport,CommandInterceptor);LabelSupport.$inject=['eventBus','modeling','bpmnFactory'];module.exports=LabelSupport;var EXTERNAL_LABEL_STYLE={fontFamily:'Arial, sans-serif',fontSize:'11px'};function getLayoutedBounds(bounds,text,textUtil){var layoutedLabelDimensions=textUtil.getDimensions(text,{box:{width:90,height:30,x:bounds.width/2+bounds.x,y:bounds.height/2+bounds.y},style:EXTERNAL_LABEL_STYLE});return{x:Math.round(bounds.x+bounds.width/2-layoutedLabelDimensions.width/2),y:Math.round(bounds.y),width:Math.ceil(layoutedLabelDimensions.width),height:Math.ceil(layoutedLabelDimensions.height)};}},{"../../../util/LabelUtil":196,"../../../util/ModelUtil":197,"./util/LabelLayoutUtil":157,"diagram-js/lib/command/CommandInterceptor":226,"diagram-js/lib/util/Text":387,"inherits":398,"lodash/object/assign":547}],145:[function(require,module,exports){'use strict';var is=require('../../../util/ModelUtil').is;var COLLAB_ERR_MSG='flow elements must be children of pools/participants',PROCESS_ERR_MSG='participants cannot be pasted onto a non-empty process diagram';function ModelingFeedback(eventBus,tooltips,translate){function showError(position,message,timeout){tooltips.add({position:{x:position.x+5,y:position.y+5},type:'error',timeout:timeout||2000,html:'<div>'+message+'</div>'});}eventBus.on(['shape.move.rejected','create.rejected'],function(event){var context=event.context,shape=context.shape,target=context.target;if(is(target,'bpmn:Collaboration')&&is(shape,'bpmn:FlowNode')){showError(event,translate(COLLAB_ERR_MSG));}});eventBus.on(['elements.paste.rejected'],function(event){var context=event.context,position=context.position,target=context.target;if(is(target,'bpmn:Collaboration')){showError(position,translate(COLLAB_ERR_MSG));}if(is(target,'bpmn:Process')){showError(position,translate(PROCESS_ERR_MSG),3000);}});}ModelingFeedback.$inject=['eventBus','tooltips','translate'];module.exports=ModelingFeedback;},{"../../../util/ModelUtil":197}],146:[function(require,module,exports){'use strict';var inherits=require('inherits');var CommandInterceptor=require('diagram-js/lib/command/CommandInterceptor');var lineIntersect=require('./util/LineIntersect');function RemoveElementBehavior(eventBus,bpmnRules,modeling){CommandInterceptor.call(this,eventBus);this.preExecute('shape.delete',function(e){var shape=e.context.shape;if(shape.incoming.length==1&&shape.outgoing.length==1){var inConnection=shape.incoming[0],outConnection=shape.outgoing[0];if(bpmnRules.canConnect(inConnection.source,outConnection.target,inConnection)){var newWaypoints=getNewWaypoints(inConnection.waypoints,outConnection.waypoints);modeling.reconnectEnd(inConnection,outConnection.target,newWaypoints);}}});}inherits(RemoveElementBehavior,CommandInterceptor);RemoveElementBehavior.$inject=['eventBus','bpmnRules','modeling'];module.exports=RemoveElementBehavior;function getDocking(point){return point.original||point;}function getNewWaypoints(inWaypoints,outWaypoints){var intersection=lineIntersect(getDocking(inWaypoints[inWaypoints.length-2]),getDocking(inWaypoints[inWaypoints.length-1]),getDocking(outWaypoints[1]),getDocking(outWaypoints[0]));if(intersection){return[].concat(inWaypoints.slice(0,inWaypoints.length-1),[intersection],outWaypoints.slice(1));}else{return[getDocking(inWaypoints[0]),getDocking(outWaypoints[outWaypoints.length-1])];}}},{"./util/LineIntersect":159,"diagram-js/lib/command/CommandInterceptor":226,"inherits":398}],147:[function(require,module,exports){'use strict';var inherits=require('inherits');var CommandInterceptor=require('diagram-js/lib/command/CommandInterceptor');var is=require('../../../util/ModelUtil').is;function RemoveParticipantBehavior(eventBus,modeling){CommandInterceptor.call(this,eventBus);this.preExecute('shape.delete',function(context){var shape=context.shape,parent=shape.parent;if(is(shape,'bpmn:Participant')){context.collaborationRoot=parent;}},true);this.postExecute('shape.delete',function(context){var collaborationRoot=context.collaborationRoot;if(collaborationRoot&&!collaborationRoot.businessObject.participants.length){modeling.makeProcess();}},true);}RemoveParticipantBehavior.$inject=['eventBus','modeling'];inherits(RemoveParticipantBehavior,CommandInterceptor);module.exports=RemoveParticipantBehavior;},{"../../../util/ModelUtil":197,"diagram-js/lib/command/CommandInterceptor":226,"inherits":398}],148:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach'),find=require('lodash/collection/find'),inherits=require('inherits');var CommandInterceptor=require('diagram-js/lib/command/CommandInterceptor');var is=require('../../../util/ModelUtil').is;function ReplaceConnectionBehavior(eventBus,modeling,bpmnRules){CommandInterceptor.call(this,eventBus);function fixConnection(connection){var source=connection.source,target=connection.target,parent=connection.parent;if(!parent){return;}var replacementType,remove;if(is(connection,'bpmn:SequenceFlow')){if(!bpmnRules.canConnectSequenceFlow(source,target)){remove=true;}if(bpmnRules.canConnectMessageFlow(source,target)){replacementType='bpmn:MessageFlow';}}if(is(connection,'bpmn:MessageFlow')){if(!bpmnRules.canConnectMessageFlow(source,target)){remove=true;}if(bpmnRules.canConnectSequenceFlow(source,target)){replacementType='bpmn:SequenceFlow';}}if(is(connection,'bpmn:Association')&&!bpmnRules.canConnectAssociation(source,target)){remove=true;}if(remove){modeling.removeConnection(connection);}if(replacementType){modeling.connect(source,target,{type:replacementType,waypoints:connection.waypoints.slice()});}}this.postExecuted('elements.move',function(context){var closure=context.closure,allConnections=closure.allConnections;forEach(allConnections,fixConnection);},true);this.postExecuted(['connection.reconnectStart','connection.reconnectEnd'],function(event){var connection=event.context.connection;fixConnection(connection);});this.postExecuted('element.updateProperties',function(event){var context=event.context,properties=context.properties,element=context.element,businessObject=element.businessObject,connection;if(properties.default){connection=find(element.outgoing,{id:element.businessObject.default.id});if(connection){modeling.updateProperties(connection,{conditionExpression:undefined});}}if(properties.conditionExpression&&businessObject.sourceRef.default===businessObject){modeling.updateProperties(element.source,{default:undefined});}});}inherits(ReplaceConnectionBehavior,CommandInterceptor);ReplaceConnectionBehavior.$inject=['eventBus','modeling','bpmnRules'];module.exports=ReplaceConnectionBehavior;},{"../../../util/ModelUtil":197,"diagram-js/lib/command/CommandInterceptor":226,"inherits":398,"lodash/collection/find":416,"lodash/collection/forEach":417}],149:[function(require,module,exports){'use strict';var inherits=require('inherits');var CommandInterceptor=require('diagram-js/lib/command/CommandInterceptor');var forEach=require('lodash/collection/forEach');var isEventSubProcess=require('../../../util/DiUtil').isEventSubProcess;var is=require('../../../util/ModelUtil').is;function ReplaceElementBehaviour(eventBus,bpmnReplace,bpmnRules,elementRegistry,selection,modeling){CommandInterceptor.call(this,eventBus);this._bpmnReplace=bpmnReplace;this._elementRegistry=elementRegistry;this._selection=selection;this._modeling=modeling;this.postExecuted(['elements.move'],500,function(event){var context=event.context,target=context.newParent,newHost=context.newHost,elements=[];forEach(context.closure.topLevel,function(topLevelElements){if(isEventSubProcess(topLevelElements)){elements=elements.concat(topLevelElements.children);}else{elements=elements.concat(topLevelElements);}});if(elements.length===1&&newHost){target=newHost;}var canReplace=bpmnRules.canReplace(elements,target);if(canReplace){this.replaceElements(elements,canReplace.replacements,newHost);}},this);this.postExecute(['shape.replace'],1500,function(e){var context=e.context,oldShape=context.oldShape,newShape=context.newShape,attachers=oldShape.attachers,canReplace;if(attachers&&attachers.length){canReplace=bpmnRules.canReplace(attachers,newShape);this.replaceElements(attachers,canReplace.replacements);}},this);this.postExecuted(['shape.replace'],1500,function(e){var context=e.context,oldShape=context.oldShape,newShape=context.newShape;modeling.unclaimId(oldShape.businessObject.id,oldShape.businessObject);modeling.updateProperties(newShape,{id:oldShape.id});});}inherits(ReplaceElementBehaviour,CommandInterceptor);ReplaceElementBehaviour.prototype.replaceElements=function(elements,newElements,newHost){var elementRegistry=this._elementRegistry,bpmnReplace=this._bpmnReplace,selection=this._selection,modeling=this._modeling;forEach(newElements,function(replacement){var newElement={type:replacement.newElementType};var oldElement=elementRegistry.get(replacement.oldElementId);if(newHost&&is(oldElement,'bpmn:BoundaryEvent')){modeling.updateAttachment(oldElement,null);}var idx=elements.indexOf(oldElement);elements[idx]=bpmnReplace.replaceElement(oldElement,newElement,{select:false});if(newHost&&is(elements[idx],'bpmn:BoundaryEvent')){modeling.updateAttachment(elements[idx],newHost);}});if(newElements){selection.select(elements);}};ReplaceElementBehaviour.$inject=['eventBus','bpmnReplace','bpmnRules','elementRegistry','selection','modeling'];module.exports=ReplaceElementBehaviour;},{"../../../util/DiUtil":195,"../../../util/ModelUtil":197,"diagram-js/lib/command/CommandInterceptor":226,"inherits":398,"lodash/collection/forEach":417}],150:[function(require,module,exports){'use strict';var is=require('../../../util/ModelUtil').is;var roundBounds=require('diagram-js/lib/layout/LayoutUtil').roundBounds;var hasPrimaryModifier=require('diagram-js/lib/util/Mouse').hasPrimaryModifier;var SLIGHTLY_HIGHER_PRIORITY=1001;function ResizeLaneBehavior(eventBus,modeling){eventBus.on('resize.start',SLIGHTLY_HIGHER_PRIORITY+500,function(event){var context=event.context,shape=context.shape;if(is(shape,'bpmn:Lane')||is(shape,'bpmn:Participant')){context.balanced=!hasPrimaryModifier(event);}});eventBus.on('resize.end',SLIGHTLY_HIGHER_PRIORITY,function(event){var context=event.context,shape=context.shape,canExecute=context.canExecute,newBounds=context.newBounds;if(is(shape,'bpmn:Lane')||is(shape,'bpmn:Participant')){if(canExecute){newBounds=roundBounds(newBounds);modeling.resizeLane(shape,newBounds,context.balanced);}return false;}});}ResizeLaneBehavior.$inject=['eventBus','modeling'];module.exports=ResizeLaneBehavior;},{"../../../util/ModelUtil":197,"diagram-js/lib/layout/LayoutUtil":359,"diagram-js/lib/util/Mouse":381}],151:[function(require,module,exports){'use strict';var inherits=require('inherits');var CommandInterceptor=require('diagram-js/lib/command/CommandInterceptor'),getBusinessObject=require('../../../util/ModelUtil').getBusinessObject,is=require('../../../util/ModelUtil').is,computeChildrenBBox=require('diagram-js/lib/features/resize/ResizeUtil').computeChildrenBBox;var LOW_PRIORITY=500;function ToggleElementCollapseBehaviour(eventBus,elementFactory,modeling,resize){CommandInterceptor.call(this,eventBus);function hideEmptyLables(children){if(children.length){children.forEach(function(child){if(child.type==='label'&&!child.businessObject.name){child.hidden=true;}});}}function expandedBounds(shape,defaultSize){var children=shape.children,newBounds=defaultSize,visibleElements,visibleBBox;visibleElements=filterVisible(children).concat([shape]);visibleBBox=computeChildrenBBox(visibleElements);if(visibleBBox){newBounds.width=Math.max(visibleBBox.width,newBounds.width);newBounds.height=Math.max(visibleBBox.height,newBounds.height);newBounds.x=visibleBBox.x+(visibleBBox.width-newBounds.width)/2;newBounds.y=visibleBBox.y+(visibleBBox.height-newBounds.height)/2;}else{newBounds.x=shape.x+(shape.width-newBounds.width)/2;newBounds.y=shape.y+(shape.height-newBounds.height)/2;}return newBounds;}function collapsedBounds(shape,defaultSize){return{x:shape.x+(shape.width-defaultSize.width)/2,y:shape.y+(shape.height-defaultSize.height)/2,width:defaultSize.width,height:defaultSize.height};}this.executed(['shape.toggleCollapse'],LOW_PRIORITY,function(e){var context=e.context,shape=context.shape;if(!is(shape,'bpmn:SubProcess')){return;}if(!shape.collapsed){hideEmptyLables(shape.children);getBusinessObject(shape).di.isExpanded=true;}else{getBusinessObject(shape).di.isExpanded=false;}});this.reverted(['shape.toggleCollapse'],LOW_PRIORITY,function(e){var context=e.context;var shape=context.shape;if(!shape.collapsed){getBusinessObject(shape).di.isExpanded=true;}else{getBusinessObject(shape).di.isExpanded=false;}});this.postExecuted(['shape.toggleCollapse'],LOW_PRIORITY,function(e){var shape=e.context.shape,defaultSize=elementFactory._getDefaultSize(shape),newBounds;if(shape.collapsed){newBounds=collapsedBounds(shape,defaultSize);}else{newBounds=expandedBounds(shape,defaultSize);}modeling.resizeShape(shape,newBounds);});}inherits(ToggleElementCollapseBehaviour,CommandInterceptor);ToggleElementCollapseBehaviour.$inject=['eventBus','elementFactory','modeling'];module.exports=ToggleElementCollapseBehaviour;function filterVisible(elements){return elements.filter(function(e){return!e.hidden;});}},{"../../../util/ModelUtil":197,"diagram-js/lib/command/CommandInterceptor":226,"diagram-js/lib/features/resize/ResizeUtil":330,"inherits":398}],152:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');var inherits=require('inherits');var CommandInterceptor=require('diagram-js/lib/command/CommandInterceptor');function UnclaimIdBehavior(eventBus,modeling){CommandInterceptor.call(this,eventBus);this.preExecute('elements.delete',function(event){var context=event.context,elements=context.elements;forEach(elements,function(element){modeling.unclaimId(element.businessObject.id,element.businessObject);});});}inherits(UnclaimIdBehavior,CommandInterceptor);UnclaimIdBehavior.$inject=['eventBus','modeling'];module.exports=UnclaimIdBehavior;},{"diagram-js/lib/command/CommandInterceptor":226,"inherits":398,"lodash/collection/forEach":417}],153:[function(require,module,exports){'use strict';var inherits=require('inherits');var CommandInterceptor=require('diagram-js/lib/command/CommandInterceptor');var is=require('../../../util/ModelUtil').is,getBusinessObject=require('../../../util/ModelUtil').getBusinessObject;function DeleteSequenceFlowBehavior(eventBus,modeling){CommandInterceptor.call(this,eventBus);this.preExecute('connection.delete',function(event){var context=event.context,connection=context.connection,source=connection.source;if(isDefaultFlow(connection,source)){modeling.updateProperties(source,{'default':null});}});}inherits(DeleteSequenceFlowBehavior,CommandInterceptor);DeleteSequenceFlowBehavior.$inject=['eventBus','modeling'];module.exports=DeleteSequenceFlowBehavior;function isDefaultFlow(connection,source){if(!is(connection,'bpmn:SequenceFlow')){return false;}var sourceBo=getBusinessObject(source),sequenceFlow=getBusinessObject(connection);return sourceBo.get('default')===sequenceFlow;}},{"../../../util/ModelUtil":197,"diagram-js/lib/command/CommandInterceptor":226,"inherits":398}],154:[function(require,module,exports){'use strict';var inherits=require('inherits');var CommandInterceptor=require('diagram-js/lib/command/CommandInterceptor');var is=require('../../../util/ModelUtil').is;var LOW_PRIORITY=500,HIGH_PRIORITY=5000;function UpdateFlowNodeRefsBehavior(eventBus,modeling,translate){CommandInterceptor.call(this,eventBus);var context;function initContext(){context=context||new UpdateContext();context.enter();return context;}function getContext(){if(!context){throw new Error(translate('out of bounds release'));}return context;}function releaseContext(){if(!context){throw new Error(translate('out of bounds release'));}var triggerUpdate=context.leave();if(triggerUpdate){modeling.updateLaneRefs(context.flowNodes,context.lanes);context=null;}return triggerUpdate;}var laneRefUpdateEvents=['spaceTool','lane.add','lane.resize','lane.split','elements.move','elements.delete','shape.create','shape.delete','shape.move','shape.resize'];this.preExecute(laneRefUpdateEvents,HIGH_PRIORITY,function(event){initContext();});this.postExecuted(laneRefUpdateEvents,LOW_PRIORITY,function(event){releaseContext();});this.preExecute(['shape.create','shape.move','shape.delete','shape.resize'],function(event){var context=event.context,shape=context.shape;var updateContext=getContext();if(shape.labelTarget){return;}if(is(shape,'bpmn:Lane')){updateContext.addLane(shape);}if(is(shape,'bpmn:FlowNode')){updateContext.addFlowNode(shape);}});}UpdateFlowNodeRefsBehavior.$inject=['eventBus','modeling','translate'];inherits(UpdateFlowNodeRefsBehavior,CommandInterceptor);module.exports=UpdateFlowNodeRefsBehavior;function UpdateContext(){this.flowNodes=[];this.lanes=[];this.counter=0;this.addLane=function(lane){this.lanes.push(lane);};this.addFlowNode=function(flowNode){this.flowNodes.push(flowNode);};this.enter=function(){this.counter++;};this.leave=function(){this.counter--;return!this.counter;};}},{"../../../util/ModelUtil":197,"diagram-js/lib/command/CommandInterceptor":226,"inherits":398}],155:[function(require,module,exports){module.exports={__init__:['appendBehavior','copyPasteBehavior','createBoundaryEventBehavior','createDataObjectBehavior','dropOnFlowBehavior','createParticipantBehavior','dataInputAssociationBehavior','deleteLaneBehavior','importDockingFix','labelBehavior','modelingFeedback','removeParticipantBehavior','replaceConnectionBehavior','replaceElementBehaviour','resizeLaneBehavior','unsetDefaultFlowBehavior','updateFlowNodeRefsBehavior','removeElementBehavior','unclaimIdBehavior','toggleElementCollapseBehaviour'],appendBehavior:['type',require('./AppendBehavior')],copyPasteBehavior:['type',require('./CopyPasteBehavior')],createBoundaryEventBehavior:['type',require('./CreateBoundaryEventBehavior')],createDataObjectBehavior:['type',require('./CreateDataObjectBehavior')],dropOnFlowBehavior:['type',require('./DropOnFlowBehavior')],createParticipantBehavior:['type',require('./CreateParticipantBehavior')],dataInputAssociationBehavior:['type',require('./DataInputAssociationBehavior')],deleteLaneBehavior:['type',require('./DeleteLaneBehavior')],importDockingFix:['type',require('./ImportDockingFix')],labelBehavior:['type',require('./LabelBehavior')],modelingFeedback:['type',require('./ModelingFeedback')],removeParticipantBehavior:['type',require('./RemoveParticipantBehavior')],replaceConnectionBehavior:['type',require('./ReplaceConnectionBehavior')],replaceElementBehaviour:['type',require('./ReplaceElementBehaviour')],resizeLaneBehavior:['type',require('./ResizeLaneBehavior')],unsetDefaultFlowBehavior:['type',require('./UnsetDefaultFlowBehavior')],updateFlowNodeRefsBehavior:['type',require('./UpdateFlowNodeRefsBehavior')],removeElementBehavior:['type',require('./RemoveElementBehavior')],unclaimIdBehavior:['type',require('./UnclaimIdBehavior')],toggleElementCollapseBehaviour:['type',require('./ToggleElementCollapseBehaviour')]};},{"./AppendBehavior":135,"./CopyPasteBehavior":136,"./CreateBoundaryEventBehavior":137,"./CreateDataObjectBehavior":138,"./CreateParticipantBehavior":139,"./DataInputAssociationBehavior":140,"./DeleteLaneBehavior":141,"./DropOnFlowBehavior":142,"./ImportDockingFix":143,"./LabelBehavior":144,"./ModelingFeedback":145,"./RemoveElementBehavior":146,"./RemoveParticipantBehavior":147,"./ReplaceConnectionBehavior":148,"./ReplaceElementBehaviour":149,"./ResizeLaneBehavior":150,"./ToggleElementCollapseBehaviour":151,"./UnclaimIdBehavior":152,"./UnsetDefaultFlowBehavior":153,"./UpdateFlowNodeRefsBehavior":154}],156:[function(require,module,exports){'use strict';function vectorLength(v){return Math.sqrt(Math.pow(v.x,2)+Math.pow(v.y,2));}module.exports.vectorLength=vectorLength;function getAngle(line){return Math.atan((line[1].y-line[0].y)/(line[1].x-line[0].x));}module.exports.getAngle=getAngle;function rotateVector(vector,angle){return(!angle)?vector:{x:Math.cos(angle)*vector.x-Math.sin(angle)*vector.y,y:Math.sin(angle)*vector.x+Math.cos(angle)*vector.y};}module.exports.rotateVector=rotateVector;function solveLambaSystem(a,b,c){var system=[{n:a[0]-c[0],lambda:b[0]},{n:a[1]-c[1],lambda:b[1]}];var n=system[0].n*b[0]+system[1].n*b[1],l=system[0].lambda*b[0]+system[1].lambda*b[1];return-n/l;}function perpendicularFoot(point,line){var a=line[0],b=line[1];var bd={x:b.x-a.x,y:b.y-a.y};var r=solveLambaSystem([a.x,a.y],[bd.x,bd.y],[point.x,point.y]);return{x:a.x+r*bd.x,y:a.y+r*bd.y};}module.exports.perpendicularFoot=perpendicularFoot;function getDistancePointLine(point,line){var pfPoint=perpendicularFoot(point,line);var connectionVector={x:pfPoint.x-point.x,y:pfPoint.y-point.y};return vectorLength(connectionVector);}module.exports.getDistancePointLine=getDistancePointLine;function getDistancePointPoint(point1,point2){return vectorLength({x:point1.x-point2.x,y:point1.y-point2.y});}module.exports.getDistancePointPoint=getDistancePointPoint;},{}],157:[function(require,module,exports){'use strict';var GeometricUtil=require('./GeometricUtil');var getDistancePointPoint=require('./GeometricUtil').getDistancePointPoint;var getAttachment=require('./LineAttachmentUtil').getAttachment;function findNewLabelLineStartIndex(oldWaypoints,newWaypoints,attachment,hints){var index=attachment.segmentIndex;var offset=newWaypoints.length-oldWaypoints.length;if(hints.segmentMove){var oldSegmentStartIndex=hints.segmentMove.segmentStartIndex,newSegmentStartIndex=hints.segmentMove.newSegmentStartIndex;if(index===oldSegmentStartIndex){return newSegmentStartIndex;}if(index>=newSegmentStartIndex){return(index+offset<newSegmentStartIndex)?newSegmentStartIndex:index+offset;}return index;}if(hints.bendpointMove){var insert=hints.bendpointMove.insert,bendpointIndex=hints.bendpointMove.bendpointIndex,newIndex;if(offset===0){return index;}if(index>=bendpointIndex){newIndex=insert?index+1:index-1;}if(index<bendpointIndex){newIndex=index;if(insert&&attachment.type!=='bendpoint'&&bendpointIndex-1===index){var rel=relativePositionMidWaypoint(newWaypoints,bendpointIndex);if(rel<attachment.relativeLocation){newIndex++;}}}return newIndex;}if(offset===0){return index;}if(hints.connectionStart){return(index===0)?0:null;}if(hints.connectionEnd){return(index===oldWaypoints.length-2)?newWaypoints.length-2:null;}return null;}module.exports.findNewLabelLineStartIndex=findNewLabelLineStartIndex;function getLabelAdjustment(label,newWaypoints,oldWaypoints,hints){var x=0,y=0;var labelPosition=getLabelMid(label);var attachment=getAttachment(labelPosition,oldWaypoints),oldLabelLineIndex=attachment.segmentIndex,newLabelLineIndex=findNewLabelLineStartIndex(oldWaypoints,newWaypoints,attachment,hints);if(newLabelLineIndex===null){return{x:x,y:y};}if(newLabelLineIndex<0||newLabelLineIndex>newWaypoints.length-2){return{x:x,y:y};}var oldLabelLine=getLine(oldWaypoints,oldLabelLineIndex),newLabelLine=getLine(newWaypoints,newLabelLineIndex),oldFoot=attachment.position;var relativeFootPosition=getRelativeFootPosition(oldLabelLine,oldFoot),angleDelta=getAngleDelta(oldLabelLine,newLabelLine);if(attachment.type==='bendpoint'){var offset=newWaypoints.length-oldWaypoints.length,oldBendpointIndex=attachment.bendpointIndex,oldBendpoint=oldWaypoints[oldBendpointIndex];if(newWaypoints.indexOf(oldBendpoint)!==-1){return{x:x,y:y};}if(offset===0){var newBendpoint=newWaypoints[oldBendpointIndex];return{x:newBendpoint.x-attachment.position.x,y:newBendpoint.y-attachment.position.y};}if(offset<0&&oldBendpointIndex!==0&&oldBendpointIndex<oldWaypoints.length-1){relativeFootPosition=relativePositionMidWaypoint(oldWaypoints,oldBendpointIndex);}}var newFoot={x:(newLabelLine[1].x-newLabelLine[0].x)*relativeFootPosition+newLabelLine[0].x,y:(newLabelLine[1].y-newLabelLine[0].y)*relativeFootPosition+newLabelLine[0].y};var newLabelVector=GeometricUtil.rotateVector({x:labelPosition.x-oldFoot.x,y:labelPosition.y-oldFoot.y},angleDelta);x=newFoot.x+newLabelVector.x-labelPosition.x;y=newFoot.y+newLabelVector.y-labelPosition.y;return{x:x,y:y};}module.exports.getLabelAdjustment=getLabelAdjustment;function relativePositionMidWaypoint(waypoints,idx){var distanceSegment1=getDistancePointPoint(waypoints[idx-1],waypoints[idx]),distanceSegment2=getDistancePointPoint(waypoints[idx],waypoints[idx+1]);var relativePosition=distanceSegment1/(distanceSegment1+distanceSegment2);return relativePosition;}function getLabelMid(label){return{x:label.x+label.width/2,y:label.y+label.height/2};}function getAngleDelta(l1,l2){var a1=GeometricUtil.getAngle(l1),a2=GeometricUtil.getAngle(l2);return a2-a1;}function getLine(waypoints,idx){return[waypoints[idx],waypoints[idx+1]];}function getRelativeFootPosition(line,foot){var length=getDistancePointPoint(line[0],line[1]),lengthToFoot=getDistancePointPoint(line[0],foot);return length===0?0:lengthToFoot/length;}},{"./GeometricUtil":156,"./LineAttachmentUtil":158}],158:[function(require,module,exports){'use strict';var sqrt=Math.sqrt,min=Math.min,max=Math.max,abs=Math.abs;function sq(n){return Math.pow(n,2);}function getDistance(p1,p2){return sqrt(sq(p1.x-p2.x)+sq(p1.y-p2.y));}function getAttachment(point,line){var idx=0,segmentStart,segmentEnd,segmentStartDistance,segmentEndDistance,attachmentPosition,minDistance,intersections,attachment,attachmentDistance,closestAttachmentDistance,closestAttachment;for(idx=0;idx<line.length-1;idx++){segmentStart=line[idx];segmentEnd=line[idx+1];if(pointsEqual(segmentStart,segmentEnd)){intersections=[segmentStart];}else{segmentStartDistance=getDistance(point,segmentStart);segmentEndDistance=getDistance(point,segmentEnd);minDistance=min(segmentStartDistance,segmentEndDistance);intersections=getCircleSegmentIntersections(segmentStart,segmentEnd,point,minDistance);}if(intersections.length<1){throw new Error('expected between [1, 2] circle -> line intersections');}if(intersections.length===1){attachment={type:'bendpoint',position:intersections[0],segmentIndex:idx,bendpointIndex:pointsEqual(segmentStart,intersections[0])?idx:idx+1};}if(intersections.length===2){attachmentPosition=mid(intersections[0],intersections[1]);attachment={type:'segment',position:attachmentPosition,segmentIndex:idx,relativeLocation:getDistance(segmentStart,attachmentPosition)/getDistance(segmentStart,segmentEnd)};}attachmentDistance=getDistance(attachment.position,point);if(!closestAttachment||closestAttachmentDistance>attachmentDistance){closestAttachment=attachment;closestAttachmentDistance=attachmentDistance;}}return closestAttachment;}module.exports.getAttachment=getAttachment;function getCircleSegmentIntersections(s1,s2,cc,cr){var baX=s2.x-s1.x;var baY=s2.y-s1.y;var caX=cc.x-s1.x;var caY=cc.y-s1.y;var a=baX*baX+baY*baY;var bBy2=baX*caX+baY*caY;var c=caX*caX+caY*caY-cr*cr;var pBy2=bBy2/a;var q=c/a;var disc=pBy2*pBy2-q;if(disc<0&&disc>-0.000001){disc=0;}if(disc<0){return[];}var tmpSqrt=sqrt(disc);var abScalingFactor1=-pBy2+tmpSqrt;var abScalingFactor2=-pBy2-tmpSqrt;var i1={x:s1.x-baX*abScalingFactor1,y:s1.y-baY*abScalingFactor1};if(disc===0){return[i1];}var i2={x:s1.x-baX*abScalingFactor2,y:s1.y-baY*abScalingFactor2};return[i1,i2].filter(function(p){return isPointInSegment(p,s1,s2);});}function isPointInSegment(p,segmentStart,segmentEnd){return(fenced(p.x,segmentStart.x,segmentEnd.x)&&fenced(p.y,segmentStart.y,segmentEnd.y));}function fenced(n,rangeStart,rangeEnd){return(n>=min(rangeStart,rangeEnd)-EQUAL_THRESHOLD&&n<=max(rangeStart,rangeEnd)+EQUAL_THRESHOLD);}function mid(p1,p2){return{x:(p1.x+p2.x)/2,y:(p1.y+p2.y)/2};}var EQUAL_THRESHOLD=0.1;function pointsEqual(p1,p2){return(abs(p1.x-p2.x)<=EQUAL_THRESHOLD&&abs(p1.y-p2.y)<=EQUAL_THRESHOLD);}},{}],159:[function(require,module,exports){'use strict';module.exports=function lineIntersect(l1s,l1e,l2s,l2e){var denominator,a,b,c,numerator;denominator=((l2e.y-l2s.y)*(l1e.x-l1s.x))-((l2e.x-l2s.x)*(l1e.y-l1s.y));if(denominator==0){return null;}a=l1s.y-l2s.y;b=l1s.x-l2s.x;numerator=((l2e.x-l2s.x)*a)-((l2e.y-l2s.y)*b);c=numerator/denominator;return{x:Math.round(l1s.x+(c*(l1e.x-l1s.x))),y:Math.round(l1s.y+(c*(l1e.y-l1s.y)))};};},{}],160:[function(require,module,exports){'use strict';var filter=require('lodash/collection/filter');var Elements=require('diagram-js/lib/util/Elements');var getLanesRoot=require('../util/LaneUtil').getLanesRoot,getChildLanes=require('../util/LaneUtil').getChildLanes,LANE_INDENTATION=require('../util/LaneUtil').LANE_INDENTATION;function AddLaneHandler(modeling,spaceTool){this._modeling=modeling;this._spaceTool=spaceTool;}AddLaneHandler.$inject=['modeling','spaceTool'];module.exports=AddLaneHandler;AddLaneHandler.prototype.preExecute=function(context){var spaceTool=this._spaceTool,modeling=this._modeling;var shape=context.shape,location=context.location;var lanesRoot=getLanesRoot(shape);var isRoot=lanesRoot===shape,laneParent=isRoot?shape:shape.parent;var existingChildLanes=getChildLanes(laneParent);if(!existingChildLanes.length){modeling.createShape({type:'bpmn:Lane'},{x:shape.x+LANE_INDENTATION,y:shape.y,width:shape.width-LANE_INDENTATION,height:shape.height},laneParent);}var allAffected=[];Elements.eachElement(lanesRoot,function(element){allAffected.push(element);if(element===shape){return[];}return filter(element.children,function(c){return c!==shape;});});var offset=location==='top'?-120:120,lanePosition=location==='top'?shape.y:shape.y+shape.height,spacePos=lanePosition+(location==='top'?10:-10),direction=location==='top'?'n':'s';var adjustments=spaceTool.calculateAdjustments(allAffected,'y',offset,spacePos);spaceTool.makeSpace(adjustments.movingShapes,adjustments.resizingShapes,{x:0,y:offset},direction);context.newLane=modeling.createShape({type:'bpmn:Lane'},{x:shape.x+(isRoot?LANE_INDENTATION:0),y:lanePosition-(location==='top'?120:0),width:shape.width-(isRoot?LANE_INDENTATION:0),height:120},laneParent);};},{"../util/LaneUtil":169,"diagram-js/lib/util/Elements":373,"lodash/collection/filter":415}],161:[function(require,module,exports){'use strict';function IdClaimHandler(moddle){this._moddle=moddle;}IdClaimHandler.$inject=['moddle'];module.exports=IdClaimHandler;IdClaimHandler.prototype.execute=function(context){var ids=this._moddle.ids,id=context.id,element=context.element,claiming=context.claiming;if(claiming){ids.claim(id,element);}else{ids.unclaim(id);}};IdClaimHandler.prototype.revert=function(context){var ids=this._moddle.ids,id=context.id,element=context.element,claiming=context.claiming;if(claiming){ids.unclaim(id);}else{ids.claim(id,element);}};},{}],162:[function(require,module,exports){'use strict';var is=require('../../../util/ModelUtil').is;var getLanesRoot=require('../util/LaneUtil').getLanesRoot,computeLanesResize=require('../util/LaneUtil').computeLanesResize;var eachElement=require('diagram-js/lib/util/Elements').eachElement;var asTRBL=require('diagram-js/lib/layout/LayoutUtil').asTRBL,substractTRBL=require('diagram-js/lib/features/resize/ResizeUtil').substractTRBL;function ResizeLaneHandler(modeling,spaceTool){this._modeling=modeling;this._spaceTool=spaceTool;}ResizeLaneHandler.$inject=['modeling','spaceTool'];module.exports=ResizeLaneHandler;ResizeLaneHandler.prototype.preExecute=function(context){var shape=context.shape,newBounds=context.newBounds,balanced=context.balanced;if(balanced!==false){this.resizeBalanced(shape,newBounds);}else{this.resizeSpace(shape,newBounds);}};ResizeLaneHandler.prototype.resizeBalanced=function(shape,newBounds){var modeling=this._modeling;var resizeNeeded=computeLanesResize(shape,newBounds);modeling.resizeShape(shape,newBounds);resizeNeeded.forEach(function(r){modeling.resizeShape(r.shape,r.newBounds);});};ResizeLaneHandler.prototype.resizeSpace=function(shape,newBounds){var spaceTool=this._spaceTool;var shapeTrbl=asTRBL(shape),newTrbl=asTRBL(newBounds);var trblDiff=substractTRBL(newTrbl,shapeTrbl);var lanesRoot=getLanesRoot(shape);var allAffected=[],allLanes=[];eachElement(lanesRoot,function(element){allAffected.push(element);if(is(element,'bpmn:Lane')||is(element,'bpmn:Participant')){allLanes.push(element);}return element.children;});var change,spacePos,direction,offset,adjustments;if(trblDiff.bottom||trblDiff.top){change=trblDiff.bottom||trblDiff.top;spacePos=shape.y+(trblDiff.bottom?shape.height:0)+(trblDiff.bottom?-10:10);direction=trblDiff.bottom?'s':'n';offset=trblDiff.top>0||trblDiff.bottom<0?-change:change;adjustments=spaceTool.calculateAdjustments(allAffected,'y',offset,spacePos);spaceTool.makeSpace(adjustments.movingShapes,adjustments.resizingShapes,{x:0,y:change},direction);}if(trblDiff.left||trblDiff.right){change=trblDiff.right||trblDiff.left;spacePos=shape.x+(trblDiff.right?shape.width:0)+(trblDiff.right?-10:100);direction=trblDiff.right?'e':'w';offset=trblDiff.left>0||trblDiff.right<0?-change:change;adjustments=spaceTool.calculateAdjustments(allLanes,'x',offset,spacePos);spaceTool.makeSpace(adjustments.movingShapes,adjustments.resizingShapes,{x:change,y:0},direction);}};},{"../../../util/ModelUtil":197,"../util/LaneUtil":169,"diagram-js/lib/features/resize/ResizeUtil":330,"diagram-js/lib/layout/LayoutUtil":359,"diagram-js/lib/util/Elements":373}],163:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign'),forEach=require('lodash/collection/forEach');function SetColorHandler(commandStack){this._commandStack=commandStack;}SetColorHandler.$inject=['commandStack'];module.exports=SetColorHandler;SetColorHandler.prototype.postExecute=function(context){var elements=context.elements,colors=context.colors||{fill:undefined,stroke:undefined};var that=this;var di={};if('fill'in colors){assign(di,{fill:colors.fill});}if('stroke'in colors){assign(di,{stroke:colors.stroke});}forEach(elements,function(element){that._commandStack.execute('element.updateProperties',{element:element,properties:{di:di}});});};SetColorHandler.prototype.execute=function(context){};SetColorHandler.prototype.revert=function(context){};},{"lodash/collection/forEach":417,"lodash/object/assign":547}],164:[function(require,module,exports){'use strict';var getChildLanes=require('../util/LaneUtil').getChildLanes;var LANE_INDENTATION=require('../util/LaneUtil').LANE_INDENTATION;function SplitLaneHandler(modeling,translate){this._modeling=modeling;this._translate=translate;}SplitLaneHandler.$inject=['modeling','translate'];module.exports=SplitLaneHandler;SplitLaneHandler.prototype.preExecute=function(context){var modeling=this._modeling,translate=this._translate;var shape=context.shape,newLanesCount=context.count;var childLanes=getChildLanes(shape),existingLanesCount=childLanes.length;if(existingLanesCount>newLanesCount){throw new Error(translate('more than {count} child lanes',{count:newLanesCount}));}var newLanesHeight=Math.round(shape.height/newLanesCount);var laneY,laneHeight,laneBounds,newLaneAttrs,idx;for(idx=0;idx<newLanesCount;idx++){laneY=shape.y+idx*newLanesHeight;if(idx===newLanesCount-1){laneHeight=shape.height-(newLanesHeight*idx);}else{laneHeight=newLanesHeight;}laneBounds={x:shape.x+LANE_INDENTATION,y:laneY,width:shape.width-LANE_INDENTATION,height:laneHeight};if(idx<existingLanesCount){modeling.resizeShape(childLanes[idx],laneBounds);}else{newLaneAttrs={type:'bpmn:Lane'};modeling.createShape(newLaneAttrs,laneBounds,shape);}}};},{"../util/LaneUtil":169}],165:[function(require,module,exports){'use strict';var Collections=require('diagram-js/lib/util/Collections');function UpdateCanvasRootHandler(canvas,modeling){this._canvas=canvas;this._modeling=modeling;}UpdateCanvasRootHandler.$inject=['canvas','modeling'];module.exports=UpdateCanvasRootHandler;UpdateCanvasRootHandler.prototype.execute=function(context){var canvas=this._canvas;var newRoot=context.newRoot,newRootBusinessObject=newRoot.businessObject,oldRoot=canvas.getRootElement(),oldRootBusinessObject=oldRoot.businessObject,bpmnDefinitions=oldRootBusinessObject.$parent,diPlane=oldRootBusinessObject.di;canvas.setRootElement(newRoot,true);Collections.add(bpmnDefinitions.rootElements,newRootBusinessObject);newRootBusinessObject.$parent=bpmnDefinitions;Collections.remove(bpmnDefinitions.rootElements,oldRootBusinessObject);oldRootBusinessObject.$parent=null;oldRootBusinessObject.di=null;diPlane.bpmnElement=newRootBusinessObject;newRootBusinessObject.di=diPlane;context.oldRoot=oldRoot;};UpdateCanvasRootHandler.prototype.revert=function(context){var canvas=this._canvas;var newRoot=context.newRoot,newRootBusinessObject=newRoot.businessObject,oldRoot=context.oldRoot,oldRootBusinessObject=oldRoot.businessObject,bpmnDefinitions=newRootBusinessObject.$parent,diPlane=newRootBusinessObject.di;canvas.setRootElement(oldRoot,true);Collections.remove(bpmnDefinitions.rootElements,newRootBusinessObject);newRootBusinessObject.$parent=null;Collections.add(bpmnDefinitions.rootElements,oldRootBusinessObject);oldRootBusinessObject.$parent=bpmnDefinitions;newRootBusinessObject.di=null;diPlane.bpmnElement=oldRootBusinessObject;oldRootBusinessObject.di=diPlane;};},{"diagram-js/lib/util/Collections":370}],166:[function(require,module,exports){'use strict';var collectLanes=require('../util/LaneUtil').collectLanes;var getLanesRoot=require('../util/LaneUtil').getLanesRoot;var is=require('../../../util/ModelUtil').is;var Collections=require('diagram-js/lib/util/Collections');var asTRBL=require('diagram-js/lib/layout/LayoutUtil').asTRBL;var FLOW_NODE_REFS_ATTR='flowNodeRef',LANES_ATTR='lanes';function UpdateFlowNodeRefsHandler(elementRegistry){this._elementRegistry=elementRegistry;}UpdateFlowNodeRefsHandler.$inject=['elementRegistry'];module.exports=UpdateFlowNodeRefsHandler;UpdateFlowNodeRefsHandler.prototype.computeUpdates=function(flowNodeShapes,laneShapes){var handledNodes={};var updates=[];var participantCache={};var allFlowNodeShapes=[];function isInLaneShape(element,laneShape){var laneTrbl=asTRBL(laneShape);var elementMid={x:element.x+element.width/2,y:element.y+element.height/2};return elementMid.x>laneTrbl.left&&elementMid.x<laneTrbl.right&&elementMid.y>laneTrbl.top&&elementMid.y<laneTrbl.bottom;}function addFlowNodeShape(flowNodeShape){if(!handledNodes[flowNodeShape.id]){allFlowNodeShapes.push(flowNodeShape);handledNodes[flowNodeShape.id]=flowNodeShape;}}function getAllLaneShapes(flowNodeShape){var root=getLanesRoot(flowNodeShape);if(!participantCache[root.id]){participantCache[root.id]=collectLanes(root);}return participantCache[root.id];}function getNewLanes(flowNodeShape){if(!flowNodeShape.parent){return[];}var allLaneShapes=getAllLaneShapes(flowNodeShape);return allLaneShapes.filter(function(l){return isInLaneShape(flowNodeShape,l);}).map(function(shape){return shape.businessObject;});}laneShapes.forEach(function(laneShape){var root=getLanesRoot(laneShape);if(!root||handledNodes[root.id]){return;}var children=root.children.filter(function(c){return is(c,'bpmn:FlowNode');});children.forEach(addFlowNodeShape);handledNodes[root.id]=root;});flowNodeShapes.forEach(addFlowNodeShape);allFlowNodeShapes.forEach(function(flowNodeShape){var flowNode=flowNodeShape.businessObject;var lanes=flowNode.get(LANES_ATTR),remove=lanes.slice(),add=getNewLanes(flowNodeShape);updates.push({flowNode:flowNode,remove:remove,add:add});});laneShapes.forEach(function(laneShape){var lane=laneShape.businessObject;if(!laneShape.parent){lane.get(FLOW_NODE_REFS_ATTR).forEach(function(flowNode){updates.push({flowNode:flowNode,remove:[lane],add:[]});});}});return updates;};UpdateFlowNodeRefsHandler.prototype.execute=function(context){var updates=context.updates;if(!updates){updates=context.updates=this.computeUpdates(context.flowNodeShapes,context.laneShapes);}updates.forEach(function(update){var flowNode=update.flowNode,lanes=flowNode.get(LANES_ATTR);update.remove.forEach(function(oldLane){Collections.remove(lanes,oldLane);Collections.remove(oldLane.get(FLOW_NODE_REFS_ATTR),flowNode);});update.add.forEach(function(newLane){Collections.add(lanes,newLane);Collections.add(newLane.get(FLOW_NODE_REFS_ATTR),flowNode);});});};UpdateFlowNodeRefsHandler.prototype.revert=function(context){var updates=context.updates;updates.forEach(function(update){var flowNode=update.flowNode,lanes=flowNode.get(LANES_ATTR);update.add.forEach(function(newLane){Collections.remove(lanes,newLane);Collections.remove(newLane.get(FLOW_NODE_REFS_ATTR),flowNode);});update.remove.forEach(function(oldLane){Collections.add(lanes,oldLane);Collections.add(oldLane.get(FLOW_NODE_REFS_ATTR),flowNode);});});};},{"../../../util/ModelUtil":197,"../util/LaneUtil":169,"diagram-js/lib/layout/LayoutUtil":359,"diagram-js/lib/util/Collections":370}],167:[function(require,module,exports){'use strict';var reduce=require('lodash/object/transform'),keys=require('lodash/object/keys'),forEach=require('lodash/collection/forEach'),assign=require('lodash/object/assign');var getBusinessObject=require('../../../util/ModelUtil').getBusinessObject;var TextUtil=require('diagram-js/lib/util/Text');var DEFAULT_FLOW='default',NAME='name',ID='id',DI='di';var NULL_DIMENSIONS={width:0,height:0};function UpdatePropertiesHandler(elementRegistry,moddle,translate,modeling){this._elementRegistry=elementRegistry;this._moddle=moddle;this._translate=translate;this._modeling=modeling;this._textUtil=new TextUtil();}UpdatePropertiesHandler.$inject=['elementRegistry','moddle','translate','modeling'];module.exports=UpdatePropertiesHandler;UpdatePropertiesHandler.prototype.execute=function(context){var element=context.element,changed=[element],translate=this._translate;if(!element){throw new Error(translate('element required'));}var elementRegistry=this._elementRegistry,ids=this._moddle.ids;var businessObject=element.businessObject,properties=unwrapBusinessObjects(context.properties),oldProperties=context.oldProperties||getProperties(businessObject,properties);if(isIdChange(properties,businessObject)){ids.unclaim(businessObject[ID]);elementRegistry.updateId(element,properties[ID]);ids.claim(properties[ID],businessObject);}if(DEFAULT_FLOW in properties){if(properties[DEFAULT_FLOW]){changed.push(elementRegistry.get(properties[DEFAULT_FLOW].id));}if(businessObject[DEFAULT_FLOW]){changed.push(elementRegistry.get(businessObject[DEFAULT_FLOW].id));}}if(NAME in properties&&element.label){changed.push(element.label);element.label.hidden=!properties[NAME];}if(DI in properties&&businessObject.di){setDiProperties(businessObject.di,properties.di);}setProperties(businessObject,properties);context.oldProperties=oldProperties;context.changed=changed;return changed;};UpdatePropertiesHandler.prototype.postExecute=function(context){var element=context.element,label=element.label;var text=label&&getBusinessObject(label).name;if(!text){return;}var newLabelBounds=getLayoutedBounds(label,text,this._textUtil);this._modeling.resizeShape(label,newLabelBounds,NULL_DIMENSIONS);};UpdatePropertiesHandler.prototype.revert=function(context){var element=context.element,properties=context.properties,oldProperties=context.oldProperties,businessObject=element.businessObject,elementRegistry=this._elementRegistry,ids=this._moddle.ids;if(DI in oldProperties&&businessObject.di){setDiProperties(businessObject.di,oldProperties.di);}setProperties(businessObject,oldProperties);if(isIdChange(properties,businessObject)){ids.unclaim(properties[ID]);elementRegistry.updateId(element,oldProperties[ID]);ids.claim(oldProperties[ID],businessObject);}return context.changed;};function isIdChange(properties,businessObject){return ID in properties&&properties[ID]!==businessObject[ID];}function getProperties(businessObject,properties){var propertyNames=keys(properties);return reduce(propertyNames,function(result,key){if(key!==DI){result[key]=businessObject.get(key);}else{result[key]=getDiProperties(businessObject.di,keys(properties.di));}return result;},{});}function getDiProperties(di,propertyNames){return reduce(propertyNames,function(result,key){result[key]=di.get(key);return result;},{});}function setProperties(businessObject,properties){forEach(properties,function(value,key){businessObject.set(key,value);});}function setDiProperties(di,properties){forEach(properties,function(value,key){di.set(key,value);});}var referencePropertyNames=['default'];function unwrapBusinessObjects(properties){var unwrappedProps=assign({},properties);referencePropertyNames.forEach(function(name){if(name in properties){unwrappedProps[name]=getBusinessObject(unwrappedProps[name]);}});return unwrappedProps;}var EXTERNAL_LABEL_STYLE={fontFamily:'Arial, sans-serif',fontSize:'11px'};function getLayoutedBounds(bounds,text,textUtil){var layoutedLabelDimensions=textUtil.getDimensions(text,{box:{width:90,height:30,x:bounds.width/2+bounds.x,y:bounds.height/2+bounds.y},style:EXTERNAL_LABEL_STYLE});return{x:Math.round(bounds.x+bounds.width/2-layoutedLabelDimensions.width/2),y:Math.round(bounds.y),width:Math.ceil(layoutedLabelDimensions.width),height:Math.ceil(layoutedLabelDimensions.height)};}},{"../../../util/ModelUtil":197,"diagram-js/lib/util/Text":387,"lodash/collection/forEach":417,"lodash/object/assign":547,"lodash/object/keys":550,"lodash/object/transform":556}],168:[function(require,module,exports){module.exports={__init__:['modeling','bpmnUpdater'],__depends__:[require('./behavior'),require('../label-editing'),require('../rules'),require('../ordering'),require('../replace'),require('diagram-js/lib/command'),require('diagram-js/lib/features/tooltips'),require('diagram-js/lib/features/label-support'),require('diagram-js/lib/features/attach-support'),require('diagram-js/lib/features/selection'),require('diagram-js/lib/features/change-support'),require('diagram-js/lib/features/space-tool')],bpmnFactory:['type',require('./BpmnFactory')],bpmnUpdater:['type',require('./BpmnUpdater')],elementFactory:['type',require('./ElementFactory')],modeling:['type',require('./Modeling')],layouter:['type',require('./BpmnLayouter')],connectionDocking:['type',require('diagram-js/lib/layout/CroppingConnectionDocking')]};},{"../label-editing":129,"../ordering":172,"../replace":182,"../rules":184,"./BpmnFactory":130,"./BpmnLayouter":131,"./BpmnUpdater":132,"./ElementFactory":133,"./Modeling":134,"./behavior":155,"diagram-js/lib/command":228,"diagram-js/lib/features/attach-support":242,"diagram-js/lib/features/change-support":254,"diagram-js/lib/features/label-support":281,"diagram-js/lib/features/selection":340,"diagram-js/lib/features/space-tool":347,"diagram-js/lib/features/tooltips":351,"diagram-js/lib/layout/CroppingConnectionDocking":358}],169:[function(require,module,exports){'use strict';var is=require('../../../util/ModelUtil').is;var getParent=require('./ModelingUtil').getParent;var asTRBL=require('diagram-js/lib/layout/LayoutUtil').asTRBL,substractTRBL=require('diagram-js/lib/features/resize/ResizeUtil').substractTRBL,resizeTRBL=require('diagram-js/lib/features/resize/ResizeUtil').resizeTRBL;var abs=Math.abs;function getTRBLResize(oldBounds,newBounds){return substractTRBL(asTRBL(newBounds),asTRBL(oldBounds));}var LANE_PARENTS=['bpmn:Participant','bpmn:Process','bpmn:SubProcess'];var LANE_INDENTATION=30;module.exports.LANE_INDENTATION=LANE_INDENTATION;function collectLanes(shape,collectedShapes){collectedShapes=collectedShapes||[];shape.children.filter(function(s){if(is(s,'bpmn:Lane')){collectLanes(s,collectedShapes);collectedShapes.push(s);}});return collectedShapes;}module.exports.collectLanes=collectLanes;function getChildLanes(shape){return shape.children.filter(function(c){return is(c,'bpmn:Lane');});}module.exports.getChildLanes=getChildLanes;function getLanesRoot(shape){return getParent(shape,LANE_PARENTS)||shape;}module.exports.getLanesRoot=getLanesRoot;function computeLanesResize(shape,newBounds){var rootElement=getLanesRoot(shape);var initialShapes=is(rootElement,'bpmn:Process')?[]:[rootElement];var allLanes=collectLanes(rootElement,initialShapes),shapeTrbl=asTRBL(shape),shapeNewTrbl=asTRBL(newBounds),trblResize=getTRBLResize(shape,newBounds),resizeNeeded=[];allLanes.forEach(function(other){if(other===shape){return;}var topResize=0,rightResize=trblResize.right,bottomResize=0,leftResize=trblResize.left;var otherTrbl=asTRBL(other);if(trblResize.top){if(abs(otherTrbl.bottom-shapeTrbl.top)<10){bottomResize=shapeNewTrbl.top-otherTrbl.bottom;}if(abs(otherTrbl.top-shapeTrbl.top)<5){topResize=shapeNewTrbl.top-otherTrbl.top;}}if(trblResize.bottom){if(abs(otherTrbl.top-shapeTrbl.bottom)<10){topResize=shapeNewTrbl.bottom-otherTrbl.top;}if(abs(otherTrbl.bottom-shapeTrbl.bottom)<5){bottomResize=shapeNewTrbl.bottom-otherTrbl.bottom;}}if(topResize||rightResize||bottomResize||leftResize){resizeNeeded.push({shape:other,newBounds:resizeTRBL(other,{top:topResize,right:rightResize,bottom:bottomResize,left:leftResize})});}});return resizeNeeded;}module.exports.computeLanesResize=computeLanesResize;},{"../../../util/ModelUtil":197,"./ModelingUtil":170,"diagram-js/lib/features/resize/ResizeUtil":330,"diagram-js/lib/layout/LayoutUtil":359}],170:[function(require,module,exports){'use strict';var any=require('lodash/collection/any');var is=require('../../../util/ModelUtil').is;function isAny(element,types){return any(types,function(t){return is(element,t);});}module.exports.isAny=isAny;function getParent(element,anyType){if(typeof anyType==='string'){anyType=[anyType];}while((element=element.parent)){if(isAny(element,anyType)){return element;}}return null;}module.exports.getParent=getParent;},{"../../../util/ModelUtil":197,"lodash/collection/any":413}],171:[function(require,module,exports){'use strict';var inherits=require('inherits');var OrderingProvider=require('diagram-js/lib/features/ordering/OrderingProvider');var isAny=require('../modeling/util/ModelingUtil').isAny;var findIndex=require('lodash/array/findIndex');var find=require('lodash/collection/find');function BpmnOrderingProvider(eventBus,translate){OrderingProvider.call(this,eventBus);var orders=[{type:'bpmn:SubProcess',order:{level:6}},{type:'bpmn:SequenceFlow',order:{level:5,containers:['bpmn:Participant','bpmn:FlowElementsContainer']}},{type:'bpmn:DataAssociation',order:{level:9,containers:['bpmn:Collaboration','bpmn:Process']}},{type:'bpmn:MessageFlow',order:{level:9,containers:['bpmn:Collaboration']}},{type:'bpmn:Association',order:{level:6,containers:['bpmn:Participant','bpmn:FlowElementsContainer','bpmn:Collaboration']}},{type:'bpmn:BoundaryEvent',order:{level:8}},{type:'bpmn:Participant',order:{level:-2}},{type:'bpmn:Lane',order:{level:-1}}];function computeOrder(element){if(element.labelTarget){return{level:10};}var entry=find(orders,function(o){return isAny(element,[o.type]);});return entry&&entry.order||{level:1};}function getOrder(element){var order=element.order;if(!order){element.order=order=computeOrder(element);}return order;}function findActualParent(element,newParent,containers){var actualParent=newParent;while(actualParent){if(isAny(actualParent,containers)){break;}actualParent=actualParent.parent;}if(!actualParent){throw new Error(translate('no parent for {element} in {parent}',{element:element.id,parent:newParent.id}));}return actualParent;}this.getOrdering=function(element,newParent){var elementOrder=getOrder(element);if(elementOrder.containers){newParent=findActualParent(element,newParent,elementOrder.containers);}var currentIndex=newParent.children.indexOf(element);var insertIndex=findIndex(newParent.children,function(child){if(!element.labelTarget&&child.labelTarget){return false;}return elementOrder.level<getOrder(child).level;});if(insertIndex!==-1){if(currentIndex!==-1&&currentIndex<insertIndex){insertIndex-=1;}}return{index:insertIndex,parent:newParent};};}BpmnOrderingProvider.$inject=['eventBus','translate'];inherits(BpmnOrderingProvider,OrderingProvider);module.exports=BpmnOrderingProvider;},{"../modeling/util/ModelingUtil":170,"diagram-js/lib/features/ordering/OrderingProvider":314,"inherits":398,"lodash/array/findIndex":402,"lodash/collection/find":416}],172:[function(require,module,exports){module.exports={__init__:['bpmnOrderingProvider'],__depends__:[require('diagram-js/lib/i18n/translate')],bpmnOrderingProvider:['type',require('./BpmnOrderingProvider')]};},{"./BpmnOrderingProvider":171,"diagram-js/lib/i18n/translate":355}],173:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign');function PaletteProvider(palette,create,elementFactory,spaceTool,lassoTool,handTool,globalConnect,translate){this._palette=palette;this._create=create;this._elementFactory=elementFactory;this._spaceTool=spaceTool;this._lassoTool=lassoTool;this._handTool=handTool;this._globalConnect=globalConnect;this._translate=translate;palette.registerProvider(this);}module.exports=PaletteProvider;PaletteProvider.$inject=['palette','create','elementFactory','spaceTool','lassoTool','handTool','globalConnect','translate'];PaletteProvider.prototype.getPaletteEntries=function(element){var actions={},create=this._create,elementFactory=this._elementFactory,spaceTool=this._spaceTool,lassoTool=this._lassoTool,handTool=this._handTool,globalConnect=this._globalConnect,translate=this._translate;function createAction(type,group,className,title,options){function createListener(event){var shape=elementFactory.createShape(assign({type:type},options));if(options){shape.businessObject.di.isExpanded=options.isExpanded;}create.start(event,shape);}var shortType=type.replace(/^bpmn\:/,'');return{group:group,className:className,title:title||translate('Create {type}',{type:shortType}),action:{dragstart:createListener,click:createListener}};}function createParticipant(event,collapsed){create.start(event,elementFactory.createParticipantShape(collapsed));}assign(actions,{'hand-tool':{group:'tools',className:'bpmn-icon-hand-tool',title:translate('选择'),action:{click:function(event){handTool.activateHand(event);}}},'lasso-tool':{group:'tools',className:'bpmn-icon-lasso-tool',title:translate('选择框'),action:{click:function(event){lassoTool.activateSelection(event);}}},'space-tool':{group:'tools',className:'bpmn-icon-space-tool',title:translate('空间移动'),action:{click:function(event){spaceTool.activateSelection(event);}}},'global-connect-tool':{group:'tools',className:'bpmn-icon-connection-multi',title:translate('连接线'),action:{click:function(event){globalConnect.toggle(event);}}},'tool-separator':{group:'tools',separator:true},'create.start-event':createAction('bpmn:StartEvent','event','bpmn-icon-start-event-none','开始事件'),'create.intermediate-event':createAction('bpmn:IntermediateThrowEvent','event','bpmn-icon-intermediate-event-none',translate('中间事件')),'create.end-event':createAction('bpmn:EndEvent','event','bpmn-icon-end-event-none','结束事件'),'create.exclusive-gateway':createAction('bpmn:ExclusiveGateway','gateway','bpmn-icon-gateway-xor','排他网关'),'create.task':createAction('bpmn:Task','activity','bpmn-icon-task','任务'),'create.data-object':createAction('bpmn:DataObjectReference','data-object','bpmn-icon-data-object','数据对象引用'),'create.data-store':createAction('bpmn:DataStoreReference','data-store','bpmn-icon-data-store','数据存储引用'),'create.subprocess-expanded':createAction('bpmn:SubProcess','activity','bpmn-icon-subprocess-expanded',translate('扩展子流程'),{isExpanded:true}),'create.participant-expanded':{group:'collaboration',className:'bpmn-icon-participant',title:translate('工作池/参与者'),action:{dragstart:createParticipant,click:createParticipant}}});return actions;};},{"lodash/object/assign":547}],174:[function(require,module,exports){module.exports={__depends__:[require('diagram-js/lib/features/palette'),require('diagram-js/lib/features/create'),require('diagram-js/lib/features/space-tool'),require('diagram-js/lib/features/lasso-tool'),require('diagram-js/lib/features/hand-tool'),require('diagram-js/lib/i18n/translate'),require('../global-connect')],__init__:['paletteProvider'],paletteProvider:['type',require('./PaletteProvider')]};},{"../global-connect":123,"./PaletteProvider":173,"diagram-js/lib/features/create":264,"diagram-js/lib/features/hand-tool":275,"diagram-js/lib/features/lasso-tool":283,"diagram-js/lib/features/palette":320,"diagram-js/lib/features/space-tool":347,"diagram-js/lib/i18n/translate":355}],175:[function(require,module,exports){'use strict';var is=require('../../util/ModelUtil').is,isEventSubProcess=require('../../util/DiUtil').isEventSubProcess,getBusinessObject=require('../../util/ModelUtil').getBusinessObject,isExpanded=require('../../util/DiUtil').isExpanded,isDifferentType=require('./util/TypeUtil').isDifferentType;var forEach=require('lodash/collection/forEach'),filter=require('lodash/collection/filter'),reject=require('lodash/collection/reject');var replaceOptions=require('../replace/ReplaceOptions');function ReplaceMenuProvider(popupMenu,modeling,moddle,bpmnReplace,rules,translate){this._popupMenu=popupMenu;this._modeling=modeling;this._moddle=moddle;this._bpmnReplace=bpmnReplace;this._rules=rules;this._translate=translate;this.register();}ReplaceMenuProvider.$inject=['popupMenu','modeling','moddle','bpmnReplace','rules','translate'];ReplaceMenuProvider.prototype.register=function(){this._popupMenu.registerProvider('bpmn-replace',this);};ReplaceMenuProvider.prototype.getEntries=function(element){var businessObject=element.businessObject;var rules=this._rules;var entries;if(!rules.allowed('shape.replace',{element:element})){return[];}var differentType=isDifferentType(element);if(is(businessObject,'bpmn:StartEvent')&&!isEventSubProcess(businessObject.$parent)){entries=filter(replaceOptions.START_EVENT,differentType);return this._createEntries(element,entries);}if(is(businessObject,'bpmn:Participant')){entries=filter(replaceOptions.PARTICIPANT,function(entry){return isExpanded(businessObject)!==entry.target.isExpanded;});return this._createEntries(element,entries);}if(is(businessObject,'bpmn:StartEvent')&&isEventSubProcess(businessObject.$parent)){entries=filter(replaceOptions.EVENT_SUB_PROCESS_START_EVENT,function(entry){var target=entry.target;var isInterrupting=target.isInterrupting!==false;var isInterruptingEqual=getBusinessObject(element).isInterrupting===isInterrupting;return differentType(entry)||!differentType(entry)&&!isInterruptingEqual;});return this._createEntries(element,entries);}if(is(businessObject,'bpmn:EndEvent')){entries=filter(replaceOptions.END_EVENT,function(entry){var target=entry.target;if(target.eventDefinitionType=='bpmn:CancelEventDefinition'&&!is(businessObject.$parent,'bpmn:Transaction')){return false;}return differentType(entry);});return this._createEntries(element,entries);}if(is(businessObject,'bpmn:BoundaryEvent')){entries=filter(replaceOptions.BOUNDARY_EVENT,function(entry){var target=entry.target;if(target.eventDefinition=='bpmn:CancelEventDefinition'&&!is(businessObject.attachedToRef,'bpmn:Transaction')){return false;}var cancelActivity=target.cancelActivity!==false;var isCancelActivityEqual=businessObject.cancelActivity==cancelActivity;return differentType(entry)||!differentType(entry)&&!isCancelActivityEqual;});return this._createEntries(element,entries);}if(is(businessObject,'bpmn:IntermediateCatchEvent')||is(businessObject,'bpmn:IntermediateThrowEvent')){entries=filter(replaceOptions.INTERMEDIATE_EVENT,differentType);return this._createEntries(element,entries);}if(is(businessObject,'bpmn:Gateway')){entries=filter(replaceOptions.GATEWAY,differentType);return this._createEntries(element,entries);}if(is(businessObject,'bpmn:Transaction')){entries=filter(replaceOptions.TRANSACTION,differentType);return this._createEntries(element,entries);}if(isEventSubProcess(businessObject)&&isExpanded(businessObject)){entries=filter(replaceOptions.EVENT_SUB_PROCESS,differentType);return this._createEntries(element,entries);}if(is(businessObject,'bpmn:SubProcess')&&isExpanded(businessObject)){entries=filter(replaceOptions.SUBPROCESS_EXPANDED,differentType);return this._createEntries(element,entries);}if(is(businessObject,'bpmn:AdHocSubProcess')&&!isExpanded(businessObject)){entries=filter(replaceOptions.TASK,function(entry){var target=entry.target;var isTargetSubProcess=target.type==='bpmn:SubProcess';var isTargetExpanded=target.isExpanded===true;return isDifferentType(element,target)&&(!isTargetSubProcess||isTargetExpanded);});return this._createEntries(element,entries);}if(is(businessObject,'bpmn:SequenceFlow')){return this._createSequenceFlowEntries(element,replaceOptions.SEQUENCE_FLOW);}if(is(businessObject,'bpmn:FlowNode')){entries=filter(replaceOptions.TASK,differentType);if(is(businessObject,'bpmn:SubProcess')&&!isExpanded(businessObject)){entries=reject(entries,function(entry){return entry.label==='Sub Process (collapsed)';});}return this._createEntries(element,entries);}return[];};ReplaceMenuProvider.prototype.getHeaderEntries=function(element){var headerEntries=[];if(is(element,'bpmn:Activity')&&!isEventSubProcess(element)){headerEntries=headerEntries.concat(this._getLoopEntries(element));}if(is(element,'bpmn:SubProcess')&&!is(element,'bpmn:Transaction')&&!isEventSubProcess(element)){headerEntries.push(this._getAdHocEntry(element));}return headerEntries;};ReplaceMenuProvider.prototype._createEntries=function(element,replaceOptions){var menuEntries=[];var self=this;forEach(replaceOptions,function(definition){var entry=self._createMenuEntry(definition,element);menuEntries.push(entry);});return menuEntries;};ReplaceMenuProvider.prototype._createSequenceFlowEntries=function(element,replaceOptions){var businessObject=getBusinessObject(element);var menuEntries=[];var modeling=this._modeling,moddle=this._moddle;var self=this;forEach(replaceOptions,function(entry){switch(entry.actionName){case'replace-with-default-flow':if(businessObject.sourceRef.default!==businessObject&&(is(businessObject.sourceRef,'bpmn:ExclusiveGateway')||is(businessObject.sourceRef,'bpmn:InclusiveGateway')||is(businessObject.sourceRef,'bpmn:ComplexGateway')||is(businessObject.sourceRef,'bpmn:Activity'))){menuEntries.push(self._createMenuEntry(entry,element,function(){modeling.updateProperties(element.source,{default:businessObject});}));}break;case'replace-with-conditional-flow':if(!businessObject.conditionExpression&&is(businessObject.sourceRef,'bpmn:Activity')){menuEntries.push(self._createMenuEntry(entry,element,function(){var conditionExpression=moddle.create('bpmn:FormalExpression',{body:''});modeling.updateProperties(element,{conditionExpression:conditionExpression});}));}break;default:if(is(businessObject.sourceRef,'bpmn:Activity')&&businessObject.conditionExpression){return menuEntries.push(self._createMenuEntry(entry,element,function(){modeling.updateProperties(element,{conditionExpression:undefined});}));}if((is(businessObject.sourceRef,'bpmn:ExclusiveGateway')||is(businessObject.sourceRef,'bpmn:InclusiveGateway')||is(businessObject.sourceRef,'bpmn:ComplexGateway')||is(businessObject.sourceRef,'bpmn:Activity'))&&businessObject.sourceRef.default===businessObject){return menuEntries.push(self._createMenuEntry(entry,element,function(){modeling.updateProperties(element.source,{default:undefined});}));}}});return menuEntries;};ReplaceMenuProvider.prototype._createMenuEntry=function(definition,element,action){var translate=this._translate;var replaceElement=this._bpmnReplace.replaceElement;var replaceAction=function(){return replaceElement(element,definition.target);};action=action||replaceAction;var menuEntry={label:translate(definition.label),className:definition.className,id:definition.actionName,action:action};return menuEntry;};ReplaceMenuProvider.prototype._getLoopEntries=function(element){var self=this;var translate=this._translate;function toggleLoopEntry(event,entry){var loopCharacteristics;if(entry.active){loopCharacteristics=undefined;}else{loopCharacteristics=self._moddle.create(entry.options.loopCharacteristics);if(entry.options.isSequential){loopCharacteristics.isSequential=entry.options.isSequential;}}self._modeling.updateProperties(element,{loopCharacteristics:loopCharacteristics});}var businessObject=getBusinessObject(element),loopCharacteristics=businessObject.loopCharacteristics;var isSequential,isLoop,isParallel;if(loopCharacteristics){isSequential=loopCharacteristics.isSequential;isLoop=loopCharacteristics.isSequential===undefined;isParallel=loopCharacteristics.isSequential!==undefined&&!loopCharacteristics.isSequential;}var loopEntries=[{id:'toggle-parallel-mi',className:'bpmn-icon-parallel-mi-marker',title:translate('并行多实例'),active:isParallel,action:toggleLoopEntry,options:{loopCharacteristics:'bpmn:MultiInstanceLoopCharacteristics',isSequential:false}},{id:'toggle-sequential-mi',className:'bpmn-icon-sequential-mi-marker',title:translate('串行多实例'),active:isSequential,action:toggleLoopEntry,options:{loopCharacteristics:'bpmn:MultiInstanceLoopCharacteristics',isSequential:true}},{id:'toggle-loop',className:'bpmn-icon-loop-marker',title:translate('循环'),active:isLoop,action:toggleLoopEntry,options:{loopCharacteristics:'bpmn:StandardLoopCharacteristics'}}];return loopEntries;};ReplaceMenuProvider.prototype._getAdHocEntry=function(element){var translate=this._translate;var businessObject=getBusinessObject(element);var isAdHoc=is(businessObject,'bpmn:AdHocSubProcess');var replaceElement=this._bpmnReplace.replaceElement;var adHocEntry={id:'toggle-adhoc',className:'bpmn-icon-ad-hoc-marker',title:translate('Ad-hoc'),active:isAdHoc,action:function(event,entry){if(isAdHoc){return replaceElement(element,{type:'bpmn:SubProcess'});}else{return replaceElement(element,{type:'bpmn:AdHocSubProcess'});}}};return adHocEntry;};module.exports=ReplaceMenuProvider;},{"../../util/DiUtil":195,"../../util/ModelUtil":197,"../replace/ReplaceOptions":181,"./util/TypeUtil":177,"lodash/collection/filter":415,"lodash/collection/forEach":417,"lodash/collection/reject":422}],176:[function(require,module,exports){module.exports={__depends__:[require('diagram-js/lib/features/popup-menu'),require('../replace')],__init__:['replaceMenuProvider'],replaceMenuProvider:['type',require('./ReplaceMenuProvider')]};},{"../replace":182,"./ReplaceMenuProvider":175,"diagram-js/lib/features/popup-menu":322}],177:[function(require,module,exports){'use strict';var getBusinessObject=require('../../../util/ModelUtil').getBusinessObject;var isExpanded=require('../../../util/DiUtil').isExpanded;function isDifferentType(element){return function(entry){var target=entry.target;var businessObject=getBusinessObject(element),eventDefinition=businessObject.eventDefinitions&&businessObject.eventDefinitions[0];var isTypeEqual=businessObject.$type===target.type;var isEventDefinitionEqual=((eventDefinition&&eventDefinition.$type)===target.eventDefinitionType);var isTriggeredByEventEqual=(businessObject.triggeredByEvent===target.triggeredByEvent);var isExpandedEqual=(target.isExpanded===undefined||target.isExpanded===isExpanded(businessObject));return!isTypeEqual||!isEventDefinitionEqual||!isTriggeredByEventEqual||!isExpandedEqual;};}module.exports.isDifferentType=isDifferentType;},{"../../../util/DiUtil":195,"../../../util/ModelUtil":197}],178:[function(require,module,exports){'use strict';var CommandInterceptor=require('diagram-js/lib/command/CommandInterceptor');var inherits=require('inherits');var assign=require('lodash/object/assign'),forEach=require('lodash/collection/forEach');var domQuery=require('min-dom/lib/query');var svgAttr=require('tiny-svg/lib/attr');var LOW_PRIORITY=250;function BpmnReplacePreview(eventBus,elementRegistry,elementFactory,canvas,previewSupport){CommandInterceptor.call(this,eventBus);function replaceVisual(context){var replacements=context.canExecute.replacements;forEach(replacements,function(replacement){var id=replacement.oldElementId;var newElement={type:replacement.newElementType};if(context.visualReplacements[id]){return;}var element=elementRegistry.get(id);assign(newElement,{x:element.x,y:element.y});var tempShape=elementFactory.createShape(newElement);canvas.addShape(tempShape,element.parent);var gfx=domQuery('[data-element-id='+element.id+']',context.dragGroup);if(gfx){svgAttr(gfx,{display:'none'});}var dragger=previewSupport.addDragger(tempShape,context.dragGroup);context.visualReplacements[id]=dragger;canvas.removeShape(tempShape);});}function restoreVisual(context){var visualReplacements=context.visualReplacements;forEach(visualReplacements,function(dragger,id){var originalGfx=domQuery('[data-element-id='+id+']',context.dragGroup);if(originalGfx){svgAttr(originalGfx,{display:'inline'});}dragger.remove();if(visualReplacements[id]){delete visualReplacements[id];}});}eventBus.on('shape.move.move',LOW_PRIORITY,function(event){var context=event.context,canExecute=context.canExecute;if(!context.visualReplacements){context.visualReplacements={};}if(canExecute.replacements){replaceVisual(context);}else{restoreVisual(context);}});}BpmnReplacePreview.$inject=['eventBus','elementRegistry','elementFactory','canvas','previewSupport'];inherits(BpmnReplacePreview,CommandInterceptor);module.exports=BpmnReplacePreview;},{"diagram-js/lib/command/CommandInterceptor":226,"inherits":398,"lodash/collection/forEach":417,"lodash/object/assign":547,"min-dom/lib/query":569,"tiny-svg/lib/attr":609}],179:[function(require,module,exports){module.exports={__depends__:[require('diagram-js/lib/features/preview-support')],__init__:['bpmnReplacePreview'],bpmnReplacePreview:['type',require('./BpmnReplacePreview')]};},{"./BpmnReplacePreview":178,"diagram-js/lib/features/preview-support":324}],180:[function(require,module,exports){'use strict';var pick=require('lodash/object/pick'),assign=require('lodash/object/assign'),intersection=require('lodash/array/intersection'),filter=require('lodash/collection/filter'),has=require('lodash/object/has');var is=require('../../util/ModelUtil').is,isExpanded=require('../../util/DiUtil').isExpanded,isEventSubProcess=require('../../util/DiUtil').isEventSubProcess,ModelCloneUtils=require('../../util/model/ModelCloneUtils'),getProperties=ModelCloneUtils.getProperties;var IGNORED_PROPERTIES=ModelCloneUtils.IGNORED_PROPERTIES;var ModelCloneHelper=require('../../util/model/ModelCloneHelper');var CUSTOM_PROPERTIES=['cancelActivity','instantiate','eventGatewayType','triggeredByEvent','isInterrupting'];function toggeling(element,target){var oldCollapsed=has(element,'collapsed')?element.collapsed:!isExpanded(element);var targetCollapsed;if(has(target,'collapsed')||has(target,'isExpanded')){targetCollapsed=has(target,'collapsed')?target.collapsed:!target.isExpanded;}else{targetCollapsed=oldCollapsed;}if(oldCollapsed!==targetCollapsed){element.collapsed=oldCollapsed;return true;}return false;}function BpmnReplace(bpmnFactory,replace,selection,modeling,eventBus){var helper=new ModelCloneHelper(eventBus);function replaceElement(element,target,hints){hints=hints||{};var type=target.type,oldBusinessObject=element.businessObject;if(is(oldBusinessObject,'bpmn:SubProcess')){if(type==='bpmn:SubProcess'){if(toggeling(element,target)){modeling.toggleCollapse(element);return element;}}}var newBusinessObject=bpmnFactory.create(type);var newElement={type:type,businessObject:newBusinessObject};var elementProps=getProperties(oldBusinessObject.$descriptor),newElementProps=getProperties(newBusinessObject.$descriptor,true),properties=intersection(elementProps,newElementProps);assign(newBusinessObject,pick(target,CUSTOM_PROPERTIES));properties=filter(properties,function(property){var propName=property.replace(/bpmn:/,'');if(newBusinessObject[property]!==undefined){return false;}if(propName==='loopCharacteristics'){return!isEventSubProcess(newBusinessObject);}if((propName==='processRef'&&target.isExpanded===false)||propName==='triggeredByEvent'||propName==='eventDefinitions'){return false;}return IGNORED_PROPERTIES.indexOf(propName)===-1;});newBusinessObject=helper.clone(oldBusinessObject,newBusinessObject,properties);if(target.eventDefinitionType){newElement.eventDefinitionType=target.eventDefinitionType;}if(is(oldBusinessObject,'bpmn:Activity')){if(is(oldBusinessObject,'bpmn:SubProcess')){newElement.isExpanded=isExpanded(oldBusinessObject);}else if(has(target,'isExpanded')){newElement.isExpanded=target.isExpanded;}if((isExpanded(oldBusinessObject)&&!is(oldBusinessObject,'bpmn:Task'))&&newElement.isExpanded){newElement.width=element.width;newElement.height=element.height;}}if(is(oldBusinessObject,'bpmn:Participant')){if(target.isExpanded===true){newBusinessObject.processRef=bpmnFactory.create('bpmn:Process');}else{hints.moveChildren=false;}newElement.width=element.width;newElement.height=element.height;}newBusinessObject.name=oldBusinessObject.name;if((is(oldBusinessObject,'bpmn:ExclusiveGateway')||is(oldBusinessObject,'bpmn:InclusiveGateway')||is(oldBusinessObject,'bpmn:Activity'))&&(is(newBusinessObject,'bpmn:ExclusiveGateway')||is(newBusinessObject,'bpmn:InclusiveGateway')||is(newBusinessObject,'bpmn:Activity'))){newBusinessObject.default=oldBusinessObject.default;}if('fill'in oldBusinessObject.di||'stroke'in oldBusinessObject.di){assign(newElement,{colors:pick(oldBusinessObject.di,['fill','stroke'])});}newElement=replace.replaceElement(element,newElement,hints);if(hints.select!==false){selection.select(newElement);}return newElement;}this.replaceElement=replaceElement;}BpmnReplace.$inject=['bpmnFactory','replace','selection','modeling','eventBus'];module.exports=BpmnReplace;},{"../../util/DiUtil":195,"../../util/ModelUtil":197,"../../util/model/ModelCloneHelper":199,"../../util/model/ModelCloneUtils":200,"lodash/array/intersection":405,"lodash/collection/filter":415,"lodash/object/assign":547,"lodash/object/has":549,"lodash/object/pick":555}],181:[function(require,module,exports){'use strict';module.exports.START_EVENT=[{label:'开始事件',actionName:'replace-with-none-start',className:'bpmn-icon-start-event-none',target:{type:'bpmn:StartEvent'}},{label:'中间抛出事件',actionName:'replace-with-none-intermediate-throwing',className:'bpmn-icon-intermediate-event-none',target:{type:'bpmn:IntermediateThrowEvent'}},{label:'结束事件',actionName:'replace-with-none-end',className:'bpmn-icon-end-event-none',target:{type:'bpmn:EndEvent'}},{label:'消息开始事件',actionName:'replace-with-message-start',className:'bpmn-icon-start-event-message',target:{type:'bpmn:StartEvent',eventDefinitionType:'bpmn:MessageEventDefinition'}},{label:'定时器开始事件',actionName:'replace-with-timer-start',className:'bpmn-icon-start-event-timer',target:{type:'bpmn:StartEvent',eventDefinitionType:'bpmn:TimerEventDefinition'}},{label:'条件开始事件',actionName:'replace-with-conditional-start',className:'bpmn-icon-start-event-condition',target:{type:'bpmn:StartEvent',eventDefinitionType:'bpmn:ConditionalEventDefinition'}},{label:'信号开始事件',actionName:'replace-with-signal-start',className:'bpmn-icon-start-event-signal',target:{type:'bpmn:StartEvent',eventDefinitionType:'bpmn:SignalEventDefinition'}}];module.exports.INTERMEDIATE_EVENT=[{label:'开始事件',actionName:'replace-with-none-start',className:'bpmn-icon-start-event-none',target:{type:'bpmn:StartEvent'}},{label:'中间抛出事件',actionName:'replace-with-none-intermediate-throw',className:'bpmn-icon-intermediate-event-none',target:{type:'bpmn:IntermediateThrowEvent'}},{label:'结束事件',actionName:'replace-with-none-end',className:'bpmn-icon-end-event-none',target:{type:'bpmn:EndEvent'}},{label:'消息中间捕获事件',actionName:'replace-with-message-intermediate-catch',className:'bpmn-icon-intermediate-event-catch-message',target:{type:'bpmn:IntermediateCatchEvent',eventDefinitionType:'bpmn:MessageEventDefinition'}},{label:'消息中间抛出事件',actionName:'replace-with-message-intermediate-throw',className:'bpmn-icon-intermediate-event-throw-message',target:{type:'bpmn:IntermediateThrowEvent',eventDefinitionType:'bpmn:MessageEventDefinition'}},{label:'定时器中间捕获事件',actionName:'replace-with-timer-intermediate-catch',className:'bpmn-icon-intermediate-event-catch-timer',target:{type:'bpmn:IntermediateCatchEvent',eventDefinitionType:'bpmn:TimerEventDefinition'}},{label:'升级中间抛出事件',actionName:'replace-with-escalation-intermediate-throw',className:'bpmn-icon-intermediate-event-throw-escalation',target:{type:'bpmn:IntermediateThrowEvent',eventDefinitionType:'bpmn:EscalationEventDefinition'}},{label:'条件中间捕获事件',actionName:'replace-with-conditional-intermediate-catch',className:'bpmn-icon-intermediate-event-catch-condition',target:{type:'bpmn:IntermediateCatchEvent',eventDefinitionType:'bpmn:ConditionalEventDefinition'}},{label:'链接中间捕获事件',actionName:'replace-with-link-intermediate-catch',className:'bpmn-icon-intermediate-event-catch-link',target:{type:'bpmn:IntermediateCatchEvent',eventDefinitionType:'bpmn:LinkEventDefinition'}},{label:'链接中间抛出事件',actionName:'replace-with-link-intermediate-throw',className:'bpmn-icon-intermediate-event-throw-link',target:{type:'bpmn:IntermediateThrowEvent',eventDefinitionType:'bpmn:LinkEventDefinition'}},{label:'补偿中间抛出事件',actionName:'replace-with-compensation-intermediate-throw',className:'bpmn-icon-intermediate-event-throw-compensation',target:{type:'bpmn:IntermediateThrowEvent',eventDefinitionType:'bpmn:CompensateEventDefinition'}},{label:'信号中间捕获事件',actionName:'replace-with-signal-intermediate-catch',className:'bpmn-icon-intermediate-event-catch-signal',target:{type:'bpmn:IntermediateCatchEvent',eventDefinitionType:'bpmn:SignalEventDefinition'}},{label:'信号中间抛出事件',actionName:'replace-with-signal-intermediate-throw',className:'bpmn-icon-intermediate-event-throw-signal',target:{type:'bpmn:IntermediateThrowEvent',eventDefinitionType:'bpmn:SignalEventDefinition'}}];module.exports.END_EVENT=[{label:'开始事件',actionName:'replace-with-none-start',className:'bpmn-icon-start-event-none',target:{type:'bpmn:StartEvent'}},{label:'中间抛出事件',actionName:'replace-with-none-intermediate-throw',className:'bpmn-icon-intermediate-event-none',target:{type:'bpmn:IntermediateThrowEvent'}},{label:'结束事件',actionName:'replace-with-none-end',className:'bpmn-icon-end-event-none',target:{type:'bpmn:EndEvent'}},{label:'消息结束事件',actionName:'replace-with-message-end',className:'bpmn-icon-end-event-message',target:{type:'bpmn:EndEvent',eventDefinitionType:'bpmn:MessageEventDefinition'}},{label:'升级结束事件',actionName:'replace-with-escalation-end',className:'bpmn-icon-end-event-escalation',target:{type:'bpmn:EndEvent',eventDefinitionType:'bpmn:EscalationEventDefinition'}},{label:'错误结束事件',actionName:'replace-with-error-end',className:'bpmn-icon-end-event-error',target:{type:'bpmn:EndEvent',eventDefinitionType:'bpmn:ErrorEventDefinition'}},{label:'删除结束事件',actionName:'replace-with-cancel-end',className:'bpmn-icon-end-event-cancel',target:{type:'bpmn:EndEvent',eventDefinitionType:'bpmn:CancelEventDefinition'}},{label:'补偿结束事件',actionName:'replace-with-compensation-end',className:'bpmn-icon-end-event-compensation',target:{type:'bpmn:EndEvent',eventDefinitionType:'bpmn:CompensateEventDefinition'}},{label:'信号结束事件',actionName:'replace-with-signal-end',className:'bpmn-icon-end-event-signal',target:{type:'bpmn:EndEvent',eventDefinitionType:'bpmn:SignalEventDefinition'}},{label:'终端结束事件',actionName:'replace-with-terminate-end',className:'bpmn-icon-end-event-terminate',target:{type:'bpmn:EndEvent',eventDefinitionType:'bpmn:TerminateEventDefinition'}}];module.exports.GATEWAY=[{label:'排他网关',actionName:'replace-with-exclusive-gateway',className:'bpmn-icon-gateway-xor',target:{type:'bpmn:ExclusiveGateway'}},{label:'并行网关',actionName:'replace-with-parallel-gateway',className:'bpmn-icon-gateway-parallel',target:{type:'bpmn:ParallelGateway'}},{label:'包含网关',actionName:'replace-with-inclusive-gateway',className:'bpmn-icon-gateway-or',target:{type:'bpmn:InclusiveGateway'}},{label:'复杂网关',actionName:'replace-with-complex-gateway',className:'bpmn-icon-gateway-complex',target:{type:'bpmn:ComplexGateway'}},{label:'基于事件的网关',actionName:'replace-with-event-based-gateway',className:'bpmn-icon-gateway-eventbased',target:{type:'bpmn:EventBasedGateway',instantiate:false,eventGatewayType:'Exclusive'}}];module.exports.SUBPROCESS_EXPANDED=[{label:'事务',actionName:'replace-with-transaction',className:'bpmn-icon-transaction',target:{type:'bpmn:Transaction',isExpanded:true}},{label:'事件子流程',actionName:'replace-with-event-subprocess',className:'bpmn-icon-event-subprocess-expanded',target:{type:'bpmn:SubProcess',triggeredByEvent:true,isExpanded:true}},{label:'子流程(折叠)',actionName:'replace-with-collapsed-subprocess',className:'bpmn-icon-subprocess-collapsed',target:{type:'bpmn:SubProcess',isExpanded:false}}];module.exports.TRANSACTION=[{label:'子流程',actionName:'replace-with-subprocess',className:'bpmn-icon-subprocess-expanded',target:{type:'bpmn:SubProcess',isExpanded:true}},{label:'事件子流程',actionName:'replace-with-event-subprocess',className:'bpmn-icon-event-subprocess-expanded',target:{type:'bpmn:SubProcess',triggeredByEvent:true,isExpanded:true}}];module.exports.EVENT_SUB_PROCESS=[{label:'子流程',actionName:'replace-with-subprocess',className:'bpmn-icon-subprocess-expanded',target:{type:'bpmn:SubProcess',isExpanded:true}},{label:'事务',actionName:'replace-with-transaction',className:'bpmn-icon-transaction',target:{type:'bpmn:Transaction',isExpanded:true}}];module.exports.TASK=[{label:'任务',actionName:'replace-with-task',className:'bpmn-icon-task',target:{type:'bpmn:Task'}},{label:'发送任务',actionName:'replace-with-send-task',className:'bpmn-icon-send',target:{type:'bpmn:SendTask'}},{label:'接收任务',actionName:'replace-with-receive-task',className:'bpmn-icon-receive',target:{type:'bpmn:ReceiveTask'}},{label:'用户任务',actionName:'replace-with-user-task',className:'bpmn-icon-user',target:{type:'bpmn:UserTask'}},{label:'手工任务',actionName:'replace-with-manual-task',className:'bpmn-icon-manual',target:{type:'bpmn:ManualTask'}},{label:'业务规则任务',actionName:'replace-with-rule-task',className:'bpmn-icon-business-rule',target:{type:'bpmn:BusinessRuleTask'}},{label:'服务任务',actionName:'replace-with-service-task',className:'bpmn-icon-service',target:{type:'bpmn:ServiceTask'}},{label:'脚本任务',actionName:'replace-with-script-task',className:'bpmn-icon-script',target:{type:'bpmn:ScriptTask'}},{label:'呼叫活动',actionName:'replace-with-call-activity',className:'bpmn-icon-call-activity',target:{type:'bpmn:CallActivity'}},{label:'子流程(折叠)',actionName:'replace-with-collapsed-subprocess',className:'bpmn-icon-subprocess-collapsed',target:{type:'bpmn:SubProcess',isExpanded:false}},{label:'子流程(扩展)',actionName:'replace-with-expanded-subprocess',className:'bpmn-icon-subprocess-expanded',target:{type:'bpmn:SubProcess',isExpanded:true}}];module.exports.BOUNDARY_EVENT=[{label:'消息边界事件',actionName:'replace-with-message-boundary',className:'bpmn-icon-intermediate-event-catch-message',target:{type:'bpmn:BoundaryEvent',eventDefinitionType:'bpmn:MessageEventDefinition'}},{label:'定时器边界事件',actionName:'replace-with-timer-boundary',className:'bpmn-icon-intermediate-event-catch-timer',target:{type:'bpmn:BoundaryEvent',eventDefinitionType:'bpmn:TimerEventDefinition'}},{label:'升级边界事件',actionName:'replace-with-escalation-boundary',className:'bpmn-icon-intermediate-event-catch-escalation',target:{type:'bpmn:BoundaryEvent',eventDefinitionType:'bpmn:EscalationEventDefinition'}},{label:'条件边界事件',actionName:'replace-with-conditional-boundary',className:'bpmn-icon-intermediate-event-catch-condition',target:{type:'bpmn:BoundaryEvent',eventDefinitionType:'bpmn:ConditionalEventDefinition'}},{label:'错误边界事件',actionName:'replace-with-error-boundary',className:'bpmn-icon-intermediate-event-catch-error',target:{type:'bpmn:BoundaryEvent',eventDefinitionType:'bpmn:ErrorEventDefinition'}},{label:'删除边界事件',actionName:'replace-with-cancel-boundary',className:'bpmn-icon-intermediate-event-catch-cancel',target:{type:'bpmn:BoundaryEvent',eventDefinitionType:'bpmn:CancelEventDefinition'}},{label:'信号边界事件',actionName:'replace-with-signal-boundary',className:'bpmn-icon-intermediate-event-catch-signal',target:{type:'bpmn:BoundaryEvent',eventDefinitionType:'bpmn:SignalEventDefinition'}},{label:'补偿边界事件',actionName:'replace-with-compensation-boundary',className:'bpmn-icon-intermediate-event-catch-compensation',target:{type:'bpmn:BoundaryEvent',eventDefinitionType:'bpmn:CompensateEventDefinition'}},{label:'消息边界事件(非中断)',actionName:'replace-with-non-interrupting-message-boundary',className:'bpmn-icon-intermediate-event-catch-non-interrupting-message',target:{type:'bpmn:BoundaryEvent',eventDefinitionType:'bpmn:MessageEventDefinition',cancelActivity:false}},{label:'定时器边界事件(非中断)',actionName:'replace-with-non-interrupting-timer-boundary',className:'bpmn-icon-intermediate-event-catch-non-interrupting-timer',target:{type:'bpmn:BoundaryEvent',eventDefinitionType:'bpmn:TimerEventDefinition',cancelActivity:false}},{label:'升级边界事件(非中断)',actionName:'replace-with-non-interrupting-escalation-boundary',className:'bpmn-icon-intermediate-event-catch-non-interrupting-escalation',target:{type:'bpmn:BoundaryEvent',eventDefinitionType:'bpmn:EscalationEventDefinition',cancelActivity:false}},{label:'条件边界事件(非中断)',actionName:'replace-with-non-interrupting-conditional-boundary',className:'bpmn-icon-intermediate-event-catch-non-interrupting-condition',target:{type:'bpmn:BoundaryEvent',eventDefinitionType:'bpmn:ConditionalEventDefinition',cancelActivity:false}},{label:'信号边界事件(非中断)',actionName:'replace-with-non-interrupting-signal-boundary',className:'bpmn-icon-intermediate-event-catch-non-interrupting-signal',target:{type:'bpmn:BoundaryEvent',eventDefinitionType:'bpmn:SignalEventDefinition',cancelActivity:false}}];module.exports.EVENT_SUB_PROCESS_START_EVENT=[{label:'消息开始事件',actionName:'replace-with-message-start',className:'bpmn-icon-start-event-message',target:{type:'bpmn:StartEvent',eventDefinitionType:'bpmn:MessageEventDefinition'}},{label:'定时器开始事件',actionName:'replace-with-timer-start',className:'bpmn-icon-start-event-timer',target:{type:'bpmn:StartEvent',eventDefinitionType:'bpmn:TimerEventDefinition'}},{label:'条件开始事件',actionName:'replace-with-conditional-start',className:'bpmn-icon-start-event-condition',target:{type:'bpmn:StartEvent',eventDefinitionType:'bpmn:ConditionalEventDefinition'}},{label:'信号开始事件',actionName:'replace-with-signal-start',className:'bpmn-icon-start-event-signal',target:{type:'bpmn:StartEvent',eventDefinitionType:'bpmn:SignalEventDefinition'}},{label:'错误开始事件',actionName:'replace-with-error-start',className:'bpmn-icon-start-event-error',target:{type:'bpmn:StartEvent',eventDefinitionType:'bpmn:ErrorEventDefinition'}},{label:'升级开始事件',actionName:'replace-with-escalation-start',className:'bpmn-icon-start-event-escalation',target:{type:'bpmn:StartEvent',eventDefinitionType:'bpmn:EscalationEventDefinition'}},{label:'补偿开始事件',actionName:'replace-with-compensation-start',className:'bpmn-icon-start-event-compensation',target:{type:'bpmn:StartEvent',eventDefinitionType:'bpmn:CompensateEventDefinition'}},{label:'消息开始事件(非中断)',actionName:'replace-with-non-interrupting-message-start',className:'bpmn-icon-start-event-non-interrupting-message',target:{type:'bpmn:StartEvent',eventDefinitionType:'bpmn:MessageEventDefinition',isInterrupting:false}},{label:'定时器开始事件(非中断)',actionName:'replace-with-non-interrupting-timer-start',className:'bpmn-icon-start-event-non-interrupting-timer',target:{type:'bpmn:StartEvent',eventDefinitionType:'bpmn:TimerEventDefinition',isInterrupting:false}},{label:'条件开始事件(非中断)',actionName:'replace-with-non-interrupting-conditional-start',className:'bpmn-icon-start-event-non-interrupting-condition',target:{type:'bpmn:StartEvent',eventDefinitionType:'bpmn:ConditionalEventDefinition',isInterrupting:false}},{label:'信号开始事件(非中断)',actionName:'replace-with-non-interrupting-signal-start',className:'bpmn-icon-start-event-non-interrupting-signal',target:{type:'bpmn:StartEvent',eventDefinitionType:'bpmn:SignalEventDefinition',isInterrupting:false}},{label:'升级开始事件(非中断)',actionName:'replace-with-non-interrupting-escalation-start',className:'bpmn-icon-start-event-non-interrupting-escalation',target:{type:'bpmn:StartEvent',eventDefinitionType:'bpmn:EscalationEventDefinition',isInterrupting:false}}];module.exports.SEQUENCE_FLOW=[{label:'顺序流',actionName:'replace-with-sequence-flow',className:'bpmn-icon-connection'},{label:'默认流',actionName:'replace-with-default-flow',className:'bpmn-icon-default-flow'},{label:'条件流',actionName:'replace-with-conditional-flow',className:'bpmn-icon-conditional-flow'}];module.exports.PARTICIPANT=[{label:'扩展池',actionName:'replace-with-expanded-pool',className:'bpmn-icon-participant',target:{type:'bpmn:Participant',isExpanded:true}},{label:'折叠池',actionName:'replace-with-collapsed-pool',className:'bpmn-icon-lane',target:{type:'bpmn:Participant',isExpanded:false}}];},{}],182:[function(require,module,exports){module.exports={__depends__:[require('diagram-js/lib/features/replace'),require('diagram-js/lib/features/selection')],bpmnReplace:['type',require('./BpmnReplace')]};},{"./BpmnReplace":180,"diagram-js/lib/features/replace":326,"diagram-js/lib/features/selection":340}],183:[function(require,module,exports){'use strict';var find=require('lodash/collection/find'),any=require('lodash/collection/any'),every=require('lodash/collection/every'),filter=require('lodash/collection/filter'),forEach=require('lodash/collection/forEach'),inherits=require('inherits');var is=require('../../util/ModelUtil').is,isAny=require('../modeling/util/ModelingUtil').isAny,getBusinessObject=require('../../util/ModelUtil').getBusinessObject,isExpanded=require('../../util/DiUtil').isExpanded,isEventSubProcess=require('../../util/DiUtil').isEventSubProcess,isInterrupting=require('../../util/DiUtil').isInterrupting,hasErrorEventDefinition=require('../../util/DiUtil').hasErrorEventDefinition,hasEscalationEventDefinition=require('../../util/DiUtil').hasEscalationEventDefinition,hasCompensateEventDefinition=require('../../util/DiUtil').hasCompensateEventDefinition;var RuleProvider=require('diagram-js/lib/features/rules/RuleProvider');var isBoundaryAttachment=require('../snapping/BpmnSnappingUtil').getBoundaryAttachment;function BpmnRules(eventBus){RuleProvider.call(this,eventBus);}inherits(BpmnRules,RuleProvider);BpmnRules.$inject=['eventBus'];module.exports=BpmnRules;BpmnRules.prototype.init=function(){this.addRule('connection.create',function(context){var source=context.source,target=context.target;return canConnect(source,target);});this.addRule('connection.reconnectStart',function(context){var connection=context.connection,source=context.hover||context.source,target=connection.target;return canConnect(source,target,connection);});this.addRule('connection.reconnectEnd',function(context){var connection=context.connection,source=connection.source,target=context.hover||context.target;return canConnect(source,target,connection);});this.addRule('connection.updateWaypoints',function(context){return null;});this.addRule('shape.resize',function(context){var shape=context.shape,newBounds=context.newBounds;return canResize(shape,newBounds);});this.addRule('elements.move',function(context){var target=context.target,shapes=context.shapes,position=context.position;return canAttach(shapes,target,null,position)||canReplace(shapes,target,position)||canMove(shapes,target,position)||canInsert(shapes,target,position);});this.addRule(['shape.create','shape.append'],function(context){var target=context.target,shape=context.shape,source=context.source,position=context.position;return canAttach([shape],target,source,position)||canCreate(shape,target,source,position);});this.addRule('element.copy',function(context){var collection=context.collection,element=context.element;return canCopy(collection,element);});this.addRule('element.paste',function(context){var parent=context.parent,element=context.element,position=context.position,source=context.source,target=context.target;if(source||target){return canConnect(source,target);}return canAttach([element],parent,null,position)||canCreate(element,parent,null,position);});this.addRule('elements.paste',function(context){var tree=context.tree,target=context.target;return canPaste(tree,target);});this.addRule(['elements.delete'],function(context){return filter(context.elements,function(e){return!isLabel(e);});});};BpmnRules.prototype.canConnectMessageFlow=canConnectMessageFlow;BpmnRules.prototype.canConnectSequenceFlow=canConnectSequenceFlow;BpmnRules.prototype.canConnectDataAssociation=canConnectDataAssociation;BpmnRules.prototype.canConnectAssociation=canConnectAssociation;BpmnRules.prototype.canMove=canMove;BpmnRules.prototype.canAttach=canAttach;BpmnRules.prototype.canReplace=canReplace;BpmnRules.prototype.canDrop=canDrop;BpmnRules.prototype.canInsert=canInsert;BpmnRules.prototype.canCreate=canCreate;BpmnRules.prototype.canConnect=canConnect;BpmnRules.prototype.canResize=canResize;BpmnRules.prototype.canCopy=canCopy;function nonExistantOrLabel(element){return!element||isLabel(element);}function isSame(a,b){return a===b;}function getOrganizationalParent(element){var bo=getBusinessObject(element);while(bo&&!is(bo,'bpmn:Process')){if(is(bo,'bpmn:Participant')){return bo.processRef||bo;}bo=bo.$parent;}return bo;}function isTextAnnotation(element){return is(element,'bpmn:TextAnnotation');}function isCompensationBoundary(element){return is(element,'bpmn:BoundaryEvent')&&hasEventDefinition(element,'bpmn:CompensateEventDefinition');}function isForCompensation(e){return getBusinessObject(e).isForCompensation;}function isSameOrganization(a,b){var parentA=getOrganizationalParent(a),parentB=getOrganizationalParent(b);return parentA===parentB;}function isMessageFlowSource(element){return is(element,'bpmn:InteractionNode')&&!isForCompensation(element)&&(!is(element,'bpmn:Event')||(is(element,'bpmn:ThrowEvent')&&hasEventDefinitionOrNone(element,'bpmn:MessageEventDefinition')));}function isMessageFlowTarget(element){return is(element,'bpmn:InteractionNode')&&!isForCompensation(element)&&(!is(element,'bpmn:Event')||(is(element,'bpmn:CatchEvent')&&hasEventDefinitionOrNone(element,'bpmn:MessageEventDefinition')));}function getScopeParent(element){var bo=getBusinessObject(element);if(is(bo,'bpmn:Participant')){return null;}while(bo){bo=bo.$parent;if(is(bo,'bpmn:FlowElementsContainer')){return bo;}}return bo;}function isSameScope(a,b){var scopeParentA=getScopeParent(a),scopeParentB=getScopeParent(b);return scopeParentA&&(scopeParentA===scopeParentB);}function hasEventDefinition(element,eventDefinition){var bo=getBusinessObject(element);return!!find(bo.eventDefinitions||[],function(definition){return is(definition,eventDefinition);});}function hasEventDefinitionOrNone(element,eventDefinition){var bo=getBusinessObject(element);return(bo.eventDefinitions||[]).every(function(definition){return is(definition,eventDefinition);});}function isSequenceFlowSource(element){return is(element,'bpmn:FlowNode')&&!is(element,'bpmn:EndEvent')&&!isEventSubProcess(element)&&!(is(element,'bpmn:IntermediateThrowEvent')&&hasEventDefinition(element,'bpmn:LinkEventDefinition'))&&!isCompensationBoundary(element)&&!isForCompensation(element);}function isSequenceFlowTarget(element){return is(element,'bpmn:FlowNode')&&!is(element,'bpmn:StartEvent')&&!is(element,'bpmn:BoundaryEvent')&&!isEventSubProcess(element)&&!(is(element,'bpmn:IntermediateCatchEvent')&&hasEventDefinition(element,'bpmn:LinkEventDefinition'))&&!isForCompensation(element);}function isEventBasedTarget(element){return is(element,'bpmn:ReceiveTask')||(is(element,'bpmn:IntermediateCatchEvent')&&(hasEventDefinition(element,'bpmn:MessageEventDefinition')||hasEventDefinition(element,'bpmn:TimerEventDefinition')||hasEventDefinition(element,'bpmn:ConditionalEventDefinition')||hasEventDefinition(element,'bpmn:SignalEventDefinition')));}function isLabel(element){return element.labelTarget;}function isConnection(element){return element.waypoints;}function getParents(element){var parents=[];while(element){element=element.parent;if(element){parents.push(element);}}return parents;}function isParent(possibleParent,element){var allParents=getParents(element);return allParents.indexOf(possibleParent)!==-1;}function canConnect(source,target,connection){if(nonExistantOrLabel(source)||nonExistantOrLabel(target)){return null;}if(isSame(source,target)){return false;}if(!is(connection,'bpmn:DataAssociation')){if(canConnectMessageFlow(source,target)){return{type:'bpmn:MessageFlow'};}if(canConnectSequenceFlow(source,target)){return{type:'bpmn:SequenceFlow'};}}var connectDataAssociation=canConnectDataAssociation(source,target);if(connectDataAssociation){return connectDataAssociation;}if(isCompensationBoundary(source)&&isForCompensation(target)){return{type:'bpmn:Association',associationDirection:'One'};}if(canConnectAssociation(source,target)){return{type:'bpmn:Association'};}return false;}function canDrop(element,target,position){if(isLabel(element)&&!isConnection(target)){return true;}if(is(target,'bpmn:Participant')&&!isExpanded(target)){return false;}if(is(element,'bpmn:Participant')){return is(target,'bpmn:Process')||is(target,'bpmn:Collaboration');}if(is(element,'bpmn:Lane')){return is(target,'bpmn:Participant')||is(target,'bpmn:Lane');}if(is(element,'bpmn:BoundaryEvent')){return false;}if(is(element,'bpmn:FlowElement')){if(is(target,'bpmn:FlowElementsContainer')){return isExpanded(target);}return isAny(target,['bpmn:Participant','bpmn:Lane']);}if(isAny(element,['bpmn:Artifact','bpmn:DataAssociation'])){return isAny(target,['bpmn:Collaboration','bpmn:Lane','bpmn:Participant','bpmn:Process','bpmn:SubProcess']);}if(is(element,'bpmn:MessageFlow')){return is(target,'bpmn:Collaboration')||element.source.parent==target||element.target.parent==target;}return false;}function canPaste(tree,target){var topLevel=tree[0],participants;if(is(target,'bpmn:Collaboration')){return every(topLevel,function(e){return e.type==='bpmn:Participant';});}if(is(target,'bpmn:Process')){participants=any(topLevel,function(e){return e.type==='bpmn:Participant';});return!(participants&&target.children.length>0);}if(is(target,'bpmn:Participant')&&!isExpanded(target)){return false;}if(is(target,'bpmn:FlowElementsContainer')){return isExpanded(target);}return isAny(target,['bpmn:Collaboration','bpmn:Lane','bpmn:Participant','bpmn:Process','bpmn:SubProcess']);}function isBoundaryEvent(element){return!isLabel(element)&&is(element,'bpmn:BoundaryEvent');}function isLane(element){return is(element,'bpmn:Lane');}function isBoundaryCandidate(element){return isBoundaryEvent(element)||(is(element,'bpmn:IntermediateThrowEvent')&&!element.parent);}function canAttach(elements,target,source,position){if(!Array.isArray(elements)){elements=[elements];}if(source){return false;}if(elements.length!==1){return false;}var element=elements[0];if(isLabel(element)){return false;}if(!isBoundaryCandidate(element)){return false;}if(!target){return true;}if(isEventSubProcess(target)){return false;}if(!is(target,'bpmn:Activity')||isForCompensation(target)){return false;}if(position&&!isBoundaryAttachment(position,target)){return false;}return'attach';}function canReplace(elements,target,position){if(!target){return false;}var canExecute={replacements:[]};forEach(elements,function(element){if(!isEventSubProcess(target)){if(is(element,'bpmn:StartEvent')&&element.type!=='label'&&canDrop(element,target)){if(!isInterrupting(element)){canExecute.replacements.push({oldElementId:element.id,newElementType:'bpmn:StartEvent'});}if(hasErrorEventDefinition(element)||hasEscalationEventDefinition(element)||hasCompensateEventDefinition(element)){canExecute.replacements.push({oldElementId:element.id,newElementType:'bpmn:StartEvent'});}}}if(!is(target,'bpmn:Transaction')){if(hasEventDefinition(element,'bpmn:CancelEventDefinition')&&element.type!=='label'){if(is(element,'bpmn:EndEvent')&&canDrop(element,target)){canExecute.replacements.push({oldElementId:element.id,newElementType:'bpmn:EndEvent'});}if(is(element,'bpmn:BoundaryEvent')&&canAttach(element,target,null,position)){canExecute.replacements.push({oldElementId:element.id,newElementType:'bpmn:BoundaryEvent'});}}}});return canExecute.replacements.length?canExecute:false;}function canMove(elements,target){if(any(elements,isBoundaryEvent)){return false;}if(any(elements,isLane)){return false;}if(!target){return true;}return elements.every(function(element){return canDrop(element,target);});}function canCreate(shape,target,source,position){if(!target){return false;}if(isLabel(target)){return null;}if(isSame(source,target)){return false;}if(source&&isParent(source,target)){return false;}return canDrop(shape,target,position)||canInsert(shape,target,position);}function canResize(shape,newBounds){if(is(shape,'bpmn:SubProcess')){return(!!isExpanded(shape))&&(!newBounds||(newBounds.width>=100&&newBounds.height>=80));}if(is(shape,'bpmn:Lane')){return!newBounds||(newBounds.width>=130&&newBounds.height>=60);}if(is(shape,'bpmn:Participant')){return!newBounds||(newBounds.width>=250&&newBounds.height>=50);}if(isTextAnnotation(shape)){return true;}return false;}function isOneTextAnnotation(source,target){var sourceTextAnnotation=isTextAnnotation(source),targetTextAnnotation=isTextAnnotation(target);return((sourceTextAnnotation||targetTextAnnotation)&&(sourceTextAnnotation!==targetTextAnnotation));}function canConnectAssociation(source,target){if(isConnection(source)||isConnection(target)){return false;}if(isCompensationBoundary(source)&&isForCompensation(target)){return true;}if(isParent(target,source)||isParent(source,target)){return false;}return isOneTextAnnotation(source,target);}function canConnectMessageFlow(source,target){return isMessageFlowSource(source)&&isMessageFlowTarget(target)&&!isSameOrganization(source,target);}function canConnectSequenceFlow(source,target){return isSequenceFlowSource(source)&&isSequenceFlowTarget(target)&&isSameScope(source,target)&&!(is(source,'bpmn:EventBasedGateway')&&!isEventBasedTarget(target));}function canConnectDataAssociation(source,target){if(isAny(source,['bpmn:DataObjectReference','bpmn:DataStoreReference'])&&isAny(target,['bpmn:Activity','bpmn:ThrowEvent'])){return{type:'bpmn:DataInputAssociation'};}if(isAny(target,['bpmn:DataObjectReference','bpmn:DataStoreReference'])&&isAny(source,['bpmn:Activity','bpmn:CatchEvent'])){return{type:'bpmn:DataOutputAssociation'};}return false;}function canInsert(shape,flow,position){if(Array.isArray(shape)){if(shape.length!==1){return false;}shape=shape[0];}return(isAny(flow,['bpmn:SequenceFlow','bpmn:MessageFlow'])&&!isLabel(flow)&&is(shape,'bpmn:FlowNode')&&!is(shape,'bpmn:BoundaryEvent')&&canDrop(shape,flow.parent,position));}function contains(collection,element){return(collection&&element)&&collection.indexOf(element)!==-1;}function canCopy(collection,element){if(is(element,'bpmn:Lane')&&!contains(collection,element.parent)){return false;}if(is(element,'bpmn:BoundaryEvent')&&!contains(collection,element.host)){return false;}return true;}},{"../../util/DiUtil":195,"../../util/ModelUtil":197,"../modeling/util/ModelingUtil":170,"../snapping/BpmnSnappingUtil":188,"diagram-js/lib/features/rules/RuleProvider":332,"inherits":398,"lodash/collection/any":413,"lodash/collection/every":414,"lodash/collection/filter":415,"lodash/collection/find":416,"lodash/collection/forEach":417}],184:[function(require,module,exports){module.exports={__depends__:[require('diagram-js/lib/features/rules')],__init__:['bpmnRules'],bpmnRules:['type',require('./BpmnRules')]};},{"./BpmnRules":183,"diagram-js/lib/features/rules":334}],185:[function(require,module,exports){'use strict';var map=require('lodash/collection/map'),filter=require('lodash/collection/filter'),sortBy=require('lodash/collection/sortBy');var labelUtil=require('../label-editing/LabelUtil');function BpmnSearchProvider(elementRegistry,searchPad,canvas){this._elementRegistry=elementRegistry;this._canvas=canvas;searchPad.registerProvider(this);}module.exports=BpmnSearchProvider;BpmnSearchProvider.$inject=['elementRegistry','searchPad','canvas'];BpmnSearchProvider.prototype.find=function(pattern){var rootElement=this._canvas.getRootElement();var elements=this._elementRegistry.filter(function(element){if(element.labelTarget){return false;}return true;});elements=filter(elements,function(element){return element!==rootElement;});elements=map(elements,function(element){return{primaryTokens:matchAndSplit(labelUtil.getLabel(element),pattern),secondaryTokens:matchAndSplit(element.id,pattern),element:element};});elements=filter(elements,function(element){return hasMatched(element.primaryTokens)||hasMatched(element.secondaryTokens);});elements=sortBy(elements,function(element){return labelUtil.getLabel(element.element)+element.element.id;});return elements;};function hasMatched(tokens){var matched=filter(tokens,function(t){return!!t.matched;});return matched.length>0;}function matchAndSplit(text,pattern){var tokens=[],originalText=text;if(!text){return tokens;}text=text.toLowerCase();pattern=pattern.toLowerCase();var i=text.indexOf(pattern);if(i>-1){if(i!==0){tokens.push({normal:originalText.substr(0,i)});}tokens.push({matched:originalText.substr(i,pattern.length)});if(pattern.length+i<text.length){tokens.push({normal:originalText.substr(pattern.length+i,text.length)});}}else{tokens.push({normal:originalText});}return tokens;}},{"../label-editing/LabelUtil":127,"lodash/collection/filter":415,"lodash/collection/map":420,"lodash/collection/sortBy":425}],186:[function(require,module,exports){module.exports={__depends__:[require('diagram-js/lib/features/search-pad')],__init__:['bpmnSearch'],bpmnSearch:['type',require('./BpmnSearchProvider')]};},{"./BpmnSearchProvider":185,"diagram-js/lib/features/search-pad":336}],187:[function(require,module,exports){'use strict';var inherits=require('inherits');var abs=Math.abs;var forEach=require('lodash/collection/forEach'),filter=require('lodash/collection/filter'),assign=require('lodash/object/assign');var getBoundingBox=require('diagram-js/lib/util/Elements').getBBox;var is=require('../../util/ModelUtil').is,isAny=require('../modeling/util/ModelingUtil').isAny,isExpanded=require('../../util/DiUtil').isExpanded;var Snapping=require('diagram-js/lib/features/snapping/Snapping'),SnapUtil=require('diagram-js/lib/features/snapping/SnapUtil');var asTRBL=require('diagram-js/lib/layout/LayoutUtil').asTRBL;var round=Math.round;var mid=SnapUtil.mid,topLeft=SnapUtil.topLeft,bottomRight=SnapUtil.bottomRight,isSnapped=SnapUtil.isSnapped,setSnapped=SnapUtil.setSnapped;var getBoundaryAttachment=require('./BpmnSnappingUtil').getBoundaryAttachment,getParticipantSizeConstraints=require('./BpmnSnappingUtil').getParticipantSizeConstraints,getLanesRoot=require('../modeling/util/LaneUtil').getLanesRoot;var HIGH_PRIORITY=1500;function BpmnSnapping(eventBus,canvas,bpmnRules,elementRegistry){Snapping.call(this,eventBus,canvas);eventBus.on('create.start',function(event){var context=event.context,shape=context.shape,rootElement=canvas.getRootElement();if(is(shape,'bpmn:Participant')&&is(rootElement,'bpmn:Process')){initParticipantSnapping(context,shape,rootElement.children);}});eventBus.on(['create.move','create.end'],HIGH_PRIORITY,function(event){var context=event.context,shape=context.shape,participantSnapBox=context.participantSnapBox;if(!isSnapped(event)&&participantSnapBox){snapParticipant(participantSnapBox,shape,event);}});eventBus.on('shape.move.start',function(event){var context=event.context,shape=context.shape,rootElement=canvas.getRootElement();if(is(shape,'bpmn:Participant')&&is(rootElement,'bpmn:Process')){initParticipantSnapping(context,shape,rootElement.children);}});function canAttach(shape,target,position){return bpmnRules.canAttach([shape],target,null,position)==='attach';}function canConnect(source,target){return bpmnRules.canConnect(source,target);}eventBus.on(['create.move','create.end','shape.move.move','shape.move.end'],HIGH_PRIORITY,function(event){var context=event.context,target=context.target,shape=context.shape;if(target&&!isSnapped(event)&&canAttach(shape,target,event)){snapBoundaryEvent(event,shape,target);}});eventBus.on(['shape.move.hover','shape.move.move','shape.move.end','create.hover','create.move','create.end'],HIGH_PRIORITY,function(event){var context=event.context,shape=context.shape,hover=event.hover;if(is(hover,'bpmn:Lane')&&!isAny(shape,['bpmn:Lane','bpmn:Participant'])){event.hover=getLanesRoot(hover);event.hoverGfx=elementRegistry.getGraphics(event.hover);}});eventBus.on(['connect.move','connect.hover','connect.end'],HIGH_PRIORITY,function(event){var context=event.context,source=context.source,target=context.target;var connection=canConnect(source,target)||{};if(!context.initialSourcePosition){context.initialSourcePosition=context.sourcePosition;}if(target&&connection.type==='bpmn:SequenceFlow'){context.sourcePosition=mid(source);assign(event,mid(target));}else{context.sourcePosition=context.initialSourcePosition;}});eventBus.on(['create.move','shape.move.move'],function(event){var context=event.context,shape=context.shape,target=context.target;var threshold=30;if(is(shape,'bpmn:Lane')){if(isAny(target,['bpmn:Lane','bpmn:Participant'])){var childLanes=filter(target.children,function(c){return is(c,'bpmn:Lane');});var y=event.y,targetTrbl;var insert=childLanes.reduce(function(insert,l){var laneTrbl=asTRBL(l);if(abs(laneTrbl.top-y)<threshold){insert=assign(insert||{},{before:{element:l,y:laneTrbl.top}});}else
if(abs(laneTrbl.bottom-y)<threshold){insert=assign(insert||{},{after:{element:l,y:laneTrbl.bottom}});}else
if(laneTrbl.top<y&&laneTrbl.bottom>y){if(abs(laneTrbl.top-y)>abs(laneTrbl.bottom-y)){insert=assign(insert||{},{after:{element:l,y:laneTrbl.bottom}});}else{insert=assign(insert||{},{before:{element:l,y:laneTrbl.top}});}}return insert;},false);if(!insert){targetTrbl=asTRBL(target);if(abs(targetTrbl.top-y)<threshold){insert={before:{element:target,y:targetTrbl.top}};}else
if(abs(targetTrbl.bottom-y)<threshold){insert={after:{element:target,y:targetTrbl.bottom}};}else{insert={into:{element:target,y:(targetTrbl.top+targetTrbl.bottom)/2}};}}if(insert.before&&insert.after){console.log('insert between',insert.before.element.id,'and',insert.after.element.id);setSnapped(event,'x',insert.before.element.x+insert.before.element.width/2);setSnapped(event,'y',insert.before.y);}else
if(insert.after){console.log('insert after',insert.after.element.id);setSnapped(event,'x',insert.after.element.x+insert.after.element.width/2);setSnapped(event,'y',insert.after.y);}else
if(insert.before){console.log('insert before',insert.before.element.id);setSnapped(event,'x',insert.before.element.x+insert.before.element.width/2);setSnapped(event,'y',insert.before.y);}else
if(insert.into){console.log('insert into',insert.into.element.id);setSnapped(event,'x',insert.into.element.x+insert.into.element.width/2);setSnapped(event,'y',insert.into.y);}}}});eventBus.on('resize.start',HIGH_PRIORITY,function(event){var context=event.context,shape=context.shape;if(is(shape,'bpmn:SubProcess')&&isExpanded(shape)){context.minDimensions={width:140,height:120};}if(is(shape,'bpmn:Participant')){context.minDimensions={width:300,height:150};}if(is(shape,'bpmn:Lane')||is(shape,'bpmn:Participant')){context.resizeConstraints=getParticipantSizeConstraints(shape,context.direction,context.balanced);}if(is(shape,'bpmn:TextAnnotation')){context.minDimensions={width:50,height:30};}});}inherits(BpmnSnapping,Snapping);BpmnSnapping.$inject=['eventBus','canvas','bpmnRules','elementRegistry'];module.exports=BpmnSnapping;BpmnSnapping.prototype.initSnap=function(event){var context=event.context,shape=event.shape,shapeMid,shapeBounds,shapeTopLeft,shapeBottomRight,snapContext;snapContext=Snapping.prototype.initSnap.call(this,event);if(is(shape,'bpmn:Participant')){snapContext.setSnapLocations(['top-left','bottom-right','mid']);}if(shape){shapeMid=mid(shape,event);shapeBounds={width:shape.width,height:shape.height,x:isNaN(shape.x)?round(shapeMid.x-shape.width/2):shape.x,y:isNaN(shape.y)?round(shapeMid.y-shape.height/2):shape.y};shapeTopLeft=topLeft(shapeBounds);shapeBottomRight=bottomRight(shapeBounds);snapContext.setSnapOrigin('top-left',{x:shapeTopLeft.x-event.x,y:shapeTopLeft.y-event.y});snapContext.setSnapOrigin('bottom-right',{x:shapeBottomRight.x-event.x,y:shapeBottomRight.y-event.y});forEach(shape.outgoing,function(c){var docking=c.waypoints[0];docking=docking.original||docking;snapContext.setSnapOrigin(c.id+'-docking',{x:docking.x-event.x,y:docking.y-event.y});});forEach(shape.incoming,function(c){var docking=c.waypoints[c.waypoints.length-1];docking=docking.original||docking;snapContext.setSnapOrigin(c.id+'-docking',{x:docking.x-event.x,y:docking.y-event.y});});}var source=context.source;if(source){snapContext.addDefaultSnap('mid',mid(source));}};BpmnSnapping.prototype.addTargetSnaps=function(snapPoints,shape,target){if(is(shape,'bpmn:BoundaryEvent')&&shape.type!=='label'){target=target.parent;}if(is(target,'bpmn:SequenceFlow')){this.addTargetSnaps(snapPoints,shape,target.parent);}var siblings=this.getSiblings(shape,target)||[];forEach(siblings,function(s){if(is(s,'bpmn:Lane')){return;}snapPoints.add('mid',mid(s));if(is(s,'bpmn:Participant')){snapPoints.add('top-left',topLeft(s));snapPoints.add('bottom-right',bottomRight(s));}});forEach(shape.incoming,function(c){if(siblings.indexOf(c.source)===-1){snapPoints.add('mid',mid(c.source));}var docking=c.waypoints[0];snapPoints.add(c.id+'-docking',docking.original||docking);});forEach(shape.outgoing,function(c){if(siblings.indexOf(c.target)===-1){snapPoints.add('mid',mid(c.target));}var docking=c.waypoints[c.waypoints.length-1];snapPoints.add(c.id+'-docking',docking.original||docking);});};function initParticipantSnapping(context,shape,elements){if(!elements.length){return;}var snapBox=getBoundingBox(elements.filter(function(e){return!e.labelTarget&&!e.waypoints;}));snapBox.x-=50;snapBox.y-=20;snapBox.width+=70;snapBox.height+=40;shape.width=Math.max(shape.width,snapBox.width);shape.height=Math.max(shape.height,snapBox.height);context.participantSnapBox=snapBox;}function snapParticipant(snapBox,shape,event,offset){offset=offset||0;var shapeHalfWidth=shape.width/2-offset,shapeHalfHeight=shape.height/2;var currentTopLeft={x:event.x-shapeHalfWidth-offset,y:event.y-shapeHalfHeight};var currentBottomRight={x:event.x+shapeHalfWidth+offset,y:event.y+shapeHalfHeight};var snapTopLeft=snapBox,snapBottomRight=bottomRight(snapBox);if(currentTopLeft.x>=snapTopLeft.x){setSnapped(event,'x',snapTopLeft.x+offset+shapeHalfWidth);}else
if(currentBottomRight.x<=snapBottomRight.x){setSnapped(event,'x',snapBottomRight.x-offset-shapeHalfWidth);}if(currentTopLeft.y>=snapTopLeft.y){setSnapped(event,'y',snapTopLeft.y+shapeHalfHeight);}else
if(currentBottomRight.y<=snapBottomRight.y){setSnapped(event,'y',snapBottomRight.y-shapeHalfHeight);}}function snapBoundaryEvent(event,shape,target){var targetTRBL=asTRBL(target);var direction=getBoundaryAttachment(event,target);if(/top/.test(direction)){setSnapped(event,'y',targetTRBL.top);}else
if(/bottom/.test(direction)){setSnapped(event,'y',targetTRBL.bottom);}if(/left/.test(direction)){setSnapped(event,'x',targetTRBL.left);}else
if(/right/.test(direction)){setSnapped(event,'x',targetTRBL.right);}}},{"../../util/DiUtil":195,"../../util/ModelUtil":197,"../modeling/util/LaneUtil":169,"../modeling/util/ModelingUtil":170,"./BpmnSnappingUtil":188,"diagram-js/lib/features/snapping/SnapUtil":342,"diagram-js/lib/features/snapping/Snapping":343,"diagram-js/lib/layout/LayoutUtil":359,"diagram-js/lib/util/Elements":373,"inherits":398,"lodash/collection/filter":415,"lodash/collection/forEach":417,"lodash/object/assign":547}],188:[function(require,module,exports){'use strict';var getOrientation=require('diagram-js/lib/layout/LayoutUtil').getOrientation;function getBoundaryAttachment(position,targetBounds){var orientation=getOrientation(position,targetBounds,-15);if(orientation!=='intersect'){return orientation;}else{return null;}}module.exports.getBoundaryAttachment=getBoundaryAttachment;var is=require('../../util/ModelUtil').is;var asTRBL=require('diagram-js/lib/layout/LayoutUtil').asTRBL;var collectLanes=require('../modeling/util/LaneUtil').collectLanes,getLanesRoot=require('../modeling/util/LaneUtil').getLanesRoot;var abs=Math.abs,min=Math.min,max=Math.max;function addToTrbl(trbl,attr,value,choice){var current=trbl[attr];trbl[attr]=current===undefined?value:choice(value,current);}function addMin(trbl,attr,value){return addToTrbl(trbl,attr,value,min);}function addMax(trbl,attr,value){return addToTrbl(trbl,attr,value,max);}var LANE_MIN_HEIGHT=60,LANE_MIN_WIDTH=300,LANE_RIGHT_PADDING=20,LANE_LEFT_PADDING=50,LANE_TOP_PADDING=20,LANE_BOTTOM_PADDING=20;function getParticipantSizeConstraints(laneShape,resizeDirection,balanced){var lanesRoot=getLanesRoot(laneShape);var isFirst=true,isLast=true;var allLanes=collectLanes(lanesRoot,[lanesRoot]);var laneTrbl=asTRBL(laneShape);var maxTrbl={},minTrbl={};if(/e/.test(resizeDirection)){minTrbl.right=laneTrbl.left+LANE_MIN_WIDTH;}else
if(/w/.test(resizeDirection)){minTrbl.left=laneTrbl.right-LANE_MIN_WIDTH;}allLanes.forEach(function(other){var otherTrbl=asTRBL(other);if(/n/.test(resizeDirection)){if(otherTrbl.top<(laneTrbl.top-10)){isFirst=false;}if(balanced&&abs(laneTrbl.top-otherTrbl.bottom)<10){addMax(maxTrbl,'top',otherTrbl.top+LANE_MIN_HEIGHT);}if(abs(laneTrbl.top-otherTrbl.top)<5){addMin(minTrbl,'top',otherTrbl.bottom-LANE_MIN_HEIGHT);}}if(/s/.test(resizeDirection)){if(otherTrbl.bottom>(laneTrbl.bottom+10)){isLast=false;}if(balanced&&abs(laneTrbl.bottom-otherTrbl.top)<10){addMin(maxTrbl,'bottom',otherTrbl.bottom-LANE_MIN_HEIGHT);}if(abs(laneTrbl.bottom-otherTrbl.bottom)<5){addMax(minTrbl,'bottom',otherTrbl.top+LANE_MIN_HEIGHT);}}});var flowElements=lanesRoot.children.filter(function(s){return!s.hidden&&!s.waypoints&&(is(s,'bpmn:FlowElement')||is(s,'bpmn:Artifact'));});flowElements.forEach(function(flowElement){var flowElementTrbl=asTRBL(flowElement);if(isFirst&&/n/.test(resizeDirection)){addMin(minTrbl,'top',flowElementTrbl.top-LANE_TOP_PADDING);}if(/e/.test(resizeDirection)){addMax(minTrbl,'right',flowElementTrbl.right+LANE_RIGHT_PADDING);}if(isLast&&/s/.test(resizeDirection)){addMax(minTrbl,'bottom',flowElementTrbl.bottom+LANE_BOTTOM_PADDING);}if(/w/.test(resizeDirection)){addMin(minTrbl,'left',flowElementTrbl.left-LANE_LEFT_PADDING);}});return{min:minTrbl,max:maxTrbl};}module.exports.getParticipantSizeConstraints=getParticipantSizeConstraints;},{"../../util/ModelUtil":197,"../modeling/util/LaneUtil":169,"diagram-js/lib/layout/LayoutUtil":359}],189:[function(require,module,exports){module.exports={__init__:['snapping'],snapping:['type',require('./BpmnSnapping')]};},{"./BpmnSnapping":187}],190:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign'),map=require('lodash/collection/map');var LabelUtil=require('../util/LabelUtil');var TextUtil=require('diagram-js/lib/util/Text');var is=require('../util/ModelUtil').is;var hasExternalLabel=LabelUtil.hasExternalLabel,getExternalLabelBounds=LabelUtil.getExternalLabelBounds,isExpanded=require('../util/DiUtil').isExpanded,elementToString=require('./Util').elementToString;function elementData(semantic,attrs){return assign({id:semantic.id,type:semantic.$type,businessObject:semantic},attrs);}function collectWaypoints(waypoints){return map(waypoints,function(p){return{x:p.x,y:p.y};});}function notYetDrawn(translate,semantic,refSemantic,property){return new Error(translate('element {element} referenced by {referenced}#{property} not yet drawn',{element:elementToString(refSemantic),referenced:elementToString(semantic),property:property}));}function BpmnImporter(eventBus,canvas,elementFactory,elementRegistry,translate){this._eventBus=eventBus;this._canvas=canvas;this._elementFactory=elementFactory;this._elementRegistry=elementRegistry;this._translate=translate;this._textUtil=new TextUtil();}BpmnImporter.$inject=['eventBus','canvas','elementFactory','elementRegistry','translate'];module.exports=BpmnImporter;BpmnImporter.prototype.add=function(semantic,parentElement){var di=semantic.di,element,translate=this._translate,hidden;if(is(di,'bpmndi:BPMNPlane')){element=this._elementFactory.createRoot(elementData(semantic));this._canvas.setRootElement(element);}else if(is(di,'bpmndi:BPMNShape')){var collapsed=!isExpanded(semantic);hidden=parentElement&&(parentElement.hidden||parentElement.collapsed);var bounds=semantic.di.bounds;element=this._elementFactory.createShape(elementData(semantic,{collapsed:collapsed,hidden:hidden,x:Math.round(bounds.x),y:Math.round(bounds.y),width:Math.round(bounds.width),height:Math.round(bounds.height)}));if(is(semantic,'bpmn:BoundaryEvent')){this._attachBoundary(semantic,element);}this._canvas.addShape(element,parentElement);}else if(is(di,'bpmndi:BPMNEdge')){var source=this._getSource(semantic),target=this._getTarget(semantic);hidden=parentElement&&(parentElement.hidden||parentElement.collapsed);element=this._elementFactory.createConnection(elementData(semantic,{hidden:hidden,source:source,target:target,waypoints:collectWaypoints(semantic.di.waypoint)}));if(is(semantic,'bpmn:DataAssociation')){parentElement=null;}this._canvas.addConnection(element,parentElement);}else{throw new Error(translate('unknown di {di} for element {semantic}',{di:elementToString(di),semantic:elementToString(semantic)}));}if(hasExternalLabel(semantic)){this.addLabel(semantic,element);}this._eventBus.fire('bpmnElement.added',{element:element});return element;};BpmnImporter.prototype._attachBoundary=function(boundarySemantic,boundaryElement){var translate=this._translate;var hostSemantic=boundarySemantic.attachedToRef;if(!hostSemantic){throw new Error(translate('missing {semantic}#attachedToRef',{semantic:elementToString(boundarySemantic)}));}var host=this._elementRegistry.get(hostSemantic.id),attachers=host&&host.attachers;if(!host){throw notYetDrawn(translate,boundarySemantic,hostSemantic,'attachedToRef');}boundaryElement.host=host;if(!attachers){host.attachers=attachers=[];}if(attachers.indexOf(boundaryElement)===-1){attachers.push(boundaryElement);}};BpmnImporter.prototype.addLabel=function(semantic,element){var bounds,text,label;bounds=getExternalLabelBounds(semantic,element);text=semantic.name;if(text){bounds=getLayoutedBounds(bounds,text,this._textUtil);}label=this._elementFactory.createLabel(elementData(semantic,{id:semantic.id+'_label',labelTarget:element,type:'label',hidden:element.hidden||!semantic.name,x:Math.round(bounds.x),y:Math.round(bounds.y),width:Math.round(bounds.width),height:Math.round(bounds.height)}));return this._canvas.addShape(label,element.parent);};BpmnImporter.prototype._getEnd=function(semantic,side){var element,refSemantic,type=semantic.$type,translate=this._translate;refSemantic=semantic[side+'Ref'];if(side==='source'&&type==='bpmn:DataInputAssociation'){refSemantic=refSemantic&&refSemantic[0];}if(side==='source'&&type==='bpmn:DataOutputAssociation'||side==='target'&&type==='bpmn:DataInputAssociation'){refSemantic=semantic.$parent;}element=refSemantic&&this._getElement(refSemantic);if(element){return element;}if(refSemantic){throw notYetDrawn(translate,semantic,refSemantic,side+'Ref');}else{throw new Error(translate('{semantic}#{side} Ref not specified',{semantic:elementToString(semantic),side:side}));}};BpmnImporter.prototype._getSource=function(semantic){return this._getEnd(semantic,'source');};BpmnImporter.prototype._getTarget=function(semantic){return this._getEnd(semantic,'target');};BpmnImporter.prototype._getElement=function(semantic){return this._elementRegistry.get(semantic.id);};var EXTERNAL_LABEL_STYLE={fontFamily:'Arial, sans-serif',fontSize:'11px'};function getLayoutedBounds(bounds,text,textUtil){var layoutedLabelDimensions=textUtil.getDimensions(text,{box:{width:90,height:30,x:bounds.width/2+bounds.x,y:bounds.height/2+bounds.y},style:EXTERNAL_LABEL_STYLE});return{x:Math.round(bounds.x+bounds.width/2-layoutedLabelDimensions.width/2),y:Math.round(bounds.y),width:Math.ceil(layoutedLabelDimensions.width),height:Math.ceil(layoutedLabelDimensions.height)};}},{"../util/DiUtil":195,"../util/LabelUtil":196,"../util/ModelUtil":197,"./Util":193,"diagram-js/lib/util/Text":387,"lodash/collection/map":420,"lodash/object/assign":547}],191:[function(require,module,exports){'use strict';var filter=require('lodash/collection/filter'),find=require('lodash/collection/find'),forEach=require('lodash/collection/forEach');var Refs=require('object-refs');var elementToString=require('./Util').elementToString;var diRefs=new Refs({name:'bpmnElement',enumerable:true},{name:'di'});function is(element,type){return element.$instanceOf(type);}function findDisplayCandidate(definitions){return find(definitions.rootElements,function(e){return is(e,'bpmn:Process')||is(e,'bpmn:Collaboration');});}function BpmnTreeWalker(handler,translate){var handledElements={};var deferred=[];function contextual(fn,ctx){return function(e){fn(e,ctx);};}function handled(element){handledElements[element.id]=element;}function isHandled(element){return handledElements[element.id];}function visit(element,ctx){var gfx=element.gfx;if(gfx){throw new Error(translate('already rendered {element}',{element:elementToString(element)}));}return handler.element(element,ctx);}function visitRoot(element,diagram){return handler.root(element,diagram);}function visitIfDi(element,ctx){try{var gfx=element.di&&visit(element,ctx);handled(element);return gfx;}catch(e){logError(e.message,{element:element,error:e});console.error(translate('failed to import {element}',{element:elementToString(element)}));console.error(e);}}function logError(message,context){handler.error(message,context);}function registerDi(di){var bpmnElement=di.bpmnElement;if(bpmnElement){if(bpmnElement.di){logError(translate('multiple DI elements defined for {element}',{element:elementToString(bpmnElement)}),{element:bpmnElement});}else{diRefs.bind(bpmnElement,'di');bpmnElement.di=di;}}else{logError(translate('no bpmnElement referenced in {element}',{element:elementToString(di)}),{element:di});}}function handleDiagram(diagram){handlePlane(diagram.plane);}function handlePlane(plane){registerDi(plane);forEach(plane.planeElement,handlePlaneElement);}function handlePlaneElement(planeElement){registerDi(planeElement);}function handleDefinitions(definitions,diagram){var diagrams=definitions.diagrams;if(diagram&&diagrams.indexOf(diagram)===-1){throw new Error(translate('diagram not part of bpmn:Definitions'));}if(!diagram&&diagrams&&diagrams.length){diagram=diagrams[0];}if(!diagram){throw new Error(translate('no diagram to display'));}handleDiagram(diagram);var plane=diagram.plane;if(!plane){throw new Error(translate('no plane for {element}',{element:elementToString(diagram)}));}var rootElement=plane.bpmnElement;if(!rootElement){rootElement=findDisplayCandidate(definitions);if(!rootElement){throw new Error(translate('no process or collaboration to display'));}else{logError(translate('correcting missing bpmnElement on {plane} to {rootElement}',{plane:elementToString(plane),rootElement:elementToString(rootElement)}));plane.bpmnElement=rootElement;registerDi(plane);}}var ctx=visitRoot(rootElement,plane);if(is(rootElement,'bpmn:Process')){handleProcess(rootElement,ctx);}else if(is(rootElement,'bpmn:Collaboration')){handleCollaboration(rootElement,ctx);handleUnhandledProcesses(definitions.rootElements,ctx);}else{throw new Error(translate('unsupported bpmnElement for {plane}: {rootElement}',{plane:elementToString(plane),rootElement:elementToString(rootElement)}));}handleDeferred(deferred);}function handleDeferred(deferred){forEach(deferred,function(d){d();});}function handleProcess(process,context){handleFlowElementsContainer(process,context);handleIoSpecification(process.ioSpecification,context);handleArtifacts(process.artifacts,context);handled(process);}function handleUnhandledProcesses(rootElements){var processes=filter(rootElements,function(e){return!isHandled(e)&&is(e,'bpmn:Process')&&e.laneSets;});processes.forEach(contextual(handleProcess));}function handleMessageFlow(messageFlow,context){visitIfDi(messageFlow,context);}function handleMessageFlows(messageFlows,context){forEach(messageFlows,contextual(handleMessageFlow,context));}function handleDataAssociation(association,context){visitIfDi(association,context);}function handleDataInput(dataInput,context){visitIfDi(dataInput,context);}function handleDataOutput(dataOutput,context){visitIfDi(dataOutput,context);}function handleArtifact(artifact,context){visitIfDi(artifact,context);}function handleArtifacts(artifacts,context){forEach(artifacts,function(e){if(is(e,'bpmn:Association')){deferred.push(function(){handleArtifact(e,context);});}else{handleArtifact(e,context);}});}function handleIoSpecification(ioSpecification,context){if(!ioSpecification){return;}forEach(ioSpecification.dataInputs,contextual(handleDataInput,context));forEach(ioSpecification.dataOutputs,contextual(handleDataOutput,context));}function handleSubProcess(subProcess,context){handleFlowElementsContainer(subProcess,context);handleArtifacts(subProcess.artifacts,context);}function handleFlowNode(flowNode,context){var childCtx=visitIfDi(flowNode,context);if(is(flowNode,'bpmn:SubProcess')){handleSubProcess(flowNode,childCtx||context);}if(is(flowNode,'bpmn:Activity')){handleIoSpecification(flowNode.ioSpecification,context);}deferred.push(function(){forEach(flowNode.dataInputAssociations,contextual(handleDataAssociation,context));forEach(flowNode.dataOutputAssociations,contextual(handleDataAssociation,context));});}function handleSequenceFlow(sequenceFlow,context){visitIfDi(sequenceFlow,context);}function handleDataElement(dataObject,context){visitIfDi(dataObject,context);}function handleBoundaryEvent(dataObject,context){visitIfDi(dataObject,context);}function handleLane(lane,context){var newContext=visitIfDi(lane,context);if(lane.childLaneSet){handleLaneSet(lane.childLaneSet,newContext||context);}wireFlowNodeRefs(lane);}function handleLaneSet(laneSet,context){forEach(laneSet.lanes,contextual(handleLane,context));}function handleLaneSets(laneSets,context){forEach(laneSets,contextual(handleLaneSet,context));}function handleFlowElementsContainer(container,context){if(container.laneSets){handleLaneSets(container.laneSets,context);}handleFlowElements(container.flowElements,context);}function handleFlowElements(flowElements,context){forEach(flowElements,function(e){if(is(e,'bpmn:SequenceFlow')){deferred.push(function(){handleSequenceFlow(e,context);});}else if(is(e,'bpmn:BoundaryEvent')){deferred.unshift(function(){handleBoundaryEvent(e,context);});}else if(is(e,'bpmn:FlowNode')){handleFlowNode(e,context);}else if(is(e,'bpmn:DataObject')){}else if(is(e,'bpmn:DataStoreReference')){handleDataElement(e,context);}else if(is(e,'bpmn:DataObjectReference')){handleDataElement(e,context);}else{logError(translate('unrecognized flowElement {element} in context {context}',{element:elementToString(e),context:(context?elementToString(context.businessObject):'null')}),{element:e,context:context});}});}function handleParticipant(participant,context){var newCtx=visitIfDi(participant,context);var process=participant.processRef;if(process){handleProcess(process,newCtx||context);}}function handleCollaboration(collaboration){forEach(collaboration.participants,contextual(handleParticipant));handleArtifacts(collaboration.artifacts);deferred.push(function(){handleMessageFlows(collaboration.messageFlows);});}function wireFlowNodeRefs(lane){forEach(lane.flowNodeRef,function(flowNode){var lanes=flowNode.get('lanes');if(lanes){lanes.push(lane);}});}return{handleDefinitions:handleDefinitions};}module.exports=BpmnTreeWalker;},{"./Util":193,"lodash/collection/filter":415,"lodash/collection/find":416,"lodash/collection/forEach":417,"object-refs":583}],192:[function(require,module,exports){'use strict';var BpmnTreeWalker=require('./BpmnTreeWalker');function importBpmnDiagram(diagram,definitions,done){var importer=diagram.get('bpmnImporter'),eventBus=diagram.get('eventBus'),translate=diagram.get('translate');var error,warnings=[];function render(definitions){var visitor={root:function(element){return importer.add(element);},element:function(element,parentShape){return importer.add(element,parentShape);},error:function(message,context){warnings.push({message:message,context:context});}};var walker=new BpmnTreeWalker(visitor,translate);walker.handleDefinitions(definitions);}eventBus.fire('import.render.start',{definitions:definitions});try{render(definitions);}catch(e){error=e;}eventBus.fire('import.render.complete',{error:error,warnings:warnings});done(error,warnings);}module.exports.importBpmnDiagram=importBpmnDiagram;},{"./BpmnTreeWalker":191}],193:[function(require,module,exports){'use strict';module.exports.elementToString=function(e){if(!e){return'<null>';}return'<'+e.$type+(e.id?' id="'+e.id:'')+'" />';};},{}],194:[function(require,module,exports){module.exports={__depends__:[require('diagram-js/lib/i18n/translate')],bpmnImporter:['type',require('./BpmnImporter')]};},{"./BpmnImporter":190,"diagram-js/lib/i18n/translate":355}],195:[function(require,module,exports){'use strict';var is=require('./ModelUtil').is,getBusinessObject=require('./ModelUtil').getBusinessObject;var forEach=require('lodash/collection/forEach');module.exports.isExpanded=function(element){if(is(element,'bpmn:CallActivity')){return false;}if(is(element,'bpmn:SubProcess')){return!!getBusinessObject(element).di.isExpanded;}if(is(element,'bpmn:Participant')){return!!getBusinessObject(element).processRef;}return true;};module.exports.isInterrupting=function(element){return element&&getBusinessObject(element).isInterrupting!==false;};module.exports.isEventSubProcess=function(element){return element&&!!getBusinessObject(element).triggeredByEvent;};function hasEventDefinition(element,eventType){var bo=getBusinessObject(element),hasEventDefinition=false;if(bo.eventDefinitions){forEach(bo.eventDefinitions,function(event){if(is(event,eventType)){hasEventDefinition=true;}});}return hasEventDefinition;}module.exports.hasEventDefinition=hasEventDefinition;module.exports.hasErrorEventDefinition=function(element){return hasEventDefinition(element,'bpmn:ErrorEventDefinition');};module.exports.hasEscalationEventDefinition=function(element){return hasEventDefinition(element,'bpmn:EscalationEventDefinition');};module.exports.hasCompensateEventDefinition=function(element){return hasEventDefinition(element,'bpmn:CompensateEventDefinition');};},{"./ModelUtil":197,"lodash/collection/forEach":417}],196:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign');var is=require('./ModelUtil').is;var DEFAULT_LABEL_SIZE=module.exports.DEFAULT_LABEL_SIZE={width:90,height:20};var FLOW_LABEL_INDENT=module.exports.FLOW_LABEL_INDENT=15;module.exports.hasExternalLabel=function(semantic){return is(semantic,'bpmn:Event')||is(semantic,'bpmn:Gateway')||is(semantic,'bpmn:DataStoreReference')||is(semantic,'bpmn:DataObjectReference')||is(semantic,'bpmn:SequenceFlow')||is(semantic,'bpmn:MessageFlow');};function getFlowLabelPosition(waypoints){var mid=waypoints.length/2-1;var first=waypoints[Math.floor(mid)];var second=waypoints[Math.ceil(mid+0.01)];var position=getWaypointsMid(waypoints);var angle=Math.atan((second.y-first.y)/(second.x-first.x));var x=position.x,y=position.y;if(Math.abs(angle)<Math.PI/2){y-=FLOW_LABEL_INDENT;}else{x+=FLOW_LABEL_INDENT;}return{x:x,y:y};}module.exports.getFlowLabelPosition=getFlowLabelPosition;function getWaypointsMid(waypoints){var mid=waypoints.length/2-1;var first=waypoints[Math.floor(mid)];var second=waypoints[Math.ceil(mid+0.01)];return{x:first.x+(second.x-first.x)/2,y:first.y+(second.y-first.y)/2};}module.exports.getWaypointsMid=getWaypointsMid;function getExternalLabelMid(element){if(element.waypoints){return getFlowLabelPosition(element.waypoints);}else{return{x:element.x+element.width/2,y:element.y+element.height+DEFAULT_LABEL_SIZE.height/2};}}module.exports.getExternalLabelMid=getExternalLabelMid;module.exports.getExternalLabelBounds=function(semantic,element){var mid,size,bounds,di=semantic.di,label=di.label;if(label&&label.bounds){bounds=label.bounds;size={width:Math.max(DEFAULT_LABEL_SIZE.width,bounds.width),height:bounds.height};mid={x:bounds.x+bounds.width/2,y:bounds.y+bounds.height/2};}else{mid=getExternalLabelMid(element);size=DEFAULT_LABEL_SIZE;}return assign({x:mid.x-size.width/2,y:mid.y-size.height/2},size);};},{"./ModelUtil":197,"lodash/object/assign":547}],197:[function(require,module,exports){'use strict';function is(element,type){var bo=getBusinessObject(element);return bo&&(typeof bo.$instanceOf==='function')&&bo.$instanceOf(type);}module.exports.is=is;function getBusinessObject(element){return(element&&element.businessObject)||element;}module.exports.getBusinessObject=getBusinessObject;},{}],198:[function(require,module,exports){'use strict';var domify=require('min-dom/lib/domify');var domDelegate=require('min-dom/lib/delegate');var logoData=module.exports.BPMNIO_LOGO='iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAMAAADypuvZAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAADBQTFRFiMte9PrwldFwfcZPqtqN0+zEyOe1XLgjvuKncsJAZ70y6fXh3vDT////UrQV////G2zN+AAAABB0Uk5T////////////////////AOAjXRkAAAHDSURBVHjavJZJkoUgDEBJmAX8979tM8u3E6x20VlYJfFFMoL4vBDxATxZcakIOJTWSmxvKWVIkJ8jHvlRv1F2LFrVISCZI+tCtQx+XfewgVTfyY3plPiQEAzI3zWy+kR6NBhFBYeBuscJLOUuA2WVLpCjVIaFzrNQZArxAZKUQm6gsj37L9Cb7dnIBUKxENaaMJQqMpDXvSL+ktxdGRm2IsKgJGGPg7atwUG5CcFUEuSv+CwQqizTrvDTNXdMU2bMiDWZd8d7QIySWVRsb2vBBioxOFt4OinPBapL+neAb5KL5IJ8szOza2/DYoipUCx+CjO0Bpsv0V6mktNZ+k8rlABlWG0FrOpKYVo8DT3dBeLEjUBAj7moDogVii7nSS9QzZnFcOVBp1g2PyBQ3Vr5aIapN91VJy33HTJLC1iX2FY6F8gRdaAeIEfVONgtFCzZTmoLEdOjBDfsIOA6128gw3eu1shAajdZNAORxuQDJN5A5PbEG6gNIu24QJD5iNyRMZIr6bsHbCtCU/OaOaSvgkUyDMdDa1BXGf5HJ1To+/Ym6mCKT02Y+/Sa126ZKyd3jxhzpc1r8zVL6YM1Qy/kR4ABAFJ6iQUnivhAAAAAAElFTkSuQmCC';function css(attrs){return attrs.join(';');}var LIGHTBOX_STYLES=css(['z-index: 1001','position: fixed','top: 0','left: 0','right: 0','bottom: 0']);var BACKDROP_STYLES=css(['width: 100%','height: 100%','background: rgba(0,0,0,0.2)']);var NOTICE_STYLES=css(['position: absolute','left: 50%','top: 40%','margin: 0 -130px','width: 260px','padding: 10px','background: white','border: solid 1px #AAA','border-radius: 3px','font-family: Helvetica, Arial, sans-serif','font-size: 14px','line-height: 1.2em']);var LIGHTBOX_MARKUP='<div class="bjs-powered-by-lightbox" style="'+LIGHTBOX_STYLES+'">'+'<div class="backdrop" style="'+BACKDROP_STYLES+'"></div>'+'<div class="notice" style="'+NOTICE_STYLES+'">'+'<a href="http://bpmn.io" target="_blank" style="float: left; margin-right: 10px">'+'<img src="data:image/png;base64,'+logoData+'">'+'</a>'+'Web-based tooling for BPMN, DMN and CMMN diagrams '+'powered by <a href="http://bpmn.io" target="_blank">bpmn.io</a>.'+'</div>'+'</div>';var lightbox;function open(){if(!lightbox){lightbox=domify(LIGHTBOX_MARKUP);domDelegate.bind(lightbox,'.backdrop','click',function(event){document.body.removeChild(lightbox);});}document.body.appendChild(lightbox);}module.exports.open=open;},{"min-dom/lib/delegate":565,"min-dom/lib/domify":566}],199:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach'),filter=require('lodash/collection/filter'),any=require('lodash/collection/any'),sort=require('lodash/collection/sortBy'),isArray=require('lodash/lang/isArray');var IGNORED_PROPERTIES=require('./ModelCloneUtils').IGNORED_PROPERTIES;function isAllowedIn(extProp,type){var allowedIn=extProp.meta.allowedIn;if(allowedIn.length===1&&allowedIn[0]==='*'){return true;}return allowedIn.indexOf(type)!==-1;}function isType(element,types){return any(types,function(type){return typeof element===type;});}function ModelCloneHelper(eventBus){this._eventBus=eventBus;}module.exports=ModelCloneHelper;ModelCloneHelper.prototype.clone=function(refElement,newElement,properties){var context={newElement:newElement,hasNestedProperty:false};properties=sort(properties,function(prop){return prop==='bpmn:extensionElements';});forEach(properties,function(propName){var refElementProp=refElement.get(propName),newElementProp=newElement.get(propName),propDescriptor=newElement.$model.getPropertyDescriptor(newElement,propName),newProperty,name;if(newElementProp===refElementProp||(propDescriptor&&(propDescriptor.isId||propDescriptor.isReference))){return;}if(isType(refElementProp,['boolean','string','number'])||refElementProp===null){newElement.set(propName,refElementProp);return;}if(isArray(refElementProp)){forEach(refElementProp,function(extElement){var newProp;context.refTopLevelProperty=extElement;newProp=this._deepClone(extElement,context);if(context.hasNestedProperty){newProp.$parent=newElement;newElementProp.push(newProp);}context.hasNestedProperty=false;},this);}else{name=propName.replace(/bpmn:/,'');context.refTopLevelProperty=refElementProp;newProperty=this._deepClone(refElementProp,context);if(context.hasNestedProperty){newElement[name]=newProperty;}context.hasNestedProperty=false;}},this);return newElement;};ModelCloneHelper.prototype._deepClone=function _deepClone(propertyElement,context){var eventBus=this._eventBus;var newProp=propertyElement.$model.create(propertyElement.$type);var properties=filter(Object.keys(propertyElement),function(prop){var descriptor=newProp.$model.getPropertyDescriptor(newProp,prop);if(descriptor&&(descriptor.isId||descriptor.isReference)){return false;}if(IGNORED_PROPERTIES.indexOf(prop)!==-1){return false;}return prop!=='$type';});if(!properties.length){context.hasNestedProperty=true;}forEach(properties,function(propName){if(propertyElement[propName]!==undefined&&(propertyElement[propName].$type||isArray(propertyElement[propName]))){if(isArray(propertyElement[propName])){newProp[propName]=[];forEach(propertyElement[propName],function(property){var extProp=propertyElement.$model.getTypeDescriptor(property.$type),newDeepProp;if(!extProp){return;}var canClone=eventBus.fire('property.clone',{newElement:context.newElement,refTopLevelProperty:context.refTopLevelProperty,propertyDescriptor:extProp});if(!canClone){if(propertyElement.$type==='bpmn:ExtensionElements'&&extProp.meta&&extProp.meta.allowedIn&&!isAllowedIn(extProp,context.newElement.$type)){return false;}}newDeepProp=this._deepClone(property,context);newDeepProp.$parent=newProp;if(!newProp[propName]){newProp[propName]=[];}context.hasNestedProperty=true;newProp[propName].push(newDeepProp);},this);}else if(propertyElement[propName].$type){newProp[propName]=this._deepClone(propertyElement[propName],context);if(newProp[propName]){context.hasNestedProperty=true;newProp[propName].$parent=newProp;}}}else{context.hasNestedProperty=true;newProp[propName]=propertyElement[propName];}},this);return newProp;};},{"./ModelCloneUtils":200,"lodash/collection/any":413,"lodash/collection/filter":415,"lodash/collection/forEach":417,"lodash/collection/sortBy":425,"lodash/lang/isArray":537}],200:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');module.exports.IGNORED_PROPERTIES=['lanes','incoming','outgoing','artifacts','default','flowElements'];function getProperties(descriptor,keepDefault){var properties=[];forEach(descriptor.properties,function(property){if(keepDefault&&property.default){return;}properties.push(property.ns.name);});return properties;}module.exports.getProperties=getProperties;},{"lodash/collection/forEach":417}],201:[function(require,module,exports){module.exports=require('./lib/simple');},{"./lib/simple":203}],202:[function(require,module,exports){'use strict';var isString=require('lodash/lang/isString'),isFunction=require('lodash/lang/isFunction'),assign=require('lodash/object/assign');var Moddle=require('moddle'),XmlReader=require('moddle-xml/lib/reader'),XmlWriter=require('moddle-xml/lib/writer');function BpmnModdle(packages,options){Moddle.call(this,packages,options);}BpmnModdle.prototype=Object.create(Moddle.prototype);module.exports=BpmnModdle;BpmnModdle.prototype.fromXML=function(xmlStr,typeName,options,done){if(!isString(typeName)){done=options;options=typeName;typeName='bpmn:Definitions';}if(isFunction(options)){done=options;options={};}var reader=new XmlReader(assign({model:this,lax:true},options));var rootHandler=reader.handler(typeName);reader.fromXML(xmlStr,rootHandler,done);};BpmnModdle.prototype.toXML=function(element,options,done){if(isFunction(options)){done=options;options={};}var writer=new XmlWriter(options);try{var result=writer.toXML(element);done(null,result);}catch(e){done(e);}};},{"lodash/lang/isFunction":539,"lodash/lang/isString":544,"lodash/object/assign":547,"moddle":574,"moddle-xml/lib/reader":572,"moddle-xml/lib/writer":573}],203:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign');var BpmnModdle=require('./bpmn-moddle');var packages={bpmn:require('../resources/bpmn/json/bpmn.json'),bpmndi:require('../resources/bpmn/json/bpmndi.json'),dc:require('../resources/bpmn/json/dc.json'),di:require('../resources/bpmn/json/di.json'),bioc:require('../resources/bpmn-io/json/bioc.json')};module.exports=function(additionalPackages,options){return new BpmnModdle(assign({},packages,additionalPackages),options);};},{"../resources/bpmn-io/json/bioc.json":204,"../resources/bpmn/json/bpmn.json":205,"../resources/bpmn/json/bpmndi.json":206,"../resources/bpmn/json/dc.json":207,"../resources/bpmn/json/di.json":208,"./bpmn-moddle":202,"lodash/object/assign":547}],204:[function(require,module,exports){module.exports={"name":"bpmn.io colors for BPMN","uri":"http://bpmn.io/schema/bpmn/biocolor/1.0","prefix":"bioc","types":[{"name":"ColoredShape","extends":["bpmndi:BPMNShape"],"properties":[{"name":"stroke","isAttr":true,"type":"String"},{"name":"fill","isAttr":true,"type":"String"}]},{"name":"ColoredEdge","extends":["bpmndi:BPMNEdge"],"properties":[{"name":"stroke","isAttr":true,"type":"String"},{"name":"fill","isAttr":true,"type":"String"}]}],"emumerations":[],"associations":[]}},{}],205:[function(require,module,exports){module.exports={"name":"BPMN20","uri":"http://www.omg.org/spec/BPMN/20100524/MODEL","associations":[],"types":[{"name":"Interface","superClass":["RootElement"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"operations","type":"Operation","isMany":true},{"name":"implementationRef","type":"String","isAttr":true}]},{"name":"Operation","superClass":["BaseElement"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"inMessageRef","type":"Message","isReference":true},{"name":"outMessageRef","type":"Message","isReference":true},{"name":"errorRef","type":"Error","isMany":true,"isReference":true},{"name":"implementationRef","type":"String","isAttr":true}]},{"name":"EndPoint","superClass":["RootElement"]},{"name":"Auditing","superClass":["BaseElement"]},{"name":"GlobalTask","superClass":["CallableElement"],"properties":[{"name":"resources","type":"ResourceRole","isMany":true}]},{"name":"Monitoring","superClass":["BaseElement"]},{"name":"Performer","superClass":["ResourceRole"]},{"name":"Process","superClass":["FlowElementsContainer","CallableElement"],"properties":[{"name":"processType","type":"ProcessType","isAttr":true},{"name":"isClosed","isAttr":true,"type":"Boolean"},{"name":"auditing","type":"Auditing"},{"name":"monitoring","type":"Monitoring"},{"name":"properties","type":"Property","isMany":true},{"name":"laneSets","type":"LaneSet","isMany":true,"replaces":"FlowElementsContainer#laneSets"},{"name":"flowElements","type":"FlowElement","isMany":true,"replaces":"FlowElementsContainer#flowElements"},{"name":"artifacts","type":"Artifact","isMany":true},{"name":"resources","type":"ResourceRole","isMany":true},{"name":"correlationSubscriptions","type":"CorrelationSubscription","isMany":true},{"name":"supports","type":"Process","isMany":true,"isReference":true},{"name":"definitionalCollaborationRef","type":"Collaboration","isAttr":true,"isReference":true},{"name":"isExecutable","isAttr":true,"type":"Boolean"}]},{"name":"LaneSet","superClass":["BaseElement"],"properties":[{"name":"lanes","type":"Lane","isMany":true},{"name":"name","isAttr":true,"type":"String"}]},{"name":"Lane","superClass":["BaseElement"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"partitionElementRef","type":"BaseElement","isAttr":true,"isReference":true},{"name":"partitionElement","type":"BaseElement"},{"name":"flowNodeRef","type":"FlowNode","isMany":true,"isReference":true},{"name":"childLaneSet","type":"LaneSet","xml":{"serialize":"xsi:type"}}]},{"name":"GlobalManualTask","superClass":["GlobalTask"]},{"name":"ManualTask","superClass":["Task"]},{"name":"UserTask","superClass":["Task"],"properties":[{"name":"renderings","type":"Rendering","isMany":true},{"name":"implementation","isAttr":true,"type":"String"}]},{"name":"Rendering","superClass":["BaseElement"]},{"name":"HumanPerformer","superClass":["Performer"]},{"name":"PotentialOwner","superClass":["HumanPerformer"]},{"name":"GlobalUserTask","superClass":["GlobalTask"],"properties":[{"name":"implementation","isAttr":true,"type":"String"},{"name":"renderings","type":"Rendering","isMany":true}]},{"name":"Gateway","isAbstract":true,"superClass":["FlowNode"],"properties":[{"name":"gatewayDirection","type":"GatewayDirection","default":"Unspecified","isAttr":true}]},{"name":"EventBasedGateway","superClass":["Gateway"],"properties":[{"name":"instantiate","default":false,"isAttr":true,"type":"Boolean"},{"name":"eventGatewayType","type":"EventBasedGatewayType","isAttr":true,"default":"Exclusive"}]},{"name":"ComplexGateway","superClass":["Gateway"],"properties":[{"name":"activationCondition","type":"Expression","xml":{"serialize":"xsi:type"}},{"name":"default","type":"SequenceFlow","isAttr":true,"isReference":true}]},{"name":"ExclusiveGateway","superClass":["Gateway"],"properties":[{"name":"default","type":"SequenceFlow","isAttr":true,"isReference":true}]},{"name":"InclusiveGateway","superClass":["Gateway"],"properties":[{"name":"default","type":"SequenceFlow","isAttr":true,"isReference":true}]},{"name":"ParallelGateway","superClass":["Gateway"]},{"name":"RootElement","isAbstract":true,"superClass":["BaseElement"]},{"name":"Relationship","superClass":["BaseElement"],"properties":[{"name":"type","isAttr":true,"type":"String"},{"name":"direction","type":"RelationshipDirection","isAttr":true},{"name":"source","isMany":true,"isReference":true,"type":"Element"},{"name":"target","isMany":true,"isReference":true,"type":"Element"}]},{"name":"BaseElement","isAbstract":true,"properties":[{"name":"id","isAttr":true,"type":"String","isId":true},{"name":"documentation","type":"Documentation","isMany":true},{"name":"extensionDefinitions","type":"ExtensionDefinition","isMany":true,"isReference":true},{"name":"extensionElements","type":"ExtensionElements"}]},{"name":"Extension","properties":[{"name":"mustUnderstand","default":false,"isAttr":true,"type":"Boolean"},{"name":"definition","type":"ExtensionDefinition","isAttr":true,"isReference":true}]},{"name":"ExtensionDefinition","properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"extensionAttributeDefinitions","type":"ExtensionAttributeDefinition","isMany":true}]},{"name":"ExtensionAttributeDefinition","properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"type","isAttr":true,"type":"String"},{"name":"isReference","default":false,"isAttr":true,"type":"Boolean"},{"name":"extensionDefinition","type":"ExtensionDefinition","isAttr":true,"isReference":true}]},{"name":"ExtensionElements","properties":[{"name":"valueRef","isAttr":true,"isReference":true,"type":"Element"},{"name":"values","type":"Element","isMany":true},{"name":"extensionAttributeDefinition","type":"ExtensionAttributeDefinition","isAttr":true,"isReference":true}]},{"name":"Documentation","superClass":["BaseElement"],"properties":[{"name":"text","type":"String","isBody":true},{"name":"textFormat","default":"text/plain","isAttr":true,"type":"String"}]},{"name":"Event","isAbstract":true,"superClass":["FlowNode","InteractionNode"],"properties":[{"name":"properties","type":"Property","isMany":true}]},{"name":"IntermediateCatchEvent","superClass":["CatchEvent"]},{"name":"IntermediateThrowEvent","superClass":["ThrowEvent"]},{"name":"EndEvent","superClass":["ThrowEvent"]},{"name":"StartEvent","superClass":["CatchEvent"],"properties":[{"name":"isInterrupting","default":true,"isAttr":true,"type":"Boolean"}]},{"name":"ThrowEvent","isAbstract":true,"superClass":["Event"],"properties":[{"name":"dataInputs","type":"DataInput","isMany":true},{"name":"dataInputAssociations","type":"DataInputAssociation","isMany":true},{"name":"inputSet","type":"InputSet"},{"name":"eventDefinitions","type":"EventDefinition","isMany":true},{"name":"eventDefinitionRef","type":"EventDefinition","isMany":true,"isReference":true}]},{"name":"CatchEvent","isAbstract":true,"superClass":["Event"],"properties":[{"name":"parallelMultiple","isAttr":true,"type":"Boolean","default":false},{"name":"dataOutputs","type":"DataOutput","isMany":true},{"name":"dataOutputAssociations","type":"DataOutputAssociation","isMany":true},{"name":"outputSet","type":"OutputSet"},{"name":"eventDefinitions","type":"EventDefinition","isMany":true},{"name":"eventDefinitionRef","type":"EventDefinition","isMany":true,"isReference":true}]},{"name":"BoundaryEvent","superClass":["CatchEvent"],"properties":[{"name":"cancelActivity","default":true,"isAttr":true,"type":"Boolean"},{"name":"attachedToRef","type":"Activity","isAttr":true,"isReference":true}]},{"name":"EventDefinition","isAbstract":true,"superClass":["RootElement"]},{"name":"CancelEventDefinition","superClass":["EventDefinition"]},{"name":"ErrorEventDefinition","superClass":["EventDefinition"],"properties":[{"name":"errorRef","type":"Error","isAttr":true,"isReference":true}]},{"name":"TerminateEventDefinition","superClass":["EventDefinition"]},{"name":"EscalationEventDefinition","superClass":["EventDefinition"],"properties":[{"name":"escalationRef","type":"Escalation","isAttr":true,"isReference":true}]},{"name":"Escalation","properties":[{"name":"structureRef","type":"ItemDefinition","isAttr":true,"isReference":true},{"name":"name","isAttr":true,"type":"String"},{"name":"escalationCode","isAttr":true,"type":"String"}],"superClass":["RootElement"]},{"name":"CompensateEventDefinition","superClass":["EventDefinition"],"properties":[{"name":"waitForCompletion","isAttr":true,"type":"Boolean"},{"name":"activityRef","type":"Activity","isAttr":true,"isReference":true}]},{"name":"TimerEventDefinition","superClass":["EventDefinition"],"properties":[{"name":"timeDate","type":"Expression","xml":{"serialize":"xsi:type"}},{"name":"timeCycle","type":"Expression","xml":{"serialize":"xsi:type"}},{"name":"timeDuration","type":"Expression","xml":{"serialize":"xsi:type"}}]},{"name":"LinkEventDefinition","superClass":["EventDefinition"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"target","type":"LinkEventDefinition","isAttr":true,"isReference":true},{"name":"source","type":"LinkEventDefinition","isMany":true,"isReference":true}]},{"name":"MessageEventDefinition","superClass":["EventDefinition"],"properties":[{"name":"messageRef","type":"Message","isAttr":true,"isReference":true},{"name":"operationRef","type":"Operation","isAttr":true,"isReference":true}]},{"name":"ConditionalEventDefinition","superClass":["EventDefinition"],"properties":[{"name":"condition","type":"Expression","xml":{"serialize":"xsi:type"}}]},{"name":"SignalEventDefinition","superClass":["EventDefinition"],"properties":[{"name":"signalRef","type":"Signal","isAttr":true,"isReference":true}]},{"name":"Signal","superClass":["RootElement"],"properties":[{"name":"structureRef","type":"ItemDefinition","isAttr":true,"isReference":true},{"name":"name","isAttr":true,"type":"String"}]},{"name":"ImplicitThrowEvent","superClass":["ThrowEvent"]},{"name":"DataState","superClass":["BaseElement"],"properties":[{"name":"name","isAttr":true,"type":"String"}]},{"name":"ItemAwareElement","superClass":["BaseElement"],"properties":[{"name":"itemSubjectRef","type":"ItemDefinition","isAttr":true,"isReference":true},{"name":"dataState","type":"DataState"}]},{"name":"DataAssociation","superClass":["BaseElement"],"properties":[{"name":"assignment","type":"Assignment","isMany":true},{"name":"sourceRef","type":"ItemAwareElement","isMany":true,"isReference":true},{"name":"targetRef","type":"ItemAwareElement","isReference":true},{"name":"transformation","type":"FormalExpression","xml":{"serialize":"property"}}]},{"name":"DataInput","superClass":["ItemAwareElement"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"isCollection","default":false,"isAttr":true,"type":"Boolean"},{"name":"inputSetRef","type":"InputSet","isVirtual":true,"isMany":true,"isReference":true},{"name":"inputSetWithOptional","type":"InputSet","isVirtual":true,"isMany":true,"isReference":true},{"name":"inputSetWithWhileExecuting","type":"InputSet","isVirtual":true,"isMany":true,"isReference":true}]},{"name":"DataOutput","superClass":["ItemAwareElement"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"isCollection","default":false,"isAttr":true,"type":"Boolean"},{"name":"outputSetRef","type":"OutputSet","isVirtual":true,"isMany":true,"isReference":true},{"name":"outputSetWithOptional","type":"OutputSet","isVirtual":true,"isMany":true,"isReference":true},{"name":"outputSetWithWhileExecuting","type":"OutputSet","isVirtual":true,"isMany":true,"isReference":true}]},{"name":"InputSet","superClass":["BaseElement"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"dataInputRefs","type":"DataInput","isMany":true,"isReference":true},{"name":"optionalInputRefs","type":"DataInput","isMany":true,"isReference":true},{"name":"whileExecutingInputRefs","type":"DataInput","isMany":true,"isReference":true},{"name":"outputSetRefs","type":"OutputSet","isMany":true,"isReference":true}]},{"name":"OutputSet","superClass":["BaseElement"],"properties":[{"name":"dataOutputRefs","type":"DataOutput","isMany":true,"isReference":true},{"name":"name","isAttr":true,"type":"String"},{"name":"inputSetRefs","type":"InputSet","isMany":true,"isReference":true},{"name":"optionalOutputRefs","type":"DataOutput","isMany":true,"isReference":true},{"name":"whileExecutingOutputRefs","type":"DataOutput","isMany":true,"isReference":true}]},{"name":"Property","superClass":["ItemAwareElement"],"properties":[{"name":"name","isAttr":true,"type":"String"}]},{"name":"DataInputAssociation","superClass":["DataAssociation"]},{"name":"DataOutputAssociation","superClass":["DataAssociation"]},{"name":"InputOutputSpecification","superClass":["BaseElement"],"properties":[{"name":"dataInputs","type":"DataInput","isMany":true},{"name":"dataOutputs","type":"DataOutput","isMany":true},{"name":"inputSets","type":"InputSet","isMany":true},{"name":"outputSets","type":"OutputSet","isMany":true}]},{"name":"DataObject","superClass":["FlowElement","ItemAwareElement"],"properties":[{"name":"isCollection","default":false,"isAttr":true,"type":"Boolean"}]},{"name":"InputOutputBinding","properties":[{"name":"inputDataRef","type":"InputSet","isAttr":true,"isReference":true},{"name":"outputDataRef","type":"OutputSet","isAttr":true,"isReference":true},{"name":"operationRef","type":"Operation","isAttr":true,"isReference":true}]},{"name":"Assignment","superClass":["BaseElement"],"properties":[{"name":"from","type":"Expression","xml":{"serialize":"xsi:type"}},{"name":"to","type":"Expression","xml":{"serialize":"xsi:type"}}]},{"name":"DataStore","superClass":["RootElement","ItemAwareElement"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"capacity","isAttr":true,"type":"Integer"},{"name":"isUnlimited","default":true,"isAttr":true,"type":"Boolean"}]},{"name":"DataStoreReference","superClass":["ItemAwareElement","FlowElement"],"properties":[{"name":"dataStoreRef","type":"DataStore","isAttr":true,"isReference":true}]},{"name":"DataObjectReference","superClass":["ItemAwareElement","FlowElement"],"properties":[{"name":"dataObjectRef","type":"DataObject","isAttr":true,"isReference":true}]},{"name":"ConversationLink","superClass":["BaseElement"],"properties":[{"name":"sourceRef","type":"InteractionNode","isAttr":true,"isReference":true},{"name":"targetRef","type":"InteractionNode","isAttr":true,"isReference":true},{"name":"name","isAttr":true,"type":"String"}]},{"name":"ConversationAssociation","superClass":["BaseElement"],"properties":[{"name":"innerConversationNodeRef","type":"ConversationNode","isAttr":true,"isReference":true},{"name":"outerConversationNodeRef","type":"ConversationNode","isAttr":true,"isReference":true}]},{"name":"CallConversation","superClass":["ConversationNode"],"properties":[{"name":"calledCollaborationRef","type":"Collaboration","isAttr":true,"isReference":true},{"name":"participantAssociations","type":"ParticipantAssociation","isMany":true}]},{"name":"Conversation","superClass":["ConversationNode"]},{"name":"SubConversation","superClass":["ConversationNode"],"properties":[{"name":"conversationNodes","type":"ConversationNode","isMany":true}]},{"name":"ConversationNode","isAbstract":true,"superClass":["InteractionNode","BaseElement"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"participantRefs","type":"Participant","isMany":true,"isReference":true},{"name":"messageFlowRefs","type":"MessageFlow","isMany":true,"isReference":true},{"name":"correlationKeys","type":"CorrelationKey","isMany":true}]},{"name":"GlobalConversation","superClass":["Collaboration"]},{"name":"PartnerEntity","superClass":["RootElement"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"participantRef","type":"Participant","isMany":true,"isReference":true}]},{"name":"PartnerRole","superClass":["RootElement"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"participantRef","type":"Participant","isMany":true,"isReference":true}]},{"name":"CorrelationProperty","superClass":["RootElement"],"properties":[{"name":"correlationPropertyRetrievalExpression","type":"CorrelationPropertyRetrievalExpression","isMany":true},{"name":"name","isAttr":true,"type":"String"},{"name":"type","type":"ItemDefinition","isAttr":true,"isReference":true}]},{"name":"Error","superClass":["RootElement"],"properties":[{"name":"structureRef","type":"ItemDefinition","isAttr":true,"isReference":true},{"name":"name","isAttr":true,"type":"String"},{"name":"errorCode","isAttr":true,"type":"String"}]},{"name":"CorrelationKey","superClass":["BaseElement"],"properties":[{"name":"correlationPropertyRef","type":"CorrelationProperty","isMany":true,"isReference":true},{"name":"name","isAttr":true,"type":"String"}]},{"name":"Expression","superClass":["BaseElement"],"isAbstract":false,"properties":[{"name":"body","type":"String","isBody":true}]},{"name":"FormalExpression","superClass":["Expression"],"properties":[{"name":"language","isAttr":true,"type":"String"},{"name":"evaluatesToTypeRef","type":"ItemDefinition","isAttr":true,"isReference":true}]},{"name":"Message","superClass":["RootElement"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"itemRef","type":"ItemDefinition","isAttr":true,"isReference":true}]},{"name":"ItemDefinition","superClass":["RootElement"],"properties":[{"name":"itemKind","type":"ItemKind","isAttr":true},{"name":"structureRef","type":"String","isAttr":true},{"name":"isCollection","default":false,"isAttr":true,"type":"Boolean"},{"name":"import","type":"Import","isAttr":true,"isReference":true}]},{"name":"FlowElement","isAbstract":true,"superClass":["BaseElement"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"auditing","type":"Auditing"},{"name":"monitoring","type":"Monitoring"},{"name":"categoryValueRef","type":"CategoryValue","isMany":true,"isReference":true}]},{"name":"SequenceFlow","superClass":["FlowElement"],"properties":[{"name":"isImmediate","isAttr":true,"type":"Boolean"},{"name":"conditionExpression","type":"Expression","xml":{"serialize":"xsi:type"}},{"name":"sourceRef","type":"FlowNode","isAttr":true,"isReference":true},{"name":"targetRef","type":"FlowNode","isAttr":true,"isReference":true}]},{"name":"FlowElementsContainer","isAbstract":true,"superClass":["BaseElement"],"properties":[{"name":"laneSets","type":"LaneSet","isMany":true},{"name":"flowElements","type":"FlowElement","isMany":true}]},{"name":"CallableElement","isAbstract":true,"superClass":["RootElement"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"ioSpecification","type":"InputOutputSpecification","xml":{"serialize":"property"}},{"name":"supportedInterfaceRef","type":"Interface","isMany":true,"isReference":true},{"name":"ioBinding","type":"InputOutputBinding","isMany":true,"xml":{"serialize":"property"}}]},{"name":"FlowNode","isAbstract":true,"superClass":["FlowElement"],"properties":[{"name":"incoming","type":"SequenceFlow","isMany":true,"isReference":true},{"name":"outgoing","type":"SequenceFlow","isMany":true,"isReference":true},{"name":"lanes","type":"Lane","isVirtual":true,"isMany":true,"isReference":true}]},{"name":"CorrelationPropertyRetrievalExpression","superClass":["BaseElement"],"properties":[{"name":"messagePath","type":"FormalExpression"},{"name":"messageRef","type":"Message","isAttr":true,"isReference":true}]},{"name":"CorrelationPropertyBinding","superClass":["BaseElement"],"properties":[{"name":"dataPath","type":"FormalExpression"},{"name":"correlationPropertyRef","type":"CorrelationProperty","isAttr":true,"isReference":true}]},{"name":"Resource","superClass":["RootElement"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"resourceParameters","type":"ResourceParameter","isMany":true}]},{"name":"ResourceParameter","superClass":["BaseElement"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"isRequired","isAttr":true,"type":"Boolean"},{"name":"type","type":"ItemDefinition","isAttr":true,"isReference":true}]},{"name":"CorrelationSubscription","superClass":["BaseElement"],"properties":[{"name":"correlationKeyRef","type":"CorrelationKey","isAttr":true,"isReference":true},{"name":"correlationPropertyBinding","type":"CorrelationPropertyBinding","isMany":true}]},{"name":"MessageFlow","superClass":["BaseElement"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"sourceRef","type":"InteractionNode","isAttr":true,"isReference":true},{"name":"targetRef","type":"InteractionNode","isAttr":true,"isReference":true},{"name":"messageRef","type":"Message","isAttr":true,"isReference":true}]},{"name":"MessageFlowAssociation","superClass":["BaseElement"],"properties":[{"name":"innerMessageFlowRef","type":"MessageFlow","isAttr":true,"isReference":true},{"name":"outerMessageFlowRef","type":"MessageFlow","isAttr":true,"isReference":true}]},{"name":"InteractionNode","isAbstract":true,"properties":[{"name":"incomingConversationLinks","type":"ConversationLink","isVirtual":true,"isMany":true,"isReference":true},{"name":"outgoingConversationLinks","type":"ConversationLink","isVirtual":true,"isMany":true,"isReference":true}]},{"name":"Participant","superClass":["InteractionNode","BaseElement"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"interfaceRef","type":"Interface","isMany":true,"isReference":true},{"name":"participantMultiplicity","type":"ParticipantMultiplicity"},{"name":"endPointRefs","type":"EndPoint","isMany":true,"isReference":true},{"name":"processRef","type":"Process","isAttr":true,"isReference":true}]},{"name":"ParticipantAssociation","superClass":["BaseElement"],"properties":[{"name":"innerParticipantRef","type":"Participant","isAttr":true,"isReference":true},{"name":"outerParticipantRef","type":"Participant","isAttr":true,"isReference":true}]},{"name":"ParticipantMultiplicity","properties":[{"name":"minimum","default":0,"isAttr":true,"type":"Integer"},{"name":"maximum","default":1,"isAttr":true,"type":"Integer"}]},{"name":"Collaboration","superClass":["RootElement"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"isClosed","isAttr":true,"type":"Boolean"},{"name":"participants","type":"Participant","isMany":true},{"name":"messageFlows","type":"MessageFlow","isMany":true},{"name":"artifacts","type":"Artifact","isMany":true},{"name":"conversations","type":"ConversationNode","isMany":true},{"name":"conversationAssociations","type":"ConversationAssociation"},{"name":"participantAssociations","type":"ParticipantAssociation","isMany":true},{"name":"messageFlowAssociations","type":"MessageFlowAssociation","isMany":true},{"name":"correlationKeys","type":"CorrelationKey","isMany":true},{"name":"choreographyRef","type":"Choreography","isMany":true,"isReference":true},{"name":"conversationLinks","type":"ConversationLink","isMany":true}]},{"name":"ChoreographyActivity","isAbstract":true,"superClass":["FlowNode"],"properties":[{"name":"participantRefs","type":"Participant","isMany":true,"isReference":true},{"name":"initiatingParticipantRef","type":"Participant","isAttr":true,"isReference":true},{"name":"correlationKeys","type":"CorrelationKey","isMany":true},{"name":"loopType","type":"ChoreographyLoopType","default":"None","isAttr":true}]},{"name":"CallChoreography","superClass":["ChoreographyActivity"],"properties":[{"name":"calledChoreographyRef","type":"Choreography","isAttr":true,"isReference":true},{"name":"participantAssociations","type":"ParticipantAssociation","isMany":true}]},{"name":"SubChoreography","superClass":["ChoreographyActivity","FlowElementsContainer"],"properties":[{"name":"artifacts","type":"Artifact","isMany":true}]},{"name":"ChoreographyTask","superClass":["ChoreographyActivity"],"properties":[{"name":"messageFlowRef","type":"MessageFlow","isMany":true,"isReference":true}]},{"name":"Choreography","superClass":["FlowElementsContainer","Collaboration"]},{"name":"GlobalChoreographyTask","superClass":["Choreography"],"properties":[{"name":"initiatingParticipantRef","type":"Participant","isAttr":true,"isReference":true}]},{"name":"TextAnnotation","superClass":["Artifact"],"properties":[{"name":"text","type":"String"},{"name":"textFormat","default":"text/plain","isAttr":true,"type":"String"}]},{"name":"Group","superClass":["Artifact"],"properties":[{"name":"categoryValueRef","type":"CategoryValue","isAttr":true,"isReference":true}]},{"name":"Association","superClass":["Artifact"],"properties":[{"name":"associationDirection","type":"AssociationDirection","isAttr":true},{"name":"sourceRef","type":"BaseElement","isAttr":true,"isReference":true},{"name":"targetRef","type":"BaseElement","isAttr":true,"isReference":true}]},{"name":"Category","superClass":["RootElement"],"properties":[{"name":"categoryValue","type":"CategoryValue","isMany":true},{"name":"name","isAttr":true,"type":"String"}]},{"name":"Artifact","isAbstract":true,"superClass":["BaseElement"]},{"name":"CategoryValue","superClass":["BaseElement"],"properties":[{"name":"categorizedFlowElements","type":"FlowElement","isVirtual":true,"isMany":true,"isReference":true},{"name":"value","isAttr":true,"type":"String"}]},{"name":"Activity","isAbstract":true,"superClass":["FlowNode"],"properties":[{"name":"isForCompensation","default":false,"isAttr":true,"type":"Boolean"},{"name":"default","type":"SequenceFlow","isAttr":true,"isReference":true},{"name":"ioSpecification","type":"InputOutputSpecification","xml":{"serialize":"property"}},{"name":"boundaryEventRefs","type":"BoundaryEvent","isMany":true,"isReference":true},{"name":"properties","type":"Property","isMany":true},{"name":"dataInputAssociations","type":"DataInputAssociation","isMany":true},{"name":"dataOutputAssociations","type":"DataOutputAssociation","isMany":true},{"name":"startQuantity","default":1,"isAttr":true,"type":"Integer"},{"name":"resources","type":"ResourceRole","isMany":true},{"name":"completionQuantity","default":1,"isAttr":true,"type":"Integer"},{"name":"loopCharacteristics","type":"LoopCharacteristics"}]},{"name":"ServiceTask","superClass":["Task"],"properties":[{"name":"implementation","isAttr":true,"type":"String"},{"name":"operationRef","type":"Operation","isAttr":true,"isReference":true}]},{"name":"SubProcess","superClass":["Activity","FlowElementsContainer","InteractionNode"],"properties":[{"name":"triggeredByEvent","default":false,"isAttr":true,"type":"Boolean"},{"name":"artifacts","type":"Artifact","isMany":true}]},{"name":"LoopCharacteristics","isAbstract":true,"superClass":["BaseElement"]},{"name":"MultiInstanceLoopCharacteristics","superClass":["LoopCharacteristics"],"properties":[{"name":"isSequential","default":false,"isAttr":true,"type":"Boolean"},{"name":"behavior","type":"MultiInstanceBehavior","default":"All","isAttr":true},{"name":"loopCardinality","type":"Expression","xml":{"serialize":"xsi:type"}},{"name":"loopDataInputRef","type":"ItemAwareElement","isReference":true},{"name":"loopDataOutputRef","type":"ItemAwareElement","isReference":true},{"name":"inputDataItem","type":"DataInput","xml":{"serialize":"property"}},{"name":"outputDataItem","type":"DataOutput","xml":{"serialize":"property"}},{"name":"complexBehaviorDefinition","type":"ComplexBehaviorDefinition","isMany":true},{"name":"completionCondition","type":"Expression","xml":{"serialize":"xsi:type"}},{"name":"oneBehaviorEventRef","type":"EventDefinition","isAttr":true,"isReference":true},{"name":"noneBehaviorEventRef","type":"EventDefinition","isAttr":true,"isReference":true}]},{"name":"StandardLoopCharacteristics","superClass":["LoopCharacteristics"],"properties":[{"name":"testBefore","default":false,"isAttr":true,"type":"Boolean"},{"name":"loopCondition","type":"Expression","xml":{"serialize":"xsi:type"}},{"name":"loopMaximum","type":"Expression","xml":{"serialize":"xsi:type"}}]},{"name":"CallActivity","superClass":["Activity"],"properties":[{"name":"calledElement","type":"String","isAttr":true}]},{"name":"Task","superClass":["Activity","InteractionNode"]},{"name":"SendTask","superClass":["Task"],"properties":[{"name":"implementation","isAttr":true,"type":"String"},{"name":"operationRef","type":"Operation","isAttr":true,"isReference":true},{"name":"messageRef","type":"Message","isAttr":true,"isReference":true}]},{"name":"ReceiveTask","superClass":["Task"],"properties":[{"name":"implementation","isAttr":true,"type":"String"},{"name":"instantiate","default":false,"isAttr":true,"type":"Boolean"},{"name":"operationRef","type":"Operation","isAttr":true,"isReference":true},{"name":"messageRef","type":"Message","isAttr":true,"isReference":true}]},{"name":"ScriptTask","superClass":["Task"],"properties":[{"name":"scriptFormat","isAttr":true,"type":"String"},{"name":"script","type":"String"}]},{"name":"BusinessRuleTask","superClass":["Task"],"properties":[{"name":"implementation","isAttr":true,"type":"String"}]},{"name":"AdHocSubProcess","superClass":["SubProcess"],"properties":[{"name":"completionCondition","type":"Expression","xml":{"serialize":"xsi:type"}},{"name":"ordering","type":"AdHocOrdering","isAttr":true},{"name":"cancelRemainingInstances","default":true,"isAttr":true,"type":"Boolean"}]},{"name":"Transaction","superClass":["SubProcess"],"properties":[{"name":"protocol","isAttr":true,"type":"String"},{"name":"method","isAttr":true,"type":"String"}]},{"name":"GlobalScriptTask","superClass":["GlobalTask"],"properties":[{"name":"scriptLanguage","isAttr":true,"type":"String"},{"name":"script","isAttr":true,"type":"String"}]},{"name":"GlobalBusinessRuleTask","superClass":["GlobalTask"],"properties":[{"name":"implementation","isAttr":true,"type":"String"}]},{"name":"ComplexBehaviorDefinition","superClass":["BaseElement"],"properties":[{"name":"condition","type":"FormalExpression"},{"name":"event","type":"ImplicitThrowEvent"}]},{"name":"ResourceRole","superClass":["BaseElement"],"properties":[{"name":"resourceRef","type":"Resource","isReference":true},{"name":"resourceParameterBindings","type":"ResourceParameterBinding","isMany":true},{"name":"resourceAssignmentExpression","type":"ResourceAssignmentExpression"},{"name":"name","isAttr":true,"type":"String"}]},{"name":"ResourceParameterBinding","properties":[{"name":"expression","type":"Expression","xml":{"serialize":"xsi:type"}},{"name":"parameterRef","type":"ResourceParameter","isAttr":true,"isReference":true}]},{"name":"ResourceAssignmentExpression","properties":[{"name":"expression","type":"Expression","xml":{"serialize":"xsi:type"}}],"superClass":["BaseElement"]},{"name":"Import","properties":[{"name":"importType","isAttr":true,"type":"String"},{"name":"location","isAttr":true,"type":"String"},{"name":"namespace","isAttr":true,"type":"String"}]},{"name":"Definitions","superClass":["BaseElement"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"targetNamespace","isAttr":true,"type":"String"},{"name":"expressionLanguage","default":"http://www.w3.org/1999/XPath","isAttr":true,"type":"String"},{"name":"typeLanguage","default":"http://www.w3.org/2001/XMLSchema","isAttr":true,"type":"String"},{"name":"imports","type":"Import","isMany":true},{"name":"extensions","type":"Extension","isMany":true},{"name":"rootElements","type":"RootElement","isMany":true},{"name":"diagrams","isMany":true,"type":"bpmndi:BPMNDiagram"},{"name":"exporter","isAttr":true,"type":"String"},{"name":"relationships","type":"Relationship","isMany":true},{"name":"exporterVersion","isAttr":true,"type":"String"}]}],"emumerations":[{"name":"ProcessType","literalValues":[{"name":"None"},{"name":"Public"},{"name":"Private"}]},{"name":"GatewayDirection","literalValues":[{"name":"Unspecified"},{"name":"Converging"},{"name":"Diverging"},{"name":"Mixed"}]},{"name":"EventBasedGatewayType","literalValues":[{"name":"Parallel"},{"name":"Exclusive"}]},{"name":"RelationshipDirection","literalValues":[{"name":"None"},{"name":"Forward"},{"name":"Backward"},{"name":"Both"}]},{"name":"ItemKind","literalValues":[{"name":"Physical"},{"name":"Information"}]},{"name":"ChoreographyLoopType","literalValues":[{"name":"None"},{"name":"Standard"},{"name":"MultiInstanceSequential"},{"name":"MultiInstanceParallel"}]},{"name":"AssociationDirection","literalValues":[{"name":"None"},{"name":"One"},{"name":"Both"}]},{"name":"MultiInstanceBehavior","literalValues":[{"name":"None"},{"name":"One"},{"name":"All"},{"name":"Complex"}]},{"name":"AdHocOrdering","literalValues":[{"name":"Parallel"},{"name":"Sequential"}]}],"prefix":"bpmn","xml":{"tagAlias":"lowerCase","typePrefix":"t"}}},{}],206:[function(require,module,exports){module.exports={"name":"BPMNDI","uri":"http://www.omg.org/spec/BPMN/20100524/DI","types":[{"name":"BPMNDiagram","properties":[{"name":"plane","type":"BPMNPlane","redefines":"di:Diagram#rootElement"},{"name":"labelStyle","type":"BPMNLabelStyle","isMany":true}],"superClass":["di:Diagram"]},{"name":"BPMNPlane","properties":[{"name":"bpmnElement","isAttr":true,"isReference":true,"type":"bpmn:BaseElement","redefines":"di:DiagramElement#modelElement"}],"superClass":["di:Plane"]},{"name":"BPMNShape","properties":[{"name":"bpmnElement","isAttr":true,"isReference":true,"type":"bpmn:BaseElement","redefines":"di:DiagramElement#modelElement"},{"name":"isHorizontal","isAttr":true,"type":"Boolean"},{"name":"isExpanded","isAttr":true,"type":"Boolean"},{"name":"isMarkerVisible","isAttr":true,"type":"Boolean"},{"name":"label","type":"BPMNLabel"},{"name":"isMessageVisible","isAttr":true,"type":"Boolean"},{"name":"participantBandKind","type":"ParticipantBandKind","isAttr":true},{"name":"choreographyActivityShape","type":"BPMNShape","isAttr":true,"isReference":true}],"superClass":["di:LabeledShape"]},{"name":"BPMNEdge","properties":[{"name":"label","type":"BPMNLabel"},{"name":"bpmnElement","isAttr":true,"isReference":true,"type":"bpmn:BaseElement","redefines":"di:DiagramElement#modelElement"},{"name":"sourceElement","isAttr":true,"isReference":true,"type":"di:DiagramElement","redefines":"di:Edge#source"},{"name":"targetElement","isAttr":true,"isReference":true,"type":"di:DiagramElement","redefines":"di:Edge#target"},{"name":"messageVisibleKind","type":"MessageVisibleKind","isAttr":true,"default":"initiating"}],"superClass":["di:LabeledEdge"]},{"name":"BPMNLabel","properties":[{"name":"labelStyle","type":"BPMNLabelStyle","isAttr":true,"isReference":true,"redefines":"di:DiagramElement#style"}],"superClass":["di:Label"]},{"name":"BPMNLabelStyle","properties":[{"name":"font","type":"dc:Font"}],"superClass":["di:Style"]}],"emumerations":[{"name":"ParticipantBandKind","literalValues":[{"name":"top_initiating"},{"name":"middle_initiating"},{"name":"bottom_initiating"},{"name":"top_non_initiating"},{"name":"middle_non_initiating"},{"name":"bottom_non_initiating"}]},{"name":"MessageVisibleKind","literalValues":[{"name":"initiating"},{"name":"non_initiating"}]}],"associations":[],"prefix":"bpmndi"}},{}],207:[function(require,module,exports){module.exports={"name":"DC","uri":"http://www.omg.org/spec/DD/20100524/DC","types":[{"name":"Boolean"},{"name":"Integer"},{"name":"Real"},{"name":"String"},{"name":"Font","properties":[{"name":"name","type":"String","isAttr":true},{"name":"size","type":"Real","isAttr":true},{"name":"isBold","type":"Boolean","isAttr":true},{"name":"isItalic","type":"Boolean","isAttr":true},{"name":"isUnderline","type":"Boolean","isAttr":true},{"name":"isStrikeThrough","type":"Boolean","isAttr":true}]},{"name":"Point","properties":[{"name":"x","type":"Real","default":"0","isAttr":true},{"name":"y","type":"Real","default":"0","isAttr":true}]},{"name":"Bounds","properties":[{"name":"x","type":"Real","default":"0","isAttr":true},{"name":"y","type":"Real","default":"0","isAttr":true},{"name":"width","type":"Real","isAttr":true},{"name":"height","type":"Real","isAttr":true}]}],"prefix":"dc","associations":[]}},{}],208:[function(require,module,exports){module.exports={"name":"DI","uri":"http://www.omg.org/spec/DD/20100524/DI","types":[{"name":"DiagramElement","isAbstract":true,"properties":[{"name":"id","type":"String","isAttr":true,"isId":true},{"name":"extension","type":"Extension"},{"name":"owningDiagram","type":"Diagram","isReadOnly":true,"isVirtual":true,"isReference":true},{"name":"owningElement","type":"DiagramElement","isReadOnly":true,"isVirtual":true,"isReference":true},{"name":"modelElement","isReadOnly":true,"isVirtual":true,"isReference":true,"type":"Element"},{"name":"style","type":"Style","isReadOnly":true,"isVirtual":true,"isReference":true},{"name":"ownedElement","type":"DiagramElement","isReadOnly":true,"isVirtual":true,"isMany":true}]},{"name":"Node","isAbstract":true,"superClass":["DiagramElement"]},{"name":"Edge","isAbstract":true,"superClass":["DiagramElement"],"properties":[{"name":"source","type":"DiagramElement","isReadOnly":true,"isVirtual":true,"isReference":true},{"name":"target","type":"DiagramElement","isReadOnly":true,"isVirtual":true,"isReference":true},{"name":"waypoint","isUnique":false,"isMany":true,"type":"dc:Point","xml":{"serialize":"xsi:type"}}]},{"name":"Diagram","isAbstract":true,"properties":[{"name":"id","type":"String","isAttr":true,"isId":true},{"name":"rootElement","type":"DiagramElement","isReadOnly":true,"isVirtual":true},{"name":"name","isAttr":true,"type":"String"},{"name":"documentation","isAttr":true,"type":"String"},{"name":"resolution","isAttr":true,"type":"Real"},{"name":"ownedStyle","type":"Style","isReadOnly":true,"isVirtual":true,"isMany":true}]},{"name":"Shape","isAbstract":true,"superClass":["Node"],"properties":[{"name":"bounds","type":"dc:Bounds"}]},{"name":"Plane","isAbstract":true,"superClass":["Node"],"properties":[{"name":"planeElement","type":"DiagramElement","subsettedProperty":"DiagramElement-ownedElement","isMany":true}]},{"name":"LabeledEdge","isAbstract":true,"superClass":["Edge"],"properties":[{"name":"ownedLabel","type":"Label","isReadOnly":true,"subsettedProperty":"DiagramElement-ownedElement","isVirtual":true,"isMany":true}]},{"name":"LabeledShape","isAbstract":true,"superClass":["Shape"],"properties":[{"name":"ownedLabel","type":"Label","isReadOnly":true,"subsettedProperty":"DiagramElement-ownedElement","isVirtual":true,"isMany":true}]},{"name":"Label","isAbstract":true,"superClass":["Node"],"properties":[{"name":"bounds","type":"dc:Bounds"}]},{"name":"Style","isAbstract":true,"properties":[{"name":"id","type":"String","isAttr":true,"isId":true}]},{"name":"Extension","properties":[{"name":"values","type":"Element","isMany":true}]}],"associations":[],"prefix":"di","xml":{"tagAlias":"lowerCase"}}},{}],209:[function(require,module,exports){},{}],210:[function(require,module,exports){var Buffer=require('buffer').Buffer;var isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case'hex':case'utf8':case'utf-8':case'ascii':case'binary':case'base64':case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':case'raw':return true;default:return false;}};function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding)){throw new Error('Unknown encoding: '+encoding);}}var StringDecoder=exports.StringDecoder=function(encoding){this.encoding=(encoding||'utf8').toLowerCase().replace(/[-_]/,'');assertEncoding(encoding);switch(this.encoding){case'utf8':this.surrogateSize=3;break;case'ucs2':case'utf16le':this.surrogateSize=2;this.detectIncompleteChar=utf16DetectIncompleteChar;break;case'base64':this.surrogateSize=3;this.detectIncompleteChar=base64DetectIncompleteChar;break;default:this.write=passThroughWrite;return;}this.charBuffer=new Buffer(6);this.charReceived=0;this.charLength=0;};StringDecoder.prototype.write=function(buffer){var charStr='';while(this.charLength){var available=(buffer.length>=this.charLength-this.charReceived)?this.charLength-this.charReceived:buffer.length;buffer.copy(this.charBuffer,this.charReceived,0,available);this.charReceived+=available;if(this.charReceived<this.charLength){return'';}buffer=buffer.slice(available,buffer.length);charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(charCode>=0xD800&&charCode<=0xDBFF){this.charLength+=this.surrogateSize;charStr='';continue;}this.charReceived=this.charLength=0;if(buffer.length===0){return charStr;}break;}this.detectIncompleteChar(buffer);var end=buffer.length;if(this.charLength){buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end);end-=this.charReceived;}charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1;var charCode=charStr.charCodeAt(end);if(charCode>=0xD800&&charCode<=0xDBFF){var size=this.surrogateSize;this.charLength+=size;this.charReceived+=size;this.charBuffer.copy(this.charBuffer,size,0,size);buffer.copy(this.charBuffer,0,0,size);return charStr.substring(0,end);}return charStr;};StringDecoder.prototype.detectIncompleteChar=function(buffer){var i=(buffer.length>=3)?3:buffer.length;for(;i>0;i--){var c=buffer[buffer.length-i];if(i==1&&c>>5==0x06){this.charLength=2;break;}if(i<=2&&c>>4==0x0E){this.charLength=3;break;}if(i<=3&&c>>3==0x1E){this.charLength=4;break;}}this.charReceived=i;};StringDecoder.prototype.end=function(buffer){var res='';if(buffer&&buffer.length)res=this.write(buffer);if(this.charReceived){var cr=this.charReceived;var buf=this.charBuffer;var enc=this.encoding;res+=buf.slice(0,cr).toString(enc);}return res;};function passThroughWrite(buffer){return buffer.toString(this.encoding);}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2;this.charLength=this.charReceived?2:0;}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3;this.charLength=this.charReceived?3:0;}},{"buffer":211}],211:[function(require,module,exports){(function(global){/*!
  The buffer module from node.js, for the browser.
 
  @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
  @license  MIT
 */'use strict';var base64=require('base64-js');var ieee754=require('ieee754');var isArray=require('isarray');exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=global.TYPED_ARRAY_SUPPORT!==undefined?global.TYPED_ARRAY_SUPPORT:typedArraySupport();exports.kMaxLength=kMaxLength();function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42;}};return arr.foo()===42&&typeof arr.subarray==='function'&&arr.subarray(1,1).byteLength===0;}catch(e){return false;}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?0x7fffffff:0x3fffffff;}function createBuffer(that,length){if(kMaxLength()<length){throw new RangeError('Invalid typed array length');}if(Buffer.TYPED_ARRAY_SUPPORT){that=new Uint8Array(length);that.__proto__=Buffer.prototype;}else{if(that===null){that=new Buffer(length);}that.length=length;}return that;}function Buffer(arg,encodingOrOffset,length){if(!Buffer.TYPED_ARRAY_SUPPORT&&!(this instanceof Buffer)){return new Buffer(arg,encodingOrOffset,length);}if(typeof arg==='number'){if(typeof encodingOrOffset==='string'){throw new Error('If encoding is specified then the first argument must be a string');}return allocUnsafe(this,arg);}return from(this,arg,encodingOrOffset,length);}Buffer.poolSize=8192;Buffer._augment=function(arr){arr.__proto__=Buffer.prototype;return arr;};function from(that,value,encodingOrOffset,length){if(typeof value==='number'){throw new TypeError('"value" argument must not be a number');}if(typeof ArrayBuffer!=='undefined'&&value instanceof ArrayBuffer){return fromArrayBuffer(that,value,encodingOrOffset,length);}if(typeof value==='string'){return fromString(that,value,encodingOrOffset);}return fromObject(that,value);}Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length);};if(Buffer.TYPED_ARRAY_SUPPORT){Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;if(typeof Symbol!=='undefined'&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true});}}function assertSize(size){if(typeof size!=='number'){throw new TypeError('"size" argument must be a number');}else if(size<0){throw new RangeError('"size" argument must not be negative');}}function alloc(that,size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(that,size);}if(fill!==undefined){return typeof encoding==='string'?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill);}return createBuffer(that,size);}Buffer.alloc=function(size,fill,encoding){return alloc(null,size,fill,encoding);};function allocUnsafe(that,size){assertSize(size);that=createBuffer(that,size<0?0:checked(size)|0);if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<size;++i){that[i]=0;}}return that;}Buffer.allocUnsafe=function(size){return allocUnsafe(null,size);};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size);};function fromString(that,string,encoding){if(typeof encoding!=='string'||encoding===''){encoding='utf8';}if(!Buffer.isEncoding(encoding)){throw new TypeError('"encoding" must be a valid string encoding');}var length=byteLength(string,encoding)|0;that=createBuffer(that,length);var actual=that.write(string,encoding);if(actual!==length){that=that.slice(0,actual);}return that;}function fromArrayLike(that,array){var length=array.length<0?0:checked(array.length)|0;that=createBuffer(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255;}return that;}function fromArrayBuffer(that,array,byteOffset,length){array.byteLength;if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError('\'offset\' is out of bounds');}if(array.byteLength<byteOffset+(length||0)){throw new RangeError('\'length\' is out of bounds');}if(byteOffset===undefined&&length===undefined){array=new Uint8Array(array);}else if(length===undefined){array=new Uint8Array(array,byteOffset);}else{array=new Uint8Array(array,byteOffset,length);}if(Buffer.TYPED_ARRAY_SUPPORT){that=array;that.__proto__=Buffer.prototype;}else{that=fromArrayLike(that,array);}return that;}function fromObject(that,obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;that=createBuffer(that,len);if(that.length===0){return that;}obj.copy(that,0,0,len);return that;}if(obj){if((typeof ArrayBuffer!=='undefined'&&obj.buffer instanceof ArrayBuffer)||'length'in obj){if(typeof obj.length!=='number'||isnan(obj.length)){return createBuffer(that,0);}return fromArrayLike(that,obj);}if(obj.type==='Buffer'&&isArray(obj.data)){return fromArrayLike(that,obj.data);}}throw new TypeError('First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.');}function checked(length){if(length>=kMaxLength()){throw new RangeError('Attempt to allocate Buffer larger than maximum '+'size: 0x'+kMaxLength().toString(16)+' bytes');}return length|0;}function SlowBuffer(length){if(+length!=length){length=0;}return Buffer.alloc(+length);}Buffer.isBuffer=function isBuffer(b){return!!(b!=null&&b._isBuffer);};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError('Arguments must be Buffers');}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break;}}if(x<y)return-1;if(y<x)return 1;return 0;};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case'hex':case'utf8':case'utf-8':case'ascii':case'latin1':case'binary':case'base64':case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return true;default:return false;}};Buffer.concat=function concat(list,length){if(!isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers');}if(list.length===0){return Buffer.alloc(0);}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length;}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers');}buf.copy(buffer,pos);pos+=buf.length;}return buffer;};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length;}if(typeof ArrayBuffer!=='undefined'&&typeof ArrayBuffer.isView==='function'&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer)){return string.byteLength;}if(typeof string!=='string'){string=''+string;}var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case'ascii':case'latin1':case'binary':return len
case'utf8':case'utf-8':case undefined:return utf8ToBytes(string).length;case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return len*2;case'hex':return len>>>1;case'base64':return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(''+encoding).toLowerCase();loweredCase=true;}}};Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0;}if(start>this.length){return'';}if(end===undefined||end>this.length){end=this.length;}if(end<=0){return'';}end>>>=0;start>>>=0;if(end<=start){return'';}if(!encoding)encoding='utf8';while(true){switch(encoding){case'hex':return hexSlice(this,start,end);case'utf8':case'utf-8':return utf8Slice(this,start,end);case'ascii':return asciiSlice(this,start,end);case'latin1':case'binary':return latin1Slice(this,start,end);case'base64':return base64Slice(this,start,end);case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError('Unknown encoding: '+encoding);encoding=(encoding+'').toLowerCase();loweredCase=true;}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i;}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError('Buffer size must be a multiple of 16-bits');}for(var i=0;i<len;i+=2){swap(this,i,i+1);}return this;};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError('Buffer size must be a multiple of 32-bits');}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2);}return this;};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError('Buffer size must be a multiple of 64-bits');}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4);}return this;};Buffer.prototype.toString=function toString(){var length=this.length|0;if(length===0)return'';if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments);};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError('Argument must be a Buffer');if(this===b)return true;return Buffer.compare(this,b)===0;};Buffer.prototype.inspect=function inspect(){var str='';var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString('hex',0,max).match(/.{2}/g).join(' ');if(this.length>max)str+=' ... ';}return'<Buffer '+str+'>';};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target)){throw new TypeError('Argument must be a Buffer');}if(start===undefined){start=0;}if(end===undefined){end=target?target.length:0;}if(thisStart===undefined){thisStart=0;}if(thisEnd===undefined){thisEnd=this.length;}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError('out of range index');}if(thisStart>=thisEnd&&start>=end){return 0;}if(thisStart>=thisEnd){return-1;}if(start>=end){return 1;}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break;}}if(x<y)return-1;if(y<x)return 1;return 0;};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==='string'){encoding=byteOffset;byteOffset=0;}else if(byteOffset>0x7fffffff){byteOffset=0x7fffffff;}else if(byteOffset<-0x80000000){byteOffset=-0x80000000;}byteOffset=+byteOffset;if(isNaN(byteOffset)){byteOffset=dir?0:(buffer.length-1);}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1;}else if(byteOffset<0){if(dir)byteOffset=0;else return-1;}if(typeof val==='string'){val=Buffer.from(val,encoding);}if(Buffer.isBuffer(val)){if(val.length===0){return-1;}return arrayIndexOf(buffer,val,byteOffset,encoding,dir);}else if(typeof val==='number'){val=val&0xFF;if(Buffer.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf==='function'){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset);}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset);}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir);}throw new TypeError('val must be string, number or Buffer');}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==='ucs2'||encoding==='ucs-2'||encoding==='utf16le'||encoding==='utf-16le'){if(arr.length<2||val.length<2){return-1;}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2;}}function read(buf,i){if(indexSize===1){return buf[i];}else{return buf.readUInt16BE(i*indexSize);}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize;}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1;}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break;}}if(found)return i;}}return-1;}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1;};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true);};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false);};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining;}else{length=Number(length);if(length>remaining){length=remaining;}}var strLen=string.length;if(strLen%2!==0)throw new TypeError('Invalid hex string');if(length>strLen/2){length=strLen/2;}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed;}return i;}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length);}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length);}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length);}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length);}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length);}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding='utf8';length=this.length;offset=0;}else if(length===undefined&&typeof offset==='string'){encoding=offset;length=this.length;offset=0;}else if(isFinite(offset)){offset=offset|0;if(isFinite(length)){length=length|0;if(encoding===undefined)encoding='utf8';}else{encoding=length;length=undefined;}}else{throw new Error('Buffer.write(string, encoding, offset[, length]) is no longer supported');}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if((string.length>0&&(length<0||offset<0))||offset>this.length){throw new RangeError('Attempt to write outside buffer bounds');}if(!encoding)encoding='utf8';var loweredCase=false;for(;;){switch(encoding){case'hex':return hexWrite(this,string,offset,length);case'utf8':case'utf-8':return utf8Write(this,string,offset,length);case'ascii':return asciiWrite(this,string,offset,length);case'latin1':case'binary':return latin1Write(this,string,offset,length);case'base64':return base64Write(this,string,offset,length);case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError('Unknown encoding: '+encoding);encoding=(''+encoding).toLowerCase();loweredCase=true;}}};Buffer.prototype.toJSON=function toJSON(){return{type:'Buffer',data:Array.prototype.slice.call(this._arr||this,0)};};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf);}else{return base64.fromByteArray(buf.slice(start,end));}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=(firstByte>0xEF)?4:(firstByte>0xDF)?3:(firstByte>0xBF)?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<0x80){codePoint=firstByte;}break;case 2:secondByte=buf[i+1];if((secondByte&0xC0)===0x80){tempCodePoint=(firstByte&0x1F)<<0x6|(secondByte&0x3F);if(tempCodePoint>0x7F){codePoint=tempCodePoint;}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&0xC0)===0x80&&(thirdByte&0xC0)===0x80){tempCodePoint=(firstByte&0xF)<<0xC|(secondByte&0x3F)<<0x6|(thirdByte&0x3F);if(tempCodePoint>0x7FF&&(tempCodePoint<0xD800||tempCodePoint>0xDFFF)){codePoint=tempCodePoint;}}break
case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&0xC0)===0x80&&(thirdByte&0xC0)===0x80&&(fourthByte&0xC0)===0x80){tempCodePoint=(firstByte&0xF)<<0x12|(secondByte&0x3F)<<0xC|(thirdByte&0x3F)<<0x6|(fourthByte&0x3F);if(tempCodePoint>0xFFFF&&tempCodePoint<0x110000){codePoint=tempCodePoint;}}}}if(codePoint===null){codePoint=0xFFFD;bytesPerSequence=1;}else if(codePoint>0xFFFF){codePoint-=0x10000;res.push(codePoint>>>10&0x3FF|0xD800);codePoint=0xDC00|codePoint&0x3FF;}res.push(codePoint);i+=bytesPerSequence;}return decodeCodePointsArray(res);}var MAX_ARGUMENTS_LENGTH=0x1000;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints);}var res='';var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));}return res;}function asciiSlice(buf,start,end){var ret='';end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&0x7F);}return ret;}function latin1Slice(buf,start,end){var ret='';end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]);}return ret;}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out='';for(var i=start;i<end;++i){out+=toHex(buf[i]);}return out;}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res='';for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256);}return res;}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0;}else if(start>len){start=len;}if(end<0){end+=len;if(end<0)end=0;}else if(end>len){end=len;}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype;}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;++i){newBuf[i]=this[i+start];}}return newBuf;};function checkOffset(offset,ext,length){if((offset%1)!==0||offset<0)throw new RangeError('offset is not uint');if(offset+ext>length)throw new RangeError('Trying to access beyond buffer length');}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=0x100)){val+=this[offset+i]*mul;}return val;};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert){checkOffset(offset,byteLength,this.length);}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=0x100)){val+=this[offset+--byteLength]*mul;}return val;};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset];};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|(this[offset+1]<<8);};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return(this[offset]<<8)|this[offset+1];};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return((this[offset])|(this[offset+1]<<8)|(this[offset+2]<<16))+(this[offset+3]*0x1000000);};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]*0x1000000)+((this[offset+1]<<16)|(this[offset+2]<<8)|this[offset+3]);};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=0x100)){val+=this[offset+i]*mul;}mul*=0x80;if(val>=mul)val-=Math.pow(2,8*byteLength);return val;};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=0x100)){val+=this[offset+--i]*mul;}mul*=0x80;if(val>=mul)val-=Math.pow(2,8*byteLength);return val;};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&0x80))return(this[offset]);return((0xff-this[offset]+1)*-1);};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|(this[offset+1]<<8);return(val&0x8000)?val|0xFFFF0000:val;};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|(this[offset]<<8);return(val&0x8000)?val|0xFFFF0000:val;};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset])|(this[offset+1]<<8)|(this[offset+2]<<16)|(this[offset+3]<<24);};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]<<24)|(this[offset+1]<<16)|(this[offset+2]<<8)|(this[offset+3]);};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4);};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4);};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8);};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8);};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError('Index out of range');}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0);}var mul=1;var i=0;this[offset]=value&0xFF;while(++i<byteLength&&(mul*=0x100)){this[offset+i]=(value/mul)&0xFF;}return offset+byteLength;};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0);}var i=byteLength-1;var mul=1;this[offset+i]=value&0xFF;while(--i>=0&&(mul*=0x100)){this[offset+i]=(value/mul)&0xFF;}return offset+byteLength;};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,0xff,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=(value&0xff);return offset+1;};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=0xffff+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i){buf[offset+i]=(value&(0xff<<(8*(littleEndian?i:1-i))))>>>(littleEndian?i:1-i)*8;}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,0xffff,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=(value&0xff);this[offset+1]=(value>>>8);}else{objectWriteUInt16(this,value,offset,true);}return offset+2;};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,0xffff,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=(value>>>8);this[offset+1]=(value&0xff);}else{objectWriteUInt16(this,value,offset,false);}return offset+2;};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=0xffffffff+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i){buf[offset+i]=(value>>>(littleEndian?i:3-i)*8)&0xff;}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,0xffffffff,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=(value>>>24);this[offset+2]=(value>>>16);this[offset+1]=(value>>>8);this[offset]=(value&0xff);}else{objectWriteUInt32(this,value,offset,true);}return offset+4;};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,0xffffffff,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=(value>>>24);this[offset+1]=(value>>>16);this[offset+2]=(value>>>8);this[offset+3]=(value&0xff);}else{objectWriteUInt32(this,value,offset,false);}return offset+4;};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit);}var i=0;var mul=1;var sub=0;this[offset]=value&0xFF;while(++i<byteLength&&(mul*=0x100)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1;}this[offset+i]=((value/mul)>>0)-sub&0xFF;}return offset+byteLength;};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit);}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&0xFF;while(--i>=0&&(mul*=0x100)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1;}this[offset+i]=((value/mul)>>0)-sub&0xFF;}return offset+byteLength;};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,0x7f,-0x80);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=0xff+value+1;this[offset]=(value&0xff);return offset+1;};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,0x7fff,-0x8000);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=(value&0xff);this[offset+1]=(value>>>8);}else{objectWriteUInt16(this,value,offset,true);}return offset+2;};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,0x7fff,-0x8000);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=(value>>>8);this[offset+1]=(value&0xff);}else{objectWriteUInt16(this,value,offset,false);}return offset+2;};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,0x7fffffff,-0x80000000);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=(value&0xff);this[offset+1]=(value>>>8);this[offset+2]=(value>>>16);this[offset+3]=(value>>>24);}else{objectWriteUInt32(this,value,offset,true);}return offset+4;};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,0x7fffffff,-0x80000000);if(value<0)value=0xffffffff+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=(value>>>24);this[offset+1]=(value>>>16);this[offset+2]=(value>>>8);this[offset+3]=(value&0xff);}else{objectWriteUInt32(this,value,offset,false);}return offset+4;};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError('Index out of range');if(offset<0)throw new RangeError('Index out of range');}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e+38,-3.4028234663852886e+38);}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4;}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert);};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert);};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157E+308,-1.7976931348623157E+308);}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8;}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert);};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert);};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError('targetStart out of bounds');}if(start<0||start>=this.length)throw new RangeError('sourceStart out of bounds');if(end<0)throw new RangeError('sourceEnd out of bounds');if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start;}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;--i){target[i+targetStart]=this[i+start];}}else if(len<1000||!Buffer.TYPED_ARRAY_SUPPORT){for(i=0;i<len;++i){target[i+targetStart]=this[i+start];}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart);}return len;};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==='string'){if(typeof start==='string'){encoding=start;start=0;end=this.length;}else if(typeof end==='string'){encoding=end;end=this.length;}if(val.length===1){var code=val.charCodeAt(0);if(code<256){val=code;}}if(encoding!==undefined&&typeof encoding!=='string'){throw new TypeError('encoding must be a string');}if(typeof encoding==='string'&&!Buffer.isEncoding(encoding)){throw new TypeError('Unknown encoding: '+encoding);}}else if(typeof val==='number'){val=val&255;}if(start<0||this.length<start||this.length<end){throw new RangeError('Out of range index');}if(end<=start){return this;}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==='number'){for(i=start;i<end;++i){this[i]=val;}}else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString());var len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len];}}return this;};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,'');if(str.length<2)return'';while(str.length%4!==0){str=str+'=';}return str;}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,'');}function toHex(n){if(n<16)return'0'+n.toString(16);return n.toString(16);}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>0xD7FF&&codePoint<0xE000){if(!leadSurrogate){if(codePoint>0xDBFF){if((units-=3)>-1)bytes.push(0xEF,0xBF,0xBD);continue;}else if(i+1===length){if((units-=3)>-1)bytes.push(0xEF,0xBF,0xBD);continue;}leadSurrogate=codePoint;continue;}if(codePoint<0xDC00){if((units-=3)>-1)bytes.push(0xEF,0xBF,0xBD);leadSurrogate=codePoint;continue;}codePoint=(leadSurrogate-0xD800<<10|codePoint-0xDC00)+0x10000;}else if(leadSurrogate){if((units-=3)>-1)bytes.push(0xEF,0xBF,0xBD);}leadSurrogate=null;if(codePoint<0x80){if((units-=1)<0)break;bytes.push(codePoint);}else if(codePoint<0x800){if((units-=2)<0)break;bytes.push(codePoint>>0x6|0xC0,codePoint&0x3F|0x80);}else if(codePoint<0x10000){if((units-=3)<0)break;bytes.push(codePoint>>0xC|0xE0,codePoint>>0x6&0x3F|0x80,codePoint&0x3F|0x80);}else if(codePoint<0x110000){if((units-=4)<0)break;bytes.push(codePoint>>0x12|0xF0,codePoint>>0xC&0x3F|0x80,codePoint>>0x6&0x3F|0x80,codePoint&0x3F|0x80);}else{throw new Error('Invalid code point');}}return bytes;}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&0xFF);}return byteArray;}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi);}return byteArray;}function base64ToBytes(str){return base64.toByteArray(base64clean(str));}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if((i+offset>=dst.length)||(i>=src.length))break;dst[i+offset]=src[i];}return i;}function isnan(val){return val!==val;}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"base64-js":2,"ieee754":397,"isarray":400}],212:[function(require,module,exports){module.exports={"name":"Camunda","uri":"http://camunda.org/schema/1.0/bpmn","prefix":"camunda","xml":{"tagAlias":"lowerCase"},"associations":[],"types":[{"name":"InOutBinding","superClass":["Element"],"isAbstract":true,"properties":[{"name":"source","isAttr":true,"type":"String"},{"name":"sourceExpression","isAttr":true,"type":"String"},{"name":"target","isAttr":true,"type":"String"},{"name":"businessKey","isAttr":true,"type":"String"},{"name":"local","isAttr":true,"type":"Boolean","default":false},{"name":"variables","isAttr":true,"type":"String"}]},{"name":"In","superClass":["InOutBinding"]},{"name":"Out","superClass":["InOutBinding"]},{"name":"AsyncCapable","isAbstract":true,"extends":["bpmn:Activity","bpmn:Gateway","bpmn:Event"],"properties":[{"name":"async","isAttr":true,"type":"Boolean","default":false},{"name":"asyncBefore","isAttr":true,"type":"Boolean","default":false},{"name":"asyncAfter","isAttr":true,"type":"Boolean","default":false},{"name":"exclusive","isAttr":true,"type":"Boolean","default":true}]},{"name":"JobPriorized","isAbstract":true,"extends":["bpmn:Process","camunda:AsyncCapable"],"properties":[{"name":"jobPriority","isAttr":true,"type":"String"}]},{"name":"SignalEventDefinition","isAbstract":true,"extends":["bpmn:SignalEventDefinition"],"properties":[{"name":"async","isAttr":true,"type":"Boolean","default":false}]},{"name":"ErrorEventDefinition","isAbstract":true,"extends":["bpmn:ErrorEventDefinition"],"properties":[{"name":"errorCodeVariable","isAttr":true,"type":"String"},{"name":"errorMessageVariable","isAttr":true,"type":"String"}]},{"name":"PotentialStarter","superClass":["Element"],"properties":[{"name":"resourceAssignmentExpression","type":"bpmn:ResourceAssignmentExpression"}]},{"name":"FormSupported","isAbstract":true,"extends":["bpmn:StartEvent","bpmn:UserTask"],"properties":[{"name":"formHandlerClass","isAttr":true,"type":"String"},{"name":"formKey","isAttr":true,"type":"String"}]},{"name":"Initiator","isAbstract":true,"extends":["bpmn:StartEvent"],"properties":[{"name":"initiator","isAttr":true,"type":"String"}]},{"name":"ScriptTask","isAbstract":true,"extends":["bpmn:ScriptTask"],"properties":[{"name":"resultVariable","isAttr":true,"type":"String"},{"name":"resource","isAttr":true,"type":"String"}]},{"name":"Process","isAbstract":true,"extends":["bpmn:Process"],"properties":[{"name":"candidateStarterGroups","isAttr":true,"type":"String"},{"name":"candidateStarterUsers","isAttr":true,"type":"String"},{"name":"versionTag","isAttr":true,"type":"String"}]},{"name":"EscalationEventDefinition","isAbstract":true,"extends":["bpmn:EscalationEventDefinition"],"properties":[{"name":"escalationCodeVariable","isAttr":true,"type":"String"}]},{"name":"FormalExpression","isAbstract":true,"extends":["bpmn:FormalExpression"],"properties":[{"name":"resource","isAttr":true,"type":"String"}]},{"name":"Assignable","extends":["bpmn:UserTask"],"properties":[{"name":"assignee","isAttr":true,"type":"String"},{"name":"candidateUsers","isAttr":true,"type":"String"},{"name":"candidateGroups","isAttr":true,"type":"String"},{"name":"dueDate","isAttr":true,"type":"String"},{"name":"followUpDate","isAttr":true,"type":"String"},{"name":"priority","isAttr":true,"type":"String"}]},{"name":"CallActivity","extends":["bpmn:CallActivity"],"properties":[{"name":"calledElementBinding","isAttr":true,"type":"String","default":"latest"},{"name":"calledElementVersion","isAttr":true,"type":"String"},{"name":"calledElementTenantId","isAttr":true,"type":"String"},{"name":"caseRef","isAttr":true,"type":"String"},{"name":"caseBinding","isAttr":true,"type":"String","default":"latest"},{"name":"caseVersion","isAttr":true,"type":"String"},{"name":"caseTenantId","isAttr":true,"type":"String"},{"name":"variableMappingClass","isAttr":true,"type":"String"},{"name":"variableMappingDelegateExpression","isAttr":true,"type":"String"}]},{"name":"ServiceTaskLike","extends":["bpmn:ServiceTask","bpmn:BusinessRuleTask","bpmn:SendTask","bpmn:MessageEventDefinition"],"properties":[{"name":"expression","isAttr":true,"type":"String"},{"name":"class","isAttr":true,"type":"String"},{"name":"delegateExpression","isAttr":true,"type":"String"},{"name":"resultVariable","isAttr":true,"type":"String"}]},{"name":"DmnCapable","extends":["bpmn:BusinessRuleTask"],"properties":[{"name":"decisionRef","isAttr":true,"type":"String"},{"name":"decisionRefBinding","isAttr":true,"type":"String","default":"latest"},{"name":"decisionRefVersion","isAttr":true,"type":"String"},{"name":"mapDecisionResult","isAttr":true,"type":"String","default":"resultList"},{"name":"decisionRefTenantId","isAttr":true,"type":"String"}]},{"name":"ExternalCapable","extends":["camunda:ServiceTaskLike"],"properties":[{"name":"type","isAttr":true,"type":"String"},{"name":"topic","isAttr":true,"type":"String"}]},{"name":"TaskPriorized","extends":["bpmn:Process","camunda:ExternalCapable"],"properties":[{"name":"taskPriority","isAttr":true,"type":"String"}]},{"name":"Properties","superClass":["Element"],"properties":[{"name":"values","type":"Property","isMany":true}]},{"name":"Property","superClass":["Element"],"properties":[{"name":"id","type":"String","isAttr":true},{"name":"name","type":"String","isAttr":true},{"name":"value","type":"String","isAttr":true}]},{"name":"Connector","superClass":["Element"],"properties":[{"name":"inputOutput","type":"InputOutput"},{"name":"connectorId","type":"String"}]},{"name":"InputOutput","superClass":["Element"],"properties":[{"name":"inputOutput","type":"InputOutput"},{"name":"connectorId","type":"String"},{"name":"inputParameters","isMany":true,"type":"InputParameter"},{"name":"outputParameters","isMany":true,"type":"OutputParameter"}]},{"name":"InputOutputParameter","properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"value","isBody":true,"type":"String"},{"name":"definition","type":"InputOutputParameterDefinition"}]},{"name":"InputOutputParameterDefinition","isAbstract":true},{"name":"List","superClass":["InputOutputParameterDefinition"],"properties":[{"name":"items","isMany":true,"type":"InputOutputParameterDefinition"}]},{"name":"Map","superClass":["InputOutputParameterDefinition"],"properties":[{"name":"entries","isMany":true,"type":"Entry"}]},{"name":"Entry","properties":[{"name":"key","isAttr":true,"type":"String"},{"name":"value","isBody":true,"type":"String"},{"name":"definition","type":"InputOutputParameterDefinition"}]},{"name":"Value","superClass":["InputOutputParameterDefinition"],"properties":[{"name":"id","isAttr":true,"type":"String"},{"name":"name","isAttr":true,"type":"String"},{"name":"value","isBody":true,"type":"String"}]},{"name":"Script","superClass":["InputOutputParameterDefinition"],"properties":[{"name":"scriptFormat","isAttr":true,"type":"String"},{"name":"resource","isAttr":true,"type":"String"},{"name":"value","isBody":true,"type":"String"}]},{"name":"Field","superClass":["Element"],"properties":[{"name":"name","isAttr":true,"type":"String"},{"name":"expression","type":"String"},{"name":"stringValue","isAttr":true,"type":"String"},{"name":"string","type":"String"}]},{"name":"InputParameter","superClass":["InputOutputParameter"]},{"name":"OutputParameter","superClass":["InputOutputParameter"]},{"name":"Collectable","isAbstract":true,"extends":["bpmn:MultiInstanceLoopCharacteristics"],"superClass":["camunda:AsyncCapable"],"properties":[{"name":"collection","isAttr":true,"type":"String"},{"name":"elementVariable","isAttr":true,"type":"String"}]},{"name":"FailedJobRetryTimeCycle","superClass":["Element"],"properties":[{"name":"body","isBody":true,"type":"String"}]},{"name":"ExecutionListener","superClass":["Element"],"properties":[{"name":"expression","isAttr":true,"type":"String"},{"name":"class","isAttr":true,"type":"String"},{"name":"delegateExpression","isAttr":true,"type":"String"},{"name":"event","isAttr":true,"type":"String"},{"name":"script","type":"Script"},{"name":"fields","type":"Field","isMany":true}]},{"name":"TaskListener","superClass":["Element"],"properties":[{"name":"expression","isAttr":true,"type":"String"},{"name":"class","isAttr":true,"type":"String"},{"name":"delegateExpression","isAttr":true,"type":"String"},{"name":"event","isAttr":true,"type":"String"},{"name":"script","type":"Script"},{"name":"fields","type":"Field","isMany":true}]},{"name":"FormProperty","superClass":["Element"],"properties":[{"name":"id","type":"String","isAttr":true},{"name":"name","type":"String","isAttr":true},{"name":"type","type":"String","isAttr":true},{"name":"required","type":"String","isAttr":true},{"name":"readable","type":"String","isAttr":true},{"name":"writable","type":"String","isAttr":true},{"name":"variable","type":"String","isAttr":true},{"name":"expression","type":"String","isAttr":true},{"name":"datePattern","type":"String","isAttr":true},{"name":"default","type":"String","isAttr":true},{"name":"values","type":"Value","isMany":true}]},{"name":"FormData","superClass":["Element"],"properties":[{"name":"fields","type":"FormField","isMany":true},{"name":"businessKey","type":"String","isAttr":true}]},{"name":"FormField","superClass":["Element"],"properties":[{"name":"id","type":"String","isAttr":true},{"name":"label","type":"String","isAttr":true},{"name":"type","type":"String","isAttr":true},{"name":"datePattern","type":"String","isAttr":true},{"name":"defaultValue","type":"String","isAttr":true},{"name":"properties","type":"Properties"},{"name":"validation","type":"Validation"},{"name":"values","type":"Value","isMany":true}]},{"name":"Validation","superClass":["Element"],"properties":[{"name":"constraints","type":"Constraint","isMany":true}]},{"name":"Constraint","superClass":["Element"],"properties":[{"name":"name","type":"String","isAttr":true},{"name":"config","type":"String","isAttr":true}]}],"emumerations":[]}},{}],213:[function(require,module,exports){try{var index=require('indexof');}catch(err){var index=require('component-indexof');}var re=/\s+/;var toString=Object.prototype.toString;module.exports=function(el){return new ClassList(el);};function ClassList(el){if(!el||!el.nodeType){throw new Error('A DOM element reference is required');}this.el=el;this.list=el.classList;}ClassList.prototype.add=function(name){if(this.list){this.list.add(name);return this;}var arr=this.array();var i=index(arr,name);if(!~i)arr.push(name);this.el.className=arr.join(' ');return this;};ClassList.prototype.remove=function(name){if('[object RegExp]'==toString.call(name)){return this.removeMatching(name);}if(this.list){this.list.remove(name);return this;}var arr=this.array();var i=index(arr,name);if(~i)arr.splice(i,1);this.el.className=arr.join(' ');return this;};ClassList.prototype.removeMatching=function(re){var arr=this.array();for(var i=0;i<arr.length;i++){if(re.test(arr[i])){this.remove(arr[i]);}}return this;};ClassList.prototype.toggle=function(name,force){if(this.list){if("undefined"!==typeof force){if(force!==this.list.toggle(name,force)){this.list.toggle(name);}}else{this.list.toggle(name);}return this;}if("undefined"!==typeof force){if(!force){this.remove(name);}else{this.add(name);}}else{if(this.has(name)){this.remove(name);}else{this.add(name);}}return this;};ClassList.prototype.array=function(){var className=this.el.getAttribute('class')||'';var str=className.replace(/^\s+|\s+$/g,'');var arr=str.split(re);if(''===arr[0])arr.shift();return arr;};ClassList.prototype.has=ClassList.prototype.contains=function(name){return this.list?this.list.contains(name):!!~index(this.array(),name);};},{"component-indexof":217,"indexof":217}],214:[function(require,module,exports){var matches=require('matches-selector');module.exports=function(element,selector,checkYoSelf,root){element=checkYoSelf?{parentNode:element}:element;root=root||document;while((element=element.parentNode)&&element!==document){if(matches(element,selector))return element;if(element===root)return;}};},{"matches-selector":218}],215:[function(require,module,exports){try{var closest=require('closest');}catch(err){var closest=require('component-closest');}try{var event=require('event');}catch(err){var event=require('component-event');}exports.bind=function(el,selector,type,fn,capture){return event.bind(el,type,function(e){var target=e.target||e.srcElement;e.delegateTarget=closest(target,selector,true,el);if(e.delegateTarget)fn.call(el,e);},capture);};exports.unbind=function(el,type,fn,capture){event.unbind(el,type,fn,capture);};},{"closest":214,"component-closest":214,"component-event":216,"event":216}],216:[function(require,module,exports){var bind=window.addEventListener?'addEventListener':'attachEvent',unbind=window.removeEventListener?'removeEventListener':'detachEvent',prefix=bind!=='addEventListener'?'on':'';exports.bind=function(el,type,fn,capture){el[bind](prefix+type,fn,capture||false);return fn;};exports.unbind=function(el,type,fn,capture){el[unbind](prefix+type,fn,capture||false);return fn;};},{}],217:[function(require,module,exports){module.exports=function(arr,obj){if(arr.indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i;}return-1;};},{}],218:[function(require,module,exports){try{var query=require('query');}catch(err){var query=require('component-query');}var proto=Element.prototype;var vendor=proto.matches||proto.webkitMatchesSelector||proto.mozMatchesSelector||proto.msMatchesSelector||proto.oMatchesSelector;module.exports=match;function match(el,selector){if(!el||el.nodeType!==1)return false;if(vendor)return vendor.call(el,selector);var nodes=query.all(selector,el.parentNode);for(var i=0;i<nodes.length;++i){if(nodes[i]==el)return true;}return false;}},{"component-query":219,"query":219}],219:[function(require,module,exports){function one(selector,el){return el.querySelector(selector);}exports=module.exports=function(selector,el){el=el||document;return one(selector,el);};exports.all=function(selector,el){el=el||document;return el.querySelectorAll(selector);};exports.engine=function(obj){if(!obj.one)throw new Error('.one callback required');if(!obj.all)throw new Error('.all callback required');one=obj.one;exports.all=obj.all;return exports;};},{}],220:[function(require,module,exports){(function(Buffer){function isArray(arg){if(Array.isArray){return Array.isArray(arg);}return objectToString(arg)==='[object Array]';}exports.isArray=isArray;function isBoolean(arg){return typeof arg==='boolean';}exports.isBoolean=isBoolean;function isNull(arg){return arg===null;}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null;}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==='number';}exports.isNumber=isNumber;function isString(arg){return typeof arg==='string';}exports.isString=isString;function isSymbol(arg){return typeof arg==='symbol';}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0;}exports.isUndefined=isUndefined;function isRegExp(re){return objectToString(re)==='[object RegExp]';}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==='object'&&arg!==null;}exports.isObject=isObject;function isDate(d){return objectToString(d)==='[object Date]';}exports.isDate=isDate;function isError(e){return(objectToString(e)==='[object Error]'||e instanceof Error);}exports.isError=isError;function isFunction(arg){return typeof arg==='function';}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==='boolean'||typeof arg==='number'||typeof arg==='string'||typeof arg==='symbol'||typeof arg==='undefined';}exports.isPrimitive=isPrimitive;exports.isBuffer=Buffer.isBuffer;function objectToString(o){return Object.prototype.toString.call(o);}}).call(this,{"isBuffer":require("../../is-buffer/index.js")})},{"../../is-buffer/index.js":399}],221:[function(require,module,exports){module.exports={__depends__:[require('diagram-js/lib/features/interaction-events')],__init__:['directEditing'],directEditing:['type',require('./lib/DirectEditing')]};},{"./lib/DirectEditing":222,"diagram-js/lib/features/interaction-events":277}],222:[function(require,module,exports){'use strict';var bind=require('lodash/function/bind'),find=require('lodash/collection/find');var TextBox=require('./TextBox');function DirectEditing(eventBus,canvas){this._eventBus=eventBus;this._providers=[];this._textbox=new TextBox({container:canvas.getContainer(),keyHandler:bind(this._handleKey,this)});}DirectEditing.$inject=['eventBus','canvas'];DirectEditing.prototype.registerProvider=function(provider){this._providers.push(provider);};DirectEditing.prototype.isActive=function(){return!!this._active;};DirectEditing.prototype.cancel=function(){if(!this._active){return;}this._fire('cancel');this.close();};DirectEditing.prototype._fire=function(event){this._eventBus.fire('directEditing.'+event,{active:this._active});};DirectEditing.prototype.close=function(){this._textbox.destroy();this._fire('deactivate');this._active=null;};DirectEditing.prototype.complete=function(){var active=this._active;if(!active){return;}var text=this.getValue();if(text!==active.context.text){active.provider.update(active.element,text,active.context.text);}this._fire('complete');this.close();};DirectEditing.prototype.getValue=function(){return this._textbox.getValue();};DirectEditing.prototype._handleKey=function(e){e.stopPropagation();var key=e.keyCode||e.charCode;if(key===27){e.preventDefault();return this.cancel();}if(key===13&&!e.shiftKey){e.preventDefault();return this.complete();}};DirectEditing.prototype.activate=function(element){if(this.isActive()){this.cancel();}var context;var provider=find(this._providers,function(p){return(context=p.activate(element))?p:null;});if(context){this._textbox.create(context.bounds,context.style,context.text);this._active={element:element,context:context,provider:provider};this._fire('activate');}return!!context;};module.exports=DirectEditing;},{"./TextBox":223,"lodash/collection/find":416,"lodash/function/bind":427}],223:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign'),domEvent=require('min-dom/lib/event'),domRemove=require('min-dom/lib/remove');function stopPropagation(event){event.stopPropagation();}function TextBox(options){this.container=options.container;this.content=document.createElement('div');this.content.contentEditable='true';this.keyHandler=options.keyHandler||function(){};}module.exports=TextBox;TextBox.prototype.create=function(bounds,style,value){var content=this.content,container=this.container;assign(content.style,{width:bounds.width+'px',height:bounds.height+'px',maxWidth:bounds.maxWidth+'px',maxHeight:bounds.maxHeight+'px',minWidth:bounds.minWidth+'px',minHeight:bounds.minHeight+'px',left:bounds.x+'px',top:bounds.y+'px',backgroundColor:'#ffffff',position:'absolute',overflowY:'auto',border:'1px solid #ccc',padding:'2px',wordWrap:'normal',textAlign:'center',outline:'none'},style||{});content.innerText=value;domEvent.bind(content,'keydown',this.keyHandler);domEvent.bind(content,'mousedown',stopPropagation);container.appendChild(content);this.setCursor();return content;};TextBox.prototype.destroy=function(){var content=this.content;content.innerText='';assign(content.style,{width:'',height:'',maxWidth:'',maxHeight:'',minWidth:'',minHeight:''});domEvent.unbind(content,'keydown',this.keyHandler);domEvent.unbind(content,'mousedown',stopPropagation);domRemove(content);};TextBox.prototype.getValue=function(){return this.content.innerText;};TextBox.prototype.setCursor=function(){this.content.focus();this.content.scrollTop=this.content.scrollHeight;if(typeof window.getSelection!='undefined'&&typeof document.createRange!='undefined'){var range=document.createRange();range.selectNodeContents(this.content);range.collapse(false);var selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);}else if(typeof document.body.createTextRange!='undefined'){var textRange=document.body.createTextRange();textRange.moveToElementText(this.content);textRange.collapse(false);textRange.select();}};},{"lodash/object/assign":547,"min-dom/lib/event":567,"min-dom/lib/remove":570}],224:[function(require,module,exports){module.exports=require('./lib/Diagram');},{"./lib/Diagram":225}],225:[function(require,module,exports){'use strict';var di=require('didi');function bootstrap(bootstrapModules){var modules=[],components=[];function hasModule(m){return modules.indexOf(m)>=0;}function addModule(m){modules.push(m);}function visit(m){if(hasModule(m)){return;}(m.__depends__||[]).forEach(visit);if(hasModule(m)){return;}addModule(m);(m.__init__||[]).forEach(function(c){components.push(c);});}bootstrapModules.forEach(visit);var injector=new di.Injector(modules);components.forEach(function(c){try{injector[typeof c==='string'?'get':'invoke'](c);}catch(e){console.error('Failed to instantiate component');console.error(e.stack);throw e;}});return injector;}function createInjector(options){options=options||{};var configModule={'config':['value',options]};var coreModule=require('./core');var modules=[configModule,coreModule].concat(options.modules||[]);return bootstrap(modules);}function Diagram(options,injector){this.injector=injector=injector||createInjector(options);this.get=injector.get;this.invoke=injector.invoke;this.get('eventBus').fire('diagram.init');}module.exports=Diagram;Diagram.prototype.destroy=function(){this.get('eventBus').fire('diagram.destroy');};Diagram.prototype.clear=function(){this.get('eventBus').fire('diagram.clear');};},{"./core":234,"didi":389}],226:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach'),isFunction=require('lodash/lang/isFunction'),isArray=require('lodash/lang/isArray'),isNumber=require('lodash/lang/isNumber');var DEFAULT_PRIORITY=1000;function isObject(element){return typeof element==='object';}function CommandInterceptor(eventBus){this._eventBus=eventBus;}CommandInterceptor.$inject=['eventBus'];module.exports=CommandInterceptor;function unwrapEvent(fn,that){return function(event){return fn.call(that||null,event.context,event.command,event);};}CommandInterceptor.prototype.on=function(events,hook,priority,handlerFn,unwrap,that){if(isFunction(hook)||isNumber(hook)){that=unwrap;unwrap=handlerFn;handlerFn=priority;priority=hook;hook=null;}if(isFunction(priority)){that=unwrap;unwrap=handlerFn;handlerFn=priority;priority=DEFAULT_PRIORITY;}if(isObject(unwrap)){that=unwrap;unwrap=false;}if(!isFunction(handlerFn)){throw new Error('handlerFn must be a function');}if(!isArray(events)){events=[events];}var eventBus=this._eventBus;forEach(events,function(event){var fullEvent=['commandStack',event,hook].filter(function(e){return e;}).join('.');eventBus.on(fullEvent,priority,unwrap?unwrapEvent(handlerFn,that):handlerFn,that);});};var hooks=['canExecute','preExecute','preExecuted','execute','executed','postExecute','postExecuted','revert','reverted'];forEach(hooks,function(hook){CommandInterceptor.prototype[hook]=function(events,priority,handlerFn,unwrap,that){if(isFunction(events)||isNumber(events)){that=unwrap;unwrap=handlerFn;handlerFn=priority;priority=events;events=null;}this.on(events,hook,priority,handlerFn,unwrap,that);};});},{"lodash/collection/forEach":417,"lodash/lang/isArray":537,"lodash/lang/isFunction":539,"lodash/lang/isNumber":541}],227:[function(require,module,exports){'use strict';var unique=require('lodash/array/unique'),isArray=require('lodash/lang/isArray'),assign=require('lodash/object/assign');var InternalEvent=require('../core/EventBus').Event;function CommandStack(eventBus,injector){this._handlerMap={};this._stack=[];this._stackIdx=-1;this._currentExecution={actions:[],dirty:[]};this._injector=injector;this._eventBus=eventBus;this._uid=1;eventBus.on(['diagram.destroy','diagram.clear'],this.clear,this);}CommandStack.$inject=['eventBus','injector'];module.exports=CommandStack;CommandStack.prototype.execute=function(command,context){if(!command){throw new Error('command required');}var action={command:command,context:context};this._pushAction(action);this._internalExecute(action);this._popAction(action);};CommandStack.prototype.canExecute=function(command,context){var action={command:command,context:context};var handler=this._getHandler(command);var result=this._fire(command,'canExecute',action);if(result===undefined){if(!handler){return false;}if(handler.canExecute){result=handler.canExecute(context);}}return result;};CommandStack.prototype.clear=function(){this._stack.length=0;this._stackIdx=-1;this._fire('changed');};CommandStack.prototype.undo=function(){var action=this._getUndoAction(),next;if(action){this._pushAction(action);while(action){this._internalUndo(action);next=this._getUndoAction();if(!next||next.id!==action.id){break;}action=next;}this._popAction();}};CommandStack.prototype.redo=function(){var action=this._getRedoAction(),next;if(action){this._pushAction(action);while(action){this._internalExecute(action,true);next=this._getRedoAction();if(!next||next.id!==action.id){break;}action=next;}this._popAction();}};CommandStack.prototype.register=function(command,handler){this._setHandler(command,handler);};CommandStack.prototype.registerHandler=function(command,handlerCls){if(!command||!handlerCls){throw new Error('command and handlerCls must be defined');}var handler=this._injector.instantiate(handlerCls);this.register(command,handler);};CommandStack.prototype.canUndo=function(){return!!this._getUndoAction();};CommandStack.prototype.canRedo=function(){return!!this._getRedoAction();};CommandStack.prototype._getRedoAction=function(){return this._stack[this._stackIdx+1];};CommandStack.prototype._getUndoAction=function(){return this._stack[this._stackIdx];};CommandStack.prototype._internalUndo=function(action){var self=this;var command=action.command,context=action.context;var handler=this._getHandler(command);this._atomicDo(function(){self._fire(command,'revert',action);if(handler.revert){self._markDirty(handler.revert(context));}self._revertedAction(action);self._fire(command,'reverted',action);});};CommandStack.prototype._fire=function(command,qualifier,event){if(arguments.length<3){event=qualifier;qualifier=null;}var names=qualifier?[command+'.'+qualifier,qualifier]:[command],i,name,result;event=assign(new InternalEvent(),event);for(i=0;(name=names[i]);i++){result=this._eventBus.fire('commandStack.'+name,event);if(event.cancelBubble){break;}}return result;};CommandStack.prototype._createId=function(){return this._uid++;};CommandStack.prototype._atomicDo=function(fn){var execution=this._currentExecution;execution.atomic=true;try{fn();}finally{execution.atomic=false;}};CommandStack.prototype._internalExecute=function(action,redo){var self=this;var command=action.command,context=action.context;var handler=this._getHandler(command);if(!handler){throw new Error('no command handler registered for <'+command+'>');}this._pushAction(action);if(!redo){this._fire(command,'preExecute',action);if(handler.preExecute){handler.preExecute(context);}this._fire(command,'preExecuted',action);}this._atomicDo(function(){self._fire(command,'execute',action);if(handler.execute){self._markDirty(handler.execute(context));}self._executedAction(action,redo);self._fire(command,'executed',action);});if(!redo){this._fire(command,'postExecute',action);if(handler.postExecute){handler.postExecute(context);}this._fire(command,'postExecuted',action);}this._popAction(action);};CommandStack.prototype._pushAction=function(action){var execution=this._currentExecution,actions=execution.actions;var baseAction=actions[0];if(execution.atomic){throw new Error('illegal invocation in <execute> or <revert> phase (action: '+action.command+')');}if(!action.id){action.id=(baseAction&&baseAction.id)||this._createId();}actions.push(action);};CommandStack.prototype._popAction=function(){var execution=this._currentExecution,actions=execution.actions,dirty=execution.dirty;actions.pop();if(!actions.length){this._eventBus.fire('elements.changed',{elements:unique(dirty)});dirty.length=0;this._fire('changed');}};CommandStack.prototype._markDirty=function(elements){var execution=this._currentExecution;if(!elements){return;}elements=isArray(elements)?elements:[elements];execution.dirty=execution.dirty.concat(elements);};CommandStack.prototype._executedAction=function(action,redo){var stackIdx=++this._stackIdx;if(!redo){this._stack.splice(stackIdx,this._stack.length,action);}};CommandStack.prototype._revertedAction=function(action){this._stackIdx--;};CommandStack.prototype._getHandler=function(command){return this._handlerMap[command];};CommandStack.prototype._setHandler=function(command,handler){if(!command||!handler){throw new Error('command and handler required');}if(this._handlerMap[command]){throw new Error('overriding handler for command <'+command+'>');}this._handlerMap[command]=handler;};},{"../core/EventBus":232,"lodash/array/unique":409,"lodash/lang/isArray":537,"lodash/object/assign":547}],228:[function(require,module,exports){module.exports={commandStack:['type',require('./CommandStack')]};},{"./CommandStack":227}],229:[function(require,module,exports){'use strict';var isNumber=require('lodash/lang/isNumber'),assign=require('lodash/object/assign'),forEach=require('lodash/collection/forEach'),every=require('lodash/collection/every'),debounce=require('lodash/function/debounce');var Collections=require('../util/Collections'),Elements=require('../util/Elements');var svgAppend=require('tiny-svg/lib/append'),svgAttr=require('tiny-svg/lib/attr'),svgClasses=require('tiny-svg/lib/classes'),svgCreate=require('tiny-svg/lib/create'),svgTransform=require('tiny-svg/lib/transform');var createMatrix=require('tiny-svg/lib/geometry').createMatrix;function round(number,resolution){return Math.round(number*resolution)/resolution;}function ensurePx(number){return isNumber(number)?number+'px':number;}function createContainer(options){options=assign({},{width:'100%',height:'100%'},options);var container=options.container||document.body;var parent=document.createElement('div');parent.setAttribute('class','djs-container');assign(parent.style,{position:'relative',overflow:'hidden',width:ensurePx(options.width),height:ensurePx(options.height)});container.appendChild(parent);return parent;}function createGroup(parent,cls){var group=svgCreate('g');svgClasses(group).add(cls);svgAppend(parent,group);return group;}var BASE_LAYER='base';var REQUIRED_MODEL_ATTRS={shape:['x','y','width','height'],connection:['waypoints']};function Canvas(config,eventBus,graphicsFactory,elementRegistry){this._eventBus=eventBus;this._elementRegistry=elementRegistry;this._graphicsFactory=graphicsFactory;this._init(config||{});}Canvas.$inject=['config.canvas','eventBus','graphicsFactory','elementRegistry'];module.exports=Canvas;Canvas.prototype._init=function(config){var eventBus=this._eventBus;var container=this._container=createContainer(config);var svg=this._svg=svgCreate('svg');svgAttr(svg,{width:'100%',height:'100%'});svgAppend(container,svg);var viewport=this._viewport=createGroup(svg,'viewport');this._layers={};if(config.deferUpdate!==false){this._viewboxChanged=debounce(this._viewboxChanged,300);}eventBus.on('diagram.init',function(){eventBus.fire('canvas.init',{svg:svg,viewport:viewport});this.resized();},this);eventBus.on('diagram.destroy',500,this._destroy,this);eventBus.on('diagram.clear',500,this._clear,this);};Canvas.prototype._destroy=function(emit){this._eventBus.fire('canvas.destroy',{svg:this._svg,viewport:this._viewport});var parent=this._container.parentNode;if(parent){parent.removeChild(this._container);}delete this._svg;delete this._container;delete this._layers;delete this._rootElement;delete this._viewport;};Canvas.prototype._clear=function(){var self=this;var allElements=this._elementRegistry.getAll();allElements.forEach(function(element){var type=Elements.getType(element);if(type==='root'){self.setRootElement(null,true);}else{self._removeElement(element,type);}});delete this._cachedViewbox;};Canvas.prototype.getDefaultLayer=function(){return this.getLayer(BASE_LAYER);};Canvas.prototype.getLayer=function(name){if(!name){throw new Error('must specify a name');}var layer=this._layers[name];if(!layer){layer=this._layers[name]=createGroup(this._viewport,'layer-'+name);}return layer;};Canvas.prototype.getContainer=function(){return this._container;};Canvas.prototype._updateMarker=function(element,marker,add){var container;if(!element.id){element=this._elementRegistry.get(element);}container=this._elementRegistry._elements[element.id];if(!container){return;}forEach([container.gfx,container.secondaryGfx],function(gfx){if(gfx){if(add){svgClasses(gfx).add(marker);}else{svgClasses(gfx).remove(marker);}}});this._eventBus.fire('element.marker.update',{element:element,gfx:container.gfx,marker:marker,add:!!add});};Canvas.prototype.addMarker=function(element,marker){this._updateMarker(element,marker,true);};Canvas.prototype.removeMarker=function(element,marker){this._updateMarker(element,marker,false);};Canvas.prototype.hasMarker=function(element,marker){if(!element.id){element=this._elementRegistry.get(element);}var gfx=this.getGraphics(element);return svgClasses(gfx).has(marker);};Canvas.prototype.toggleMarker=function(element,marker){if(this.hasMarker(element,marker)){this.removeMarker(element,marker);}else{this.addMarker(element,marker);}};Canvas.prototype.getRootElement=function(){if(!this._rootElement){this.setRootElement({id:'__implicitroot',children:[]});}return this._rootElement;};Canvas.prototype.setRootElement=function(element,override){if(element){this._ensureValid('root',element);}var currentRoot=this._rootElement,elementRegistry=this._elementRegistry,eventBus=this._eventBus;if(currentRoot){if(!override){throw new Error('rootElement already set, need to specify override');}eventBus.fire('root.remove',{element:currentRoot});eventBus.fire('root.removed',{element:currentRoot});elementRegistry.remove(currentRoot);}if(element){var gfx=this.getDefaultLayer();eventBus.fire('root.add',{element:element});elementRegistry.add(element,gfx,this._svg);eventBus.fire('root.added',{element:element,gfx:gfx});}this._rootElement=element;return element;};Canvas.prototype._ensureValid=function(type,element){if(!element.id){throw new Error('element must have an id');}if(this._elementRegistry.get(element.id)){throw new Error('element with id '+element.id+' already exists');}var requiredAttrs=REQUIRED_MODEL_ATTRS[type];var valid=every(requiredAttrs,function(attr){return typeof element[attr]!=='undefined';});if(!valid){throw new Error('must supply { '+requiredAttrs.join(', ')+' } with '+type);}};Canvas.prototype._setParent=function(element,parent,parentIndex){Collections.add(parent.children,element,parentIndex);element.parent=parent;};Canvas.prototype._addElement=function(type,element,parent,parentIndex){parent=parent||this.getRootElement();var eventBus=this._eventBus,graphicsFactory=this._graphicsFactory;this._ensureValid(type,element);eventBus.fire(type+'.add',{element:element,parent:parent});this._setParent(element,parent,parentIndex);var gfx=graphicsFactory.create(type,element);this._elementRegistry.add(element,gfx);graphicsFactory.update(type,element,gfx);eventBus.fire(type+'.added',{element:element,gfx:gfx});return element;};Canvas.prototype.addShape=function(shape,parent,parentIndex){return this._addElement('shape',shape,parent,parentIndex);};Canvas.prototype.addConnection=function(connection,parent,parentIndex){return this._addElement('connection',connection,parent,parentIndex);};Canvas.prototype._removeElement=function(element,type){var elementRegistry=this._elementRegistry,graphicsFactory=this._graphicsFactory,eventBus=this._eventBus;element=elementRegistry.get(element.id||element);if(!element){return;}eventBus.fire(type+'.remove',{element:element});graphicsFactory.remove(element);Collections.remove(element.parent&&element.parent.children,element);element.parent=null;eventBus.fire(type+'.removed',{element:element});elementRegistry.remove(element);return element;};Canvas.prototype.removeShape=function(shape){return this._removeElement(shape,'shape');};Canvas.prototype.removeConnection=function(connection){return this._removeElement(connection,'connection');};Canvas.prototype.getGraphics=function(element,secondary){return this._elementRegistry.getGraphics(element,secondary);};Canvas.prototype._changeViewbox=function(changeFn){this._eventBus.fire('canvas.viewbox.changing');changeFn.apply(this);this._cachedViewbox=null;this._viewboxChanged();};Canvas.prototype._viewboxChanged=function(){this._eventBus.fire('canvas.viewbox.changed',{viewbox:this.viewbox()});};Canvas.prototype.viewbox=function(box){if(box===undefined&&this._cachedViewbox){return this._cachedViewbox;}var viewport=this._viewport,innerBox,outerBox=this.getSize(),matrix,scale,x,y;if(!box){innerBox=this.getDefaultLayer().getBBox();var transform=svgTransform(viewport);matrix=transform?transform.matrix:createMatrix();scale=round(matrix.a,1000);x=round(-matrix.e||0,1000);y=round(-matrix.f||0,1000);box=this._cachedViewbox={x:x?x/scale:0,y:y?y/scale:0,width:outerBox.width/scale,height:outerBox.height/scale,scale:scale,inner:{width:innerBox.width,height:innerBox.height,x:innerBox.x,y:innerBox.y},outer:outerBox};return box;}else{this._changeViewbox(function(){scale=Math.min(outerBox.width/box.width,outerBox.height/box.height);var matrix=this._svg.createSVGMatrix().scale(scale).translate(-box.x,-box.y);svgTransform(viewport,matrix);});}return box;};Canvas.prototype.scroll=function(delta){var node=this._viewport;var matrix=node.getCTM();if(delta){this._changeViewbox(function(){delta=assign({dx:0,dy:0},delta||{});matrix=this._svg.createSVGMatrix().translate(delta.dx,delta.dy).multiply(matrix);setCTM(node,matrix);});}return{x:matrix.e,y:matrix.f};};Canvas.prototype.zoom=function(newScale,center){if(!newScale){return this.viewbox(newScale).scale;}if(newScale==='fit-viewport'){return this._fitViewport(center);}var outer,matrix;this._changeViewbox(function(){if(typeof center!=='object'){outer=this.viewbox().outer;center={x:outer.width/2,y:outer.height/2};}matrix=this._setZoom(newScale,center);});return round(matrix.a,1000);};function setCTM(node,m){var mstr='matrix('+m.a+','+m.b+','+m.c+','+m.d+','+m.e+','+m.f+')';node.setAttribute('transform',mstr);}Canvas.prototype._fitViewport=function(center){var vbox=this.viewbox(),outer=vbox.outer,inner=vbox.inner,newScale,newViewbox;if(inner.x>=0&&inner.y>=0&&inner.x+inner.width<=outer.width&&inner.y+inner.height<=outer.height&&!center){newViewbox={x:0,y:0,width:Math.max(inner.width+inner.x,outer.width),height:Math.max(inner.height+inner.y,outer.height)};}else{newScale=Math.min(1,outer.width/inner.width,outer.height/inner.height);newViewbox={x:inner.x+(center?inner.width/2-outer.width/newScale/2:0),y:inner.y+(center?inner.height/2-outer.height/newScale/2:0),width:outer.width/newScale,height:outer.height/newScale};}this.viewbox(newViewbox);return this.viewbox(false).scale;};Canvas.prototype._setZoom=function(scale,center){var svg=this._svg,viewport=this._viewport;var matrix=svg.createSVGMatrix();var point=svg.createSVGPoint();var centerPoint,originalPoint,currentMatrix,scaleMatrix,newMatrix;currentMatrix=viewport.getCTM();var currentScale=currentMatrix.a;if(center){centerPoint=assign(point,center);originalPoint=centerPoint.matrixTransform(currentMatrix.inverse());scaleMatrix=matrix.translate(originalPoint.x,originalPoint.y).scale(1/currentScale*scale).translate(-originalPoint.x,-originalPoint.y);newMatrix=currentMatrix.multiply(scaleMatrix);}else{newMatrix=matrix.scale(scale);}setCTM(this._viewport,newMatrix);return newMatrix;};Canvas.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight};};Canvas.prototype.getAbsoluteBBox=function(element){var vbox=this.viewbox();var bbox;if(element.waypoints){var gfx=this.getGraphics(element);var transformBBox=gfx.getBBox(true);bbox=gfx.getBBox();bbox.x-=transformBBox.x;bbox.y-=transformBBox.y;bbox.width+=2*transformBBox.x;bbox.height+=2*transformBBox.y;}else{bbox=element;}var x=bbox.x*vbox.scale-vbox.x*vbox.scale;var y=bbox.y*vbox.scale-vbox.y*vbox.scale;var width=bbox.width*vbox.scale;var height=bbox.height*vbox.scale;return{x:x,y:y,width:width,height:height};};Canvas.prototype.resized=function(){delete this._cachedViewbox;this._eventBus.fire('canvas.resized');};},{"../util/Collections":370,"../util/Elements":373,"lodash/collection/every":414,"lodash/collection/forEach":417,"lodash/function/debounce":428,"lodash/lang/isNumber":541,"lodash/object/assign":547,"tiny-svg/lib/append":607,"tiny-svg/lib/attr":609,"tiny-svg/lib/classes":610,"tiny-svg/lib/create":613,"tiny-svg/lib/geometry":614,"tiny-svg/lib/transform":617}],230:[function(require,module,exports){'use strict';var Model=require('../model');var assign=require('lodash/object/assign');function ElementFactory(){this._uid=12;}module.exports=ElementFactory;ElementFactory.prototype.createRoot=function(attrs){return this.create('root',attrs);};ElementFactory.prototype.createLabel=function(attrs){return this.create('label',attrs);};ElementFactory.prototype.createShape=function(attrs){return this.create('shape',attrs);};ElementFactory.prototype.createConnection=function(attrs){return this.create('connection',attrs);};ElementFactory.prototype.create=function(type,attrs){attrs=assign({},attrs||{});if(!attrs.id){attrs.id=type+'_'+(this._uid++);}return Model.create(type,attrs);};},{"../model":361,"lodash/object/assign":547}],231:[function(require,module,exports){'use strict';var ELEMENT_ID='data-element-id';var svgAttr=require('tiny-svg/lib/attr');function ElementRegistry(eventBus){this._elements={};this._eventBus=eventBus;}ElementRegistry.$inject=['eventBus'];module.exports=ElementRegistry;ElementRegistry.prototype.add=function(element,gfx,secondaryGfx){var id=element.id;this._validateId(id);svgAttr(gfx,ELEMENT_ID,id);if(secondaryGfx){svgAttr(secondaryGfx,ELEMENT_ID,id);}this._elements[id]={element:element,gfx:gfx,secondaryGfx:secondaryGfx};};ElementRegistry.prototype.remove=function(element){var elements=this._elements,id=element.id||element,container=id&&elements[id];if(container){svgAttr(container.gfx,ELEMENT_ID,'');if(container.secondaryGfx){svgAttr(container.secondaryGfx,ELEMENT_ID,'');}delete elements[id];}};ElementRegistry.prototype.updateId=function(element,newId){this._validateId(newId);if(typeof element==='string'){element=this.get(element);}this._eventBus.fire('element.updateId',{element:element,newId:newId});var gfx=this.getGraphics(element),secondaryGfx=this.getGraphics(element,true);this.remove(element);element.id=newId;this.add(element,gfx,secondaryGfx);};ElementRegistry.prototype.get=function(filter){var id;if(typeof filter==='string'){id=filter;}else{id=filter&&svgAttr(filter,ELEMENT_ID);}var container=this._elements[id];return container&&container.element;};ElementRegistry.prototype.filter=function(fn){var filtered=[];this.forEach(function(element,gfx){if(fn(element,gfx)){filtered.push(element);}});return filtered;};ElementRegistry.prototype.getAll=function(){return this.filter(function(e){return e;});};ElementRegistry.prototype.forEach=function(fn){var map=this._elements;Object.keys(map).forEach(function(id){var container=map[id],element=container.element,gfx=container.gfx;return fn(element,gfx);});};ElementRegistry.prototype.getGraphics=function(filter,secondary){var id=filter.id||filter;var container=this._elements[id];return container&&(secondary?container.secondaryGfx:container.gfx);};ElementRegistry.prototype._validateId=function(id){if(!id){throw new Error('element must have an id');}if(this._elements[id]){throw new Error('element with id '+id+' already added');}};},{"tiny-svg/lib/attr":609}],232:[function(require,module,exports){'use strict';var isFunction=require('lodash/lang/isFunction'),isArray=require('lodash/lang/isArray'),isNumber=require('lodash/lang/isNumber'),bind=require('lodash/function/bind'),assign=require('lodash/object/assign');var FN_REF='__fn';var DEFAULT_PRIORITY=1000;var slice=Array.prototype.slice;function EventBus(){this._listeners={};this.on('diagram.destroy',1,this._destroy,this);}module.exports=EventBus;EventBus.prototype.on=function(events,priority,callback,that){events=isArray(events)?events:[events];if(isFunction(priority)){that=callback;callback=priority;priority=DEFAULT_PRIORITY;}if(!isNumber(priority)){throw new Error('priority must be a number');}var actualCallback=callback;if(that){actualCallback=bind(callback,that);actualCallback[FN_REF]=callback[FN_REF]||callback;}var self=this,listener={priority:priority,callback:actualCallback};events.forEach(function(e){self._addListener(e,listener);});};EventBus.prototype.once=function(event,priority,callback,that){var self=this;if(isFunction(priority)){that=callback;callback=priority;priority=DEFAULT_PRIORITY;}if(!isNumber(priority)){throw new Error('priority must be a number');}function wrappedCallback(){self.off(event,wrappedCallback);return callback.apply(that,arguments);}wrappedCallback[FN_REF]=callback;this.on(event,priority,wrappedCallback);};EventBus.prototype.off=function(event,callback){var listeners=this._getListeners(event),listener,listenerCallback,idx;if(callback){for(idx=listeners.length-1;(listener=listeners[idx]);idx--){listenerCallback=listener.callback;if(listenerCallback===callback||listenerCallback[FN_REF]===callback){listeners.splice(idx,1);}}}else{listeners.length=0;}};EventBus.prototype.fire=function(type,data){var event,listeners,returnValue,args;args=slice.call(arguments);if(typeof type==='object'){event=type;type=event.type;}if(!type){throw new Error('no event type specified');}listeners=this._listeners[type];if(!listeners){return;}if(data instanceof Event){event=data;}else{event=new Event();event.init(data);}args[0]=event;var originalType=event.type;if(type!==originalType){event.type=type;}try{returnValue=this._invokeListeners(event,args,listeners);}finally{if(type!==originalType){event.type=originalType;}}if(returnValue===undefined&&event.defaultPrevented){returnValue=false;}return returnValue;};EventBus.prototype.handleError=function(error){return this.fire('error',{error:error})===false;};EventBus.prototype._destroy=function(){this._listeners={};};EventBus.prototype._invokeListeners=function(event,args,listeners){var idx,listener,returnValue;for(idx=0;(listener=listeners[idx]);idx++){if(event.cancelBubble){break;}returnValue=this._invokeListener(event,args,listener);}return returnValue;};EventBus.prototype._invokeListener=function(event,args,listener){var returnValue;try{returnValue=invokeFunction(listener.callback,args);if(returnValue!==undefined){event.returnValue=returnValue;event.stopPropagation();}if(returnValue===false){event.preventDefault();}}catch(e){if(!this.handleError(e)){console.error('unhandled error in event listener');console.error(e.stack);throw e;}}return returnValue;};EventBus.prototype._addListener=function(event,newListener){var listeners=this._getListeners(event),existingListener,idx;for(idx=0;(existingListener=listeners[idx]);idx++){if(existingListener.priority<newListener.priority){listeners.splice(idx,0,newListener);return;}}listeners.push(newListener);};EventBus.prototype._getListeners=function(name){var listeners=this._listeners[name];if(!listeners){this._listeners[name]=listeners=[];}return listeners;};function Event(){}module.exports.Event=Event;Event.prototype.stopPropagation=function(){this.cancelBubble=true;};Event.prototype.preventDefault=function(){this.defaultPrevented=true;};Event.prototype.init=function(data){assign(this,data||{});};function invokeFunction(fn,args){return fn.apply(null,args);}},{"lodash/function/bind":427,"lodash/lang/isArray":537,"lodash/lang/isFunction":539,"lodash/lang/isNumber":541,"lodash/object/assign":547}],233:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach'),reduce=require('lodash/collection/reduce');var GraphicsUtil=require('../util/GraphicsUtil');var translate=require('../util/SvgTransformUtil').translate;var domClear=require('min-dom/lib/clear');var svgAppend=require('tiny-svg/lib/append'),svgAttr=require('tiny-svg/lib/attr'),svgClasses=require('tiny-svg/lib/classes'),svgCreate=require('tiny-svg/lib/create'),svgRemove=require('tiny-svg/lib/remove');function GraphicsFactory(eventBus,elementRegistry){this._eventBus=eventBus;this._elementRegistry=elementRegistry;}GraphicsFactory.$inject=['eventBus','elementRegistry'];module.exports=GraphicsFactory;GraphicsFactory.prototype._getChildren=function(element){var gfx=this._elementRegistry.getGraphics(element);var childrenGfx;if(!element.parent){childrenGfx=gfx;}else{childrenGfx=GraphicsUtil.getChildren(gfx);if(!childrenGfx){childrenGfx=svgCreate('g');svgClasses(childrenGfx).add('djs-children');svgAppend(gfx.parentNode,childrenGfx);}}return childrenGfx;};GraphicsFactory.prototype._clear=function(gfx){var visual=GraphicsUtil.getVisual(gfx);domClear(visual);return visual;};GraphicsFactory.prototype._createContainer=function(type,parentGfx){var outerGfx=svgCreate('g');svgClasses(outerGfx).add('djs-group');svgAppend(parentGfx,outerGfx);var gfx=svgCreate('g');svgClasses(gfx).add('djs-element');svgClasses(gfx).add('djs-'+type);svgAppend(outerGfx,gfx);var visual=svgCreate('g');svgClasses(visual).add('djs-visual');svgAppend(gfx,visual);return gfx;};GraphicsFactory.prototype.create=function(type,element){var childrenGfx=this._getChildren(element.parent);return this._createContainer(type,childrenGfx);};GraphicsFactory.prototype.updateContainments=function(elements){var self=this,elementRegistry=this._elementRegistry,parents;parents=reduce(elements,function(map,e){if(e.parent){map[e.parent.id]=e.parent;}return map;},{});forEach(parents,function(parent){var childGfx=self._getChildren(parent),children=parent.children;if(!children){return;}forEach(children.slice().reverse(),function(c){var gfx=elementRegistry.getGraphics(c);prependTo(gfx.parentNode,childGfx);});});};GraphicsFactory.prototype.drawShape=function(visual,element){var eventBus=this._eventBus;return eventBus.fire('render.shape',{gfx:visual,element:element});};GraphicsFactory.prototype.getShapePath=function(element){var eventBus=this._eventBus;return eventBus.fire('render.getShapePath',element);};GraphicsFactory.prototype.drawConnection=function(visual,element){var eventBus=this._eventBus;return eventBus.fire('render.connection',{gfx:visual,element:element});};GraphicsFactory.prototype.getConnectionPath=function(waypoints){var eventBus=this._eventBus;return eventBus.fire('render.getConnectionPath',waypoints);};GraphicsFactory.prototype.update=function(type,element,gfx){if(!element.parent){return;}var visual=this._clear(gfx);if(type==='shape'){this.drawShape(visual,element);translate(gfx,element.x,element.y);}else
if(type==='connection'){this.drawConnection(visual,element);}else{throw new Error('unknown type: '+type);}if(element.hidden){svgAttr(gfx,'display','none');}else{svgAttr(gfx,'display','block');}};GraphicsFactory.prototype.remove=function(element){var gfx=this._elementRegistry.getGraphics(element);svgRemove(gfx.parentNode);};function prependTo(newNode,parentNode){parentNode.insertBefore(newNode,parentNode.firstChild);}},{"../util/GraphicsUtil":376,"../util/SvgTransformUtil":386,"lodash/collection/forEach":417,"lodash/collection/reduce":421,"min-dom/lib/clear":563,"tiny-svg/lib/append":607,"tiny-svg/lib/attr":609,"tiny-svg/lib/classes":610,"tiny-svg/lib/create":613,"tiny-svg/lib/remove":616}],234:[function(require,module,exports){module.exports={__depends__:[require('../draw')],__init__:['canvas'],canvas:['type',require('./Canvas')],elementRegistry:['type',require('./ElementRegistry')],elementFactory:['type',require('./ElementFactory')],eventBus:['type',require('./EventBus')],graphicsFactory:['type',require('./GraphicsFactory')]};},{"../draw":238,"./Canvas":229,"./ElementFactory":230,"./ElementRegistry":231,"./EventBus":232,"./GraphicsFactory":233}],235:[function(require,module,exports){'use strict';var DEFAULT_RENDER_PRIORITY=1000;function BaseRenderer(eventBus,renderPriority){var self=this;renderPriority=renderPriority||DEFAULT_RENDER_PRIORITY;eventBus.on(['render.shape','render.connection'],renderPriority,function(evt,context){var type=evt.type,element=context.element,visuals=context.gfx;if(self.canRender(element)){if(type==='render.shape'){return self.drawShape(visuals,element);}else{return self.drawConnection(visuals,element);}}});eventBus.on(['render.getShapePath','render.getConnectionPath'],renderPriority,function(evt,element){if(self.canRender(element)){if(evt.type==='render.getShapePath'){return self.getShapePath(element);}else{return self.getConnectionPath(element);}}});}BaseRenderer.prototype.canRender=function(){};BaseRenderer.prototype.drawShape=function(){};BaseRenderer.prototype.drawConnection=function(){};BaseRenderer.prototype.getShapePath=function(){};BaseRenderer.prototype.getConnectionPath=function(){};module.exports=BaseRenderer;},{}],236:[function(require,module,exports){'use strict';var inherits=require('inherits');var BaseRenderer=require('./BaseRenderer');var renderUtil=require('../util/RenderUtil');var componentsToPath=renderUtil.componentsToPath,createLine=renderUtil.createLine;var svgAppend=require('tiny-svg/lib/append'),svgAttr=require('tiny-svg/lib/attr'),svgCreate=require('tiny-svg/lib/create');var DEFAULT_RENDER_PRIORITY=1;function DefaultRenderer(eventBus,styles){BaseRenderer.call(this,eventBus,DEFAULT_RENDER_PRIORITY);this.CONNECTION_STYLE=styles.style(['no-fill'],{strokeWidth:5,stroke:'fuchsia'});this.SHAPE_STYLE=styles.style({fill:'white',stroke:'fuchsia',strokeWidth:2});}inherits(DefaultRenderer,BaseRenderer);DefaultRenderer.prototype.canRender=function(){return true;};DefaultRenderer.prototype.drawShape=function drawShape(visuals,element){var rect=svgCreate('rect');svgAttr(rect,{x:0,y:0,width:element.width||0,height:element.height||0});svgAttr(rect,this.SHAPE_STYLE);svgAppend(visuals,rect);return rect;};DefaultRenderer.prototype.drawConnection=function drawConnection(visuals,connection){var line=createLine(connection.waypoints,this.CONNECTION_STYLE);svgAppend(visuals,line);return line;};DefaultRenderer.prototype.getShapePath=function getShapePath(shape){var x=shape.x,y=shape.y,width=shape.width,height=shape.height;var shapePath=[['M',x,y],['l',width,0],['l',0,height],['l',-width,0],['z']];return componentsToPath(shapePath);};DefaultRenderer.prototype.getConnectionPath=function getConnectionPath(connection){var waypoints=connection.waypoints;var idx,point,connectionPath=[];for(idx=0;(point=waypoints[idx]);idx++){point=point.original||point;connectionPath.push([idx===0?'M':'L',point.x,point.y]);}return componentsToPath(connectionPath);};DefaultRenderer.$inject=['eventBus','styles'];module.exports=DefaultRenderer;},{"../util/RenderUtil":385,"./BaseRenderer":235,"inherits":398,"tiny-svg/lib/append":607,"tiny-svg/lib/attr":609,"tiny-svg/lib/create":613}],237:[function(require,module,exports){'use strict';var isArray=require('lodash/lang/isArray'),assign=require('lodash/object/assign'),reduce=require('lodash/collection/reduce');function Styles(){var defaultTraits={'no-fill':{fill:'none'},'no-border':{strokeOpacity:0.0},'no-events':{pointerEvents:'none'}};var self=this;this.cls=function(className,traits,additionalAttrs){var attrs=this.style(traits,additionalAttrs);return assign(attrs,{'class':className});};this.style=function(traits,additionalAttrs){if(!isArray(traits)&&!additionalAttrs){additionalAttrs=traits;traits=[];}var attrs=reduce(traits,function(attrs,t){return assign(attrs,defaultTraits[t]||{});},{});return additionalAttrs?assign(attrs,additionalAttrs):attrs;};this.computeStyle=function(custom,traits,defaultStyles){if(!isArray(traits)){defaultStyles=traits;traits=[];}return self.style(traits||[],assign({},defaultStyles,custom||{}));};}module.exports=Styles;},{"lodash/collection/reduce":421,"lodash/lang/isArray":537,"lodash/object/assign":547}],238:[function(require,module,exports){module.exports={__init__:['defaultRenderer'],defaultRenderer:['type',require('./DefaultRenderer')],styles:['type',require('./Styles')]};},{"./DefaultRenderer":236,"./Styles":237}],239:[function(require,module,exports){'use strict';var filter=require('lodash/collection/filter'),forEach=require('lodash/collection/forEach'),sortBy=require('lodash/collection/sortBy');function last(arr){return arr&&arr[arr.length-1];}function sortTopOrMiddle(element){return element.y;}function sortLeftOrCenter(element){return element.x;}var ALIGNMENT_SORTING={left:sortLeftOrCenter,center:sortLeftOrCenter,right:function(element){return element.x+element.width;},top:sortTopOrMiddle,middle:sortTopOrMiddle,bottom:function(element){return element.y+element.height;}};function AlignElements(modeling){this._modeling=modeling;}module.exports=AlignElements;AlignElements.$inject=['modeling'];AlignElements.prototype._getOrientationDetails=function(type){var vertical=['top','bottom','middle'],axis='x',dimension='width';if(vertical.indexOf(type)!==-1){axis='y';dimension='height';}return{axis:axis,dimension:dimension};};AlignElements.prototype._isType=function(type,types){return types.indexOf(type)!==-1;};AlignElements.prototype._alignmentPosition=function(type,sortedElements){var orientation=this._getOrientationDetails(type),axis=orientation.axis,dimension=orientation.dimension,alignment={},centers={},hasSharedCenters=false,centeredElements,firstElement,lastElement;function getMiddleOrTop(first,last){return Math.round((first[axis]+last[axis]+last[dimension])/2);}if(this._isType(type,['left','top'])){alignment[type]=sortedElements[0][axis];}else if(this._isType(type,['right','bottom'])){lastElement=last(sortedElements);alignment[type]=lastElement[axis]+lastElement[dimension];}else if(this._isType(type,['center','middle'])){forEach(sortedElements,function(element){var center=element[axis]+Math.round(element[dimension]/2);if(centers[center]){centers[center].elements.push(element);}else{centers[center]={elements:[element],center:center};}});centeredElements=sortBy(centers,function(center){if(center.elements.length>1){hasSharedCenters=true;}return center.elements.length;});if(hasSharedCenters){alignment[type]=last(centeredElements).center;return alignment;}firstElement=sortedElements[0];sortedElements=sortBy(sortedElements,function(element){return element[axis]+element[dimension];});lastElement=last(sortedElements);alignment[type]=getMiddleOrTop(firstElement,lastElement);}return alignment;};AlignElements.prototype.trigger=function(elements,type){var modeling=this._modeling;var filteredElements=filter(elements,function(element){return!(element.waypoints||element.host||element.labelTarget);});var sortFn=ALIGNMENT_SORTING[type];var sortedElements=sortBy(filteredElements,sortFn);var alignment=this._alignmentPosition(type,sortedElements);modeling.alignElements(sortedElements,alignment);};},{"lodash/collection/filter":415,"lodash/collection/forEach":417,"lodash/collection/sortBy":425}],240:[function(require,module,exports){'use strict';module.exports={__init__:['alignElements'],alignElements:['type',require('./AlignElements')]};},{"./AlignElements":239}],241:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach'),flatten=require('lodash/array/flatten'),union=require('lodash/array/union'),filter=require('lodash/collection/filter'),groupBy=require('lodash/collection/groupBy'),map=require('lodash/collection/map');var saveClear=require('../../util/Removal').saveClear,Collections=require('../../util/Collections');var getNewAttachShapeDelta=require('../../util/AttachUtil').getNewAttachShapeDelta;var inherits=require('inherits');var HIGH_PRIORITY=1500;var CommandInterceptor=require('../../command/CommandInterceptor');function AttachSupport(eventBus,modeling,movePreview,rules){CommandInterceptor.call(this,eventBus);eventBus.on('shape.move.start',HIGH_PRIORITY,function(e){var context=e.context,shapes=context.shapes,validatedShapes=context.validatedShapes;context.shapes=addAttached(shapes);context.validatedShapes=removeAttached(validatedShapes);});this.postExecuted(['elements.move'],function(event){var context=event.context,delta=context.delta,newParent=context.newParent,closure=context.closure,enclosedElements=closure.enclosedElements,attachers=getAttachers(enclosedElements);forEach(attachers,function(attacher){if(!enclosedElements[attacher.id]){modeling.moveShape(attacher,delta,newParent);}});});this.postExecuted(['elements.move'],function(e){var context=e.context,shapes=context.shapes,newHost=context.newHost,attachers;if(shapes.length>1){return;}if(newHost){attachers=shapes;}else{attachers=filter(shapes,function(s){return!!s.host;});}forEach(attachers,function(attacher){modeling.updateAttachment(attacher,newHost);});});this.postExecuted(['elements.move'],function(e){var shapes=e.context.shapes;forEach(shapes,function(shape){forEach(shape.attachers,function(attacher){forEach(attacher.outgoing.slice(),function(connection){var allowed=rules.allowed('connection.reconnectStart',{connection:connection,source:connection.source,target:connection.target});if(!allowed){modeling.removeConnection(connection);}});forEach(attacher.incoming.slice(),function(connection){var allowed=rules.allowed('connection.reconnectEnd',{connection:connection,source:connection.source,target:connection.target});if(!allowed){modeling.removeConnection(connection);}});});});});this.postExecute(['shape.create'],function(e){var context=e.context,shape=context.shape,host=context.host;if(host){modeling.updateAttachment(shape,host);}});this.postExecute(['shape.replace'],function(e){var context=e.context,oldShape=context.oldShape,newShape=context.newShape;saveClear(oldShape.attachers,function(attacher){var allowed=rules.allowed('elements.move',{target:newShape,shapes:[attacher]});if(allowed==='attach'){modeling.updateAttachment(attacher,newShape);}else{modeling.removeShape(attacher);}});if(newShape.attachers.length){forEach(newShape.attachers,function(attacher){var delta=getNewAttachShapeDelta(attacher,oldShape,newShape);modeling.moveShape(attacher,delta,attacher.parent);});}});this.postExecute(['shape.resize'],function(event){var context=event.context,shape=context.shape,oldBounds=context.oldBounds,newBounds=context.newBounds,attachers=shape.attachers;if(!attachers.length){return;}forEach(attachers,function(attacher){var delta=getNewAttachShapeDelta(attacher,oldBounds,newBounds);modeling.moveShape(attacher,delta,attacher.parent);if(attacher.label){modeling.moveShape(attacher.label,delta,attacher.label.parent);}});});this.preExecute(['shape.delete'],function(event){var shape=event.context.shape;saveClear(shape.attachers,function(attacher){modeling.removeShape(attacher);});if(shape.host){modeling.updateAttachment(shape,null);}});eventBus.on('spaceTool.move',function(event){var movingShapes=event.context.movingShapes;var movingAttachers=filter(movingShapes,function(shape){return shape.host&&shape.host.id;});forEach(movingAttachers,function(shape){Collections.remove(movingShapes,shape);if(shape.label){Collections.remove(movingShapes,shape.label);}});});}inherits(AttachSupport,CommandInterceptor);AttachSupport.$inject=['eventBus','modeling','movePreview','rules'];module.exports=AttachSupport;function getAttachers(shapes){return flatten(map(shapes,function(s){return s.attachers||[];}));}function addAttached(elements){var attachers=getAttachers(elements);return union(elements,attachers);}function removeAttached(elements){var ids=groupBy(elements,'id');return filter(elements,function(element){while(element){if(element.host&&ids[element.host.id]){return false;}element=element.parent;}return true;});}},{"../../command/CommandInterceptor":226,"../../util/AttachUtil":368,"../../util/Collections":370,"../../util/Removal":384,"inherits":398,"lodash/array/flatten":403,"lodash/array/union":407,"lodash/collection/filter":415,"lodash/collection/forEach":417,"lodash/collection/groupBy":418,"lodash/collection/map":420}],242:[function(require,module,exports){module.exports={__depends__:[require('../move'),require('../label-support')],__init__:['attachSupport'],attachSupport:['type',require('./AttachSupport')]};},{"../label-support":281,"../move":313,"./AttachSupport":241}],243:[function(require,module,exports){'use strict';var inherits=require('inherits');var getBoundingBox=require('../../util/Elements').getBBox;var asTRBL=require('../../layout/LayoutUtil').asTRBL,asBounds=require('../../layout/LayoutUtil').asBounds;var assign=require('lodash/object/assign'),forEach=require('lodash/collection/forEach'),values=require('lodash/object/values'),flatten=require('lodash/array/flatten'),groupBy=require('lodash/collection/groupBy');var CommandInterceptor=require('../../command/CommandInterceptor');function AutoResize(eventBus,elementRegistry,modeling,rules){CommandInterceptor.call(this,eventBus);this._elementRegistry=elementRegistry;this._modeling=modeling;this._rules=rules;var self=this;this.postExecuted(['shape.create'],function(event){var context=event.context,hints=context.hints,shape=context.shape,parent=context.parent||context.newParent;if(hints&&hints.root===false){return;}self._expand([shape],parent);});this.postExecuted(['elements.move'],function(event){var context=event.context,elements=flatten(values(context.closure.topLevel)),hints=context.hints;if(hints&&hints.autoResize===false){return;}var expandings=groupBy(elements,function(element){return element.parent.id;});forEach(expandings,function(elements,parentId){self._expand(elements,parentId);});});}AutoResize.$inject=['eventBus','elementRegistry','modeling','rules'];inherits(AutoResize,CommandInterceptor);module.exports=AutoResize;AutoResize.prototype._getOptimalBounds=function(elements,target){var offset=this.getOffset(target),padding=this.getPadding(target);var elementsTrbl=asTRBL(getBoundingBox(elements)),targetTrbl=asTRBL(target);var newTrbl={};if(elementsTrbl.top-targetTrbl.top<padding.top){newTrbl.top=elementsTrbl.top-offset.top;}if(elementsTrbl.left-targetTrbl.left<padding.left){newTrbl.left=elementsTrbl.left-offset.left;}if(targetTrbl.right-elementsTrbl.right<padding.right){newTrbl.right=elementsTrbl.right+offset.right;}if(targetTrbl.bottom-elementsTrbl.bottom<padding.bottom){newTrbl.bottom=elementsTrbl.bottom+offset.bottom;}return asBounds(assign({},targetTrbl,newTrbl));};AutoResize.prototype._expand=function(elements,target){if(typeof target==='string'){target=this._elementRegistry.get(target);}var allowed=this._rules.allowed('element.autoResize',{elements:elements,target:target});if(!allowed){return;}var newBounds=this._getOptimalBounds(elements,target);if(!boundsChanged(newBounds,target)){return;}this.resize(target,newBounds);var parent=target.parent;if(parent){this._expand([target],parent);}};AutoResize.prototype.getOffset=function(shape){return{top:60,bottom:60,left:100,right:100};};AutoResize.prototype.getPadding=function(shape){return{top:2,bottom:2,left:15,right:15};};AutoResize.prototype.resize=function(target,newBounds){this._modeling.resizeShape(target,newBounds);};function boundsChanged(newBounds,oldBounds){return(newBounds.x!==oldBounds.x||newBounds.y!==oldBounds.y||newBounds.width!==oldBounds.width||newBounds.height!==oldBounds.height);}},{"../../command/CommandInterceptor":226,"../../layout/LayoutUtil":359,"../../util/Elements":373,"inherits":398,"lodash/array/flatten":403,"lodash/collection/forEach":417,"lodash/collection/groupBy":418,"lodash/object/assign":547,"lodash/object/values":557}],244:[function(require,module,exports){var RuleProvider=require('../rules/RuleProvider');var inherits=require('inherits');function AutoResizeProvider(eventBus){RuleProvider.call(this,eventBus);var self=this;this.addRule('element.autoResize',function(context){return self.canResize(context.elements,context.target);});}AutoResizeProvider.$inject=['eventBus'];inherits(AutoResizeProvider,RuleProvider);module.exports=AutoResizeProvider;AutoResizeProvider.prototype.canResize=function(elements,target){return false;};},{"../rules/RuleProvider":332,"inherits":398}],245:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign');var EventUtil=require('../../util/Event');function AutoScroll(config,eventBus,canvas,mouseTracking){this._canvas=canvas;this._mouseTracking=mouseTracking;this._opts=assign({scrollThresholdIn:[20,20,20,20],scrollThresholdOut:[0,0,0,0],scrollRepeatTimeout:15,scrollStep:10},config);var self=this;eventBus.on('drag.move',function(e){var point=self._toBorderPoint(e);self.startScroll(point);});eventBus.on(['drag.cleanup'],function(){self.stopScroll();});}AutoScroll.$inject=['config.autoScroll','eventBus','canvas','mouseTracking'];module.exports=AutoScroll;AutoScroll.prototype.startScroll=function(point){var canvas=this._canvas;var opts=this._opts;var self=this;var clientRect=canvas.getContainer().getBoundingClientRect();var diff=[point.x,point.y,clientRect.width-point.x,clientRect.height-point.y];this.stopScroll();var dx=0,dy=0;for(var i=0;i<4;i++){if(between(diff[i],opts.scrollThresholdOut[i],opts.scrollThresholdIn[i])){if(i===0){dx=opts.scrollStep;}else if(i==1){dy=opts.scrollStep;}else if(i==2){dx=-opts.scrollStep;}else if(i==3){dy=-opts.scrollStep;}}}if(dx!==0||dy!==0){canvas.scroll({dx:dx,dy:dy});this._scrolling=setTimeout(function(){self.startScroll(point);},opts.scrollRepeatTimeout);}};function between(val,start,end){if(start<val&&val<end){return true;}return false;}AutoScroll.prototype.stopScroll=function(){clearTimeout(this._scrolling);};AutoScroll.prototype.setOptions=function(options){this._opts=assign({},this._opts,options);};AutoScroll.prototype._toBorderPoint=function(event){var clientRect=this._canvas._container.getBoundingClientRect();var globalPosition=EventUtil.toPoint(event.originalEvent);return{x:globalPosition.x-clientRect.left,y:globalPosition.y-clientRect.top};};},{"../../util/Event":374,"lodash/object/assign":547}],246:[function(require,module,exports){module.exports={__depends__:[require('../dragging'),require('../mouse-tracking')],__init__:['autoScroll'],autoScroll:['type',require('./AutoScroll')]};},{"../dragging":269,"../mouse-tracking":310,"./AutoScroll":245}],247:[function(require,module,exports){'use strict';var Geometry=require('../../util/Geometry'),BendpointUtil=require('./BendpointUtil');var MARKER_OK='connect-ok',MARKER_NOT_OK='connect-not-ok',MARKER_CONNECT_HOVER='connect-hover',MARKER_CONNECT_UPDATING='djs-updating';var COMMAND_BENDPOINT_UPDATE='connection.updateWaypoints',COMMAND_RECONNECT_START='connection.reconnectStart',COMMAND_RECONNECT_END='connection.reconnectEnd';var round=Math.round;var svgClasses=require('tiny-svg/lib/classes'),svgRemove=require('tiny-svg/lib/remove');var translate=require('../../util/SvgTransformUtil').translate;function BendpointMove(injector,eventBus,canvas,dragging,graphicsFactory,rules,modeling){var connectionDocking=injector.get('connectionDocking',false);this.start=function(event,connection,bendpointIndex,insert){var type,context,waypoints=connection.waypoints,gfx=canvas.getGraphics(connection);if(!insert&&bendpointIndex===0){type=COMMAND_RECONNECT_START;}else
if(!insert&&bendpointIndex===waypoints.length-1){type=COMMAND_RECONNECT_END;}else{type=COMMAND_BENDPOINT_UPDATE;}context={connection:connection,bendpointIndex:bendpointIndex,insert:insert,type:type};dragging.init(event,'bendpoint.move',{data:{connection:connection,connectionGfx:gfx,context:context}});};function redrawConnection(data){graphicsFactory.update('connection',data.connection,data.connectionGfx);}function filterRedundantWaypoints(waypoints){waypoints=waypoints.slice();var idx=0,point,previousPoint,nextPoint;while(waypoints[idx]){point=waypoints[idx];previousPoint=waypoints[idx-1];nextPoint=waypoints[idx+1];if(Geometry.pointDistance(point,nextPoint)===0||Geometry.pointsOnLine(previousPoint,nextPoint,point)){waypoints.splice(idx,1);}else{idx++;}}return waypoints;}eventBus.on('bendpoint.move.start',function(e){var context=e.context,connection=context.connection,originalWaypoints=connection.waypoints,waypoints=originalWaypoints.slice(),insert=context.insert,idx=context.bendpointIndex;context.originalWaypoints=originalWaypoints;if(insert){waypoints.splice(idx,0,null);}connection.waypoints=waypoints;context.draggerGfx=BendpointUtil.addBendpoint(canvas.getLayer('overlays'));svgClasses(context.draggerGfx).add('djs-dragging');canvas.addMarker(connection,MARKER_CONNECT_UPDATING);});eventBus.on('bendpoint.move.hover',function(e){e.context.hover=e.hover;canvas.addMarker(e.hover,MARKER_CONNECT_HOVER);});eventBus.on(['bendpoint.move.out','bendpoint.move.cleanup'],function(e){var hover=e.context.hover;if(hover){canvas.removeMarker(hover,MARKER_CONNECT_HOVER);canvas.removeMarker(hover,e.context.target?MARKER_OK:MARKER_NOT_OK);}});eventBus.on('bendpoint.move.move',function(e){var context=e.context,moveType=context.type,connection=e.connection,source,target;connection.waypoints[context.bendpointIndex]={x:e.x,y:e.y};if(connectionDocking){if(context.hover){if(moveType===COMMAND_RECONNECT_START){source=context.hover;}if(moveType===COMMAND_RECONNECT_END){target=context.hover;}}connection.waypoints=connectionDocking.getCroppedWaypoints(connection,source,target);}var allowed=context.allowed=rules.allowed(context.type,context);if(allowed){if(context.hover){canvas.removeMarker(context.hover,MARKER_NOT_OK);canvas.addMarker(context.hover,MARKER_OK);context.target=context.hover;}}else
if(allowed===false){if(context.hover){canvas.removeMarker(context.hover,MARKER_OK);canvas.addMarker(context.hover,MARKER_NOT_OK);context.target=null;}}translate(context.draggerGfx,e.x,e.y);redrawConnection(e);});eventBus.on(['bendpoint.move.end','bendpoint.move.cancel'],function(e){var context=e.context,hover=context.hover,connection=context.connection;svgRemove(context.draggerGfx);context.newWaypoints=connection.waypoints.slice();connection.waypoints=context.originalWaypoints;canvas.removeMarker(connection,MARKER_CONNECT_UPDATING);if(hover){canvas.removeMarker(hover,MARKER_OK);canvas.removeMarker(hover,MARKER_NOT_OK);}});eventBus.on('bendpoint.move.end',function(e){var context=e.context,waypoints=context.newWaypoints,bendpointIndex=context.bendpointIndex,bendpoint=waypoints[bendpointIndex],allowed=context.allowed,hints;bendpoint.x=round(bendpoint.x);bendpoint.y=round(bendpoint.y);if(allowed&&context.type===COMMAND_RECONNECT_START){modeling.reconnectStart(context.connection,context.target,bendpoint);}else
if(allowed&&context.type===COMMAND_RECONNECT_END){modeling.reconnectEnd(context.connection,context.target,bendpoint);}else
if(allowed!==false&&context.type===COMMAND_BENDPOINT_UPDATE){hints={bendpointMove:{insert:e.context.insert,bendpointIndex:bendpointIndex}};modeling.updateWaypoints(context.connection,filterRedundantWaypoints(waypoints),hints);}else{redrawConnection(e);return false;}});eventBus.on('bendpoint.move.cancel',function(e){redrawConnection(e);});}BendpointMove.$inject=['injector','eventBus','canvas','dragging','graphicsFactory','rules','modeling'];module.exports=BendpointMove;},{"../../util/Geometry":375,"../../util/SvgTransformUtil":386,"./BendpointUtil":249,"tiny-svg/lib/classes":610,"tiny-svg/lib/remove":616}],248:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign'),forEach=require('lodash/collection/forEach'),isArray=require('lodash/lang/isArray');var abs=Math.abs,round=Math.round;var TOLERANCE=10;function BendpointSnapping(eventBus){function snapTo(values,value){if(isArray(values)){var i=values.length;while(i--)if(abs(values[i]-value)<=TOLERANCE){return values[i];}}else{values=+values;var rem=value%values;if(rem<TOLERANCE){return value-rem;}if(rem>values-TOLERANCE){return value-rem+values;}}return value;}function mid(element){if(element.width){return{x:round(element.width/2+element.x),y:round(element.height/2+element.y)};}}function getConnectionSegmentSnaps(context){var snapPoints=context.snapPoints,connection=context.connection,waypoints=connection.waypoints,segmentStart=context.segmentStart,segmentStartIndex=context.segmentStartIndex,segmentEnd=context.segmentEnd,segmentEndIndex=context.segmentEndIndex,axis=context.axis;if(snapPoints){return snapPoints;}var referenceWaypoints=[waypoints[segmentStartIndex-1],segmentStart,segmentEnd,waypoints[segmentEndIndex+1]];if(segmentStartIndex<2){referenceWaypoints.unshift(mid(connection.source));}if(segmentEndIndex>waypoints.length-3){referenceWaypoints.unshift(mid(connection.target));}context.snapPoints=snapPoints={horizontal:[],vertical:[]};forEach(referenceWaypoints,function(p){if(p){p=p.original||p;if(axis==='y'){snapPoints.horizontal.push(p.y);}if(axis==='x'){snapPoints.vertical.push(p.x);}}});return snapPoints;}eventBus.on('connectionSegment.move.move',1500,function(event){var context=event.context,snapPoints=getConnectionSegmentSnaps(context),x=event.x,y=event.y,sx,sy;if(!snapPoints){return;}sx=snapTo(snapPoints.vertical,x);sy=snapTo(snapPoints.horizontal,y);var cx=(x-sx),cy=(y-sy);assign(event,{dx:event.dx-cx,dy:event.dy-cy,x:sx,y:sy});});function getBendpointSnaps(context){var snapPoints=context.snapPoints,waypoints=context.connection.waypoints,bendpointIndex=context.bendpointIndex;if(snapPoints){return snapPoints;}var referenceWaypoints=[waypoints[bendpointIndex-1],waypoints[bendpointIndex+1]];context.snapPoints=snapPoints={horizontal:[],vertical:[]};forEach(referenceWaypoints,function(p){if(p){p=p.original||p;snapPoints.horizontal.push(p.y);snapPoints.vertical.push(p.x);}});return snapPoints;}eventBus.on('bendpoint.move.move',1500,function(event){var context=event.context,snapPoints=getBendpointSnaps(context),target=context.target,targetMid=target&&mid(target),x=event.x,y=event.y,sx,sy;if(!snapPoints){return;}sx=snapTo(targetMid?snapPoints.vertical.concat([targetMid.x]):snapPoints.vertical,x);sy=snapTo(targetMid?snapPoints.horizontal.concat([targetMid.y]):snapPoints.horizontal,y);var cx=(x-sx),cy=(y-sy);assign(event,{dx:event.dx-cx,dy:event.dy-cy,x:event.x-cx,y:event.y-cy});});}BendpointSnapping.$inject=['eventBus'];module.exports=BendpointSnapping;},{"lodash/collection/forEach":417,"lodash/lang/isArray":537,"lodash/object/assign":547}],249:[function(require,module,exports){'use strict';var Events=require('../../util/Event'),Geometry=require('../../util/Geometry');var BENDPOINT_CLS=module.exports.BENDPOINT_CLS='djs-bendpoint';var SEGMENT_DRAGGER_CLS=module.exports.SEGMENT_DRAGGER_CLS='djs-segment-dragger';var svgAppend=require('tiny-svg/lib/append'),svgAttr=require('tiny-svg/lib/attr'),svgClasses=require('tiny-svg/lib/classes'),svgCreate=require('tiny-svg/lib/create');var rotate=require('../../util/SvgTransformUtil').rotate,translate=require('../../util/SvgTransformUtil').translate;module.exports.toCanvasCoordinates=function(canvas,event){var position=Events.toPoint(event),clientRect=canvas._container.getBoundingClientRect(),offset;offset={x:clientRect.left,y:clientRect.top};var viewbox=canvas.viewbox();return{x:viewbox.x+(position.x-offset.x)/viewbox.scale,y:viewbox.y+(position.y-offset.y)/viewbox.scale};};module.exports.addBendpoint=function(parentGfx,cls){var groupGfx=svgCreate('g');svgClasses(groupGfx).add(BENDPOINT_CLS);svgAppend(parentGfx,groupGfx);var visual=svgCreate('circle');svgAttr(visual,{cx:0,cy:0,r:4});svgClasses(visual).add('djs-visual');svgAppend(groupGfx,visual);var hit=svgCreate('circle');svgAttr(hit,{cx:0,cy:0,r:10});svgClasses(hit).add('djs-hit');svgAppend(groupGfx,hit);if(cls){svgClasses(groupGfx).add(cls);}return groupGfx;};function createParallelDragger(parentGfx,position,alignment){var draggerGfx=svgCreate('g');svgAppend(parentGfx,draggerGfx);var width=14,height=3,padding=6,hitWidth=width+padding,hitHeight=height+padding;var visual=svgCreate('rect');svgAttr(visual,{x:-width/2,y:-height/2,width:width,height:height});svgClasses(visual).add('djs-visual');svgAppend(draggerGfx,visual);var hit=svgCreate('rect');svgAttr(hit,{x:-hitWidth/2,y:-hitHeight/2,width:hitWidth,height:hitHeight});svgClasses(hit).add('djs-hit');svgAppend(draggerGfx,hit);rotate(draggerGfx,alignment==='h'?90:0,0,0);return draggerGfx;}module.exports.addSegmentDragger=function(parentGfx,segmentStart,segmentEnd){var groupGfx=svgCreate('g'),mid=Geometry.getMidPoint(segmentStart,segmentEnd),alignment=Geometry.pointsAligned(segmentStart,segmentEnd);svgAppend(parentGfx,groupGfx);createParallelDragger(groupGfx,mid,alignment);svgClasses(groupGfx).add(SEGMENT_DRAGGER_CLS);svgClasses(groupGfx).add(alignment==='h'?'vertical':'horizontal');translate(groupGfx,mid.x,mid.y);return groupGfx;};},{"../../util/Event":374,"../../util/Geometry":375,"../../util/SvgTransformUtil":386,"tiny-svg/lib/append":607,"tiny-svg/lib/attr":609,"tiny-svg/lib/classes":610,"tiny-svg/lib/create":613}],250:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');var domEvent=require('min-dom/lib/event'),domQuery=require('min-dom/lib/query'),BendpointUtil=require('./BendpointUtil');var pointsAligned=require('../../util/Geometry').pointsAligned,getMidPoint=require('../../util/Geometry').getMidPoint;var BENDPOINT_CLS=BendpointUtil.BENDPOINT_CLS,SEGMENT_DRAGGER_CLS=BendpointUtil.SEGMENT_DRAGGER_CLS;var getApproxIntersection=require('../../util/LineIntersection').getApproxIntersection;var svgAppend=require('tiny-svg/lib/append'),svgAttr=require('tiny-svg/lib/attr'),svgClasses=require('tiny-svg/lib/classes'),svgCreate=require('tiny-svg/lib/create'),svgRemove=require('tiny-svg/lib/remove');var translate=require('../../util/SvgTransformUtil').translate;function Bendpoints(eventBus,canvas,interactionEvents,bendpointMove,connectionSegmentMove){function getConnectionIntersection(waypoints,event){var localPosition=BendpointUtil.toCanvasCoordinates(canvas,event),intersection=getApproxIntersection(waypoints,localPosition);return intersection;}function isIntersectionMiddle(intersection,waypoints,treshold){var idx=intersection.index,p=intersection.point,p0,p1,mid,aligned,xDelta,yDelta;if(idx<=0||intersection.bendpoint){return false;}p0=waypoints[idx-1];p1=waypoints[idx];mid=getMidPoint(p0,p1),aligned=pointsAligned(p0,p1);xDelta=Math.abs(p.x-mid.x);yDelta=Math.abs(p.y-mid.y);return aligned&&xDelta<=treshold&&yDelta<=treshold;}function activateBendpointMove(event,connection){var waypoints=connection.waypoints,intersection=getConnectionIntersection(waypoints,event);if(!intersection){return;}if(isIntersectionMiddle(intersection,waypoints,10)){connectionSegmentMove.start(event,connection,intersection.index);}else{bendpointMove.start(event,connection,intersection.index,!intersection.bendpoint);}}function bindInteractionEvents(node,eventName,element){domEvent.bind(node,eventName,function(event){interactionEvents.triggerMouseEvent(eventName,event,element);event.stopPropagation();});}function getBendpointsContainer(element,create){var layer=canvas.getLayer('overlays'),gfx=domQuery('.djs-bendpoints[data-element-id='+element.id+']',layer);if(!gfx&&create){gfx=svgCreate('g');svgAttr(gfx,{'data-element-id':element.id});svgClasses(gfx).add('djs-bendpoints');svgAppend(layer,gfx);bindInteractionEvents(gfx,'mousedown',element);bindInteractionEvents(gfx,'click',element);bindInteractionEvents(gfx,'dblclick',element);}return gfx;}function createBendpoints(gfx,connection){connection.waypoints.forEach(function(p,idx){var bendpoint=BendpointUtil.addBendpoint(gfx);svgAppend(gfx,bendpoint);translate(bendpoint,p.x,p.y);});BendpointUtil.addBendpoint(gfx,'floating');}function createSegmentDraggers(gfx,connection){var waypoints=connection.waypoints;var segmentStart,segmentEnd;for(var i=1;i<waypoints.length;i++){segmentStart=waypoints[i-1];segmentEnd=waypoints[i];if(pointsAligned(segmentStart,segmentEnd)){BendpointUtil.addSegmentDragger(gfx,segmentStart,segmentEnd);}}}function clearBendpoints(gfx){forEach(domQuery.all('.'+BENDPOINT_CLS,gfx),function(node){svgRemove(node);});}function clearSegmentDraggers(gfx){forEach(domQuery.all('.'+SEGMENT_DRAGGER_CLS,gfx),function(node){svgRemove(node);});}function addHandles(connection){var gfx=getBendpointsContainer(connection);if(!gfx){gfx=getBendpointsContainer(connection,true);createBendpoints(gfx,connection);createSegmentDraggers(gfx,connection);}return gfx;}function updateHandles(connection){var gfx=getBendpointsContainer(connection);if(gfx){clearSegmentDraggers(gfx);clearBendpoints(gfx);createSegmentDraggers(gfx,connection);createBendpoints(gfx,connection);}}eventBus.on('connection.changed',function(event){updateHandles(event.element);});eventBus.on('connection.remove',function(event){var gfx=getBendpointsContainer(event.element);if(gfx){svgRemove(gfx);}});eventBus.on('element.marker.update',function(event){var element=event.element,bendpointsGfx;if(!element.waypoints){return;}bendpointsGfx=addHandles(element);if(event.add){svgClasses(bendpointsGfx).add(event.marker);}else{svgClasses(bendpointsGfx).remove(event.marker);}});eventBus.on('element.mousemove',function(event){var element=event.element,waypoints=element.waypoints,bendpointsGfx,floating,intersection;if(waypoints){bendpointsGfx=getBendpointsContainer(element,true);floating=domQuery('.floating',bendpointsGfx);if(!floating){return;}intersection=getConnectionIntersection(waypoints,event.originalEvent);if(intersection){translate(floating,intersection.point.x,intersection.point.y);}}});eventBus.on('element.mousedown',function(event){var originalEvent=event.originalEvent,element=event.element,waypoints=element.waypoints;if(!waypoints){return;}activateBendpointMove(originalEvent,element,waypoints);});eventBus.on('selection.changed',function(event){var newSelection=event.newSelection,primary=newSelection[0];if(primary&&primary.waypoints){addHandles(primary);}});eventBus.on('element.hover',function(event){var element=event.element;if(element.waypoints){addHandles(element);interactionEvents.registerEvent(event.gfx,'mousemove','element.mousemove');}});eventBus.on('element.out',function(event){interactionEvents.unregisterEvent(event.gfx,'mousemove','element.mousemove');});eventBus.on('element.updateId',function(context){var element=context.element,newId=context.newId;if(element.waypoints){var bendpointContainer=getBendpointsContainer(element);if(bendpointContainer){svgAttr(bendpointContainer,{'data-element-id':newId});}}});this.addHandles=addHandles;this.updateHandles=updateHandles;this.getBendpointsContainer=getBendpointsContainer;}Bendpoints.$inject=['eventBus','canvas','interactionEvents','bendpointMove','connectionSegmentMove'];module.exports=Bendpoints;},{"../../util/Geometry":375,"../../util/LineIntersection":379,"../../util/SvgTransformUtil":386,"./BendpointUtil":249,"lodash/collection/forEach":417,"min-dom/lib/event":567,"min-dom/lib/query":569,"tiny-svg/lib/append":607,"tiny-svg/lib/attr":609,"tiny-svg/lib/classes":610,"tiny-svg/lib/create":613,"tiny-svg/lib/remove":616}],251:[function(require,module,exports){'use strict';var Geometry=require('../../util/Geometry'),BendpointUtil=require('./BendpointUtil'),LayoutUtil=require('../../layout/LayoutUtil');var MARKER_CONNECT_HOVER='connect-hover',MARKER_CONNECT_UPDATING='djs-updating';var svgClasses=require('tiny-svg/lib/classes'),svgRemove=require('tiny-svg/lib/remove');var translate=require('../../util/SvgTransformUtil').translate;function axisAdd(point,axis,delta){return axisSet(point,axis,point[axis]+delta);}function axisSet(point,axis,value){return{x:(axis==='x'?value:point.x),y:(axis==='y'?value:point.y)};}function axisFenced(position,segmentStart,segmentEnd,axis){var maxValue=Math.max(segmentStart[axis],segmentEnd[axis]),minValue=Math.min(segmentStart[axis],segmentEnd[axis]);var padding=20;var fencedValue=Math.min(Math.max(minValue+padding,position[axis]),maxValue-padding);return axisSet(segmentStart,axis,fencedValue);}function flipAxis(axis){return axis==='x'?'y':'x';}function getDocking(point,referenceElement,moveAxis){var referenceMid,inverseAxis;if(point.original){return point.original;}else{referenceMid=LayoutUtil.getMid(referenceElement);inverseAxis=flipAxis(moveAxis);return axisSet(point,inverseAxis,referenceMid[inverseAxis]);}}function ConnectionSegmentMove(injector,eventBus,canvas,dragging,graphicsFactory,rules,modeling){var connectionDocking=injector.get('connectionDocking',false);this.start=function(event,connection,idx){var context,gfx=canvas.getGraphics(connection),segmentStartIndex=idx-1,segmentEndIndex=idx,waypoints=connection.waypoints,segmentStart=waypoints[segmentStartIndex],segmentEnd=waypoints[segmentEndIndex],direction,axis;direction=Geometry.pointsAligned(segmentStart,segmentEnd);if(!direction){return;}axis=direction==='v'?'y':'x';if(segmentStartIndex===0){segmentStart=getDocking(segmentStart,connection.source,axis);}if(segmentEndIndex===waypoints.length-1){segmentEnd=getDocking(segmentEnd,connection.target,axis);}context={connection:connection,segmentStartIndex:segmentStartIndex,segmentEndIndex:segmentEndIndex,segmentStart:segmentStart,segmentEnd:segmentEnd,axis:axis};dragging.init(event,{x:(segmentStart.x+segmentEnd.x)/2,y:(segmentStart.y+segmentEnd.y)/2},'connectionSegment.move',{cursor:axis==='x'?'resize-ew':'resize-ns',data:{connection:connection,connectionGfx:gfx,context:context}});};function cropConnection(connection,newWaypoints){if(!connectionDocking){return newWaypoints;}var oldWaypoints=connection.waypoints,croppedWaypoints;connection.waypoints=newWaypoints;croppedWaypoints=connectionDocking.getCroppedWaypoints(connection);connection.waypoints=oldWaypoints;return croppedWaypoints;}function redrawConnection(data){graphicsFactory.update('connection',data.connection,data.connectionGfx);}function updateDragger(context,segmentOffset,event){var newWaypoints=context.newWaypoints,segmentStartIndex=context.segmentStartIndex+segmentOffset,segmentStart=newWaypoints[segmentStartIndex],segmentEndIndex=context.segmentEndIndex+segmentOffset,segmentEnd=newWaypoints[segmentEndIndex],axis=flipAxis(context.axis);var draggerPosition=axisFenced(event,segmentStart,segmentEnd,axis);translate(context.draggerGfx,draggerPosition.x,draggerPosition.y);}function filterRedundantWaypoints(waypoints,segmentStartIndex){var segmentOffset=0;var filteredWaypoints=waypoints.filter(function(r,idx){if(Geometry.pointsOnLine(waypoints[idx-1],waypoints[idx+1],r)){segmentOffset=idx<=segmentStartIndex?segmentOffset-1:segmentOffset;return false;}return true;});return{waypoints:filteredWaypoints,segmentOffset:segmentOffset};}eventBus.on('connectionSegment.move.start',function(e){var context=e.context,connection=e.connection,layer=canvas.getLayer('overlays');context.originalWaypoints=connection.waypoints.slice();context.draggerGfx=BendpointUtil.addSegmentDragger(layer,context.segmentStart,context.segmentEnd);svgClasses(context.draggerGfx).add('djs-dragging');canvas.addMarker(connection,MARKER_CONNECT_UPDATING);});eventBus.on('connectionSegment.move.move',function(e){var context=e.context,connection=context.connection,segmentStartIndex=context.segmentStartIndex,segmentEndIndex=context.segmentEndIndex,segmentStart=context.segmentStart,segmentEnd=context.segmentEnd,axis=context.axis;var newWaypoints=context.originalWaypoints.slice(),newSegmentStart=axisAdd(segmentStart,axis,e['d'+axis]),newSegmentEnd=axisAdd(segmentEnd,axis,e['d'+axis]);var waypointCount=newWaypoints.length,segmentOffset=0;newWaypoints[segmentStartIndex]=newSegmentStart;newWaypoints[segmentEndIndex]=newSegmentEnd;var sourceToSegmentOrientation,targetToSegmentOrientation;if(segmentStartIndex<2){sourceToSegmentOrientation=LayoutUtil.getOrientation(connection.source,newSegmentStart);if(segmentStartIndex===1){if(sourceToSegmentOrientation==='intersect'){newWaypoints.shift();newWaypoints[0]=newSegmentStart;segmentOffset--;}}else{if(sourceToSegmentOrientation!=='intersect'){newWaypoints.unshift(segmentStart);segmentOffset++;}}}if(segmentEndIndex>waypointCount-3){targetToSegmentOrientation=LayoutUtil.getOrientation(connection.target,newSegmentEnd);if(segmentEndIndex===waypointCount-2){if(targetToSegmentOrientation==='intersect'){newWaypoints.pop();newWaypoints[newWaypoints.length-1]=newSegmentEnd;}}else{if(targetToSegmentOrientation!=='intersect'){newWaypoints.push(segmentEnd);}}}context.newWaypoints=connection.waypoints=cropConnection(connection,newWaypoints);updateDragger(context,segmentOffset,e);context.newSegmentStartIndex=segmentStartIndex+segmentOffset;redrawConnection(e);});eventBus.on('connectionSegment.move.hover',function(e){e.context.hover=e.hover;canvas.addMarker(e.hover,MARKER_CONNECT_HOVER);});eventBus.on(['connectionSegment.move.out','connectionSegment.move.cleanup'],function(e){var hover=e.context.hover;if(hover){canvas.removeMarker(hover,MARKER_CONNECT_HOVER);}});eventBus.on('connectionSegment.move.cleanup',function(e){var context=e.context,connection=context.connection;if(context.draggerGfx){svgRemove(context.draggerGfx);}canvas.removeMarker(connection,MARKER_CONNECT_UPDATING);});eventBus.on(['connectionSegment.move.cancel','connectionSegment.move.end'],function(e){var context=e.context,connection=context.connection;connection.waypoints=context.originalWaypoints;redrawConnection(e);});eventBus.on('connectionSegment.move.end',function(e){var context=e.context,connection=context.connection,newWaypoints=context.newWaypoints,newSegmentStartIndex=context.newSegmentStartIndex;newWaypoints=newWaypoints.map(function(p){return{original:p.original,x:Math.round(p.x),y:Math.round(p.y)};});var filtered=filterRedundantWaypoints(newWaypoints,newSegmentStartIndex);var filteredWaypoints=filtered.waypoints,croppedWaypoints=cropConnection(connection,filteredWaypoints),segmentOffset=filtered.segmentOffset;var hints={segmentMove:{segmentStartIndex:context.segmentStartIndex,newSegmentStartIndex:newSegmentStartIndex+segmentOffset}};modeling.updateWaypoints(connection,croppedWaypoints,hints);});}ConnectionSegmentMove.$inject=['injector','eventBus','canvas','dragging','graphicsFactory','rules','modeling'];module.exports=ConnectionSegmentMove;},{"../../layout/LayoutUtil":359,"../../util/Geometry":375,"../../util/SvgTransformUtil":386,"./BendpointUtil":249,"tiny-svg/lib/classes":610,"tiny-svg/lib/remove":616}],252:[function(require,module,exports){module.exports={__depends__:[require('../dragging'),require('../rules')],__init__:['bendpoints','bendpointSnapping'],bendpoints:['type',require('./Bendpoints')],bendpointMove:['type',require('./BendpointMove')],connectionSegmentMove:['type',require('./ConnectionSegmentMove')],bendpointSnapping:['type',require('./BendpointSnapping')]};},{"../dragging":269,"../rules":334,"./BendpointMove":247,"./BendpointSnapping":248,"./Bendpoints":250,"./ConnectionSegmentMove":251}],253:[function(require,module,exports){'use strict';var getElementType=require('../../util/Elements').getType;function ChangeSupport(eventBus,canvas,elementRegistry,graphicsFactory){eventBus.on('element.changed',function(event){var element=event.element;if(element.parent||element===canvas.getRootElement()){event.gfx=elementRegistry.getGraphics(element);}if(!event.gfx){return;}eventBus.fire(getElementType(element)+'.changed',event);});eventBus.on('elements.changed',function(event){var elements=event.elements;elements.forEach(function(e){eventBus.fire('element.changed',{element:e});});graphicsFactory.updateContainments(elements);});eventBus.on('shape.changed',function(event){graphicsFactory.update('shape',event.element,event.gfx);});eventBus.on('connection.changed',function(event){graphicsFactory.update('connection',event.element,event.gfx);});}ChangeSupport.$inject=['eventBus','canvas','elementRegistry','graphicsFactory'];module.exports=ChangeSupport;},{"../../util/Elements":373}],254:[function(require,module,exports){module.exports={__init__:['changeSupport'],changeSupport:['type',require('./ChangeSupport')]};},{"./ChangeSupport":253}],255:[function(require,module,exports){'use strict';function Clipboard(){}module.exports=Clipboard;Clipboard.prototype.get=function(){return this._data;};Clipboard.prototype.set=function(data){this._data=data;};Clipboard.prototype.clear=function(){var data=this._data;delete this._data;return data;};Clipboard.prototype.isEmpty=function(){return!this._data;};},{}],256:[function(require,module,exports){module.exports={clipboard:['type',require('./Clipboard')]};},{"./Clipboard":255}],257:[function(require,module,exports){'use strict';var LayoutUtil=require('../../layout/LayoutUtil');var MARKER_OK='connect-ok',MARKER_NOT_OK='connect-not-ok';var svgAppend=require('tiny-svg/lib/append'),svgAttr=require('tiny-svg/lib/attr'),svgCreate=require('tiny-svg/lib/create'),svgRemove=require('tiny-svg/lib/remove');function Connect(eventBus,dragging,modeling,rules,canvas,graphicsFactory){function canConnect(source,target){return rules.allowed('connection.create',{source:source,target:target});}function crop(start,end,source,target){var sourcePath=graphicsFactory.getShapePath(source),targetPath=target&&graphicsFactory.getShapePath(target),connectionPath=graphicsFactory.getConnectionPath({waypoints:[start,end]});start=LayoutUtil.getElementLineIntersection(sourcePath,connectionPath,true)||start;end=(target&&LayoutUtil.getElementLineIntersection(targetPath,connectionPath,false))||end;return[start,end];}eventBus.on('connect.move',function(event){var context=event.context,source=context.source,target=context.target,visual=context.visual,sourcePosition=context.sourcePosition,endPosition,waypoints;endPosition={x:event.x,y:event.y};waypoints=crop(sourcePosition,endPosition,source,target);svgAttr(visual,{'points':[waypoints[0].x,waypoints[0].y,waypoints[1].x,waypoints[1].y]});});eventBus.on('connect.hover',function(event){var context=event.context,source=context.source,hover=event.hover,canExecute;canExecute=context.canExecute=canConnect(source,hover);if(canExecute===null){return;}context.target=hover;canvas.addMarker(hover,canExecute?MARKER_OK:MARKER_NOT_OK);});eventBus.on(['connect.out','connect.cleanup'],function(event){var context=event.context;if(context.target){canvas.removeMarker(context.target,context.canExecute?MARKER_OK:MARKER_NOT_OK);}context.target=null;});eventBus.on('connect.cleanup',function(event){var context=event.context;if(context.visual){svgRemove(context.visual);}});eventBus.on('connect.start',function(event){var context=event.context,visual;visual=svgCreate('polyline');svgAttr(visual,{'stroke':'#333','strokeDasharray':[1],'strokeWidth':2,'pointer-events':'none'});svgAppend(canvas.getDefaultLayer(),visual);context.visual=visual;});eventBus.on('connect.end',function(event){var context=event.context,source=context.source,sourcePosition=context.sourcePosition,target=context.target,targetPosition={x:event.x,y:event.y},canExecute=context.canExecute||canConnect(source,target);if(!canExecute){return false;}var attrs=null,hints={connectionStart:sourcePosition,connectionEnd:targetPosition};if(typeof canExecute==='object'){attrs=canExecute;}modeling.connect(source,target,attrs,hints);});this.start=function(event,source,sourcePosition,autoActivate){if(typeof sourcePosition!=='object'){autoActivate=sourcePosition;sourcePosition=LayoutUtil.getMid(source);}dragging.init(event,'connect',{autoActivate:autoActivate,data:{shape:source,context:{source:source,sourcePosition:sourcePosition}}});};}Connect.$inject=['eventBus','dragging','modeling','rules','canvas','graphicsFactory'];module.exports=Connect;},{"../../layout/LayoutUtil":359,"tiny-svg/lib/append":607,"tiny-svg/lib/attr":609,"tiny-svg/lib/create":613,"tiny-svg/lib/remove":616}],258:[function(require,module,exports){module.exports={__depends__:[require('../selection'),require('../rules'),require('../dragging')],connect:['type',require('./Connect')]};},{"../dragging":269,"../rules":334,"../selection":340,"./Connect":257}],259:[function(require,module,exports){'use strict';var isFunction=require('lodash/lang/isFunction'),isArray=require('lodash/lang/isArray'),forEach=require('lodash/collection/forEach'),domDelegate=require('min-dom/lib/delegate'),domEvent=require('min-dom/lib/event'),domAttr=require('min-dom/lib/attr'),domQuery=require('min-dom/lib/query'),domClasses=require('min-dom/lib/classes'),domify=require('min-dom/lib/domify');var entrySelector='.entry';function ContextPad(eventBus,overlays){this._providers=[];this._eventBus=eventBus;this._overlays=overlays;this._current=null;this._init();}ContextPad.$inject=['eventBus','overlays'];module.exports=ContextPad;ContextPad.prototype._init=function(){var eventBus=this._eventBus;var self=this;eventBus.on('selection.changed',function(e){var selection=e.newSelection;if(selection.length===1){self.open(selection[0]);}else{self.close();}});eventBus.on('elements.delete',function(event){var elements=event.elements;forEach(elements,function(e){if(self.isOpen(e)){self.close();}});});eventBus.on('element.changed',function(event){var element=event.element,current=self._current;if(current&&current.element===element){self.open(element,true);}});};ContextPad.prototype.registerProvider=function(provider){this._providers.push(provider);};ContextPad.prototype.getEntries=function(element){var entries={};forEach(this._providers,function(provider){var e=provider.getContextPadEntries(element);forEach(e,function(entry,id){entries[id]=entry;});});return entries;};ContextPad.prototype.trigger=function(action,event,autoActivate){var element=this._current.element,entries=this._current.entries,entry,handler,originalEvent,button=event.delegateTarget||event.target;if(!button){return event.preventDefault();}entry=entries[domAttr(button,'data-action')];handler=entry.action;originalEvent=event.originalEvent||event;if(isFunction(handler)){if(action==='click'){return handler(originalEvent,element,autoActivate);}}else{if(handler[action]){return handler[action](originalEvent,element,autoActivate);}}event.preventDefault();};ContextPad.prototype.open=function(element,force){if(!force&&this.isOpen(element)){return;}this.close();this._updateAndOpen(element);};ContextPad.prototype._updateAndOpen=function(element){var entries=this.getEntries(element),pad=this.getPad(element),html=pad.html;forEach(entries,function(entry,id){var grouping=entry.group||'default',control=domify(entry.html||'<div class="entry" draggable="true"></div>'),container;domAttr(control,'data-action',id);container=domQuery('[data-group='+grouping+']',html);if(!container){container=domify('<div class="group" data-group="'+grouping+'"></div>');html.appendChild(container);}container.appendChild(control);if(entry.className){addClasses(control,entry.className);}if(entry.title){domAttr(control,'title',entry.title);}if(entry.imageUrl){control.appendChild(domify('<img src="'+entry.imageUrl+'">'));}});domClasses(html).add('open');this._current={element:element,pad:pad,entries:entries};this._eventBus.fire('contextPad.open',{current:this._current});};ContextPad.prototype.getPad=function(element){if(this.isOpen()){return this._current.pad;}var self=this;var overlays=this._overlays;var html=domify('<div class="djs-context-pad"></div>');domDelegate.bind(html,entrySelector,'click',function(event){self.trigger('click',event);});domDelegate.bind(html,entrySelector,'dragstart',function(event){self.trigger('dragstart',event);});domEvent.bind(html,'mousedown',function(event){event.stopPropagation();});this._overlayId=overlays.add(element,'context-pad',{position:{right:-9,top:-6},html:html});var pad=overlays.get(this._overlayId);this._eventBus.fire('contextPad.create',{element:element,pad:pad});return pad;};ContextPad.prototype.close=function(){if(!this.isOpen()){return;}this._overlays.remove(this._overlayId);this._overlayId=null;this._eventBus.fire('contextPad.close',{current:this._current});this._current=null;};ContextPad.prototype.isOpen=function(element){return!!this._current&&(!element?true:this._current.element===element);};function addClasses(element,classNames){var classes=domClasses(element);var actualClassNames=isArray(classNames)?classNames:classNames.split(/\s+/g);actualClassNames.forEach(function(cls){classes.add(cls);});}},{"lodash/collection/forEach":417,"lodash/lang/isArray":537,"lodash/lang/isFunction":539,"min-dom/lib/attr":561,"min-dom/lib/classes":562,"min-dom/lib/delegate":565,"min-dom/lib/domify":566,"min-dom/lib/event":567,"min-dom/lib/query":569}],260:[function(require,module,exports){module.exports={__depends__:[require('../interaction-events'),require('../overlays')],contextPad:['type',require('./ContextPad')]};},{"../interaction-events":277,"../overlays":318,"./ContextPad":259}],261:[function(require,module,exports){'use strict';var isArray=require('lodash/lang/isArray'),forEach=require('lodash/collection/forEach'),map=require('lodash/collection/map'),find=require('lodash/collection/find'),findIndex=require('lodash/array/findIndex'),sortBy=require('lodash/collection/sortBy'),reduce=require('lodash/collection/reduce');var getBBox=require('../../util/Elements').getBBox;var PositionUtil=require('../../util/PositionUtil');var CopyPasteUtil=require('../../util/CopyPasteUtil'),ElementsUtil=require('../../util/Elements');function CopyPaste(eventBus,modeling,elementFactory,rules,clipboard,canvas){this._eventBus=eventBus;this._modeling=modeling;this._elementFactory=elementFactory;this._rules=rules;this._canvas=canvas;this._clipboard=clipboard;this._descriptors=[];this.registerDescriptor(function(element,descriptor){descriptor.priority=1;descriptor.id=element.id;if(element.parent){descriptor.parent=element.parent.id;}if(element.labelTarget){descriptor.priority=4;descriptor.labelTarget=element.labelTarget.id;}if(element.host){descriptor.priority=2;descriptor.host=element.host.id;}if(typeof element.x==='number'){descriptor.x=element.x;descriptor.y=element.y;}if(element.width){descriptor.width=element.width;descriptor.height=element.height;}if(element.waypoints){descriptor.priority=3;descriptor.waypoints=[];forEach(element.waypoints,function(waypoint){var wp={x:waypoint.x,y:waypoint.y};if(waypoint.original){wp.original={x:waypoint.original.x,y:waypoint.original.y};}descriptor.waypoints.push(wp);});}if(element.source&&element.target){descriptor.source=element.source.id;descriptor.target=element.target.id;}return descriptor;});}CopyPaste.$inject=['eventBus','modeling','elementFactory','rules','clipboard','canvas'];module.exports=CopyPaste;CopyPaste.prototype.copy=function(selectedElements){var clipboard=this._clipboard,tree,bbox;if(!isArray(selectedElements)){selectedElements=selectedElements?[selectedElements]:[];}if(!selectedElements.length){return;}tree=this.createTree(selectedElements);bbox=this._bbox=PositionUtil.center(getBBox(tree.allShapes));delete tree.allShapes;forEach(tree,function(elements){forEach(elements,function(element){var delta,labelTarget;if(element.labelTarget){labelTarget=find(elements,{id:element.labelTarget});if(labelTarget.waypoints){delta=PositionUtil.delta(element,labelTarget.waypoints[0]);}else{delta=PositionUtil.delta(element,labelTarget);}}else
if(element.priority===3){delta=[];forEach(element.waypoints,function(waypoint){var waypointDelta=PositionUtil.delta(waypoint,bbox);delta.push(waypointDelta);},this);}else{delta=PositionUtil.delta(element,bbox);}element.delta=delta;});});this._eventBus.fire('elements.copy',{context:{tree:tree}});if(Object.keys(tree).length===0){clipboard.clear();}else{clipboard.set(tree);}this._eventBus.fire('elements.copied',{context:{tree:tree}});return tree;};CopyPaste.prototype.paste=function(context){var clipboard=this._clipboard,modeling=this._modeling,eventBus=this._eventBus,rules=this._rules;var tree=clipboard.get(),topParent=context.element,position=context.point,newTree,canPaste;if(clipboard.isEmpty()){return;}newTree=reduce(tree,function(pasteTree,elements,depthStr){var depth=parseInt(depthStr,10);if(isNaN(depth)){return pasteTree;}pasteTree[depth]=elements;return pasteTree;},{},this);canPaste=rules.allowed('elements.paste',{tree:newTree,target:topParent});if(!canPaste){eventBus.fire('elements.paste.rejected',{context:{tree:newTree,position:position,target:topParent}});return;}modeling.pasteElements(newTree,topParent,position);};CopyPaste.prototype._computeDelta=function(elements,element){var bbox=this._bbox,delta={};if(element.labelTarget){return PositionUtil.delta(element,element.labelTarget);}if(element.priority===3){delta=[];forEach(element.waypoints,function(waypoint){var waypointDelta=PositionUtil.delta(waypoint,bbox);delta.push(waypointDelta);},this);}else{delta=PositionUtil.delta(element,bbox);}return delta;};CopyPaste.prototype.hasRelations=function(elements,element){var source,target,labelTarget;if(element.waypoints){source=find(elements,{id:element.source.id});target=find(elements,{id:element.target.id});if(!source||!target){return false;}}if(element.labelTarget){labelTarget=find(elements,{id:element.labelTarget.id});if(!labelTarget){return false;}}return true;};CopyPaste.prototype.registerDescriptor=function(descriptor){if(typeof descriptor!=='function'){throw new Error('the descriptor must be a function');}if(this._descriptors.indexOf(descriptor)!==-1){throw new Error('this descriptor is already registered');}this._descriptors.push(descriptor);};CopyPaste.prototype._executeDescriptors=function(data){if(!data.descriptor){data.descriptor={};}forEach(this._descriptors,function(descriptor){data.descriptor=descriptor(data.element,data.descriptor);});return data;};CopyPaste.prototype.createTree=function(elements){var rules=this._rules;var tree={},includedElements=[],_elements;var topLevel=CopyPasteUtil.getTopLevel(elements);tree.allShapes=[];function canCopy(collection,element){return rules.allowed('element.copy',{collection:collection,element:element});}function includeElement(data){var idx=findIndex(includedElements,{element:data.element}),element;if(idx!==-1){element=includedElements[idx];}else{return includedElements.push(data);}if(element.depth<data.depth){includedElements.splice(idx,1);includedElements.push(data);}}ElementsUtil.eachElement(topLevel,function(element,i,depth){var nestedChildren=element.children;if(element.labelTarget){return;}function getNested(lists){forEach(lists,function(list){if(list&&list.length){forEach(list,function(elem){if(elem.label){includeElement({element:elem.label,depth:depth});}includeElement({element:elem,depth:depth});});}});}if(element.label){includeElement({element:element.label,depth:depth});}getNested([element.attachers,element.incoming,element.outgoing]);includeElement({element:element,depth:depth});if(nestedChildren){return nestedChildren;}});includedElements=map(includedElements,function(data){return this._executeDescriptors(data);},this);includedElements=sortBy(includedElements,function(data){return data.descriptor.priority;});_elements=map(includedElements,function(data){return data.element;});forEach(includedElements,function(data){var depth=data.depth;if(!this.hasRelations(tree.allShapes,data.element)){return;}if(!canCopy(_elements,data.element)){return;}tree.allShapes.push(data.element);if(!tree[depth]){tree[depth]=[];}tree[depth].push(data.descriptor);},this);return tree;};},{"../../util/CopyPasteUtil":371,"../../util/Elements":373,"../../util/PositionUtil":383,"lodash/array/findIndex":402,"lodash/collection/find":416,"lodash/collection/forEach":417,"lodash/collection/map":420,"lodash/collection/reduce":421,"lodash/collection/sortBy":425,"lodash/lang/isArray":537}],262:[function(require,module,exports){module.exports={__depends__:[require('../clipboard'),require('../rules'),require('../mouse-tracking')],__init__:['copyPaste'],copyPaste:['type',require('./CopyPaste')]};},{"../clipboard":256,"../mouse-tracking":310,"../rules":334,"./CopyPaste":261}],263:[function(require,module,exports){'use strict';var LOW_PRIORITY=750;var MARKER_OK='drop-ok',MARKER_NOT_OK='drop-not-ok',MARKER_ATTACH='attach-ok',MARKER_NEW_PARENT='new-parent';var svgAppend=require('tiny-svg/lib/append'),svgAttr=require('tiny-svg/lib/attr'),svgClasses=require('tiny-svg/lib/classes'),svgCreate=require('tiny-svg/lib/create'),svgRemove=require('tiny-svg/lib/remove');var translate=require('../../util/SvgTransformUtil').translate;function Create(eventBus,dragging,rules,modeling,canvas,styles,graphicsFactory){function canCreate(shape,target,source,position){if(source){return rules.allowed('shape.append',{source:source,shape:shape,target:target,position:position});}else{return rules.allowed('shape.create',{shape:shape,target:target,position:position});}}function setMarker(element,marker){[MARKER_ATTACH,MARKER_OK,MARKER_NOT_OK,MARKER_NEW_PARENT].forEach(function(m){if(m===marker){canvas.addMarker(element,m);}else{canvas.removeMarker(element,m);}});}function createVisual(shape){var group,preview,visual;group=svgCreate('g');svgAttr(group,styles.cls('djs-drag-group',['no-events']));svgAppend(canvas.getDefaultLayer(),group);preview=svgCreate('g');svgClasses(preview).add('djs-dragger');svgAppend(group,preview);translate(preview,shape.width/-2,shape.height/-2);var visualGroup=svgCreate('g');svgClasses(visualGroup).add('djs-visual');svgAppend(preview,visualGroup);visual=visualGroup;graphicsFactory.drawShape(visual,shape);return group;}eventBus.on('create.move',function(event){var context=event.context,hover=event.hover,canExecute;var position={x:event.x,y:event.y};canExecute=context.canExecute=hover&&canCreate(context.shape,hover,context.source,position);if(hover&&canExecute!==null){context.target=hover;if(canExecute==='attach'){setMarker(hover,MARKER_ATTACH);}else{setMarker(hover,context.canExecute?MARKER_NEW_PARENT:MARKER_NOT_OK);}}});eventBus.on('create.move',LOW_PRIORITY,function(event){var context=event.context,shape=context.shape,visual=context.visual;if(!visual){visual=context.visual=createVisual(shape);}translate(visual,event.x,event.y);});eventBus.on(['create.end','create.out','create.cleanup'],function(event){var context=event.context,target=context.target;if(target){setMarker(target,null);}});eventBus.on('create.end',function(event){var context=event.context,source=context.source,shape=context.shape,target=context.target,canExecute=context.canExecute,isAttach,position={x:event.x,y:event.y};if(!canExecute){return false;}if(source){shape=modeling.appendShape(source,shape,position,target);}else{isAttach=canExecute==='attach';shape=modeling.createShape(shape,position,target,isAttach);}context.shape=shape;});eventBus.on('create.cleanup',function(event){var context=event.context;if(context.visual){svgRemove(context.visual);}});this.start=function(event,shape,source){dragging.init(event,'create',{cursor:'grabbing',autoActivate:true,data:{shape:shape,context:{shape:shape,source:source}}});};}Create.$inject=['eventBus','dragging','rules','modeling','canvas','styles','graphicsFactory'];module.exports=Create;},{"../../util/SvgTransformUtil":386,"tiny-svg/lib/append":607,"tiny-svg/lib/attr":609,"tiny-svg/lib/classes":610,"tiny-svg/lib/create":613,"tiny-svg/lib/remove":616}],264:[function(require,module,exports){module.exports={__depends__:[require('../dragging'),require('../selection'),require('../rules')],create:['type',require('./Create')]};},{"../dragging":269,"../rules":334,"../selection":340,"./Create":263}],265:[function(require,module,exports){'use strict';var sortBy=require('lodash/collection/sortBy'),forEach=require('lodash/collection/forEach'),filter=require('lodash/collection/filter');var AXIS_DIMENSIONS={horizontal:['x','width'],vertical:['y','height']};var THRESHOLD=5;function DistributeElements(modeling){this._modeling=modeling;this._filters=[];this.registerFilter(function(elements,axis,dimension){var elementsSize=0,numOfShapes=0,avgDimension;forEach(elements,function(element){if(element.waypoints||element.labelTarget){return;}elementsSize+=element[dimension];numOfShapes+=1;});avgDimension=Math.round(elementsSize/numOfShapes);return filter(elements,function(element){return element[dimension]<(avgDimension+50);});});}module.exports=DistributeElements;DistributeElements.$inject=['modeling'];DistributeElements.prototype.registerFilter=function(filterFn){if(typeof filterFn!=='function'){throw new Error('the filter has to be a function');}this._filters.push(filterFn);};DistributeElements.prototype.trigger=function(elements,orientation){var modeling=this._modeling;var groups,distributableElements;if(elements.length<3){return;}this._setOrientation(orientation);distributableElements=this._filterElements(elements);groups=this._createGroups(distributableElements);if(groups.length<=2){return;}modeling.distributeElements(groups,this._axis,this._dimension);return groups;};DistributeElements.prototype._filterElements=function(elements){var filters=this._filters,axis=this._axis,dimension=this._dimension,distributableElements=[].concat(elements);if(!filters.length){return elements;}forEach(filters,function(filterFn){distributableElements=filterFn(distributableElements,axis,dimension);});return distributableElements;};DistributeElements.prototype._createGroups=function(elements){var rangeGroups=[],axis=this._axis,dimension=this._dimension;if(!axis){throw new Error('must have a defined "axis" and "dimension"');}var sortedElements=sortBy(elements,axis);forEach(sortedElements,function(element,idx){var elementRange=this._findRange(element,axis,dimension),range;var previous=rangeGroups[rangeGroups.length-1];if(previous&&this._hasIntersection(previous.range,elementRange)){rangeGroups[rangeGroups.length-1].elements.push(element);}else{range={range:elementRange,elements:[element]};rangeGroups.push(range);}},this);return rangeGroups;};DistributeElements.prototype._setOrientation=function(direction){var orientation=AXIS_DIMENSIONS[direction];this._axis=orientation[0];this._dimension=orientation[1];};DistributeElements.prototype._hasIntersection=function(rangeA,rangeB){return Math.max(rangeA.min,rangeA.max)>=Math.min(rangeB.min,rangeB.max)&&Math.min(rangeA.min,rangeA.max)<=Math.max(rangeB.min,rangeB.max);};DistributeElements.prototype._findRange=function(element){var axis=element[this._axis],dimension=element[this._dimension];return{min:axis+THRESHOLD,max:axis+dimension-THRESHOLD};};},{"lodash/collection/filter":415,"lodash/collection/forEach":417,"lodash/collection/sortBy":425}],266:[function(require,module,exports){'use strict';module.exports={__init__:['distributeElements'],distributeElements:['type',require('./DistributeElements')]};},{"./DistributeElements":265}],267:[function(require,module,exports){'use strict';var round=Math.round;var assign=require('lodash/object/assign');var domEvent=require('min-dom/lib/event'),Event=require('../../util/Event'),ClickTrap=require('../../util/ClickTrap'),Cursor=require('../../util/Cursor');var EventBusEvent=require('../../core/EventBus').Event;var DRAG_ACTIVE_CLS='djs-drag-active';function suppressEvent(event){if(event instanceof MouseEvent){Event.stopEvent(event,true);}else{Event.preventDefault(event);}}function getLength(point){return Math.sqrt(Math.pow(point.x,2)+Math.pow(point.y,2));}function substract(p1,p2){return{x:p1.x-p2.x,y:p1.y-p2.y};}function Dragging(eventBus,canvas,selection){var defaultOptions={threshold:5,trapClick:true};var context;function toLocalPoint(globalPosition){var viewbox=canvas.viewbox();var clientRect=canvas._container.getBoundingClientRect();return{x:viewbox.x+round((globalPosition.x-clientRect.left)/viewbox.scale),y:viewbox.y+round((globalPosition.y-clientRect.top)/viewbox.scale)};}function fire(type,dragContext){dragContext=dragContext||context;var event=assign(new EventBusEvent(),dragContext.payload,dragContext.data);if(eventBus.fire('drag.'+type,event)===false){return false;}return eventBus.fire(dragContext.prefix+'.'+type,event);}function move(event,activate){var payload=context.payload,displacement=context.displacement;var globalStart=context.globalStart,globalCurrent=Event.toPoint(event),globalDelta=substract(globalCurrent,globalStart);var localStart=context.localStart,localCurrent=toLocalPoint(globalCurrent),localDelta=substract(localCurrent,localStart);if(!context.active&&(activate||getLength(globalDelta)>context.threshold)){assign(payload,{x:localStart.x+displacement.x,y:localStart.y+displacement.y,dx:0,dy:0},{originalEvent:event});if(false===fire('start')){return cancel();}context.active=true;if(!context.keepSelection){payload.previousSelection=selection.get();selection.select(null);}if(context.cursor){Cursor.set(context.cursor);}canvas.addMarker(canvas.getRootElement(),DRAG_ACTIVE_CLS);}suppressEvent(event);if(context.active){assign(payload,{x:localCurrent.x+displacement.x,y:localCurrent.y+displacement.y,dx:localDelta.x,dy:localDelta.y},{originalEvent:event});fire('move');}}function end(event){var previousContext,returnValue=true;if(context.active){if(event){context.payload.originalEvent=event;suppressEvent(event);}returnValue=fire('end');}if(returnValue===false){fire('rejected');}previousContext=cleanup(returnValue!==true);fire('ended',previousContext);}function checkCancel(event){if(event.which===27){event.preventDefault();cancel();}}function trapClickAndEnd(event){var untrap;if(context.active){untrap=ClickTrap.install();setTimeout(untrap,400);}end(event);}function trapTouch(event){move(event);}function hover(event){var payload=context.payload;payload.hoverGfx=event.gfx;payload.hover=event.element;fire('hover');}function out(event){fire('out');var payload=context.payload;payload.hoverGfx=null;payload.hover=null;}function cancel(restore){var previousContext;if(!context){return;}var wasActive=context.active;if(wasActive){fire('cancel');}previousContext=cleanup(restore);if(wasActive){fire('canceled',previousContext);}}function cleanup(restore){var previousContext,endDrag;fire('cleanup');Cursor.unset();if(context.trapClick){endDrag=trapClickAndEnd;}else{endDrag=end;}domEvent.unbind(document,'mousemove',move);domEvent.unbind(document,'mousedown',endDrag,true);domEvent.unbind(document,'mouseup',endDrag,true);domEvent.unbind(document,'keyup',checkCancel);domEvent.unbind(document,'touchstart',trapTouch,true);domEvent.unbind(document,'touchcancel',cancel,true);domEvent.unbind(document,'touchmove',move,true);domEvent.unbind(document,'touchend',end,true);eventBus.off('element.hover',hover);eventBus.off('element.out',out);canvas.removeMarker(canvas.getRootElement(),DRAG_ACTIVE_CLS);var previousSelection=context.payload.previousSelection;if(restore!==false&&previousSelection&&!selection.get().length){selection.select(previousSelection);}previousContext=context;context=null;return previousContext;}function init(event,relativeTo,prefix,options){if(context){cancel(false);}if(typeof relativeTo==='string'){options=prefix;prefix=relativeTo;relativeTo=null;}options=assign({},defaultOptions,options||{});var data=options.data||{},originalEvent,globalStart,endDrag;if(options.trapClick){endDrag=trapClickAndEnd;}else{endDrag=end;}if(event){originalEvent=Event.getOriginal(event)||event;globalStart=Event.toPoint(event);suppressEvent(event);}else{originalEvent=null;globalStart={x:0,y:0};}var localStart=toLocalPoint(globalStart);if(!relativeTo){relativeTo=localStart;}context=assign({prefix:prefix,data:data,payload:{},globalStart:globalStart,displacement:substract(relativeTo,localStart),localStart:localStart},options);if(!options.manual){if(typeof TouchEvent!=='undefined'&&originalEvent instanceof TouchEvent){domEvent.bind(document,'touchstart',trapTouch,true);domEvent.bind(document,'touchcancel',cancel,true);domEvent.bind(document,'touchmove',move,true);domEvent.bind(document,'touchend',end,true);}else{domEvent.bind(document,'mousemove',move);domEvent.bind(document,'mousedown',endDrag,true);domEvent.bind(document,'mouseup',endDrag,true);}domEvent.bind(document,'keyup',checkCancel);eventBus.on('element.hover',hover);eventBus.on('element.out',out);}fire('init');if(options.autoActivate){move(event,true);}}eventBus.on('diagram.destroy',cancel);this.init=init;this.move=move;this.hover=hover;this.out=out;this.end=end;this.cancel=cancel;this.context=function(){return context;};this.setOptions=function(options){assign(defaultOptions,options);};}Dragging.$inject=['eventBus','canvas','selection'];module.exports=Dragging;},{"../../core/EventBus":232,"../../util/ClickTrap":369,"../../util/Cursor":372,"../../util/Event":374,"lodash/object/assign":547,"min-dom/lib/event":567}],268:[function(require,module,exports){'use strict';var domClosest=require('min-dom/lib/closest');var Event=require('../../util/Event');function getGfx(target){var node=domClosest(target,'svg, .djs-element',true);return node;}function HoverFix(eventBus,dragging,elementRegistry){var self=this;eventBus.on('drag.start',function(event){eventBus.once('drag.move',function(){eventBus.once('drag.move',function(event){self.ensureHover(event);});});});this.ensureHover=function(event){if(event.hover){return;}var originalEvent=event.originalEvent,position,target,element,gfx;if(!(originalEvent instanceof MouseEvent)){return;}position=Event.toPoint(originalEvent);target=document.elementFromPoint(position.x,position.y);gfx=getGfx(target);if(gfx){element=elementRegistry.get(gfx);dragging.hover({element:element,gfx:gfx});}};}HoverFix.$inject=['eventBus','dragging','elementRegistry'];module.exports=HoverFix;},{"../../util/Event":374,"min-dom/lib/closest":564}],269:[function(require,module,exports){module.exports={__init__:['hoverFix'],__depends__:[require('../selection')],dragging:['type',require('./Dragging')],hoverFix:['type',require('./HoverFix')]};},{"../selection":340,"./Dragging":267,"./HoverFix":268}],270:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach'),isArray=require('lodash/lang/isArray');var NOT_REGISTERED_ERROR='is not a registered action',IS_REGISTERED_ERROR='is already registered';function EditorActions(eventBus,commandStack,modeling,selection,zoomScroll,copyPaste,canvas,rules,mouseTracking){this._actions={undo:function(){commandStack.undo();},redo:function(){commandStack.redo();},copy:function(){var selectedElements=selection.get();copyPaste.copy(selectedElements);},paste:function(){var context=mouseTracking.getHoverContext();copyPaste.paste(context);},stepZoom:function(opts){zoomScroll.stepZoom(opts.value);},zoom:function(opts){canvas.zoom(opts.value);},removeSelection:function(){var selectedElements=selection.get();if(selectedElements.length){var allowed=rules.allowed('elements.delete',{elements:selectedElements}),removableElements;if(allowed===false){return;}else if(isArray(allowed)){removableElements=allowed;}else{removableElements=selectedElements;}if(removableElements.length){modeling.removeElements(removableElements.slice());}}},moveCanvas:function(opts){var dx=0,dy=0,invertY=opts.invertY,speed=opts.speed;var actualSpeed=speed/Math.min(Math.sqrt(canvas.viewbox().scale),1);switch(opts.direction){case'left':dx=actualSpeed;break;case'up':dy=actualSpeed;break;case'right':dx=-actualSpeed;break;case'down':dy=-actualSpeed;break;}if(dy&&invertY){dy=-dy;}canvas.scroll({dx:dx,dy:dy});}};}EditorActions.$inject=['eventBus','commandStack','modeling','selection','zoomScroll','copyPaste','canvas','rules','mouseTracking'];module.exports=EditorActions;EditorActions.prototype.trigger=function(action,opts){if(!this._actions[action]){throw error(action,NOT_REGISTERED_ERROR);}return this._actions[action](opts);};EditorActions.prototype.register=function(actions,listener){if(typeof actions==='string'){return this._registerAction(actions,listener);}forEach(actions,function(listener,action){this._registerAction(action,listener);},this);};EditorActions.prototype._registerAction=function(action,listener){if(this.isRegistered(action)){throw error(action,IS_REGISTERED_ERROR);}this._actions[action]=listener;};EditorActions.prototype.unregister=function(action){if(!this.isRegistered(action)){throw error(action,NOT_REGISTERED_ERROR);}this._actions[action]=undefined;};EditorActions.prototype.length=function(){return Object.keys(this._actions).length;};EditorActions.prototype.isRegistered=function(action){return!!this._actions[action];};function error(action,message){return new Error(action+' '+message);}},{"lodash/collection/forEach":417,"lodash/lang/isArray":537}],271:[function(require,module,exports){module.exports={__depends__:[require('../selection'),require('../copy-paste'),require('../../navigation/zoomscroll')],__init__:['editorActions'],editorActions:['type',require('./EditorActions')]};},{"../../navigation/zoomscroll":367,"../copy-paste":262,"../selection":340,"./EditorActions":270}],272:[function(require,module,exports){'use strict';var MARKER_OK='connect-ok',MARKER_NOT_OK='connect-not-ok';function GlobalConnect(eventBus,dragging,connect,canvas,toolManager){var self=this;this._dragging=dragging;toolManager.registerTool('global-connect',{tool:'global-connect',dragging:'global-connect.drag'});eventBus.on('global-connect.hover',function(event){var context=event.context,startTarget=event.hover;var canStartConnect=context.canStartConnect=self.canStartConnect(startTarget);if(canStartConnect===null){return;}context.startTarget=startTarget;canvas.addMarker(startTarget,canStartConnect?MARKER_OK:MARKER_NOT_OK);});eventBus.on(['global-connect.out','global-connect.cleanup'],function(event){var startTarget=event.context.startTarget,canStartConnect=event.context.canStartConnect;if(startTarget){canvas.removeMarker(startTarget,canStartConnect?MARKER_OK:MARKER_NOT_OK);}});eventBus.on(['global-connect.ended'],function(event){var context=event.context,startTarget=context.startTarget,startPosition={x:event.x,y:event.y};var canStartConnect=self.canStartConnect(startTarget);if(!canStartConnect){return;}eventBus.once('element.out',function(){eventBus.once(['connect.ended','connect.canceled'],function(){eventBus.fire('global-connect.drag.ended');});connect.start(null,startTarget,startPosition);});return false;});}GlobalConnect.$inject=['eventBus','dragging','connect','canvas','toolManager'];module.exports=GlobalConnect;GlobalConnect.prototype.start=function(event){this._dragging.init(event,'global-connect',{trapClick:false,data:{context:{}}});};GlobalConnect.prototype.toggle=function(){if(this.isActive()){this._dragging.cancel();}else{this.start();}};GlobalConnect.prototype.isActive=function(){var context=this._dragging.context();return context&&/^global-connect/.test(context.prefix);};GlobalConnect.prototype.registerProvider=function(provider){this._provider=provider;};GlobalConnect.prototype.canStartConnect=function(startTarget){return this._provider.canStartConnect(startTarget);};},{}],273:[function(require,module,exports){module.exports={__depends__:[require('../connect'),require('../rules'),require('../dragging'),require('../tool-manager')],globalConnect:['type',require('./GlobalConnect')]};},{"../connect":258,"../dragging":269,"../rules":334,"../tool-manager":349,"./GlobalConnect":272}],274:[function(require,module,exports){'use strict';var hasPrimaryModifier=require('../../util/Mouse').hasPrimaryModifier;var HIGH_PRIORITY=1500;var HAND_CURSOR='grab';function HandTool(eventBus,canvas,dragging,toolManager){this._dragging=dragging;toolManager.registerTool('hand',{tool:'hand',dragging:'hand.move'});eventBus.on('element.mousedown',HIGH_PRIORITY,function(event){if(hasPrimaryModifier(event)){this.activateMove(event.originalEvent);return false;}},this);eventBus.on('hand.end',function(event){var target=event.originalEvent.target;if(!event.hover&&!(target instanceof SVGElement)){return false;}eventBus.once('hand.ended',function(){this.activateMove(event.originalEvent,{reactivate:true});},this);},this);eventBus.on('hand.move.move',function(event){var scale=canvas.viewbox().scale;canvas.scroll({dx:event.dx*scale,dy:event.dy*scale});});eventBus.on('hand.move.end',function(event){var context=event.context,reactivate=context.reactivate;if(!hasPrimaryModifier(event)&&reactivate){eventBus.once('hand.move.ended',function(event){this.activateHand(event.originalEvent,true,true);},this);}return false;},this);}HandTool.$inject=['eventBus','canvas','dragging','toolManager'];module.exports=HandTool;HandTool.prototype.activateMove=function(event,autoActivate,context){if(typeof autoActivate==='object'){context=autoActivate;autoActivate=false;}this._dragging.init(event,'hand.move',{autoActivate:autoActivate,cursor:HAND_CURSOR,data:{context:context||{}}});};HandTool.prototype.activateHand=function(event,autoActivate,reactivate){this._dragging.init(event,'hand',{trapClick:false,autoActivate:autoActivate,cursor:HAND_CURSOR,data:{context:{reactivate:reactivate}}});};HandTool.prototype.toggle=function(){if(this.isActive()){this._dragging.cancel();}else{this.activateHand();}};HandTool.prototype.isActive=function(){var context=this._dragging.context();return context&&/^hand/.test(context.prefix);};},{"../../util/Mouse":381}],275:[function(require,module,exports){'use strict';module.exports={__depends__:[require('../tool-manager')],__init__:['handTool'],handTool:['type',require('./HandTool')]};},{"../tool-manager":349,"./HandTool":274}],276:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach'),domDelegate=require('min-dom/lib/delegate');var isPrimaryButton=require('../../util/Mouse').isPrimaryButton;var svgAppend=require('tiny-svg/lib/append'),svgAttr=require('tiny-svg/lib/attr'),svgCreate=require('tiny-svg/lib/create');var domQuery=require('min-dom/lib/query');var renderUtil=require('../../util/RenderUtil');var createLine=renderUtil.createLine,updateLine=renderUtil.updateLine;var LOW_PRIORITY=500;function InteractionEvents(eventBus,elementRegistry,styles){var HIT_STYLE=styles.cls('djs-hit',['no-fill','no-border'],{stroke:'white',strokeWidth:15});function fire(type,event,element){if(!isPrimaryButton(event)){return;}var target,gfx,returnValue;if(!element){target=event.delegateTarget||event.target;if(target){gfx=target;element=elementRegistry.get(gfx);}}else{gfx=elementRegistry.getGraphics(element);}if(!gfx||!element){return;}returnValue=eventBus.fire(type,{element:element,gfx:gfx,originalEvent:event});if(returnValue===false){event.stopPropagation();event.preventDefault();}}var handlers={};function mouseHandler(type){var fn=handlers[type];if(!fn){fn=handlers[type]=function(event){fire(type,event);};}return fn;}var bindings={mouseover:'element.hover',mouseout:'element.out',click:'element.click',dblclick:'element.dblclick',mousedown:'element.mousedown',mouseup:'element.mouseup'};function triggerMouseEvent(eventName,event,targetElement){var localEventName=bindings[eventName];if(!localEventName){throw new Error('unmapped DOM event name <'+eventName+'>');}return fire(localEventName,event,targetElement);}var elementSelector='svg, .djs-element';function registerEvent(node,event,localEvent){var handler=mouseHandler(localEvent);handler.$delegate=domDelegate.bind(node,elementSelector,event,handler);}function unregisterEvent(node,event,localEvent){domDelegate.unbind(node,event,mouseHandler(localEvent).$delegate);}function registerEvents(svg){forEach(bindings,function(val,key){registerEvent(svg,key,val);});}function unregisterEvents(svg){forEach(bindings,function(val,key){unregisterEvent(svg,key,val);});}eventBus.on('canvas.destroy',function(event){unregisterEvents(event.svg);});eventBus.on('canvas.init',function(event){registerEvents(event.svg);});eventBus.on(['shape.added','connection.added'],function(event){var element=event.element,gfx=event.gfx,hit;if(element.waypoints){hit=createLine(element.waypoints);}else{hit=svgCreate('rect');svgAttr(hit,{x:0,y:0,width:element.width,height:element.height});}svgAttr(hit,HIT_STYLE);svgAppend(gfx,hit);});eventBus.on('shape.changed',LOW_PRIORITY,function(event){var element=event.element,gfx=event.gfx,hit=domQuery('.djs-hit',gfx);svgAttr(hit,{width:element.width,height:element.height});});eventBus.on('connection.changed',function(event){var element=event.element,gfx=event.gfx,hit=domQuery('.djs-hit',gfx);updateLine(hit,element.waypoints);});this.fire=fire;this.triggerMouseEvent=triggerMouseEvent;this.mouseHandler=mouseHandler;this.registerEvent=registerEvent;this.unregisterEvent=unregisterEvent;}InteractionEvents.$inject=['eventBus','elementRegistry','styles'];module.exports=InteractionEvents;},{"../../util/Mouse":381,"../../util/RenderUtil":385,"lodash/collection/forEach":417,"min-dom/lib/delegate":565,"min-dom/lib/query":569,"tiny-svg/lib/append":607,"tiny-svg/lib/attr":609,"tiny-svg/lib/create":613}],277:[function(require,module,exports){module.exports={__init__:['interactionEvents'],interactionEvents:['type',require('./InteractionEvents')]};},{"./InteractionEvents":276}],278:[function(require,module,exports){'use strict';var domEvent=require('min-dom/lib/event'),domMatches=require('min-dom/lib/matches');function Keyboard(config,eventBus,editorActions){var self=this;this._config=config||{};this._eventBus=eventBus;this._editorActions=editorActions;this._listeners=[];this._keyHandler=function(event){var i,l,target=event.target,listeners=self._listeners,code=event.keyCode||event.charCode||-1;if(target&&(domMatches(target,'input, textarea')||target.contentEditable==='true')){return;}for(i=0;(l=listeners[i]);i++){if(l(code,event)){event.preventDefault();event.stopPropagation();}}};eventBus.on('diagram.destroy',function(){self._fire('destroy');self.unbind();self._listeners=null;});eventBus.on('diagram.init',function(){self._fire('init');if(config&&config.bindTo){self.bind(config.bindTo);}});this._init();}Keyboard.$inject=['config.keyboard','eventBus','editorActions'];module.exports=Keyboard;Keyboard.prototype.bind=function(node){this.unbind();this._node=node;domEvent.bind(node,'keydown',this._keyHandler,true);this._fire('bind');};Keyboard.prototype.getBinding=function(){return this._node;};Keyboard.prototype.unbind=function(){var node=this._node;if(node){this._fire('unbind');domEvent.unbind(node,'keydown',this._keyHandler,true);}this._node=null;};Keyboard.prototype._fire=function(event){this._eventBus.fire('keyboard.'+event,{node:this._node,listeners:this._listeners});};Keyboard.prototype._init=function(){var listeners=this._listeners;var editorActions=this._editorActions,config=this._config;function undo(key,modifiers){if(isCmd(modifiers)&&!isShift(modifiers)&&key===90){editorActions.trigger('undo');return true;}}function redo(key,modifiers){if(isCmd(modifiers)&&(key===89||(key===90&&isShift(modifiers)))){editorActions.trigger('redo');return true;}}function copy(key,modifiers){if(isCmd(modifiers)&&(key===67)){editorActions.trigger('copy');return true;}}function paste(key,modifiers){if(isCmd(modifiers)&&(key===86)){editorActions.trigger('paste');return true;}}function zoomIn(key,modifiers){if((key===107||key===187||key===171||key===61)&&isCmd(modifiers)){editorActions.trigger('stepZoom',{value:1});return true;}}function zoomOut(key,modifiers){if((key===109||key===189||key===173)&&isCmd(modifiers)){editorActions.trigger('stepZoom',{value:-1});return true;}}function zoomDefault(key,modifiers){if((key===96||key===48)&&isCmd(modifiers)){editorActions.trigger('zoom',{value:1});return true;}}function removeSelection(key,modifiers){if(key===46){editorActions.trigger('removeSelection');return true;}}function moveCanvas(key,modifiers){if([37,38,39,40].indexOf(key)>=0){var opts={invertY:config.invertY,speed:(config.speed||50)};switch(key){case 37:opts.direction='left';break;case 38:opts.direction='up';break;case 39:opts.direction='right';break;case 40:opts.direction='down';break;}editorActions.trigger('moveCanvas',opts);return true;}}listeners.push(undo);listeners.push(redo);listeners.push(copy);listeners.push(paste);listeners.push(removeSelection);listeners.push(zoomIn);listeners.push(zoomOut);listeners.push(zoomDefault);listeners.push(moveCanvas);};Keyboard.prototype.addListener=function(listenerFn){this._listeners.push(listenerFn);};Keyboard.prototype.hasModifier=hasModifier;Keyboard.prototype.isCmd=isCmd;Keyboard.prototype.isShift=isShift;function hasModifier(modifiers){return(modifiers.ctrlKey||modifiers.metaKey||modifiers.shiftKey||modifiers.altKey);}function isCmd(modifiers){return modifiers.ctrlKey||modifiers.metaKey;}function isShift(modifiers){return modifiers.shiftKey;}},{"min-dom/lib/event":567,"min-dom/lib/matches":568}],279:[function(require,module,exports){module.exports={__init__:['keyboard'],keyboard:['type',require('./Keyboard')]};},{"./Keyboard":278}],280:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach'),filter=require('lodash/collection/filter'),inherits=require('inherits');var LOW_PRIORITY=250,HIGH_PRIORITY=1400;var CommandInterceptor=require('../../command/CommandInterceptor');function LabelSupport(eventBus,modeling,movePreview){CommandInterceptor.call(this,eventBus);eventBus.on('shape.move.start',HIGH_PRIORITY,function(e){var context=e.context,shapes=context.shapes,validatedShapes=context.validatedShapes;context.shapes=removeLabels(shapes);context.validatedShapes=removeLabels(validatedShapes);});eventBus.on('shape.move.start',LOW_PRIORITY,function(e){var context=e.context,shapes=context.shapes;var labels=[];forEach(shapes,function(element){var label=element.label;if(label&&!label.hidden&&context.shapes.indexOf(label)===-1){labels.push(label);}if(element.labelTarget){labels.push(element);}});forEach(labels,function(label){movePreview.makeDraggable(context,label,true);});});this.postExecuted(['elements.move'],function(e){var context=e.context,closure=context.closure,enclosedElements=closure.enclosedElements;forEach(enclosedElements,function(e){if(e.label&&!enclosedElements[e.label.id]){modeling.moveShape(e.label,context.delta,e.parent);}});});}inherits(LabelSupport,CommandInterceptor);LabelSupport.$inject=['eventBus','modeling','movePreview'];module.exports=LabelSupport;function removeLabels(elements){return filter(elements,function(element){return elements.indexOf(element.labelTarget)===-1;});}},{"../../command/CommandInterceptor":226,"inherits":398,"lodash/collection/filter":415,"lodash/collection/forEach":417}],281:[function(require,module,exports){module.exports={__depends__:[require('../move')],__init__:['labelSupport'],labelSupport:['type',require('./LabelSupport')]};},{"../move":313,"./LabelSupport":280}],282:[function(require,module,exports){'use strict';var values=require('lodash/object/values');var getEnclosedElements=require('../../util/Elements').getEnclosedElements;var hasSecondaryModifier=require('../../util/Mouse').hasSecondaryModifier;var svgAppend=require('tiny-svg/lib/append'),svgAttr=require('tiny-svg/lib/attr'),svgCreate=require('tiny-svg/lib/create'),svgRemove=require('tiny-svg/lib/remove');var LASSO_TOOL_CURSOR='crosshair';function LassoTool(eventBus,canvas,dragging,elementRegistry,selection,toolManager){this._selection=selection;this._dragging=dragging;var self=this;var visuals={create:function(context){var container=canvas.getDefaultLayer(),frame;frame=context.frame=svgCreate('rect');svgAttr(frame,{class:'djs-lasso-overlay',width:1,height:1,x:0,y:0});svgAppend(container,frame);},update:function(context){var frame=context.frame,bbox=context.bbox;svgAttr(frame,{x:bbox.x,y:bbox.y,width:bbox.width,height:bbox.height});},remove:function(context){if(context.frame){svgRemove(context.frame);}}};toolManager.registerTool('lasso',{tool:'lasso.selection',dragging:'lasso'});eventBus.on('lasso.selection.end',function(event){var target=event.originalEvent.target;if(!event.hover&&!(target instanceof SVGElement)){return;}eventBus.once('lasso.selection.ended',function(){self.activateLasso(event.originalEvent,true);});});eventBus.on('lasso.end',function(event){var bbox=toBBox(event);var elements=elementRegistry.filter(function(element){return element;});self.select(elements,bbox);});eventBus.on('lasso.start',function(event){var context=event.context;context.bbox=toBBox(event);visuals.create(context);});eventBus.on('lasso.move',function(event){var context=event.context;context.bbox=toBBox(event);visuals.update(context);});eventBus.on('lasso.cleanup',function(event){var context=event.context;visuals.remove(context);});eventBus.on('element.mousedown',1500,function(event){if(hasSecondaryModifier(event)){self.activateLasso(event.originalEvent);event.stopPropagation();}});}LassoTool.$inject=['eventBus','canvas','dragging','elementRegistry','selection','toolManager'];module.exports=LassoTool;LassoTool.prototype.activateLasso=function(event,autoActivate){this._dragging.init(event,'lasso',{autoActivate:autoActivate,cursor:LASSO_TOOL_CURSOR,data:{context:{}}});};LassoTool.prototype.activateSelection=function(event){this._dragging.init(event,'lasso.selection',{trapClick:false,cursor:LASSO_TOOL_CURSOR,data:{context:{}}});};LassoTool.prototype.select=function(elements,bbox){var selectedElements=getEnclosedElements(elements,bbox);this._selection.select(values(selectedElements));};LassoTool.prototype.toggle=function(){if(this.isActive()){this._dragging.cancel();}else{this.activateSelection();}};LassoTool.prototype.isActive=function(){var context=this._dragging.context();return context&&/^lasso/.test(context.prefix);};function toBBox(event){var start={x:event.x-event.dx,y:event.y-event.dy};var end={x:event.x,y:event.y};var bbox;if((start.x<=end.x&&start.y<end.y)||(start.x<end.x&&start.y<=end.y)){bbox={x:start.x,y:start.y,width:end.x-start.x,height:end.y-start.y};}else if((start.x>=end.x&&start.y<end.y)||(start.x>end.x&&start.y<=end.y)){bbox={x:end.x,y:start.y,width:start.x-end.x,height:end.y-start.y};}else if((start.x<=end.x&&start.y>end.y)||(start.x<end.x&&start.y>=end.y)){bbox={x:start.x,y:end.y,width:end.x-start.x,height:start.y-end.y};}else if((start.x>=end.x&&start.y>end.y)||(start.x>end.x&&start.y>=end.y)){bbox={x:end.x,y:end.y,width:start.x-end.x,height:start.y-end.y};}else{bbox={x:end.x,y:end.y,width:0,height:0};}return bbox;}},{"../../util/Elements":373,"../../util/Mouse":381,"lodash/object/values":557,"tiny-svg/lib/append":607,"tiny-svg/lib/attr":609,"tiny-svg/lib/create":613,"tiny-svg/lib/remove":616}],283:[function(require,module,exports){'use strict';module.exports={__depends__:[require('../tool-manager')],__init__:['lassoTool'],lassoTool:['type',require('./LassoTool')]};},{"../tool-manager":349,"./LassoTool":282}],284:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');var model=require('../../model');function Modeling(eventBus,elementFactory,commandStack){this._eventBus=eventBus;this._elementFactory=elementFactory;this._commandStack=commandStack;var self=this;eventBus.on('diagram.init',function(){self.registerHandlers(commandStack);});}Modeling.$inject=['eventBus','elementFactory','commandStack'];module.exports=Modeling;Modeling.prototype.getHandlers=function(){return{'shape.append':require('./cmd/AppendShapeHandler'),'shape.create':require('./cmd/CreateShapeHandler'),'shape.delete':require('./cmd/DeleteShapeHandler'),'shape.move':require('./cmd/MoveShapeHandler'),'shape.resize':require('./cmd/ResizeShapeHandler'),'shape.replace':require('./cmd/ReplaceShapeHandler'),'shape.toggleCollapse':require('./cmd/ToggleShapeCollapseHandler'),'spaceTool':require('./cmd/SpaceToolHandler'),'label.create':require('./cmd/CreateLabelHandler'),'connection.create':require('./cmd/CreateConnectionHandler'),'connection.delete':require('./cmd/DeleteConnectionHandler'),'connection.move':require('./cmd/MoveConnectionHandler'),'connection.layout':require('./cmd/LayoutConnectionHandler'),'connection.updateWaypoints':require('./cmd/UpdateWaypointsHandler'),'connection.reconnectStart':require('./cmd/ReconnectConnectionHandler'),'connection.reconnectEnd':require('./cmd/ReconnectConnectionHandler'),'elements.move':require('./cmd/MoveElementsHandler'),'elements.delete':require('./cmd/DeleteElementsHandler'),'elements.distribute':require('./cmd/DistributeElementsHandler'),'elements.align':require('./cmd/AlignElementsHandler'),'element.updateAttachment':require('./cmd/UpdateAttachmentHandler'),'elements.paste':require('./cmd/PasteHandler')};};Modeling.prototype.registerHandlers=function(commandStack){forEach(this.getHandlers(),function(handler,id){commandStack.registerHandler(id,handler);});};Modeling.prototype.moveShape=function(shape,delta,newParent,newParentIndex,hints){if(typeof newParentIndex==='object'){hints=newParentIndex;newParentIndex=null;}var context={shape:shape,delta:delta,newParent:newParent,newParentIndex:newParentIndex,hints:hints||{}};this._commandStack.execute('shape.move',context);};Modeling.prototype.updateAttachment=function(shape,newHost){var context={shape:shape,newHost:newHost};this._commandStack.execute('element.updateAttachment',context);};Modeling.prototype.moveElements=function(shapes,delta,target,isAttach,hints){if(typeof isAttach==='object'){hints=isAttach;isAttach=undefined;}var newParent=target,newHost;if(isAttach===true){newHost=target;newParent=target.parent;}if(isAttach===false){newHost=null;}var context={shapes:shapes,delta:delta,newParent:newParent,newHost:newHost,hints:hints||{}};this._commandStack.execute('elements.move',context);};Modeling.prototype.moveConnection=function(connection,delta,newParent,newParentIndex,hints){if(typeof newParentIndex==='object'){hints=newParentIndex;newParentIndex=undefined;}var context={connection:connection,delta:delta,newParent:newParent,newParentIndex:newParentIndex,hints:hints||{}};this._commandStack.execute('connection.move',context);};Modeling.prototype.layoutConnection=function(connection,hints){var context={connection:connection,hints:hints||{}};this._commandStack.execute('connection.layout',context);};Modeling.prototype.createConnection=function(source,target,targetIndex,connection,parent,hints){if(typeof targetIndex==='object'){hints=parent;parent=connection;connection=targetIndex;targetIndex=undefined;}connection=this._create('connection',connection);var context={source:source,target:target,parent:parent,parentIndex:targetIndex,connection:connection,hints:hints};this._commandStack.execute('connection.create',context);return context.connection;};Modeling.prototype.createShape=function(shape,position,target,targetIndex,isAttach,hints){if(typeof targetIndex!=='number'){hints=isAttach;isAttach=targetIndex;}if(typeof isAttach!=='boolean'){hints=isAttach;isAttach=false;}shape=this._create('shape',shape);var context={position:position,shape:shape,parent:target,parentIndex:targetIndex,host:shape.host,hints:hints||{}};if(isAttach){context.parent=target.parent;context.host=target;}this._commandStack.execute('shape.create',context);return context.shape;};Modeling.prototype.createLabel=function(labelTarget,position,label,parent){label=this._create('label',label);var context={labelTarget:labelTarget,position:position,parent:parent||labelTarget.parent,shape:label};this._commandStack.execute('label.create',context);return context.shape;};Modeling.prototype.appendShape=function(source,shape,position,parent,connection,connectionParent){shape=this._create('shape',shape);var context={source:source,position:position,parent:parent,shape:shape,connection:connection,connectionParent:connectionParent};this._commandStack.execute('shape.append',context);return context.shape;};Modeling.prototype.removeElements=function(elements){var context={elements:elements};this._commandStack.execute('elements.delete',context);};Modeling.prototype.distributeElements=function(groups,axis,dimension){var context={groups:groups,axis:axis,dimension:dimension};this._commandStack.execute('elements.distribute',context);};Modeling.prototype.removeShape=function(shape,hints){var context={shape:shape,hints:hints||{}};this._commandStack.execute('shape.delete',context);};Modeling.prototype.removeConnection=function(connection,hints){var context={connection:connection,hints:hints||{}};this._commandStack.execute('connection.delete',context);};Modeling.prototype.replaceShape=function(oldShape,newShape,hints){var context={oldShape:oldShape,newData:newShape,hints:hints||{}};this._commandStack.execute('shape.replace',context);return context.newShape;};Modeling.prototype.pasteElements=function(tree,topParent,position){var context={tree:tree,topParent:topParent,position:position};this._commandStack.execute('elements.paste',context);};Modeling.prototype.alignElements=function(elements,alignment){var context={elements:elements,alignment:alignment};this._commandStack.execute('elements.align',context);};Modeling.prototype.resizeShape=function(shape,newBounds,minBounds){var context={shape:shape,newBounds:newBounds,minBounds:minBounds};this._commandStack.execute('shape.resize',context);};Modeling.prototype.createSpace=function(movingShapes,resizingShapes,delta,direction){var context={movingShapes:movingShapes,resizingShapes:resizingShapes,delta:delta,direction:direction};this._commandStack.execute('spaceTool',context);};Modeling.prototype.updateWaypoints=function(connection,newWaypoints,hints){var context={connection:connection,newWaypoints:newWaypoints,hints:hints||{}};this._commandStack.execute('connection.updateWaypoints',context);};Modeling.prototype.reconnectStart=function(connection,newSource,dockingOrPoints){var context={connection:connection,newSource:newSource,dockingOrPoints:dockingOrPoints};this._commandStack.execute('connection.reconnectStart',context);};Modeling.prototype.reconnectEnd=function(connection,newTarget,dockingOrPoints){var context={connection:connection,newTarget:newTarget,dockingOrPoints:dockingOrPoints};this._commandStack.execute('connection.reconnectEnd',context);};Modeling.prototype.connect=function(source,target,attrs,hints){return this.createConnection(source,target,attrs||{},source.parent,hints);};Modeling.prototype._create=function(type,attrs){if(attrs instanceof model.Base){return attrs;}else{return this._elementFactory.create(type,attrs);}};Modeling.prototype.toggleCollapse=function(shape,hints){var context={shape:shape,hints:hints||{}};this._commandStack.execute('shape.toggleCollapse',context);};},{"../../model":361,"./cmd/AlignElementsHandler":285,"./cmd/AppendShapeHandler":286,"./cmd/CreateConnectionHandler":287,"./cmd/CreateLabelHandler":288,"./cmd/CreateShapeHandler":289,"./cmd/DeleteConnectionHandler":290,"./cmd/DeleteElementsHandler":291,"./cmd/DeleteShapeHandler":292,"./cmd/DistributeElementsHandler":293,"./cmd/LayoutConnectionHandler":294,"./cmd/MoveConnectionHandler":295,"./cmd/MoveElementsHandler":296,"./cmd/MoveShapeHandler":297,"./cmd/PasteHandler":299,"./cmd/ReconnectConnectionHandler":300,"./cmd/ReplaceShapeHandler":301,"./cmd/ResizeShapeHandler":302,"./cmd/SpaceToolHandler":303,"./cmd/ToggleShapeCollapseHandler":304,"./cmd/UpdateAttachmentHandler":305,"./cmd/UpdateWaypointsHandler":306,"lodash/collection/forEach":417}],285:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');function AlignElements(modeling,canvas){this._modeling=modeling;this._canvas=canvas;}AlignElements.$inject=['modeling','canvas'];module.exports=AlignElements;AlignElements.prototype.preExecute=function(context){var modeling=this._modeling;var elements=context.elements,alignment=context.alignment;forEach(elements,function(element){var delta={x:0,y:0};if(alignment.left){delta.x=alignment.left-element.x;}else if(alignment.right){delta.x=(alignment.right-element.width)-element.x;}else if(alignment.center){delta.x=(alignment.center-Math.round(element.width/2))-element.x;}else if(alignment.top){delta.y=alignment.top-element.y;}else if(alignment.bottom){delta.y=(alignment.bottom-element.height)-element.y;}else if(alignment.middle){delta.y=(alignment.middle-Math.round(element.height/2))-element.y;}modeling.moveElements([element],delta,element.parent);});};AlignElements.prototype.postExecute=function(context){};},{"lodash/collection/forEach":417}],286:[function(require,module,exports){'use strict';var any=require('lodash/collection/any');var inherits=require('inherits');function AppendShapeHandler(modeling){this._modeling=modeling;}inherits(AppendShapeHandler,require('./NoopHandler'));AppendShapeHandler.$inject=['modeling'];module.exports=AppendShapeHandler;AppendShapeHandler.prototype.preExecute=function(context){if(!context.source){throw new Error('source required');}var parent=context.parent||context.source.parent,shape=this._modeling.createShape(context.shape,context.position,parent);context.shape=shape;};AppendShapeHandler.prototype.postExecute=function(context){var parent=context.connectionParent||context.shape.parent;if(!existsConnection(context.source,context.shape)){this._modeling.connect(context.source,context.shape,context.connection,parent);}};function existsConnection(source,target){return any(source.outgoing,function(c){return c.target===target;});}},{"./NoopHandler":298,"inherits":398,"lodash/collection/any":413}],287:[function(require,module,exports){'use strict';function CreateConnectionHandler(canvas,layouter){this._canvas=canvas;this._layouter=layouter;}CreateConnectionHandler.$inject=['canvas','layouter'];module.exports=CreateConnectionHandler;CreateConnectionHandler.prototype.execute=function(context){var connection=context.connection,source=context.source,target=context.target,parent=context.parent,hints=context.hints;if(!source||!target){throw new Error('source and target required');}if(!parent){throw new Error('parent required');}connection.source=source;connection.target=target;if(!connection.waypoints){connection.waypoints=this._layouter.layoutConnection(connection,hints);}this._canvas.addConnection(connection,parent);return connection;};CreateConnectionHandler.prototype.revert=function(context){var connection=context.connection;this._canvas.removeConnection(connection);connection.source=null;connection.target=null;};},{}],288:[function(require,module,exports){'use strict';var inherits=require('inherits');var CreateShapeHandler=require('./CreateShapeHandler');function CreateLabelHandler(canvas){CreateShapeHandler.call(this,canvas);}inherits(CreateLabelHandler,CreateShapeHandler);CreateLabelHandler.$inject=['canvas'];module.exports=CreateLabelHandler;var originalExecute=CreateShapeHandler.prototype.execute;CreateLabelHandler.prototype.execute=function(context){var label=context.shape;ensureValidDimensions(label);label.labelTarget=context.labelTarget;return originalExecute.call(this,context);};var originalRevert=CreateShapeHandler.prototype.revert;CreateLabelHandler.prototype.revert=function(context){context.shape.labelTarget=null;return originalRevert.call(this,context);};function ensureValidDimensions(label){['width','height'].forEach(function(prop){if(typeof label[prop]==='undefined'){label[prop]=0;}});}},{"./CreateShapeHandler":289,"inherits":398}],289:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign');var round=Math.round;function CreateShapeHandler(canvas){this._canvas=canvas;}CreateShapeHandler.$inject=['canvas'];module.exports=CreateShapeHandler;CreateShapeHandler.prototype.execute=function(context){var shape=context.shape,positionOrBounds=context.position,parent=context.parent,parentIndex=context.parentIndex;if(!parent){throw new Error('parent required');}if(!positionOrBounds){throw new Error('position required');}if(positionOrBounds.width!==undefined){assign(shape,positionOrBounds);}else{assign(shape,{x:positionOrBounds.x-round(shape.width/2),y:positionOrBounds.y-round(shape.height/2)});}this._canvas.addShape(shape,parent,parentIndex);return shape;};CreateShapeHandler.prototype.revert=function(context){this._canvas.removeShape(context.shape);};},{"lodash/object/assign":547}],290:[function(require,module,exports){'use strict';var Collections=require('../../../util/Collections');function DeleteConnectionHandler(canvas,modeling){this._canvas=canvas;this._modeling=modeling;}DeleteConnectionHandler.$inject=['canvas','modeling'];module.exports=DeleteConnectionHandler;DeleteConnectionHandler.prototype.preExecute=function(context){var connection=context.connection;if(connection.label){this._modeling.removeShape(connection.label);}};DeleteConnectionHandler.prototype.execute=function(context){var connection=context.connection,parent=connection.parent;context.parent=parent;context.parentIndex=Collections.indexOf(parent.children,connection);context.source=connection.source;context.target=connection.target;this._canvas.removeConnection(connection);connection.source=null;connection.target=null;connection.label=null;return connection;};DeleteConnectionHandler.prototype.revert=function(context){var connection=context.connection,parent=context.parent,parentIndex=context.parentIndex;connection.source=context.source;connection.target=context.target;Collections.add(parent.children,connection,parentIndex);this._canvas.addConnection(connection,parent);return connection;};},{"../../../util/Collections":370}],291:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach'),inherits=require('inherits');function DeleteElementsHandler(modeling,elementRegistry){this._modeling=modeling;this._elementRegistry=elementRegistry;}inherits(DeleteElementsHandler,require('./NoopHandler'));DeleteElementsHandler.$inject=['modeling','elementRegistry'];module.exports=DeleteElementsHandler;DeleteElementsHandler.prototype.postExecute=function(context){var modeling=this._modeling,elementRegistry=this._elementRegistry,elements=context.elements;forEach(elements,function(element){if(!elementRegistry.get(element.id)){return;}if(element.waypoints){modeling.removeConnection(element);}else{modeling.removeShape(element);}deleteBackupData(element.id,element.type)});};},{"./NoopHandler":298,"inherits":398,"lodash/collection/forEach":417}],292:[function(require,module,exports){'use strict';var Collections=require('../../../util/Collections');var saveClear=require('../../../util/Removal').saveClear;function DeleteShapeHandler(canvas,modeling){this._canvas=canvas;this._modeling=modeling;}DeleteShapeHandler.$inject=['canvas','modeling'];module.exports=DeleteShapeHandler;DeleteShapeHandler.prototype.preExecute=function(context){var modeling=this._modeling;var shape=context.shape,label=shape.label;if(shape.labelTarget){context.labelTarget=shape.labelTarget;shape.labelTarget=null;}if(label){this._modeling.removeShape(label,{nested:true});}saveClear(shape.incoming,function(connection){modeling.removeConnection(connection,{nested:true});});saveClear(shape.outgoing,function(connection){modeling.removeConnection(connection,{nested:true});});saveClear(shape.children,function(child){if(isConnection(child)){modeling.removeConnection(child,{nested:true});}else{modeling.removeShape(child,{nested:true});}});};DeleteShapeHandler.prototype.execute=function(context){var canvas=this._canvas;var shape=context.shape,oldParent=shape.parent;context.oldParent=oldParent;context.oldParentIndex=Collections.indexOf(oldParent.children,shape);shape.label=null;canvas.removeShape(shape);return shape;};DeleteShapeHandler.prototype.revert=function(context){var canvas=this._canvas;var shape=context.shape,oldParent=context.oldParent,oldParentIndex=context.oldParentIndex,labelTarget=context.labelTarget;Collections.add(oldParent.children,shape,oldParentIndex);if(labelTarget){labelTarget.label=shape;}canvas.addShape(shape,oldParent);return shape;};function isConnection(element){return element.waypoints;}},{"../../../util/Collections":370,"../../../util/Removal":384}],293:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach'),sortBy=require('lodash/collection/sortBy');function DistributeElements(modeling){this._modeling=modeling;}DistributeElements.$inject=['modeling'];module.exports=DistributeElements;var OFF_AXIS={x:'y',y:'x'};DistributeElements.prototype.preExecute=function(context){var modeling=this._modeling;var groups=context.groups,axis=context.axis,dimension=context.dimension;function updateRange(group,element){group.range.min=Math.min(element[axis],group.range.min);group.range.max=Math.max(element[axis]+element[dimension],group.range.max);}function center(element){return element[axis]+element[dimension]/2;}function lastIdx(arr){return arr.length-1;}function rangeDiff(range){return range.max-range.min;}function centerElement(refCenter,element){var delta={y:0};delta[axis]=refCenter-center(element);if(delta[axis]){delta[OFF_AXIS[axis]]=0;modeling.moveElements([element],delta,element.parent);}}var firstGroup=groups[0],lastGroupIdx=lastIdx(groups),lastGroup=groups[lastGroupIdx];var margin,spaceInBetween,groupsSize=0;forEach(groups,function(group,idx){var sortedElements,refElem,refCenter;if(group.elements.length<2){if(idx&&idx!==groups.length-1){updateRange(group,group.elements[0]);groupsSize+=rangeDiff(group.range);}return;}sortedElements=sortBy(group.elements,axis);refElem=sortedElements[0];if(idx===lastGroupIdx){refElem=sortedElements[lastIdx(sortedElements)];}refCenter=center(refElem);group.range=null;forEach(sortedElements,function(element){centerElement(refCenter,element);if(group.range===null){group.range={min:element[axis],max:element[axis]+element[dimension]};return;}updateRange(group,element);});if(idx&&idx!==groups.length-1){groupsSize+=rangeDiff(group.range);}});spaceInBetween=Math.abs(lastGroup.range.min-firstGroup.range.max);margin=Math.round((spaceInBetween-groupsSize)/(groups.length-1));if(margin<groups.length-1){return;}forEach(groups,function(group,groupIdx){var delta={},prevGroup;if(group===firstGroup||group===lastGroup){return;}prevGroup=groups[groupIdx-1];group.range.max=0;forEach(group.elements,function(element,idx){delta[OFF_AXIS[axis]]=0;delta[axis]=(prevGroup.range.max-element[axis])+margin;if(group.range.min!==element[axis]){delta[axis]+=element[axis]-group.range.min;}if(delta[axis]){modeling.moveElements([element],delta,element.parent);}group.range.max=Math.max(element[axis]+element[dimension],idx?group.range.max:0);});});};DistributeElements.prototype.postExecute=function(context){};},{"lodash/collection/forEach":417,"lodash/collection/sortBy":425}],294:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign');function LayoutConnectionHandler(layouter,canvas){this._layouter=layouter;this._canvas=canvas;}LayoutConnectionHandler.$inject=['layouter','canvas'];module.exports=LayoutConnectionHandler;LayoutConnectionHandler.prototype.execute=function(context){var connection=context.connection,parent=connection.parent,connectionSiblings=parent.children;var oldIndex=connectionSiblings.indexOf(connection);var oldWaypoints=connection.waypoints;assign(context,{oldWaypoints:oldWaypoints,oldIndex:oldIndex});sendToFront(connection);connection.waypoints=this._layouter.layoutConnection(connection,context.hints);return connection;};LayoutConnectionHandler.prototype.revert=function(context){var connection=context.connection,parent=connection.parent,connectionSiblings=parent.children,currentIndex=connectionSiblings.indexOf(connection),oldIndex=context.oldIndex;connection.waypoints=context.oldWaypoints;if(oldIndex!==currentIndex){connectionSiblings.splice(currentIndex,1);connectionSiblings.splice(oldIndex,0,connection);}return connection;};function sendToFront(connection){var connectionSiblings=connection.parent.children;var connectionIdx=connectionSiblings.indexOf(connection),sourceIdx=findIndex(connectionSiblings,connection.source),targetIdx=findIndex(connectionSiblings,connection.target),insertIndex=Math.max(sourceIdx+1,targetIdx+1,connectionIdx);if(connectionIdx<insertIndex){connectionSiblings.splice(insertIndex,0,connection);connectionSiblings.splice(connectionIdx,1);}function findIndex(array,obj){var index=array.indexOf(obj);if(index<0&&obj){var parent=obj.parent;index=findIndex(array,parent);}return index;}return insertIndex;}},{"lodash/object/assign":547}],295:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');var Collections=require('../../../util/Collections');function MoveConnectionHandler(){}module.exports=MoveConnectionHandler;MoveConnectionHandler.prototype.execute=function(context){var connection=context.connection,delta=context.delta;var newParent=context.newParent||connection.parent,newParentIndex=context.newParentIndex,oldParent=connection.parent;context.oldParent=oldParent;context.oldParentIndex=Collections.remove(oldParent.children,connection);Collections.add(newParent.children,connection,newParentIndex);connection.parent=newParent;forEach(connection.waypoints,function(p){p.x+=delta.x;p.y+=delta.y;if(p.original){p.original.x+=delta.x;p.original.y+=delta.y;}});return connection;};MoveConnectionHandler.prototype.revert=function(context){var connection=context.connection,newParent=connection.parent,oldParent=context.oldParent,oldParentIndex=context.oldParentIndex,delta=context.delta;Collections.remove(newParent.children,connection);Collections.add(oldParent.children,connection,oldParentIndex);connection.parent=oldParent;forEach(connection.waypoints,function(p){p.x-=delta.x;p.y-=delta.y;if(p.original){p.original.x-=delta.x;p.original.y-=delta.y;}});return connection;};},{"../../../util/Collections":370,"lodash/collection/forEach":417}],296:[function(require,module,exports){'use strict';var MoveHelper=require('./helper/MoveHelper');function MoveElementsHandler(modeling){this._helper=new MoveHelper(modeling);}MoveElementsHandler.$inject=['modeling'];module.exports=MoveElementsHandler;MoveElementsHandler.prototype.preExecute=function(context){context.closure=this._helper.getClosure(context.shapes);};MoveElementsHandler.prototype.postExecute=function(context){var hints=context.hints,primaryShape;if(hints&&hints.primaryShape){primaryShape=hints.primaryShape;hints.oldParent=primaryShape.parent;}this._helper.moveClosure(context.closure,context.delta,context.newParent,context.newHost,primaryShape);};MoveElementsHandler.prototype.execute=function(context){};MoveElementsHandler.prototype.revert=function(context){};},{"./helper/MoveHelper":308}],297:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign'),forEach=require('lodash/collection/forEach'),pick=require('lodash/object/pick');var MoveHelper=require('./helper/MoveHelper'),Collections=require('../../../util/Collections');var getMovedSourceAnchor=require('./helper/AnchorsHelper').getMovedSourceAnchor,getMovedTargetAnchor=require('./helper/AnchorsHelper').getMovedTargetAnchor;function MoveShapeHandler(modeling){this._modeling=modeling;this._helper=new MoveHelper(modeling);}MoveShapeHandler.$inject=['modeling'];module.exports=MoveShapeHandler;MoveShapeHandler.prototype.execute=function(context){var shape=context.shape,delta=context.delta,newParent=context.newParent||shape.parent,newParentIndex=context.newParentIndex,oldParent=shape.parent;context.oldBounds=pick(shape,['x','y','width','height']);context.oldParent=oldParent;context.oldParentIndex=Collections.remove(oldParent.children,shape);Collections.add(newParent.children,shape,newParentIndex);assign(shape,{parent:newParent,x:shape.x+delta.x,y:shape.y+delta.y});return shape;};MoveShapeHandler.prototype.postExecute=function(context){var shape=context.shape,delta=context.delta,hints=context.hints;var modeling=this._modeling;if(hints.layout!==false){forEach(shape.incoming,function(c){modeling.layoutConnection(c,{connectionEnd:getMovedTargetAnchor(c,shape,delta)});});forEach(shape.outgoing,function(c){modeling.layoutConnection(c,{connectionStart:getMovedSourceAnchor(c,shape,delta)});});}if(hints.recurse!==false){this.moveChildren(context);}};MoveShapeHandler.prototype.revert=function(context){var shape=context.shape,oldParent=context.oldParent,oldParentIndex=context.oldParentIndex,delta=context.delta;Collections.add(oldParent.children,shape,oldParentIndex);assign(shape,{parent:oldParent,x:shape.x-delta.x,y:shape.y-delta.y});return shape;};MoveShapeHandler.prototype.moveChildren=function(context){var delta=context.delta,shape=context.shape;this._helper.moveRecursive(shape.children,delta,null);};MoveShapeHandler.prototype.getNewParent=function(context){return context.newParent||context.shape.parent;};},{"../../../util/Collections":370,"./helper/AnchorsHelper":307,"./helper/MoveHelper":308,"lodash/collection/forEach":417,"lodash/object/assign":547,"lodash/object/pick":555}],298:[function(require,module,exports){'use strict';function NoopHandler(){}module.exports=NoopHandler;NoopHandler.prototype.execute=function(){};NoopHandler.prototype.revert=function(){};},{}],299:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach'),map=require('lodash/collection/map'),sortBy=require('lodash/collection/sortBy'),clone=require('lodash/lang/clone');var inherits=require('inherits');function removeProperties(element,properties){forEach(properties,function(prop){if(element[prop]){delete element[prop];}});}function PasteHandler(eventBus,canvas,selection,elementFactory,modeling,rules){this._eventBus=eventBus;this._canvas=canvas;this._selection=selection;this._elementFactory=elementFactory;this._modeling=modeling;this._rules=rules;}inherits(PasteHandler,require('./NoopHandler'));PasteHandler.$inject=['eventBus','canvas','selection','elementFactory','modeling','rules'];module.exports=PasteHandler;PasteHandler.prototype.preExecute=function(context){var eventBus=this._eventBus;var tree=context.tree,topParent=context.topParent,position=context.position;tree.createdElements={};tree.labels=[];forEach(tree,function(elements,depthStr){var depth=parseInt(depthStr,10);if(isNaN(depth)){return;}if(!depth){elements=map(elements,function(descriptor){descriptor.parent=topParent;return descriptor;});}elements=sortBy(elements,'priority');forEach(elements,function(descriptor){var id=descriptor.id,parent=descriptor.parent,isAttach=false,hints,newPosition;var element=clone(descriptor);if(depth){element.parent=this._getCreatedElement(parent,tree);}if(!parent){return;}eventBus.fire('element.paste',{createdElements:tree.createdElements,descriptor:element});parent=element.parent;if(element.waypoints){element=this._createConnection(element,parent,position,tree);if(element){tree.createdElements[id]={element:element,descriptor:descriptor};}return;}if(element.parent!==topParent){hints={root:false};}if(element.host){isAttach=true;parent=this._getCreatedElement(element.host,tree);}if(element.labelTarget){return tree.labels.push(element);}newPosition={x:Math.round(position.x+element.delta.x+(element.width/2)),y:Math.round(position.y+element.delta.y+(element.height/2))};removeProperties(element,['id','parent','delta','host','priority']);element=this._createShape(element,parent,newPosition,isAttach,hints);if(element){tree.createdElements[id]={element:element,descriptor:descriptor};}},this);},this);};PasteHandler.prototype.postExecute=function(context){var modeling=this._modeling,selection=this._selection;var tree=context.tree,labels=tree.labels,topLevelElements=[];forEach(labels,function(labelDescriptor){var labelTarget=this._getCreatedElement(labelDescriptor.labelTarget,tree),label,labelTargetPos,newPosition;if(!labelTarget){return;}label=labelTarget.label;if(!label){return;}labelTargetPos={x:labelTarget.x,y:labelTarget.y};if(labelTarget.waypoints){labelTargetPos=labelTarget.waypoints[0];}newPosition={x:Math.round((labelTargetPos.x-label.x)+labelDescriptor.delta.x),y:Math.round((labelTargetPos.y-label.y)+labelDescriptor.delta.y)};modeling.moveShape(label,newPosition,labelTarget.parent);},this);forEach(tree[0],function(descriptor){var id=descriptor.id,toplevel=tree.createdElements[id];if(toplevel){topLevelElements.push(toplevel.element);}});selection.select(topLevelElements);};PasteHandler.prototype._createConnection=function(element,parent,parentCenter,tree){var modeling=this._modeling,rules=this._rules;var connection,source,target,canPaste;element.waypoints=map(element.waypoints,function(waypoint,idx){return{x:Math.round(parentCenter.x+element.delta[idx].x),y:Math.round(parentCenter.y+element.delta[idx].y)};});source=this._getCreatedElement(element.source,tree);target=this._getCreatedElement(element.target,tree);if(!source||!target){return null;}canPaste=rules.allowed('element.paste',{source:source,target:target});if(!canPaste){return null;}removeProperties(element,['id','parent','delta','source','target','width','height','priority']);connection=modeling.createConnection(source,target,element,parent);return connection;};PasteHandler.prototype._createShape=function(element,parent,position,isAttach,hints){var modeling=this._modeling,elementFactory=this._elementFactory,rules=this._rules;var canPaste=rules.allowed('element.paste',{element:element,position:position,parent:parent});if(!canPaste){return null;}var shape=elementFactory.createShape(element);modeling.createShape(shape,position,parent,isAttach,hints);return shape;};PasteHandler.prototype._getCreatedElement=function(id,tree){return tree.createdElements[id]&&tree.createdElements[id].element;};},{"./NoopHandler":298,"inherits":398,"lodash/collection/forEach":417,"lodash/collection/map":420,"lodash/collection/sortBy":425,"lodash/lang/clone":535}],300:[function(require,module,exports){'use strict';var isArray=require('lodash/lang/isArray');function ReconnectConnectionHandler(){}ReconnectConnectionHandler.$inject=[];module.exports=ReconnectConnectionHandler;ReconnectConnectionHandler.prototype.execute=function(context){var newSource=context.newSource,newTarget=context.newTarget,connection=context.connection,dockingOrPoints=context.dockingOrPoints,oldWaypoints=connection.waypoints,newWaypoints;if(!newSource&&!newTarget){throw new Error('newSource or newTarget are required');}if(newSource&&newTarget){throw new Error('must specify either newSource or newTarget');}context.oldWaypoints=oldWaypoints;if(isArray(dockingOrPoints)){newWaypoints=dockingOrPoints;}else{newWaypoints=oldWaypoints.slice();newWaypoints.splice(newSource?0:-1,1,dockingOrPoints);}if(newSource){context.oldSource=connection.source;connection.source=newSource;}if(newTarget){context.oldTarget=connection.target;connection.target=newTarget;}connection.waypoints=newWaypoints;return connection;};ReconnectConnectionHandler.prototype.revert=function(context){var newSource=context.newSource,newTarget=context.newTarget,connection=context.connection;if(newSource){connection.source=context.oldSource;}if(newTarget){connection.target=context.oldTarget;}connection.waypoints=context.oldWaypoints;return connection;};},{"lodash/lang/isArray":537}],301:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');function ReplaceShapeHandler(modeling,rules){this._modeling=modeling;this._rules=rules;}ReplaceShapeHandler.$inject=['modeling','rules'];module.exports=ReplaceShapeHandler;ReplaceShapeHandler.prototype.preExecute=function(context){var self=this,modeling=this._modeling,rules=this._rules;var oldShape=context.oldShape,newData=context.newData,hints=context.hints,newShape;function canReconnect(type,source,target,connection){return rules.allowed(type,{source:source,target:target,connection:connection});}var position={x:newData.x,y:newData.y};newShape=context.newShape=context.newShape||self.createShape(newData,position,oldShape.parent);if(oldShape.host){modeling.updateAttachment(newShape,oldShape.host);}var children;if(hints.moveChildren!==false){children=oldShape.children.slice();modeling.moveElements(children,{x:0,y:0},newShape);}var incoming=oldShape.incoming.slice(),outgoing=oldShape.outgoing.slice();forEach(incoming,function(connection){var waypoints=connection.waypoints,docking=waypoints[waypoints.length-1],source=connection.source,allowed=canReconnect('connection.reconnectEnd',source,newShape,connection);if(allowed){self.reconnectEnd(connection,newShape,docking);}});forEach(outgoing,function(connection){var waypoints=connection.waypoints,docking=waypoints[0],target=connection.target,allowed=canReconnect('connection.reconnectStart',newShape,target,connection);if(allowed){self.reconnectStart(connection,newShape,docking);}});};ReplaceShapeHandler.prototype.postExecute=function(context){var modeling=this._modeling;var oldShape=context.oldShape,newShape=context.newShape;forEach(newShape.incoming,function(c){modeling.layoutConnection(c,{endChanged:true});});forEach(newShape.outgoing,function(c){modeling.layoutConnection(c,{startChanged:true});});modeling.removeShape(oldShape);};ReplaceShapeHandler.prototype.execute=function(context){};ReplaceShapeHandler.prototype.revert=function(context){};ReplaceShapeHandler.prototype.createShape=function(shape,position,target){var modeling=this._modeling;return modeling.createShape(shape,position,target);};ReplaceShapeHandler.prototype.reconnectStart=function(connection,newSource,dockingPoint){var modeling=this._modeling;modeling.reconnectStart(connection,newSource,dockingPoint);};ReplaceShapeHandler.prototype.reconnectEnd=function(connection,newTarget,dockingPoint){var modeling=this._modeling;modeling.reconnectEnd(connection,newTarget,dockingPoint);};},{"lodash/collection/forEach":417}],302:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign'),forEach=require('lodash/collection/forEach');var getResizedSourceAnchor=require('./helper/AnchorsHelper').getResizedSourceAnchor,getResizedTargetAnchor=require('./helper/AnchorsHelper').getResizedTargetAnchor;function ResizeShapeHandler(modeling){this._modeling=modeling;}ResizeShapeHandler.$inject=['modeling'];module.exports=ResizeShapeHandler;ResizeShapeHandler.prototype.execute=function(context){var shape=context.shape,newBounds=context.newBounds,minBounds=context.minBounds;if(newBounds.x===undefined||newBounds.y===undefined||newBounds.width===undefined||newBounds.height===undefined){throw new Error('newBounds must have {x, y, width, height} properties');}if(minBounds&&(newBounds.width<minBounds.width||newBounds.height<minBounds.height)){throw new Error('width and height cannot be less than minimum height and width');}else if(!minBounds&&newBounds.width<10||newBounds.height<10){throw new Error('width and height cannot be less than 10px');}context.oldBounds={width:shape.width,height:shape.height,x:shape.x,y:shape.y};assign(shape,{width:newBounds.width,height:newBounds.height,x:newBounds.x,y:newBounds.y});return shape;};ResizeShapeHandler.prototype.postExecute=function(context){var shape=context.shape,oldBounds=context.oldBounds;var modeling=this._modeling;forEach(shape.incoming,function(c){modeling.layoutConnection(c,{connectionEnd:getResizedTargetAnchor(c,shape,oldBounds)});});forEach(shape.outgoing,function(c){modeling.layoutConnection(c,{connectionStart:getResizedSourceAnchor(c,shape,oldBounds)});});};ResizeShapeHandler.prototype.revert=function(context){var shape=context.shape,oldBounds=context.oldBounds;assign(shape,{width:oldBounds.width,height:oldBounds.height,x:oldBounds.x,y:oldBounds.y});return shape;};},{"./helper/AnchorsHelper":307,"lodash/collection/forEach":417,"lodash/object/assign":547}],303:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');var SpaceUtil=require('../../space-tool/SpaceUtil');function SpaceToolHandler(modeling){this._modeling=modeling;}SpaceToolHandler.$inject=['modeling'];module.exports=SpaceToolHandler;SpaceToolHandler.prototype.preExecute=function(context){var modeling=this._modeling,resizingShapes=context.resizingShapes,delta=context.delta,direction=context.direction;forEach(resizingShapes,function(shape){var newBounds=SpaceUtil.resizeBounds(shape,direction,delta);modeling.resizeShape(shape,newBounds);});};SpaceToolHandler.prototype.postExecute=function(context){var modeling=this._modeling,movingShapes=context.movingShapes,delta=context.delta;modeling.moveElements(movingShapes,delta,undefined,false,{autoResize:false});};SpaceToolHandler.prototype.execute=function(context){};SpaceToolHandler.prototype.revert=function(context){};},{"../../space-tool/SpaceUtil":346,"lodash/collection/forEach":417}],304:[function(require,module,exports){'use strict';function ToggleShapeCollapseHandler(modeling){this._modeling=modeling;}ToggleShapeCollapseHandler.$inject=['modeling'];module.exports=ToggleShapeCollapseHandler;ToggleShapeCollapseHandler.prototype.execute=function(context){var shape=context.shape,children=shape.children;context.oldChildrenVisibility=getElementsVisibility(children);shape.collapsed=!shape.collapsed;setHidden(children,shape.collapsed);return[shape].concat(children);};ToggleShapeCollapseHandler.prototype.revert=function(context){var shape=context.shape,oldChildrenVisibility=context.oldChildrenVisibility;var children=shape.children;restoreVisibility(children,oldChildrenVisibility);shape.collapsed=!shape.collapsed;return[shape].concat(children);};function getElementsVisibility(elements){var result={};elements.forEach(function(e){result[e.id]=e.hidden;});return result;}function setHidden(elements,newHidden){elements.forEach(function(element){element.hidden=newHidden;});}function restoreVisibility(elements,lastState){elements.forEach(function(e){e.hidden=lastState[e.id];});}},{}],305:[function(require,module,exports){'use strict';var Collections=require('../../../util/Collections');function UpdateAttachmentHandler(modeling){this._modeling=modeling;}module.exports=UpdateAttachmentHandler;UpdateAttachmentHandler.$inject=['modeling'];UpdateAttachmentHandler.prototype.execute=function(context){var shape=context.shape,newHost=context.newHost,oldHost=shape.host;context.oldHost=oldHost;context.attacherIdx=removeAttacher(oldHost,shape);addAttacher(newHost,shape);shape.host=newHost;return shape;};UpdateAttachmentHandler.prototype.revert=function(context){var shape=context.shape,newHost=context.newHost,oldHost=context.oldHost,attacherIdx=context.attacherIdx;shape.host=oldHost;removeAttacher(newHost,shape);addAttacher(oldHost,shape,attacherIdx);return shape;};function removeAttacher(host,attacher){return Collections.remove(host&&host.attachers,attacher);}function addAttacher(host,attacher,idx){if(!host){return;}var attachers=host.attachers;if(!attachers){host.attachers=attachers=[];}Collections.add(attachers,attacher,idx);}},{"../../../util/Collections":370}],306:[function(require,module,exports){'use strict';function UpdateWaypointsHandler(){}module.exports=UpdateWaypointsHandler;UpdateWaypointsHandler.prototype.execute=function(context){var connection=context.connection,newWaypoints=context.newWaypoints;context.oldWaypoints=connection.waypoints;connection.waypoints=newWaypoints;return connection;};UpdateWaypointsHandler.prototype.revert=function(context){var connection=context.connection,oldWaypoints=context.oldWaypoints;connection.waypoints=oldWaypoints;return connection;};},{}],307:[function(require,module,exports){'use strict';var getNewAttachPoint=require('../../../../util/AttachUtil').getNewAttachPoint;function getResizedSourceAnchor(connection,shape,oldBounds){var waypoints=safeGetWaypoints(connection),oldAnchor=waypoints[0];return getNewAttachPoint(oldAnchor.original||oldAnchor,oldBounds,shape);}module.exports.getResizedSourceAnchor=getResizedSourceAnchor;function getResizedTargetAnchor(connection,shape,oldBounds){var waypoints=safeGetWaypoints(connection),oldAnchor=waypoints[waypoints.length-1];return getNewAttachPoint(oldAnchor.original||oldAnchor,oldBounds,shape);}module.exports.getResizedTargetAnchor=getResizedTargetAnchor;function getMovedSourceAnchor(connection,source,moveDelta){return getResizedSourceAnchor(connection,source,substractPosition(source,moveDelta));}module.exports.getMovedSourceAnchor=getMovedSourceAnchor;function getMovedTargetAnchor(connection,target,moveDelta){return getResizedTargetAnchor(connection,target,substractPosition(target,moveDelta));}module.exports.getMovedTargetAnchor=getMovedTargetAnchor;function substractPosition(bounds,delta){return{x:bounds.x-delta.x,y:bounds.y-delta.y,width:bounds.width,height:bounds.height};}function safeGetWaypoints(connection){var waypoints=connection.waypoints;if(!waypoints.length){throw new Error('connection#'+connection.id+': no waypoints');}return waypoints;}},{"../../../../util/AttachUtil":368}],308:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');var Elements=require('../../../../util/Elements');var getMovedSourceAnchor=require('./AnchorsHelper').getMovedSourceAnchor,getMovedTargetAnchor=require('./AnchorsHelper').getMovedTargetAnchor;function MoveHelper(modeling){this._modeling=modeling;}module.exports=MoveHelper;MoveHelper.prototype.moveRecursive=function(elements,delta,newParent){if(!elements){return[];}else{return this.moveClosure(this.getClosure(elements),delta,newParent);}};MoveHelper.prototype.moveClosure=function(closure,delta,newParent,newHost,primaryShape){var modeling=this._modeling;var allShapes=closure.allShapes,allConnections=closure.allConnections,enclosedConnections=closure.enclosedConnections,topLevel=closure.topLevel,keepParent=false;if(primaryShape&&primaryShape.parent===newParent){keepParent=true;}forEach(allShapes,function(shape){modeling.moveShape(shape,delta,topLevel[shape.id]&&!keepParent&&newParent,{recurse:false,layout:false});});forEach(allConnections,function(c){var sourceMoved=!!allShapes[c.source.id],targetMoved=!!allShapes[c.target.id];if(enclosedConnections[c.id]&&sourceMoved&&targetMoved){modeling.moveConnection(c,delta,topLevel[c.id]&&!keepParent&&newParent);}else{modeling.layoutConnection(c,{connectionStart:sourceMoved&&getMovedSourceAnchor(c,c.source,delta),connectionEnd:targetMoved&&getMovedTargetAnchor(c,c.target,delta)});}});};MoveHelper.prototype.getClosure=function(elements){return Elements.getClosure(elements);};},{"../../../../util/Elements":373,"./AnchorsHelper":307,"lodash/collection/forEach":417}],309:[function(require,module,exports){'use strict';var bind=require('lodash/function/bind');function MouseTracking(eventBus,canvas){this._eventBus=eventBus;this._canvas=canvas;this._init();}MouseTracking.$inject=['eventBus','canvas'];module.exports=MouseTracking;MouseTracking.prototype.getHoverContext=function(){var viewbox=this._canvas.viewbox();return{element:this._hoverElement,point:{x:viewbox.x+Math.round(this._mouseX/viewbox.scale),y:viewbox.y+Math.round(this._mouseY/viewbox.scale)}};};MouseTracking.prototype._init=function(){var eventBus=this._eventBus,canvas=this._canvas;var container=canvas.getContainer();this._setMousePosition=bind(this._setMousePosition,this);container.addEventListener('mousemove',this._setMousePosition);eventBus.on('diagram.destroy',function(){container.removeEventListener('mousemove',this._setMousePosition);},this);eventBus.on('element.hover',this._setHoverElement,this);};MouseTracking.prototype._setHoverElement=function(event){this._hoverElement=event.element;};MouseTracking.prototype._setMousePosition=function(event){this._mouseX=event.layerX;this._mouseY=event.layerY;};},{"lodash/function/bind":427}],310:[function(require,module,exports){'use strict';module.exports={__init__:['mouseTracking'],mouseTracking:['type',require('./MouseTracking')]};},{"./MouseTracking":309}],311:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign'),filter=require('lodash/collection/filter'),groupBy=require('lodash/collection/groupBy');var LOW_PRIORITY=500,MEDIUM_PRIORITY=1250,HIGH_PRIORITY=1500;var getOriginalEvent=require('../../util/Event').getOriginal;var round=Math.round;function mid(element){return{x:element.x+round(element.width/2),y:element.y+round(element.height/2)};}function MoveEvents(eventBus,dragging,modeling,selection,rules){function canMove(shapes,delta,position,target){return rules.allowed('elements.move',{shapes:shapes,delta:delta,position:position,target:target});}eventBus.on('shape.move.start',HIGH_PRIORITY,function(event){var context=event.context,shape=event.shape,shapes=selection.get().slice();if(shapes.indexOf(shape)===-1){shapes=[shape];}shapes=removeNested(shapes);assign(context,{shapes:shapes,validatedShapes:shapes,shape:shape});});eventBus.on('shape.move.start',MEDIUM_PRIORITY,function(event){var context=event.context,validatedShapes=context.validatedShapes,canExecute;canExecute=context.canExecute=canMove(validatedShapes);if(!canExecute){event.stopPropagation();return false;}});eventBus.on('shape.move.move',LOW_PRIORITY,function(event){var context=event.context,validatedShapes=context.validatedShapes,hover=event.hover,delta={x:event.dx,y:event.dy},position={x:event.x,y:event.y},canExecute;canExecute=canMove(validatedShapes,delta,position,hover);context.delta=delta;context.canExecute=canExecute;if(canExecute===null){context.target=null;return;}context.target=hover;});eventBus.on('shape.move.end',function(event){var context=event.context;var delta=context.delta,canExecute=context.canExecute,isAttach=canExecute==='attach',shapes=context.shapes;if(!canExecute){return false;}delta.x=round(delta.x);delta.y=round(delta.y);modeling.moveElements(shapes,delta,context.target,isAttach,{primaryShape:context.shape});});eventBus.on('element.mousedown',function(event){var originalEvent=getOriginalEvent(event);if(!originalEvent){throw new Error('must supply DOM mousedown event');}start(originalEvent,event.element);});function start(event,element,activate){if(element.waypoints||!element.parent){return;}var referencePoint=mid(element);dragging.init(event,referencePoint,'shape.move',{cursor:'grabbing',autoActivate:activate,data:{shape:element,context:{}}});}this.start=start;}MoveEvents.$inject=['eventBus','dragging','modeling','selection','rules'];module.exports=MoveEvents;function removeNested(elements){var ids=groupBy(elements,'id');return filter(elements,function(element){while((element=element.parent)){if(ids[element.id]){return false;}}return true;});}},{"../../util/Event":374,"lodash/collection/filter":415,"lodash/collection/groupBy":418,"lodash/object/assign":547}],312:[function(require,module,exports){'use strict';var flatten=require('lodash/array/flatten'),forEach=require('lodash/collection/forEach'),filter=require('lodash/collection/filter'),find=require('lodash/collection/find'),size=require('lodash/collection/size'),groupBy=require('lodash/collection/groupBy'),map=require('lodash/collection/map');var Elements=require('../../util/Elements');var svgAppend=require('tiny-svg/lib/append'),svgAttr=require('tiny-svg/lib/attr'),svgClear=require('tiny-svg/lib/clear'),svgCreate=require('tiny-svg/lib/create');var translate=require('../../util/SvgTransformUtil').translate;var LOW_PRIORITY=500;var MARKER_DRAGGING='djs-dragging',MARKER_OK='drop-ok',MARKER_NOT_OK='drop-not-ok',MARKER_NEW_PARENT='new-parent',MARKER_ATTACH='attach-ok';function MovePreview(eventBus,elementRegistry,canvas,styles,previewSupport){function getVisualDragShapes(shapes){var elements=getAllDraggedElements(shapes);var filteredElements=removeEdges(elements);return filteredElements;}function getAllDraggedElements(shapes){var allShapes=Elements.selfAndAllChildren(shapes,true);var allConnections=map(allShapes,function(shape){return(shape.incoming||[]).concat(shape.outgoing||[]);});return flatten(allShapes.concat(allConnections),true);}function setMarker(element,marker){[MARKER_ATTACH,MARKER_OK,MARKER_NOT_OK,MARKER_NEW_PARENT].forEach(function(m){if(m===marker){canvas.addMarker(element,m);}else{canvas.removeMarker(element,m);}});}function makeDraggable(context,element,addMarker){previewSupport.addDragger(element,context.dragGroup);if(addMarker){canvas.addMarker(element,MARKER_DRAGGING);}if(context.allDraggedElements){context.allDraggedElements.push(element);}else{context.allDraggedElements=[element];}}this.makeDraggable=makeDraggable;eventBus.on('shape.move.start',LOW_PRIORITY,function(event){var context=event.context,dragShapes=context.shapes,allDraggedElements=context.allDraggedElements;var visuallyDraggedShapes=getVisualDragShapes(dragShapes);if(!context.dragGroup){var dragGroup=svgCreate('g');svgAttr(dragGroup,styles.cls('djs-drag-group',['no-events']));var defaultLayer=canvas.getDefaultLayer();svgAppend(defaultLayer,dragGroup);context.dragGroup=dragGroup;}visuallyDraggedShapes.forEach(function(shape){previewSupport.addDragger(shape,context.dragGroup);});if(!allDraggedElements){allDraggedElements=getAllDraggedElements(dragShapes);}else{allDraggedElements=flatten(allDraggedElements,getAllDraggedElements(dragShapes));}forEach(allDraggedElements,function(e){canvas.addMarker(e,MARKER_DRAGGING);});context.allDraggedElements=allDraggedElements;context.differentParents=haveDifferentParents(dragShapes);});eventBus.on('shape.move.move',LOW_PRIORITY,function(event){var context=event.context,dragGroup=context.dragGroup,target=context.target,parent=context.shape.parent,canExecute=context.canExecute;if(target){if(canExecute==='attach'){setMarker(target,MARKER_ATTACH);}else if(context.canExecute&&target&&target.id!==parent.id){setMarker(target,MARKER_NEW_PARENT);}else{setMarker(target,context.canExecute?MARKER_OK:MARKER_NOT_OK);}}translate(dragGroup,event.dx,event.dy);});eventBus.on(['shape.move.out','shape.move.cleanup'],function(event){var context=event.context,target=context.target;if(target){setMarker(target,null);}});eventBus.on('shape.move.cleanup',function(event){var context=event.context,allDraggedElements=context.allDraggedElements,dragGroup=context.dragGroup;forEach(allDraggedElements,function(e){canvas.removeMarker(e,MARKER_DRAGGING);});if(dragGroup){svgClear(dragGroup);}});}MovePreview.$inject=['eventBus','elementRegistry','canvas','styles','previewSupport'];module.exports=MovePreview;function removeEdges(elements){var filteredElements=filter(elements,function(element){if(!isConnection(element)){return true;}else{var srcFound=find(elements,element.source);var targetFound=find(elements,element.target);return srcFound&&targetFound;}});return filteredElements;}function haveDifferentParents(elements){return size(groupBy(elements,function(e){return e.parent&&e.parent.id;}))!==1;}function isConnection(element){return element.waypoints;}},{"../../util/Elements":373,"../../util/SvgTransformUtil":386,"lodash/array/flatten":403,"lodash/collection/filter":415,"lodash/collection/find":416,"lodash/collection/forEach":417,"lodash/collection/groupBy":418,"lodash/collection/map":420,"lodash/collection/size":423,"tiny-svg/lib/append":607,"tiny-svg/lib/attr":609,"tiny-svg/lib/clear":611,"tiny-svg/lib/create":613}],313:[function(require,module,exports){module.exports={__depends__:[require('../interaction-events'),require('../selection'),require('../outline'),require('../rules'),require('../dragging'),require('../preview-support')],__init__:['move','movePreview'],move:['type',require('./Move')],movePreview:['type',require('./MovePreview')]};},{"../dragging":269,"../interaction-events":277,"../outline":316,"../preview-support":324,"../rules":334,"../selection":340,"./Move":311,"./MovePreview":312}],314:[function(require,module,exports){'use strict';var inherits=require('inherits');var CommandInterceptor=require('../../command/CommandInterceptor');function OrderingProvider(eventBus){CommandInterceptor.call(this,eventBus);var self=this;this.preExecute(['shape.create','connection.create'],function(event){var context=event.context,element=context.shape||context.connection,parent=context.parent;var ordering=self.getOrdering(element,parent);if(ordering){if(ordering.parent!==undefined){context.parent=ordering.parent;}context.parentIndex=ordering.index;}});this.preExecute(['shape.move','connection.move'],function(event){var context=event.context,element=context.shape||context.connection,parent=context.newParent||element.parent;var ordering=self.getOrdering(element,parent);if(ordering){if(ordering.parent!==undefined){context.newParent=ordering.parent;}context.newParentIndex=ordering.index;}});}OrderingProvider.prototype.getOrdering=function(element,newParent){return null;};inherits(OrderingProvider,CommandInterceptor);module.exports=OrderingProvider;},{"../../command/CommandInterceptor":226,"inherits":398}],315:[function(require,module,exports){'use strict';var getBBox=require('../../util/Elements').getBBox;var LOW_PRIORITY=500;var svgAppend=require('tiny-svg/lib/append'),svgAttr=require('tiny-svg/lib/attr'),svgCreate=require('tiny-svg/lib/create');var domQuery=require('min-dom/lib/query');var assign=require('lodash/object/assign');function Outline(eventBus,styles,elementRegistry){this.offset=6;var OUTLINE_STYLE=styles.cls('djs-outline',['no-fill']);var self=this;function createOutline(gfx,bounds){var outline=svgCreate('rect');svgAttr(outline,assign({x:10,y:10,width:100,height:100},OUTLINE_STYLE));svgAppend(gfx,outline);return outline;}eventBus.on(['shape.added','shape.changed'],LOW_PRIORITY,function(event){var element=event.element,gfx=event.gfx;var outline=domQuery('.djs-outline',gfx);if(!outline){outline=createOutline(gfx,element);}self.updateShapeOutline(outline,element);});eventBus.on(['connection.added','connection.changed'],function(event){var element=event.element,gfx=event.gfx;var outline=domQuery('.djs-outline',gfx);if(!outline){outline=createOutline(gfx,element);}self.updateConnectionOutline(outline,element);});}Outline.prototype.updateShapeOutline=function(outline,element){svgAttr(outline,{x:-this.offset,y:-this.offset,width:element.width+this.offset*2,height:element.height+this.offset*2});};Outline.prototype.updateConnectionOutline=function(outline,connection){var bbox=getBBox(connection);svgAttr(outline,{x:bbox.x-this.offset,y:bbox.y-this.offset,width:bbox.width+this.offset*2,height:bbox.height+this.offset*2});};Outline.$inject=['eventBus','styles','elementRegistry'];module.exports=Outline;},{"../../util/Elements":373,"lodash/object/assign":547,"min-dom/lib/query":569,"tiny-svg/lib/append":607,"tiny-svg/lib/attr":609,"tiny-svg/lib/create":613}],316:[function(require,module,exports){'use strict';module.exports={__init__:['outline'],outline:['type',require('./Outline')]};},{"./Outline":315}],317:[function(require,module,exports){'use strict';var isArray=require('lodash/lang/isArray'),isString=require('lodash/lang/isString'),isObject=require('lodash/lang/isObject'),assign=require('lodash/object/assign'),forEach=require('lodash/collection/forEach'),find=require('lodash/collection/find'),filter=require('lodash/collection/filter');var domify=require('min-dom/lib/domify'),domClasses=require('min-dom/lib/classes'),domAttr=require('min-dom/lib/attr'),domRemove=require('min-dom/lib/remove'),domClear=require('min-dom/lib/clear');var getBBox=require('../../util/Elements').getBBox;var ids=new(require('../../util/IdGenerator'))('ov');var LOW_PRIORITY=500;function createRoot(parent){var root=domify('<div class="djs-overlay-container" style="position: absolute; width: 0; height: 0;" />');parent.insertBefore(root,parent.firstChild);return root;}function setPosition(el,x,y){assign(el.style,{left:x+'px',top:y+'px'});}function setVisible(el,visible){el.style.display=visible===false?'none':'';}function Overlays(eventBus,canvas,elementRegistry){this._eventBus=eventBus;this._canvas=canvas;this._elementRegistry=elementRegistry;this._ids=ids;this._overlayDefaults={show:{minZoom:0.7,maxZoom:5.0}};this._overlays={};this._overlayContainers=[];this._overlayRoot=createRoot(canvas.getContainer());this._init();}Overlays.$inject=['eventBus','canvas','elementRegistry'];module.exports=Overlays;Overlays.prototype.get=function(search){if(isString(search)){search={id:search};}if(isString(search.element)){search.element=this._elementRegistry.get(search.element);}if(search.element){var container=this._getOverlayContainer(search.element,true);if(container){return search.type?filter(container.overlays,{type:search.type}):container.overlays.slice();}else{return[];}}else
if(search.type){return filter(this._overlays,{type:search.type});}else{return search.id?this._overlays[search.id]:null;}};Overlays.prototype.add=function(element,type,overlay){if(isObject(type)){overlay=type;type=null;}if(!element.id){element=this._elementRegistry.get(element);}if(!overlay.position){throw new Error('must specifiy overlay position');}if(!overlay.html){throw new Error('must specifiy overlay html');}if(!element){throw new Error('invalid element specified');}var id=this._ids.next();overlay=assign({},this._overlayDefaults,overlay,{id:id,type:type,element:element,html:overlay.html});this._addOverlay(overlay);return id;};Overlays.prototype.remove=function(filter){var overlays=this.get(filter)||[];if(!isArray(overlays)){overlays=[overlays];}var self=this;forEach(overlays,function(overlay){var container=self._getOverlayContainer(overlay.element,true);if(overlay){domRemove(overlay.html);domRemove(overlay.htmlContainer);delete overlay.htmlContainer;delete overlay.element;delete self._overlays[overlay.id];}if(container){var idx=container.overlays.indexOf(overlay);if(idx!==-1){container.overlays.splice(idx,1);}}});};Overlays.prototype.show=function(){setVisible(this._overlayRoot);};Overlays.prototype.hide=function(){setVisible(this._overlayRoot,false);};Overlays.prototype.clear=function(){this._overlays={};this._overlayContainers=[];domClear(this._overlayRoot);};Overlays.prototype._updateOverlayContainer=function(container){var element=container.element,html=container.html;var x=element.x,y=element.y;if(element.waypoints){var bbox=getBBox(element);x=bbox.x;y=bbox.y;}setPosition(html,x,y);domAttr(container.html,'data-container-id',element.id);};Overlays.prototype._updateOverlay=function(overlay){var position=overlay.position,htmlContainer=overlay.htmlContainer,element=overlay.element;var left=position.left,top=position.top;if(position.right!==undefined){var width;if(element.waypoints){width=getBBox(element).width;}else{width=element.width;}left=position.right*-1+width;}if(position.bottom!==undefined){var height;if(element.waypoints){height=getBBox(element).height;}else{height=element.height;}top=position.bottom*-1+height;}setPosition(htmlContainer,left||0,top||0);};Overlays.prototype._createOverlayContainer=function(element){var html=domify('<div class="djs-overlays" style="position: absolute" />');this._overlayRoot.appendChild(html);var container={html:html,element:element,overlays:[]};this._updateOverlayContainer(container);this._overlayContainers.push(container);return container;};Overlays.prototype._updateRoot=function(viewbox){var a=viewbox.scale||1;var d=viewbox.scale||1;var matrix='matrix('+a+',0,0,'+d+','+(-1*viewbox.x*a)+','+(-1*viewbox.y*d)+')';this._overlayRoot.style.transform=matrix;this._overlayRoot.style['-ms-transform']=matrix;this._overlayRoot.style['-webkit-transform']=matrix;};Overlays.prototype._getOverlayContainer=function(element,raw){var container=find(this._overlayContainers,function(c){return c.element===element;});if(!container&&!raw){return this._createOverlayContainer(element);}return container;};Overlays.prototype._addOverlay=function(overlay){var id=overlay.id,element=overlay.element,html=overlay.html,htmlContainer,overlayContainer;if(html.get&&html.constructor.prototype.jquery){html=html.get(0);}if(isString(html)){html=domify(html);}overlayContainer=this._getOverlayContainer(element);htmlContainer=domify('<div class="djs-overlay" data-overlay-id="'+id+'" style="position: absolute">');htmlContainer.appendChild(html);if(overlay.type){domClasses(htmlContainer).add('djs-overlay-'+overlay.type);}overlay.htmlContainer=htmlContainer;overlayContainer.overlays.push(overlay);overlayContainer.html.appendChild(htmlContainer);this._overlays[id]=overlay;this._updateOverlay(overlay);this._updateOverlayVisibilty(overlay,this._canvas.viewbox());};Overlays.prototype._updateOverlayVisibilty=function(overlay,viewbox){var show=overlay.show,htmlContainer=overlay.htmlContainer,visible=true;if(show){if(show.minZoom>viewbox.scale||show.maxZoom<viewbox.scale){visible=false;}setVisible(htmlContainer,visible);}};Overlays.prototype._updateOverlaysVisibilty=function(viewbox){var self=this;forEach(this._overlays,function(overlay){self._updateOverlayVisibilty(overlay,viewbox);});};Overlays.prototype._init=function(){var eventBus=this._eventBus;var self=this;function updateViewbox(viewbox){self._updateRoot(viewbox);self._updateOverlaysVisibilty(viewbox);self.show();}eventBus.on('canvas.viewbox.changing',function(event){self.hide();});eventBus.on('canvas.viewbox.changed',function(event){updateViewbox(event.viewbox);});eventBus.on(['shape.remove','connection.remove'],function(e){var element=e.element;var overlays=self.get({element:element});forEach(overlays,function(o){self.remove(o.id);});var container=self._getOverlayContainer(element);if(container){domRemove(container.html);var i=self._overlayContainers.indexOf(container);if(i!==-1){self._overlayContainers.splice(i,1);}}});eventBus.on('element.changed',LOW_PRIORITY,function(e){var element=e.element;var container=self._getOverlayContainer(element,true);if(container){forEach(container.overlays,function(overlay){self._updateOverlay(overlay);});self._updateOverlayContainer(container);}});eventBus.on('element.marker.update',function(e){var container=self._getOverlayContainer(e.element,true);if(container){domClasses(container.html)[e.add?'add':'remove'](e.marker);}});eventBus.on('diagram.clear',this.clear,this);};},{"../../util/Elements":373,"../../util/IdGenerator":377,"lodash/collection/filter":415,"lodash/collection/find":416,"lodash/collection/forEach":417,"lodash/lang/isArray":537,"lodash/lang/isObject":542,"lodash/lang/isString":544,"lodash/object/assign":547,"min-dom/lib/attr":561,"min-dom/lib/classes":562,"min-dom/lib/clear":563,"min-dom/lib/domify":566,"min-dom/lib/remove":570}],318:[function(require,module,exports){module.exports={__init__:['overlays'],overlays:['type',require('./Overlays')]};},{"./Overlays":317}],319:[function(require,module,exports){'use strict';var isFunction=require('lodash/lang/isFunction'),isArray=require('lodash/lang/isArray'),forEach=require('lodash/collection/forEach');var domify=require('min-dom/lib/domify'),domQuery=require('min-dom/lib/query'),domAttr=require('min-dom/lib/attr'),domClear=require('min-dom/lib/clear'),domClasses=require('min-dom/lib/classes'),domMatches=require('min-dom/lib/matches'),domDelegate=require('min-dom/lib/delegate'),domEvent=require('min-dom/lib/event');var toggleSelector='.djs-palette-toggle',entrySelector='.entry',elementSelector=toggleSelector+', '+entrySelector;function Palette(eventBus,canvas,dragging){this._eventBus=eventBus;this._canvas=canvas;this._dragging=dragging;this._providers=[];var self=this;eventBus.on('tool-manager.update',function(event){var tool=event.tool;self.updateToolHighlight(tool);});eventBus.on('i18n.changed',function(){self._update();});}Palette.$inject=['eventBus','canvas','dragging'];module.exports=Palette;Palette.prototype.registerProvider=function(provider){this._providers.push(provider);if(!this._container){this._init();}this._update();};Palette.prototype.getEntries=function(){var entries={};forEach(this._providers,function(provider){var e=provider.getPaletteEntries();forEach(e,function(entry,id){entries[id]=entry;});});return entries;};Palette.prototype._init=function(){var canvas=this._canvas,eventBus=this._eventBus;var parent=canvas.getContainer(),container=this._container=domify(Palette.HTML_MARKUP),self=this;parent.appendChild(container);domDelegate.bind(container,elementSelector,'click',function(event){var target=event.delegateTarget;if(domMatches(target,toggleSelector)){return self.toggle();}self.trigger('click',event);});domEvent.bind(container,'mousedown',function(event){event.stopPropagation();});domDelegate.bind(container,entrySelector,'dragstart',function(event){self.trigger('dragstart',event);});eventBus.fire('palette.create',{html:container});eventBus.on('canvas.resized',this.triggerTwoColumn,this);};Palette.prototype._update=function(){var entriesContainer=domQuery('.djs-palette-entries',this._container),entries=this._entries=this.getEntries();domClear(entriesContainer);forEach(entries,function(entry,id){var grouping=entry.group||'default';var container=domQuery('[data-group='+grouping+']',entriesContainer);if(!container){container=domify('<div class="group" data-group="'+grouping+'"></div>');entriesContainer.appendChild(container);}var html=entry.html||(entry.separator?'<hr class="separator" />':'<div class="entry" draggable="true"></div>');var control=domify(html);container.appendChild(control);if(!entry.separator){domAttr(control,'data-action',id);if(entry.title){domAttr(control,'title',entry.title);}if(entry.className){addClasses(control,entry.className);}if(entry.imageUrl){control.appendChild(domify('<img src="'+entry.imageUrl+'">'));}}});this.open(true);};Palette.prototype.trigger=function(action,event,autoActivate){var entries=this._entries,entry,handler,originalEvent,button=event.delegateTarget||event.target;if(!button){return event.preventDefault();}entry=entries[domAttr(button,'data-action')];if(!entry){return;}handler=entry.action;originalEvent=event.originalEvent||event;if(isFunction(handler)){if(action==='click'){handler(originalEvent,autoActivate);}}else{if(handler[action]){handler[action](originalEvent,autoActivate);}}event.preventDefault();};Palette.prototype.triggerTwoColumn=function(){var canvas=this._canvas;var parent=canvas.getContainer();if(parent.clientHeight<650){domClasses(parent).add('two-column');}else{domClasses(parent).remove('two-column');}};Palette.prototype.close=function(){var canvas=this._canvas;var parent=canvas.getContainer();domClasses(this._container).remove('open');domClasses(parent).remove('two-column');};Palette.prototype.open=function(){domClasses(this._container).add('open');this.triggerTwoColumn();};Palette.prototype.toggle=function(open){if(this.isOpen()){this.close();}else{this.open();}};Palette.prototype.isActiveTool=function(tool){return tool&&this._activeTool===tool;};Palette.prototype.updateToolHighlight=function(name){var entriesContainer,toolsContainer;if(!this._toolsContainer){entriesContainer=domQuery('.djs-palette-entries',this._container);this._toolsContainer=domQuery('[data-group=tools]',entriesContainer);}toolsContainer=this._toolsContainer;forEach(toolsContainer.children,function(tool){var actionName=tool.getAttribute('data-action');if(!actionName){return;}actionName=actionName.replace('-tool','');if(tool.classList.contains('entry')&&actionName===name){domClasses(tool).add('highlighted-entry');}else{domClasses(tool).remove('highlighted-entry');}});};Palette.prototype.isOpen=function(){return this._container&&domClasses(this._container).has('open');};Palette.HTML_MARKUP='<div class="djs-palette">'+'<div class="djs-palette-entries"></div>'+'<div class="djs-palette-toggle"></div>'+'</div>';function addClasses(element,classNames){var classes=domClasses(element);var actualClassNames=isArray(classNames)?classNames:classNames.split(/\s+/g);actualClassNames.forEach(function(cls){classes.add(cls);});}},{"lodash/collection/forEach":417,"lodash/lang/isArray":537,"lodash/lang/isFunction":539,"min-dom/lib/attr":561,"min-dom/lib/classes":562,"min-dom/lib/clear":563,"min-dom/lib/delegate":565,"min-dom/lib/domify":566,"min-dom/lib/event":567,"min-dom/lib/matches":568,"min-dom/lib/query":569}],320:[function(require,module,exports){'use strict';module.exports={__depends__:[require('../tool-manager')],__init__:['palette'],palette:['type',require('./Palette')]};},{"../tool-manager":349,"./Palette":319}],321:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach'),assign=require('lodash/object/assign'),find=require('lodash/collection/find');var domDelegate=require('min-dom/lib/delegate'),domify=require('min-dom/lib/domify'),domClasses=require('min-dom/lib/classes'),domAttr=require('min-dom/lib/attr'),domRemove=require('min-dom/lib/remove');var DATA_REF='data-id';function PopupMenu(eventBus,canvas){this._eventBus=eventBus;this._canvas=canvas;this._providers={};}PopupMenu.$inject=['eventBus','canvas'];PopupMenu.prototype.registerProvider=function(id,provider){this._providers[id]=provider;};PopupMenu.prototype.create=function(id,element){var provider=this._providers[id];if(!provider){throw new Error('Provider is not registered: '+id);}if(!element){throw new Error('Element is missing');}var current=this._current={provider:provider,className:id,element:element};if(provider.getHeaderEntries){current.headerEntries=provider.getHeaderEntries(element);}current.entries=provider.getEntries(element);return this;};PopupMenu.prototype.isEmpty=function(){var current=this._current;return current.entries.length===0&&current.headerEntries&&current.headerEntries.length===0;};PopupMenu.prototype.open=function(position){if(!position){throw new Error('the position argument is missing');}if(this.isOpen()){this.close();}var current=this._current,canvas=this._canvas,parent=canvas.getContainer();current.position=position;current.container=this._createContainer();if(current.headerEntries){var headerEntriesContainer=this._createEntries(current.headerEntries,'djs-popup-header');current.container.appendChild(headerEntriesContainer);}if(current.entries){var entriesContainer=this._createEntries(current.entries,'djs-popup-body');current.container.appendChild(entriesContainer);}this._attachContainer(current.container,parent,position.cursor);return this;};PopupMenu.prototype.close=function(){if(!this.isOpen()){return;}this._unbindHandlers();domRemove(this._current.container);this._current.container=null;};PopupMenu.prototype.isOpen=function(){return!!this._current.container;};PopupMenu.prototype.trigger=function(event){event.preventDefault();var element=event.delegateTarget||event.target,entryId=domAttr(element,DATA_REF);var entry=this._getEntry(entryId);if(entry.action){return entry.action.call(null,event,entry);}};PopupMenu.prototype._getEntry=function(entryId){var search={id:entryId};var entry=find(this._current.entries,search)||find(this._current.headerEntries,search);if(!entry){throw new Error('entry not found');}return entry;};PopupMenu.prototype._createContainer=function(){var container=domify('<div class="djs-popup">'),position=this._current.position,className=this._current.className;assign(container.style,{position:'absolute',left:position.x+'px',top:position.y+'px',visibility:'hidden'});domClasses(container).add(className);return container;};PopupMenu.prototype._attachContainer=function(container,parent,cursor){var self=this;domDelegate.bind(container,'.entry','click',function(event){self.trigger(event);});var zoom=this._canvas.zoom();container.style.transformOrigin='top left';container.style.transform='scale('+zoom+')';parent.appendChild(container);if(cursor){this._assureIsInbounds(container,cursor);}this._bindHandlers();};PopupMenu.prototype._assureIsInbounds=function(container,cursor){var canvas=this._canvas,clientRect=canvas._container.getBoundingClientRect();var containerX=container.offsetLeft,containerY=container.offsetTop,containerWidth=container.scrollWidth,containerHeight=container.scrollHeight,overAxis={},left,top;var cursorPosition={x:cursor.x-clientRect.left,y:cursor.y-clientRect.top};if(containerX+containerWidth>clientRect.width){overAxis.x=true;}if(containerY+containerHeight>clientRect.height){overAxis.y=true;}if(overAxis.x&&overAxis.y){left=cursorPosition.x-containerWidth+'px';top=cursorPosition.y-containerHeight+'px';}else if(overAxis.x){left=cursorPosition.x-containerWidth+'px';top=cursorPosition.y+'px';}else if(overAxis.y&&cursorPosition.y<containerHeight){left=cursorPosition.x+'px';top=10+'px';}else if(overAxis.y){left=cursorPosition.x+'px';top=cursorPosition.y-containerHeight+'px';}assign(container.style,{left:left,top:top},{visibility:'visible','z-index':1000});};PopupMenu.prototype._createEntries=function(entries,className){var entriesContainer=domify('<div>'),self=this;domClasses(entriesContainer).add(className);forEach(entries,function(entry){var entryContainer=self._createEntry(entry,entriesContainer);entriesContainer.appendChild(entryContainer);});return entriesContainer;};PopupMenu.prototype._createEntry=function(entry){if(!entry.id){throw new Error('every entry must have the id property set');}var entryContainer=domify('<div>'),entryClasses=domClasses(entryContainer);entryClasses.add('entry');if(entry.className){entryClasses.add(entry.className);}domAttr(entryContainer,DATA_REF,entry.id);if(entry.label){var label=domify('<span>');label.textContent=entry.label;entryContainer.appendChild(label);}if(entry.imageUrl){entryContainer.appendChild(domify('<img src="'+entry.imageUrl+'" />'));}if(entry.active===true){entryClasses.add('active');}if(entry.disabled===true){entryClasses.add('disabled');}if(entry.title){entryContainer.title=entry.title;}return entryContainer;};PopupMenu.prototype._bindHandlers=function(){var eventBus=this._eventBus,self=this;function close(){self.close();}eventBus.once('contextPad.close',close);eventBus.once('canvas.viewbox.changing',close);eventBus.once('commandStack.changed',close);};PopupMenu.prototype._unbindHandlers=function(){var eventBus=this._eventBus,self=this;function close(){self.close();}eventBus.off('contextPad.close',close);eventBus.off('canvas.viewbox.changed',close);eventBus.off('commandStack.changed',close);};module.exports=PopupMenu;},{"lodash/collection/find":416,"lodash/collection/forEach":417,"lodash/object/assign":547,"min-dom/lib/attr":561,"min-dom/lib/classes":562,"min-dom/lib/delegate":565,"min-dom/lib/domify":566,"min-dom/lib/remove":570}],322:[function(require,module,exports){'use strict';module.exports={__init__:['popupMenu'],popupMenu:['type',require('./PopupMenu')]};},{"./PopupMenu":321}],323:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');var svgAppend=require('tiny-svg/lib/append'),svgAttr=require('tiny-svg/lib/attr'),svgClone=require('tiny-svg/lib/clone'),svgCreate=require('tiny-svg/lib/create');function PreviewSupport(elementRegistry,canvas,styles){this._elementRegistry=elementRegistry;this._canvas=canvas;this._styles=styles;}module.exports=PreviewSupport;PreviewSupport.$inject=['elementRegistry','canvas','styles'];PreviewSupport.prototype.getGfx=function(element){return this._elementRegistry.getGraphics(element);};PreviewSupport.prototype.addDragger=function(shape,group){var gfx=this.getGfx(shape);var dragger=svgClone(gfx);var bbox=gfx.getBoundingClientRect();if(isConnection(shape)){removeMarkers(dragger);}svgAttr(dragger,this._styles.cls('djs-dragger',[],{x:bbox.top,y:bbox.left}));svgAppend(group,dragger);return dragger;};PreviewSupport.prototype.addFrame=function(shape,group){var frame=svgCreate('rect',{class:'djs-resize-overlay',width:shape.width,height:shape.height,x:shape.x,y:shape.y});svgAppend(group,frame);return frame;};function removeMarkers(gfx){if(gfx.children){forEach(gfx.children,function(child){removeMarkers(child);});}gfx.style.markerStart='';gfx.style.markerEnd='';}function isConnection(element){return element.waypoints;}},{"lodash/collection/forEach":417,"tiny-svg/lib/append":607,"tiny-svg/lib/attr":609,"tiny-svg/lib/clone":612,"tiny-svg/lib/create":613}],324:[function(require,module,exports){'use strict';module.exports={__init__:['previewSupport'],previewSupport:['type',require('./PreviewSupport')]};},{"./PreviewSupport":323}],325:[function(require,module,exports){'use strict';function Replace(modeling){this._modeling=modeling;}module.exports=Replace;Replace.$inject=['modeling'];Replace.prototype.replaceElement=function(oldElement,newElementData,options){var modeling=this._modeling;var newElement=null;if(oldElement.waypoints){}else{newElementData.x=Math.ceil(oldElement.x+(newElementData.width||oldElement.width)/2);newElementData.y=Math.ceil(oldElement.y+(newElementData.height||oldElement.height)/2);newElement=modeling.replaceShape(oldElement,newElementData,options);}return newElement;};},{}],326:[function(require,module,exports){'use strict';module.exports={__init__:['replace'],replace:['type',require('./Replace')]};},{"./Replace":325}],327:[function(require,module,exports){'use strict';var pick=require('lodash/object/pick'),assign=require('lodash/object/assign');var ResizeUtil=require('./ResizeUtil');var asTRBL=require('../../layout/LayoutUtil').asTRBL,roundBounds=require('../../layout/LayoutUtil').roundBounds;var DEFAULT_MIN_WIDTH=10;function Resize(eventBus,rules,modeling,dragging){this._dragging=dragging;this._rules=rules;var self=this;eventBus.on('resize.start',function(event){var context=event.context,resizeConstraints=context.resizeConstraints,minBounds=context.minBounds;if(resizeConstraints===undefined){if(minBounds===undefined){minBounds=self.computeMinResizeBox(context);}context.resizeConstraints={min:asTRBL(minBounds)};}});eventBus.on('resize.move',function(event){var context=event.context,shape=context.shape,direction=context.direction,resizeConstraints=context.resizeConstraints,delta,newBounds;delta={x:event.dx,y:event.dy};context.delta=delta;newBounds=ResizeUtil.resizeBounds(shape,direction,delta);context.newBounds=ResizeUtil.ensureConstraints(newBounds,resizeConstraints);context.canExecute=self.canResize(context);});eventBus.on('resize.end',function(event){var context=event.context,shape=context.shape,canExecute=context.canExecute,newBounds=context.newBounds;if(canExecute){newBounds=roundBounds(newBounds);modeling.resizeShape(shape,newBounds);}});}Resize.prototype.canResize=function(context){var rules=this._rules;var ctx=pick(context,['newBounds','shape','delta','direction']);return rules.allowed('shape.resize',ctx);};Resize.prototype.activate=function(event,shape,contextOrDirection){var dragging=this._dragging,context,direction;if(typeof contextOrDirection==='string'){contextOrDirection={direction:contextOrDirection};}context=assign({shape:shape},contextOrDirection);direction=context.direction;if(!direction){throw new Error('must provide a direction (nw|se|ne|sw)');}dragging.init(event,'resize',{autoActivate:true,cursor:'resize-'+(/nw|se/.test(direction)?'nwse':'nesw'),data:{shape:shape,context:context}});};Resize.prototype.computeMinResizeBox=function(context){var shape=context.shape,direction=context.direction,minDimensions,childrenBounds;minDimensions=context.minDimensions||{width:DEFAULT_MIN_WIDTH,height:DEFAULT_MIN_WIDTH};childrenBounds=ResizeUtil.computeChildrenBBox(shape,context.childrenBoxPadding);return ResizeUtil.getMinResizeBounds(direction,shape,minDimensions,childrenBounds);};Resize.$inject=['eventBus','rules','modeling','dragging'];module.exports=Resize;},{"../../layout/LayoutUtil":359,"./ResizeUtil":330,"lodash/object/assign":547,"lodash/object/pick":555}],328:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');var HANDLE_OFFSET=-2,HANDLE_SIZE=5,HANDLE_HIT_SIZE=20;var CLS_RESIZER='djs-resizer';var svgAppend=require('tiny-svg/lib/append'),svgAttr=require('tiny-svg/lib/attr'),svgClasses=require('tiny-svg/lib/classes'),svgClear=require('tiny-svg/lib/clear'),svgCreate=require('tiny-svg/lib/create');var domEvent=require('min-dom/lib/event');var isPrimaryButton=require('../../util/Mouse').isPrimaryButton;var asTRBL=require('../../layout/LayoutUtil').asTRBL;var transform=require('../../util/SvgTransformUtil').transform;function ResizeHandles(eventBus,canvas,selection,resize){this._resize=resize;this._canvas=canvas;var self=this;eventBus.on('selection.changed',function(e){var newSelection=e.newSelection;self.removeResizers();if(newSelection.length===1){forEach(newSelection,self.addResizer,self);}});eventBus.on('shape.changed',function(e){var shape=e.element;if(selection.isSelected(shape)){self.removeResizers();self.addResizer(shape);}});}ResizeHandles.prototype.makeDraggable=function(element,gfx,direction){var resize=this._resize;function startResize(event){if(isPrimaryButton(event)){resize.activate(event,element,direction);}}domEvent.bind(gfx,'mousedown',startResize);domEvent.bind(gfx,'touchstart',startResize);};ResizeHandles.prototype._createResizer=function(element,x,y,rotation,direction){var resizersParent=this._getResizersParent();var group=svgCreate('g');svgClasses(group).add(CLS_RESIZER);svgClasses(group).add(CLS_RESIZER+'-'+element.id);svgClasses(group).add(CLS_RESIZER+'-'+direction);svgAppend(resizersParent,group);var origin=-HANDLE_SIZE+HANDLE_OFFSET;var visual=svgCreate('rect');svgAttr(visual,{x:origin,y:origin,width:HANDLE_SIZE,height:HANDLE_SIZE});svgClasses(visual).add(CLS_RESIZER+'-visual');svgAppend(group,visual);var hit=svgCreate('rect');svgAttr(hit,{x:origin,y:origin,width:HANDLE_HIT_SIZE,height:HANDLE_HIT_SIZE});svgClasses(hit).add(CLS_RESIZER+'-hit');svgAppend(group,hit);transform(group,x,y,rotation);return group;};ResizeHandles.prototype.createResizer=function(element,direction){var resizer;var trbl=asTRBL(element);if(direction==='nw'){resizer=this._createResizer(element,trbl.left,trbl.top,0,direction);}else if(direction==='ne'){resizer=this._createResizer(element,trbl.right,trbl.top,90,direction);}else if(direction==='se'){resizer=this._createResizer(element,trbl.right,trbl.bottom,180,direction);}else{resizer=this._createResizer(element,trbl.left,trbl.bottom,270,direction);}this.makeDraggable(element,resizer,direction);};ResizeHandles.prototype.addResizer=function(shape){var resize=this._resize;if(!resize.canResize({shape:shape})){return;}this.createResizer(shape,'nw');this.createResizer(shape,'ne');this.createResizer(shape,'se');this.createResizer(shape,'sw');};ResizeHandles.prototype.removeResizers=function(){var resizersParent=this._getResizersParent();svgClear(resizersParent);};ResizeHandles.prototype._getResizersParent=function(){return this._canvas.getLayer('resizers');};ResizeHandles.$inject=['eventBus','canvas','selection','resize'];module.exports=ResizeHandles;},{"../../layout/LayoutUtil":359,"../../util/Mouse":381,"../../util/SvgTransformUtil":386,"lodash/collection/forEach":417,"min-dom/lib/event":567,"tiny-svg/lib/append":607,"tiny-svg/lib/attr":609,"tiny-svg/lib/classes":610,"tiny-svg/lib/clear":611,"tiny-svg/lib/create":613}],329:[function(require,module,exports){'use strict';var MARKER_RESIZING='djs-resizing',MARKER_RESIZE_NOT_OK='resize-not-ok';var LOW_PRIORITY=500;var svgAttr=require('tiny-svg/lib/attr'),svgRemove=require('tiny-svg/lib/remove');var svgClasses=require('tiny-svg/lib/classes');function ResizePreview(eventBus,elementRegistry,canvas,styles,previewSupport){eventBus.on('resize.move',LOW_PRIORITY,function(event){var context=event.context,shape=context.shape,bounds=context.newBounds,frame=context.frame;if(!frame){frame=context.frame=previewSupport.addFrame(shape,canvas.getDefaultLayer());canvas.addMarker(shape,MARKER_RESIZING);}if(bounds.width>5){svgAttr(frame,{x:bounds.x,width:bounds.width});}if(bounds.height>5){svgAttr(frame,{y:bounds.y,height:bounds.height});}if(context.canExecute){svgClasses(frame).remove(MARKER_RESIZE_NOT_OK);}else{svgClasses(frame).add(MARKER_RESIZE_NOT_OK);}});eventBus.on('resize.cleanup',function(event){var context=event.context,shape=context.shape,frame=context.frame;if(frame){svgRemove(context.frame);}canvas.removeMarker(shape,MARKER_RESIZING);});}ResizePreview.$inject=['eventBus','elementRegistry','canvas','styles','previewSupport'];module.exports=ResizePreview;},{"tiny-svg/lib/attr":609,"tiny-svg/lib/classes":610,"tiny-svg/lib/remove":616}],330:[function(require,module,exports){'use strict';var filter=require('lodash/collection/filter');var max=Math.max,min=Math.min;var DEFAULT_CHILD_BOX_PADDING=20;var getBBox=require('../../util/Elements').getBBox;var asTRBL=require('../../layout/LayoutUtil').asTRBL,asBounds=require('../../layout/LayoutUtil').asBounds;function isNumber(a){return typeof a==='number';}module.exports.substractTRBL=function(trblA,trblB){return{top:trblA.top-trblB.top,right:trblA.right-trblB.right,bottom:trblA.bottom-trblB.bottom,left:trblA.left-trblB.left};};module.exports.resizeBounds=function(bounds,direction,delta){var dx=delta.x,dy=delta.y;switch(direction){case'nw':return{x:bounds.x+dx,y:bounds.y+dy,width:bounds.width-dx,height:bounds.height-dy};case'sw':return{x:bounds.x+dx,y:bounds.y,width:bounds.width-dx,height:bounds.height+dy};case'ne':return{x:bounds.x,y:bounds.y+dy,width:bounds.width+dx,height:bounds.height-dy};case'se':return{x:bounds.x,y:bounds.y,width:bounds.width+dx,height:bounds.height+dy};default:throw new Error('unrecognized direction: '+direction);}};module.exports.resizeTRBL=function(bounds,resize){return{x:bounds.x+(resize.left||0),y:bounds.y+(resize.top||0),width:bounds.width-(resize.left||0)+(resize.right||0),height:bounds.height-(resize.top||0)+(resize.bottom||0)};};module.exports.reattachPoint=function(bounds,newBounds,point){var sx=bounds.width/newBounds.width,sy=bounds.height/newBounds.height;return{x:Math.round((newBounds.x+newBounds.width/2))-Math.floor(((bounds.x+bounds.width/2)-point.x)/sx),y:Math.round((newBounds.y+newBounds.height/2))-Math.floor(((bounds.y+bounds.height/2)-point.y)/sy)};};function applyConstraints(attr,trbl,resizeConstraints){var value=trbl[attr],minValue=resizeConstraints.min&&resizeConstraints.min[attr],maxValue=resizeConstraints.max&&resizeConstraints.max[attr];if(isNumber(minValue)){value=(/top|left/.test(attr)?min:max)(value,minValue);}if(isNumber(maxValue)){value=(/top|left/.test(attr)?max:min)(value,maxValue);}return value;}module.exports.ensureConstraints=function(currentBounds,resizeConstraints){if(!resizeConstraints){return currentBounds;}var currentTrbl=asTRBL(currentBounds);return asBounds({top:applyConstraints('top',currentTrbl,resizeConstraints),right:applyConstraints('right',currentTrbl,resizeConstraints),bottom:applyConstraints('bottom',currentTrbl,resizeConstraints),left:applyConstraints('left',currentTrbl,resizeConstraints)});};module.exports.getMinResizeBounds=function(direction,currentBounds,minDimensions,childrenBounds){var currentBox=asTRBL(currentBounds);var minBox={top:/n/.test(direction)?currentBox.bottom-minDimensions.height:currentBox.top,left:/w/.test(direction)?currentBox.right-minDimensions.width:currentBox.left,bottom:/s/.test(direction)?currentBox.top+minDimensions.height:currentBox.bottom,right:/e/.test(direction)?currentBox.left+minDimensions.width:currentBox.right};var childrenBox=childrenBounds?asTRBL(childrenBounds):minBox;var combinedBox={top:min(minBox.top,childrenBox.top),left:min(minBox.left,childrenBox.left),bottom:max(minBox.bottom,childrenBox.bottom),right:max(minBox.right,childrenBox.right)};return asBounds(combinedBox);};function asPadding(mayBePadding,defaultValue){if(typeof mayBePadding!=='undefined'){return mayBePadding;}else{return DEFAULT_CHILD_BOX_PADDING;}}function addPadding(bbox,padding){var left,right,top,bottom;if(typeof padding==='object'){left=asPadding(padding.left);right=asPadding(padding.right);top=asPadding(padding.top);bottom=asPadding(padding.bottom);}else{left=right=top=bottom=asPadding(padding);}return{x:bbox.x-left,y:bbox.y-top,width:bbox.width+left+right,height:bbox.height+top+bottom};}module.exports.addPadding=addPadding;function isBBoxChild(element){if(element.waypoints){return false;}if(element.type==='label'){return false;}return true;}function computeChildrenBBox(shapeOrChildren,padding){var elements;if(shapeOrChildren.length===undefined){elements=filter(shapeOrChildren.children,isBBoxChild);}else{elements=shapeOrChildren;}if(elements.length){return addPadding(getBBox(elements),padding);}}module.exports.computeChildrenBBox=computeChildrenBBox;},{"../../layout/LayoutUtil":359,"../../util/Elements":373,"lodash/collection/filter":415}],331:[function(require,module,exports){module.exports={__depends__:[require('../rules'),require('../dragging'),require('../preview-support')],__init__:['resize','resizePreview','resizeHandles'],resize:['type',require('./Resize')],resizePreview:['type',require('./ResizePreview')],resizeHandles:['type',require('./ResizeHandles')]};},{"../dragging":269,"../preview-support":324,"../rules":334,"./Resize":327,"./ResizeHandles":328,"./ResizePreview":329}],332:[function(require,module,exports){'use strict';var inherits=require('inherits');var CommandInterceptor=require('../../command/CommandInterceptor');function RuleProvider(eventBus){CommandInterceptor.call(this,eventBus);this.init();}RuleProvider.$inject=['eventBus'];inherits(RuleProvider,CommandInterceptor);module.exports=RuleProvider;RuleProvider.prototype.addRule=function(actions,priority,fn){var self=this;if(typeof actions==='string'){actions=[actions];}actions.forEach(function(action){self.canExecute(action,priority,function(context,action,event){return fn(context);},true);});};RuleProvider.prototype.init=function(){};},{"../../command/CommandInterceptor":226,"inherits":398}],333:[function(require,module,exports){'use strict';function Rules(injector){this._commandStack=injector.get('commandStack',false);}Rules.$inject=['injector'];module.exports=Rules;Rules.prototype.allowed=function(action,context){var allowed=true;var commandStack=this._commandStack;if(commandStack){allowed=commandStack.canExecute(action,context);}return allowed===undefined?true:allowed;};},{}],334:[function(require,module,exports){module.exports={__init__:['rules'],rules:['type',require('./Rules')]};},{"./Rules":333}],335:[function(require,module,exports){'use strict';var domClear=require('min-dom/lib/clear'),domDelegate=require('min-dom/lib/delegate'),domQuery=require('min-dom/lib/query'),domClasses=require('min-dom/lib/classes'),domAttr=require('min-dom/lib/attr'),domify=require('min-dom/lib/domify');var getBoundingBox=require('../../util/Elements').getBBox;function SearchPad(canvas,eventBus,overlays,selection){this._open=false;this._results=[];this._eventMaps=[];this._canvas=canvas;this._eventBus=eventBus;this._overlays=overlays;this._selection=selection;this._container=domify(SearchPad.BOX_HTML);this._searchInput=domQuery(SearchPad.INPUT_SELECTOR,this._container);this._resultsContainer=domQuery(SearchPad.RESULTS_CONTAINER_SELECTOR,this._container);this._canvas.getContainer().appendChild(this._container);eventBus.on(['canvas.destroy','diagram.destroy'],this.close,this);}SearchPad.$inject=['canvas','eventBus','overlays','selection'];SearchPad.prototype._bindEvents=function(){var self=this;function listen(el,selector,type,fn){self._eventMaps.push({el:el,type:type,listener:domDelegate.bind(el,selector,type,fn)});}listen(document,'html','click',function(e){self.close();},true);listen(this._container,SearchPad.INPUT_SELECTOR,'click',function(e){e.stopPropagation();e.delegateTarget.focus();});listen(this._container,SearchPad.RESULT_SELECTOR,'mouseover',function(e){e.stopPropagation();self._scrollToNode(e.delegateTarget);self._preselect(e.delegateTarget);});listen(this._container,SearchPad.RESULT_SELECTOR,'click',function(e){e.stopPropagation();self._select(e.delegateTarget);});listen(this._container,SearchPad.INPUT_SELECTOR,'keydown',function(e){if(e.keyCode===38){e.preventDefault();}if(e.keyCode===40){e.preventDefault();}});listen(this._container,SearchPad.INPUT_SELECTOR,'keyup',function(e){if(e.keyCode===27){return self.close();}if(e.keyCode===13){var selected=self._getCurrentResult();return selected?self._select(selected):self.close();}if(e.keyCode===38){return self._scrollToDirection(true);}if(e.keyCode===40){return self._scrollToDirection();}if(e.keyCode===37||e.keyCode===39){return;}self._search(e.delegateTarget.value);});};SearchPad.prototype._unbindEvents=function(){this._eventMaps.forEach(function(m){domDelegate.unbind(m.el,m.type,m.listener);});};SearchPad.prototype._search=function(pattern){var self=this;this._clearResults();if(!pattern||pattern===''){return;}var searchResults=this._searchProvider.find(pattern);if(!searchResults.length){return;}searchResults.forEach(function(result){var id=result.element.id;var node=self._createResultNode(result,id);self._results[id]={element:result.element,node:node};});var node=domQuery(SearchPad.RESULT_SELECTOR,this._resultsContainer);this._scrollToNode(node);this._preselect(node);};SearchPad.prototype._scrollToDirection=function(previous){var selected=this._getCurrentResult();if(!selected){return;}var node=previous?selected.previousElementSibling:selected.nextElementSibling;if(node){this._scrollToNode(node);this._preselect(node);}};SearchPad.prototype._scrollToNode=function(node){if(!node||node===this._getCurrentResult()){return;}var nodeOffset=node.offsetTop;var containerScroll=this._resultsContainer.scrollTop;var bottomScroll=nodeOffset-this._resultsContainer.clientHeight+node.clientHeight;if(nodeOffset<containerScroll){this._resultsContainer.scrollTop=nodeOffset;}else if(containerScroll<bottomScroll){this._resultsContainer.scrollTop=bottomScroll;}};SearchPad.prototype._clearResults=function(){domClear(this._resultsContainer);this._results=[];this._resetOverlay();this._eventBus.fire('searchPad.cleared');};SearchPad.prototype._getCurrentResult=function(){return domQuery(SearchPad.RESULT_SELECTED_SELECTOR,this._resultsContainer);};SearchPad.prototype._createResultNode=function(result,id){var node=domify(SearchPad.RESULT_HTML);if(result.primaryTokens.length>0){createInnerTextNode(node,result.primaryTokens,SearchPad.RESULT_PRIMARY_HTML);}createInnerTextNode(node,result.secondaryTokens,SearchPad.RESULT_SECONDARY_HTML);domAttr(node,SearchPad.RESULT_ID_ATTRIBUTE,id);this._resultsContainer.appendChild(node);return node;};SearchPad.prototype.registerProvider=function(provider){this._searchProvider=provider;};SearchPad.prototype.open=function(){if(!this._searchProvider){throw new Error('no search provider registered');}if(this.isOpen()){return;}this._bindEvents();this._open=true;domClasses(this._container).add('open');this._searchInput.focus();this._eventBus.fire('searchPad.opened');};SearchPad.prototype.close=function(){if(!this.isOpen()){return;}this._unbindEvents();this._open=false;domClasses(this._container).remove('open');this._clearResults();this._searchInput.value='';this._searchInput.blur();this._resetOverlay();this._eventBus.fire('searchPad.closed');};SearchPad.prototype.toggle=function(){this.isOpen()?this.close():this.open();};SearchPad.prototype.isOpen=function(){return this._open;};SearchPad.prototype._preselect=function(node){var selectedNode=this._getCurrentResult();if(node===selectedNode){return;}if(selectedNode){domClasses(selectedNode).remove(SearchPad.RESULT_SELECTED_CLASS);}var id=domAttr(node,SearchPad.RESULT_ID_ATTRIBUTE);var element=this._results[id].element;domClasses(node).add(SearchPad.RESULT_SELECTED_CLASS);this._resetOverlay(element);this._centerViewbox(element);this._selection.select(element);this._eventBus.fire('searchPad.preselected',element);};SearchPad.prototype._select=function(node){var id=domAttr(node,SearchPad.RESULT_ID_ATTRIBUTE);var element=this._results[id].element;this.close();this._resetOverlay();this._centerViewbox(element);this._selection.select(element);this._eventBus.fire('searchPad.selected',element);};SearchPad.prototype._centerViewbox=function(element){var viewbox=this._canvas.viewbox();var box=getBoundingBox(element);var newViewbox={x:(box.x+box.width/2)-viewbox.outer.width/2,y:(box.y+box.height/2)-viewbox.outer.height/2,width:viewbox.outer.width,height:viewbox.outer.height};this._canvas.viewbox(newViewbox);this._canvas.zoom(viewbox.scale);};SearchPad.prototype._resetOverlay=function(element){if(this._overlayId){this._overlays.remove(this._overlayId);}if(element){var box=getBoundingBox(element);var overlay=constructOverlay(box);this._overlayId=this._overlays.add(element,overlay);}};module.exports=SearchPad;function constructOverlay(box){var offset=6;var w=box.width+offset*2;var h=box.height+offset*2;var styles=['width: '+w+'px','height: '+h+'px'].join('; ');return{position:{bottom:h-offset,right:w-offset},show:true,html:'<div style="'+styles+'" class="'+SearchPad.OVERLAY_CLASS+'"></div>'};}function createInnerTextNode(parentNode,tokens,template){var text=createHtmlText(tokens);var childNode=domify(template);childNode.innerHTML=text;parentNode.appendChild(childNode);}function createHtmlText(tokens){var htmlText='';tokens.forEach(function(t){if(t.matched){htmlText+='<strong class="'+SearchPad.RESULT_HIGHLIGHT_CLASS+'">'+t.matched+'</strong>';}else{htmlText+=t.normal;}});return htmlText!==''?htmlText:null;}SearchPad.CONTAINER_SELECTOR='.djs-search-container';SearchPad.INPUT_SELECTOR='.djs-search-input input';SearchPad.RESULTS_CONTAINER_SELECTOR='.djs-search-results';SearchPad.RESULT_SELECTOR='.djs-search-result';SearchPad.RESULT_SELECTED_CLASS='djs-search-result-selected';SearchPad.RESULT_SELECTED_SELECTOR='.'+SearchPad.RESULT_SELECTED_CLASS;SearchPad.RESULT_ID_ATTRIBUTE='data-result-id';SearchPad.RESULT_HIGHLIGHT_CLASS='djs-search-highlight';SearchPad.OVERLAY_CLASS='djs-search-overlay';SearchPad.BOX_HTML='<div class="djs-search-container djs-draggable djs-scrollable">'+'<div class="djs-search-input">'+'<input type="text"/>'+'</div>'+'<div class="djs-search-results"></div>'+'</div>';SearchPad.RESULT_HTML='<div class="djs-search-result"></div>';SearchPad.RESULT_PRIMARY_HTML='<div class="djs-search-result-primary"></div>';SearchPad.RESULT_SECONDARY_HTML='<p class="djs-search-result-secondary"></p>';},{"../../util/Elements":373,"min-dom/lib/attr":561,"min-dom/lib/classes":562,"min-dom/lib/clear":563,"min-dom/lib/delegate":565,"min-dom/lib/domify":566,"min-dom/lib/query":569}],336:[function(require,module,exports){module.exports={__depends__:[require('../overlays'),require('../selection')],searchPad:['type',require('./SearchPad')]};},{"../overlays":318,"../selection":340,"./SearchPad":335}],337:[function(require,module,exports){'use strict';var isArray=require('lodash/lang/isArray'),forEach=require('lodash/collection/forEach');function Selection(eventBus){this._eventBus=eventBus;this._selectedElements=[];var self=this;eventBus.on(['shape.remove','connection.remove'],function(e){var element=e.element;self.deselect(element);});eventBus.on(['diagram.clear'],function(e){self.select(null);});}Selection.$inject=['eventBus'];module.exports=Selection;Selection.prototype.deselect=function(element){var selectedElements=this._selectedElements;var idx=selectedElements.indexOf(element);if(idx!==-1){var oldSelection=selectedElements.slice();selectedElements.splice(idx,1);this._eventBus.fire('selection.changed',{oldSelection:oldSelection,newSelection:selectedElements});}};Selection.prototype.get=function(){return this._selectedElements;};Selection.prototype.isSelected=function(element){return this._selectedElements.indexOf(element)!==-1;};Selection.prototype.select=function(elements,add){var selectedElements=this._selectedElements,oldSelection=selectedElements.slice();if(!isArray(elements)){elements=elements?[elements]:[];}if(add){forEach(elements,function(element){if(selectedElements.indexOf(element)!==-1){return;}else{selectedElements.push(element);}});}else{this._selectedElements=selectedElements=elements.slice();}this._eventBus.fire('selection.changed',{oldSelection:oldSelection,newSelection:selectedElements});};},{"lodash/collection/forEach":417,"lodash/lang/isArray":537}],338:[function(require,module,exports){'use strict';var hasPrimaryModifier=require('../../util/Mouse').hasPrimaryModifier;var find=require('lodash/collection/find');function SelectionBehavior(eventBus,selection,canvas,elementRegistry){eventBus.on('create.end',500,function(e){if(e.context.canExecute){selection.select(e.context.shape);}});eventBus.on('connect.end',500,function(e){if(e.context.canExecute&&e.context.target){selection.select(e.context.target);}});eventBus.on('shape.move.end',500,function(e){var previousSelection=e.previousSelection||[];var shape=elementRegistry.get(e.context.shape.id);var inSelection=find(previousSelection,function(selectedShape){return shape.id===selectedShape.id;});if(!inSelection){selection.select(shape);}});eventBus.on('element.click',function(event){var element=event.element;if(element===canvas.getRootElement()){element=null;}var isSelected=selection.isSelected(element),isMultiSelect=selection.get().length>1;var add=hasPrimaryModifier(event);if(isSelected&&isMultiSelect){if(add){return selection.deselect(element);}else{return selection.select(element);}}else
if(!isSelected){selection.select(element,add);}else{selection.deselect(element);}});}SelectionBehavior.$inject=['eventBus','selection','canvas','elementRegistry'];module.exports=SelectionBehavior;},{"../../util/Mouse":381,"lodash/collection/find":416}],339:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');var MARKER_HOVER='hover',MARKER_SELECTED='selected';function SelectionVisuals(events,canvas,selection,styles){this._multiSelectionBox=null;function addMarker(e,cls){canvas.addMarker(e,cls);}function removeMarker(e,cls){canvas.removeMarker(e,cls);}events.on('element.hover',function(event){addMarker(event.element,MARKER_HOVER);});events.on('element.out',function(event){removeMarker(event.element,MARKER_HOVER);});events.on('selection.changed',function(event){function deselect(s){removeMarker(s,MARKER_SELECTED);}function select(s){addMarker(s,MARKER_SELECTED);}var oldSelection=event.oldSelection,newSelection=event.newSelection;forEach(oldSelection,function(e){if(newSelection.indexOf(e)===-1){deselect(e);}});forEach(newSelection,function(e){if(oldSelection.indexOf(e)===-1){select(e);}});});}SelectionVisuals.$inject=['eventBus','canvas','selection','styles'];module.exports=SelectionVisuals;},{"lodash/collection/forEach":417}],340:[function(require,module,exports){module.exports={__init__:['selectionVisuals','selectionBehavior'],__depends__:[require('../interaction-events'),require('../outline')],selection:['type',require('./Selection')],selectionVisuals:['type',require('./SelectionVisuals')],selectionBehavior:['type',require('./SelectionBehavior')]};},{"../interaction-events":277,"../outline":316,"./Selection":337,"./SelectionBehavior":338,"./SelectionVisuals":339}],341:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');var snapTo=require('./SnapUtil').snapTo;function SnapContext(){this._targets={};this._snapOrigins={};this._snapLocations=[];this._defaultSnaps={};}SnapContext.prototype.getSnapOrigin=function(snapLocation){return this._snapOrigins[snapLocation];};SnapContext.prototype.setSnapOrigin=function(snapLocation,initialValue){this._snapOrigins[snapLocation]=initialValue;if(this._snapLocations.indexOf(snapLocation)===-1){this._snapLocations.push(snapLocation);}};SnapContext.prototype.addDefaultSnap=function(type,point){var snapValues=this._defaultSnaps[type];if(!snapValues){snapValues=this._defaultSnaps[type]=[];}snapValues.push(point);};SnapContext.prototype.getSnapLocations=function(){return this._snapLocations;};SnapContext.prototype.setSnapLocations=function(snapLocations){this._snapLocations=snapLocations;};SnapContext.prototype.pointsForTarget=function(target){var targetId=target.id||target;var snapPoints=this._targets[targetId];if(!snapPoints){snapPoints=this._targets[targetId]=new SnapPoints();snapPoints.initDefaults(this._defaultSnaps);}return snapPoints;};module.exports=SnapContext;function SnapPoints(defaultSnaps){this._snapValues={};}SnapPoints.prototype.add=function(snapLocation,point){var snapValues=this._snapValues[snapLocation];if(!snapValues){snapValues=this._snapValues[snapLocation]={x:[],y:[]};}if(snapValues.x.indexOf(point.x)===-1){snapValues.x.push(point.x);}if(snapValues.y.indexOf(point.y)===-1){snapValues.y.push(point.y);}};SnapPoints.prototype.snap=function(point,snapLocation,axis,tolerance){var snappingValues=this._snapValues[snapLocation];return snappingValues&&snapTo(point[axis],snappingValues[axis],tolerance);};SnapPoints.prototype.initDefaults=function(defaultSnaps){var self=this;forEach(defaultSnaps||{},function(snapPoints,snapLocation){forEach(snapPoints,function(point){self.add(snapLocation,point);});});};},{"./SnapUtil":342,"lodash/collection/forEach":417}],342:[function(require,module,exports){'use strict';var abs=Math.abs,round=Math.round;function snapTo(value,values,tolerance){tolerance=tolerance===undefined?10:tolerance;var idx,snapValue;for(idx=0;idx<values.length;idx++){snapValue=values[idx];if(abs(snapValue-value)<=tolerance){return snapValue;}}}module.exports.snapTo=snapTo;function topLeft(bounds){return{x:bounds.x,y:bounds.y};}module.exports.topLeft=topLeft;function mid(bounds,defaultValue){if(!bounds||isNaN(bounds.x)||isNaN(bounds.y)){return defaultValue;}return{x:round(bounds.x+bounds.width/2),y:round(bounds.y+bounds.height/2)};}module.exports.mid=mid;function bottomRight(bounds){return{x:bounds.x+bounds.width,y:bounds.y+bounds.height};}module.exports.bottomRight=bottomRight;module.exports.isSnapped=function(event,axis){var snapped=event.snapped;if(!snapped){return false;}if(typeof axis==='string'){return snapped[axis];}return snapped.x&&snapped.y;};module.exports.setSnapped=function(event,axis,value){if(typeof axis!=='string'){throw new Error('axis must be in [x, y]');}if(typeof value!=='number'&&value!==false){throw new Error('value must be Number or false');}var delta,previousValue=event[axis];var snapped=event.snapped=(event.snapped||{});if(value===false){snapped[axis]=false;}else{snapped[axis]=true;delta=value-previousValue;event[axis]+=delta;event['d'+axis]+=delta;}return previousValue;};},{}],343:[function(require,module,exports){'use strict';var filter=require('lodash/collection/filter'),forEach=require('lodash/collection/forEach'),debounce=require('lodash/function/debounce');var mid=require('./SnapUtil').mid;var SnapContext=require('./SnapContext');var SnapUtil=require('./SnapUtil');var HIGHER_PRIORITY=1250;var isSnapped=SnapUtil.isSnapped,setSnapped=SnapUtil.setSnapped;var svgAppend=require('tiny-svg/lib/append'),svgAttr=require('tiny-svg/lib/attr'),svgClasses=require('tiny-svg/lib/classes'),svgCreate=require('tiny-svg/lib/create');function Snapping(eventBus,canvas){this._canvas=canvas;var self=this;eventBus.on(['shape.move.start','create.start'],function(event){self.initSnap(event);});eventBus.on(['shape.move.move','shape.move.end','create.move','create.end'],HIGHER_PRIORITY,function(event){if(event.originalEvent&&event.originalEvent.ctrlKey){return;}if(isSnapped(event)){return;}self.snap(event);});eventBus.on(['shape.move.cleanup','create.cleanup'],function(event){self.hide();});this._asyncHide=debounce(this.hide,1000);}Snapping.$inject=['eventBus','canvas'];module.exports=Snapping;Snapping.prototype.initSnap=function(event){var context=event.context,shape=context.shape,snapContext=context.snapContext;if(!snapContext){snapContext=context.snapContext=new SnapContext();}var snapMid=mid(shape,event);snapContext.setSnapOrigin('mid',{x:snapMid.x-event.x,y:snapMid.y-event.y});return snapContext;};Snapping.prototype.snap=function(event){var context=event.context,snapContext=context.snapContext,shape=context.shape,target=context.target,snapLocations=snapContext.getSnapLocations();if(!target){return;}var snapPoints=snapContext.pointsForTarget(target);if(!snapPoints.initialized){this.addTargetSnaps(snapPoints,shape,target);snapPoints.initialized=true;}var snapping={x:isSnapped(event,'x'),y:isSnapped(event,'y')};forEach(snapLocations,function(location){var snapOrigin=snapContext.getSnapOrigin(location);var snapCurrent={x:event.x+snapOrigin.x,y:event.y+snapOrigin.y};forEach(['x','y'],function(axis){var locationSnapping;if(!snapping[axis]){locationSnapping=snapPoints.snap(snapCurrent,location,axis,7);if(locationSnapping!==undefined){snapping[axis]={value:locationSnapping,originValue:locationSnapping-snapOrigin[axis]};}}});if(snapping.x&&snapping.y){return false;}});this.showSnapLine('vertical',snapping.x&&snapping.x.value);this.showSnapLine('horizontal',snapping.y&&snapping.y.value);forEach(['x','y'],function(axis){var axisSnapping=snapping[axis];if(typeof axisSnapping==='object'){setSnapped(event,axis,axisSnapping.originValue);}});};Snapping.prototype._createLine=function(orientation){var root=this._canvas.getLayer('snap');var line=svgCreate('path');svgAttr(line,{d:'M0,0 L0,0'});svgClasses(line).add('djs-snap-line');svgAppend(root,line);return{update:function(position){if(typeof position!=='number'){svgAttr(line,{display:'none'});}else{if(orientation==='horizontal'){svgAttr(line,{d:'M-100000,'+position+' L+100000,'+position,display:''});}else{svgAttr(line,{d:'M '+position+',-100000 L '+position+', +100000',display:''});}}}};};Snapping.prototype._createSnapLines=function(){this._snapLines={horizontal:this._createLine('horizontal'),vertical:this._createLine('vertical')};};Snapping.prototype.showSnapLine=function(orientation,position){var line=this.getSnapLine(orientation);if(line){line.update(position);}this._asyncHide();};Snapping.prototype.getSnapLine=function(orientation){if(!this._snapLines){this._createSnapLines();}return this._snapLines[orientation];};Snapping.prototype.hide=function(){forEach(this._snapLines,function(l){l.update();});};Snapping.prototype.addTargetSnaps=function(snapPoints,shape,target){var siblings=this.getSiblings(shape,target);forEach(siblings,function(s){snapPoints.add('mid',mid(s));});};Snapping.prototype.getSiblings=function(element,target){return target&&filter(target.children,function(e){return!e.hidden&&!e.labelTarget&&!e.waypoints&&e.host!==element&&e!==element;});};},{"./SnapContext":341,"./SnapUtil":342,"lodash/collection/filter":415,"lodash/collection/forEach":417,"lodash/function/debounce":428,"tiny-svg/lib/append":607,"tiny-svg/lib/attr":609,"tiny-svg/lib/classes":610,"tiny-svg/lib/create":613}],344:[function(require,module,exports){'use strict';var SpaceUtil=require('./SpaceUtil');var Cursor=require('../../util/Cursor');var hasPrimaryModifier=require('../../util/Mouse').hasPrimaryModifier;var abs=Math.abs,round=Math.round;var HIGH_PRIORITY=1500,SPACE_TOOL_CURSOR='crosshair';var AXIS_TO_DIMENSION={x:'width',y:'height'},AXIS_INVERTED={x:'y',y:'x'};var getAllChildren=require('../../util/Elements').selfAndAllChildren;var assign=require('lodash/object/assign'),forEach=require('lodash/collection/forEach');function SpaceTool(eventBus,dragging,canvas,modeling,rules,toolManager){this._canvas=canvas;this._dragging=dragging;this._modeling=modeling;this._rules=rules;this._toolManager=toolManager;var self=this;toolManager.registerTool('space',{tool:'spaceTool.selection',dragging:'spaceTool'});eventBus.on('spaceTool.selection.end',function(event){var target=event.originalEvent.target;if(!event.hover&&!(target instanceof SVGElement)){return;}eventBus.once('spaceTool.selection.ended',function(){self.activateMakeSpace(event.originalEvent);});});eventBus.on('spaceTool.move',HIGH_PRIORITY,function(event){var context=event.context;if(!context.initialized){context.initialized=self.initializeMakeSpace(event,context);}});eventBus.on('spaceTool.end',function(event){var context=event.context,axis=context.axis,direction=context.direction,movingShapes=context.movingShapes,resizingShapes=context.resizingShapes;if(!context.initialized){return;}var delta={x:round(event.dx),y:round(event.dy)};delta[AXIS_INVERTED[axis]]=0;var insideBounds=true;forEach(resizingShapes,function(shape){if((direction==='w'&&event.x>shape.x+shape.width)||(direction==='e'&&event.x<shape.x)||(direction==='n'&&event.y>shape.y+shape.height)||(direction==='s'&&event.y<shape.y)){insideBounds=false;return;}});if(insideBounds){self.makeSpace(movingShapes,resizingShapes,delta,direction);}eventBus.once('spaceTool.ended',function(event){self.activateSelection(event.originalEvent,true,true);});});}SpaceTool.$inject=['eventBus','dragging','canvas','modeling','rules','toolManager'];module.exports=SpaceTool;SpaceTool.prototype.activateSelection=function(event,autoActivate,reactivate){this._dragging.init(event,'spaceTool.selection',{trapClick:false,cursor:SPACE_TOOL_CURSOR,autoActivate:autoActivate,data:{context:{reactivate:reactivate}}});};SpaceTool.prototype.activateMakeSpace=function(event){this._dragging.init(event,'spaceTool',{autoActivate:true,cursor:SPACE_TOOL_CURSOR,data:{context:{}}});};SpaceTool.prototype.makeSpace=function(movingShapes,resizingShapes,delta,direction){return this._modeling.createSpace(movingShapes,resizingShapes,delta,direction);};SpaceTool.prototype.initializeMakeSpace=function(event,context){var axis=abs(event.dx)>abs(event.dy)?'x':'y',offset=event['d'+axis],spacePos=event[axis]-offset;if(abs(offset)<5){return false;}if(offset<0){offset*=-1;}if(hasPrimaryModifier(event)){offset*=-1;}var rootShape=this._canvas.getRootElement();var allShapes=getAllChildren(rootShape,true);var adjustments=this.calculateAdjustments(allShapes,axis,offset,spacePos);assign(context,adjustments,{axis:axis,direction:SpaceUtil.getDirection(axis,offset)});Cursor.set('resize-'+(axis==='x'?'ew':'ns'));return true;};SpaceTool.prototype.calculateAdjustments=function(elements,axis,offset,spacePos){var movingShapes=[],resizingShapes=[];var rules=this._rules;elements.forEach(function(shape){var shapeStart=shape[axis],shapeEnd=shapeStart+shape[AXIS_TO_DIMENSION[axis]];if(!shape.parent){return;}if(shape.waypoints){return;}if(offset>0&&shapeStart>spacePos){return movingShapes.push(shape);}if(offset<0&&shapeEnd<spacePos){return movingShapes.push(shape);}if(shapeStart<spacePos&&shapeEnd>spacePos&&rules.allowed('shape.resize',{shape:shape})){return resizingShapes.push(shape);}});return{movingShapes:movingShapes,resizingShapes:resizingShapes};};SpaceTool.prototype.toggle=function(){if(this.isActive()){this._dragging.cancel();}else{this.activateSelection();}};SpaceTool.prototype.isActive=function(){var context=this._dragging.context();return context&&/^spaceTool/.test(context.prefix);};},{"../../util/Cursor":372,"../../util/Elements":373,"../../util/Mouse":381,"./SpaceUtil":346,"lodash/collection/forEach":417,"lodash/object/assign":547}],345:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');var MARKER_DRAGGING='djs-dragging',MARKER_RESIZING='djs-resizing';var LOW_PRIORITY=250;var svgAppend=require('tiny-svg/lib/append'),svgAttr=require('tiny-svg/lib/attr'),svgClasses=require('tiny-svg/lib/classes'),svgCreate=require('tiny-svg/lib/create'),svgRemove=require('tiny-svg/lib/remove');var translate=require('../../util/SvgTransformUtil').translate;function SpaceToolPreview(eventBus,elementRegistry,canvas,styles,previewSupport){function addPreviewGfx(collection,dragGroup){forEach(collection,function(element){previewSupport.addDragger(element,dragGroup);canvas.addMarker(element,MARKER_DRAGGING);});}eventBus.on('spaceTool.selection.start',function(event){var space=canvas.getLayer('space'),context=event.context;var orientation={x:'M 0,-10000 L 0,10000',y:'M -10000,0 L 10000,0'};var crosshairGroup=svgCreate('g');svgAttr(crosshairGroup,styles.cls('djs-crosshair-group',['no-events']));svgAppend(space,crosshairGroup);var pathX=svgCreate('path');svgAttr(pathX,'d',orientation.x);svgClasses(pathX).add('djs-crosshair');svgAppend(crosshairGroup,pathX);var pathY=svgCreate('path');svgAttr(pathY,'d',orientation.y);svgClasses(pathY).add('djs-crosshair');svgAppend(crosshairGroup,pathY);context.crosshairGroup=crosshairGroup;});eventBus.on('spaceTool.selection.move',function(event){var crosshairGroup=event.context.crosshairGroup;translate(crosshairGroup,event.x,event.y);});eventBus.on('spaceTool.selection.cleanup',function(event){var context=event.context,crosshairGroup=context.crosshairGroup;if(crosshairGroup){svgRemove(crosshairGroup);}});eventBus.on('spaceTool.move',LOW_PRIORITY,function(event){var context=event.context,line=context.line,axis=context.axis,movingShapes=context.movingShapes,resizingShapes=context.resizingShapes;if(!context.initialized){return;}if(!context.dragGroup){var spaceLayer=canvas.getLayer('space');line=svgCreate('path');svgAttr(line,'d','M0,0 L0,0');svgClasses(line).add('djs-crosshair');svgAppend(spaceLayer,line);context.line=line;var dragGroup=svgCreate('g');svgAttr(dragGroup,styles.cls('djs-drag-group',['no-events']));svgAppend(canvas.getDefaultLayer(),dragGroup);addPreviewGfx(movingShapes,dragGroup);var movingConnections=context.movingConnections=elementRegistry.filter(function(element){var sourceIsMoving=false;forEach(movingShapes,function(shape){forEach(shape.outgoing,function(connection){if(element===connection){sourceIsMoving=true;}});});var targetIsMoving=false;forEach(movingShapes,function(shape){forEach(shape.incoming,function(connection){if(element===connection){targetIsMoving=true;}});});var sourceIsResizing=false;forEach(resizingShapes,function(shape){forEach(shape.outgoing,function(connection){if(element===connection){sourceIsResizing=true;}});});var targetIsResizing=false;forEach(resizingShapes,function(shape){forEach(shape.incoming,function(connection){if(element===connection){targetIsResizing=true;}});});return isConnection(element)&&(sourceIsMoving||sourceIsResizing)&&(targetIsMoving||targetIsResizing);});addPreviewGfx(movingConnections,dragGroup);context.dragGroup=dragGroup;}if(!context.frameGroup){var frameGroup=svgCreate('g');svgAttr(frameGroup,styles.cls('djs-frame-group',['no-events']));svgAppend(canvas.getDefaultLayer(),frameGroup);var frames=[];forEach(resizingShapes,function(shape){var frame=previewSupport.addFrame(shape,frameGroup);frames.push({element:frame,initialWidth:frame.getBBox().width,initialHeight:frame.getBBox().height});canvas.addMarker(shape,MARKER_RESIZING);});context.frameGroup=frameGroup;context.frames=frames;}var orientation={x:'M'+event.x+', -10000 L'+event.x+', 10000',y:'M -10000, '+event.y+' L 10000, '+event.y};svgAttr(line,{path:orientation[axis],display:''});var opposite={x:'y',y:'x'};var delta={x:event.dx,y:event.dy};delta[opposite[context.axis]]=0;translate(context.dragGroup,delta.x,delta.y);forEach(context.frames,function(frame){if(frame.initialWidth+delta.x>5){svgAttr(frame.element,{width:frame.initialWidth+delta.x});}if(frame.initialHeight+delta.y>5){svgAttr(frame.element,{height:frame.initialHeight+delta.y});}});});eventBus.on('spaceTool.cleanup',function(event){var context=event.context,movingShapes=context.movingShapes,movingConnections=context.movingConnections,resizingShapes=context.resizingShapes,line=context.line,dragGroup=context.dragGroup,frameGroup=context.frameGroup;forEach(movingShapes,function(shape){canvas.removeMarker(shape,MARKER_DRAGGING);});forEach(movingConnections,function(connection){canvas.removeMarker(connection,MARKER_DRAGGING);});if(dragGroup){svgRemove(line);svgRemove(dragGroup);}forEach(resizingShapes,function(shape){canvas.removeMarker(shape,MARKER_RESIZING);});if(frameGroup){svgRemove(frameGroup);}});}SpaceToolPreview.$inject=['eventBus','elementRegistry','canvas','styles','previewSupport'];module.exports=SpaceToolPreview;function isConnection(element){return element.waypoints;}},{"../../util/SvgTransformUtil":386,"lodash/collection/forEach":417,"tiny-svg/lib/append":607,"tiny-svg/lib/attr":609,"tiny-svg/lib/classes":610,"tiny-svg/lib/create":613,"tiny-svg/lib/remove":616}],346:[function(require,module,exports){'use strict';function getDirection(axis,offset){if(axis==='x'){if(offset>0){return'e';}if(offset<0){return'w';}}if(axis==='y'){if(offset>0){return's';}if(offset<0){return'n';}}return null;}module.exports.getDirection=getDirection;module.exports.resizeBounds=function(bounds,direction,delta){var dx=delta.x,dy=delta.y;switch(direction){case'n':return{x:bounds.x,y:bounds.y+dy,width:bounds.width,height:bounds.height-dy};case's':return{x:bounds.x,y:bounds.y,width:bounds.width,height:bounds.height+dy};case'w':return{x:bounds.x+dx,y:bounds.y,width:bounds.width-dx,height:bounds.height};case'e':return{x:bounds.x,y:bounds.y,width:bounds.width+dx,height:bounds.height};default:throw new Error('unrecognized direction: '+direction);}};},{}],347:[function(require,module,exports){'use strict';module.exports={__init__:['spaceToolPreview'],__depends__:[require('../dragging'),require('../rules'),require('../tool-manager'),require('../preview-support')],spaceTool:['type',require('./SpaceTool')],spaceToolPreview:['type',require('./SpaceToolPreview')]};},{"../dragging":269,"../preview-support":324,"../rules":334,"../tool-manager":349,"./SpaceTool":344,"./SpaceToolPreview":345}],348:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');var LOW_PRIORITY=250;function ToolManager(eventBus,dragging){this._eventBus=eventBus;this._dragging=dragging;this._tools=[];this._active=null;}ToolManager.$inject=['eventBus','dragging'];module.exports=ToolManager;ToolManager.prototype.registerTool=function(name,events){var tools=this._tools;if(!events){throw new Error('A tool has to be registered with it\'s "events"');}tools.push(name);this.bindEvents(name,events);};ToolManager.prototype.isActive=function(tool){return tool&&this._active===tool;};ToolManager.prototype.length=function(tool){return this._tools.length;};ToolManager.prototype.setActive=function(tool){var eventBus=this._eventBus;if(this._active!==tool){this._active=tool;eventBus.fire('tool-manager.update',{tool:tool});}};ToolManager.prototype.bindEvents=function(name,events){var eventBus=this._eventBus,dragging=this._dragging;var eventsToRegister=[];eventBus.on(events.tool+'.init',function(event){var context=event.context;if(!context.reactivate&&this.isActive(name)){this.setActive(null);dragging.cancel();return;}this.setActive(name);},this);forEach(events,function(event){eventsToRegister.push(event+'.ended');eventsToRegister.push(event+'.canceled');});eventBus.on(eventsToRegister,LOW_PRIORITY,function(event){var originalEvent=event.originalEvent;if(!this._active||(originalEvent&&originalEvent.target.parentNode.getAttribute('data-group')==='tools')){return;}this.setActive(null);},this);};},{"lodash/collection/forEach":417}],349:[function(require,module,exports){'use strict';module.exports={__depends__:[require('../dragging')],__init__:['toolManager'],toolManager:['type',require('./ToolManager')]};},{"../dragging":269,"./ToolManager":348}],350:[function(require,module,exports){'use strict';var isString=require('lodash/lang/isString'),assign=require('lodash/object/assign'),forEach=require('lodash/collection/forEach');var domify=require('min-dom/lib/domify'),domAttr=require('min-dom/lib/attr'),domClasses=require('min-dom/lib/classes'),domRemove=require('min-dom/lib/remove'),domDelegate=require('min-dom/lib/delegate');var ids=new(require('../../util/IdGenerator'))('tt');function createRoot(parent){var root=domify('<div class="djs-tooltip-container" style="position: absolute; width: 0; height: 0;" />');parent.insertBefore(root,parent.firstChild);return root;}function setPosition(el,x,y){assign(el.style,{left:x+'px',top:y+'px'});}function setVisible(el,visible){el.style.display=visible===false?'none':'';}var tooltipClass='djs-tooltip',tooltipSelector='.'+tooltipClass;function Tooltips(eventBus,canvas){this._eventBus=eventBus;this._canvas=canvas;this._ids=ids;this._tooltipDefaults={show:{minZoom:0.7,maxZoom:5.0}};this._tooltips={};this._tooltipRoot=createRoot(canvas.getContainer());var self=this;domDelegate.bind(this._tooltipRoot,tooltipSelector,'mousedown',function(event){event.stopPropagation();});domDelegate.bind(this._tooltipRoot,tooltipSelector,'mouseover',function(event){self.trigger('mouseover',event);});domDelegate.bind(this._tooltipRoot,tooltipSelector,'mouseout',function(event){self.trigger('mouseout',event);});this._init();}Tooltips.$inject=['eventBus','canvas'];module.exports=Tooltips;Tooltips.prototype.add=function(tooltip){if(!tooltip.position){throw new Error('must specifiy tooltip position');}if(!tooltip.html){throw new Error('must specifiy tooltip html');}var id=this._ids.next();tooltip=assign({},this._tooltipDefaults,tooltip,{id:id});this._addTooltip(tooltip);if(tooltip.timeout){this.setTimeout(tooltip);}return id;};Tooltips.prototype.trigger=function(action,event){var node=event.delegateTarget||event.target;var tooltip=this.get(domAttr(node,'data-tooltip-id'));if(!tooltip){return;}if(action==='mouseover'&&tooltip.timeout){this.clearTimeout(tooltip);}if(action==='mouseout'&&tooltip.timeout){tooltip.timeout=1000;this.setTimeout(tooltip);}};Tooltips.prototype.get=function(id){if(typeof id!=='string'){id=id.id;}return this._tooltips[id];};Tooltips.prototype.clearTimeout=function(tooltip){tooltip=this.get(tooltip);if(!tooltip){return;}var removeTimer=tooltip.removeTimer;if(removeTimer){clearTimeout(removeTimer);tooltip.removeTimer=null;}};Tooltips.prototype.setTimeout=function(tooltip){tooltip=this.get(tooltip);if(!tooltip){return;}this.clearTimeout(tooltip);var self=this;tooltip.removeTimer=setTimeout(function(){self.remove(tooltip);},tooltip.timeout);};Tooltips.prototype.remove=function(id){var tooltip=this.get(id);if(tooltip){domRemove(tooltip.html);domRemove(tooltip.htmlContainer);delete tooltip.htmlContainer;delete this._tooltips[tooltip.id];}};Tooltips.prototype.show=function(){setVisible(this._tooltipRoot);};Tooltips.prototype.hide=function(){setVisible(this._tooltipRoot,false);};Tooltips.prototype._updateRoot=function(viewbox){var a=viewbox.scale||1;var d=viewbox.scale||1;var matrix='matrix('+a+',0,0,'+d+','+(-1*viewbox.x*a)+','+(-1*viewbox.y*d)+')';this._tooltipRoot.style.transform=matrix;this._tooltipRoot.style['-ms-transform']=matrix;};Tooltips.prototype._addTooltip=function(tooltip){var id=tooltip.id,html=tooltip.html,htmlContainer,tooltipRoot=this._tooltipRoot;if(html.get&&html.constructor.prototype.jquery){html=html.get(0);}if(isString(html)){html=domify(html);}htmlContainer=domify('<div data-tooltip-id="'+id+'" class="'+tooltipClass+'" style="position: absolute">');htmlContainer.appendChild(html);if(tooltip.type){domClasses(htmlContainer).add('djs-tooltip-'+tooltip.type);}if(tooltip.className){domClasses(htmlContainer).add(tooltip.className);}tooltip.htmlContainer=htmlContainer;tooltipRoot.appendChild(htmlContainer);this._tooltips[id]=tooltip;this._updateTooltip(tooltip);};Tooltips.prototype._updateTooltip=function(tooltip){var position=tooltip.position,htmlContainer=tooltip.htmlContainer;setPosition(htmlContainer,position.x,position.y);};Tooltips.prototype._updateTooltipVisibilty=function(viewbox){forEach(this._tooltips,function(tooltip){var show=tooltip.show,htmlContainer=tooltip.htmlContainer,visible=true;if(show){if(show.minZoom>viewbox.scale||show.maxZoom<viewbox.scale){visible=false;}setVisible(htmlContainer,visible);}});};Tooltips.prototype._init=function(){var self=this;function updateViewbox(viewbox){self._updateRoot(viewbox);self._updateTooltipVisibilty(viewbox);self.show();}this._eventBus.on('canvas.viewbox.changing',function(event){self.hide();});this._eventBus.on('canvas.viewbox.changed',function(event){updateViewbox(event.viewbox);});};},{"../../util/IdGenerator":377,"lodash/collection/forEach":417,"lodash/lang/isString":544,"lodash/object/assign":547,"min-dom/lib/attr":561,"min-dom/lib/classes":562,"min-dom/lib/delegate":565,"min-dom/lib/domify":566,"min-dom/lib/remove":570}],351:[function(require,module,exports){module.exports={__init__:['tooltips'],tooltips:['type',require('./Tooltips')]};},{"./Tooltips":350}],352:[function(require,module,exports){'use strict';var svgAppend=require('tiny-svg/lib/append'),svgAttr=require('tiny-svg/lib/attr'),svgCreate=require('tiny-svg/lib/create');function TouchFix(canvas,eventBus){var self=this;eventBus.on('canvas.init',function(e){self.addBBoxMarker(e.svg);});}TouchFix.$inject=['canvas','eventBus'];module.exports=TouchFix;TouchFix.prototype.addBBoxMarker=function(svg){var markerStyle={fill:'none',class:'outer-bound-marker'};var rect1=svgCreate('rect');svgAttr(rect1,{x:-10000,y:10000,width:10,height:10});svgAttr(rect1,markerStyle);svgAppend(svg,rect1);var rect2=svgCreate('rect');svgAttr(rect2,{x:10000,y:10000,width:10,height:10});svgAttr(rect2,markerStyle);svgAppend(svg,rect2);};},{"tiny-svg/lib/append":607,"tiny-svg/lib/attr":609,"tiny-svg/lib/create":613}],353:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach'),domEvent=require('min-dom/lib/event'),domClosest=require('min-dom/lib/closest'),Hammer=require('hammerjs'),Event=require('../../util/Event');var MIN_ZOOM=0.2,MAX_ZOOM=4;var mouseEvents=['mousedown','mouseup','mouseover','mouseout','click','dblclick'];function log(){}function get(service,injector){return injector.get(service,false);}function createTouchRecognizer(node){function stopEvent(event){Event.stopEvent(event,true);}function stopMouse(event){forEach(mouseEvents,function(e){domEvent.bind(node,e,stopEvent,true);});}function allowMouse(event){setTimeout(function(){forEach(mouseEvents,function(e){domEvent.unbind(node,e,stopEvent,true);});},500);}domEvent.bind(node,'touchstart',stopMouse,true);domEvent.bind(node,'touchend',allowMouse,true);domEvent.bind(node,'touchcancel',allowMouse,true);var recognizer=new Hammer.Manager(node,{inputClass:Hammer.TouchInput,recognizers:[]});var tap=new Hammer.Tap();var pan=new Hammer.Pan({threshold:10});var press=new Hammer.Press();var pinch=new Hammer.Pinch();var doubleTap=new Hammer.Tap({event:'doubletap',taps:2});pinch.requireFailure(pan);pinch.requireFailure(press);recognizer.add([pan,press,pinch,doubleTap,tap]);recognizer.reset=function(force){var recognizers=this.recognizers,session=this.session;if(session.stopped){return;}log('recognizer','stop');recognizer.stop(force);setTimeout(function(){var i,r;log('recognizer','reset');for(i=0;(r=recognizers[i]);i++){r.reset();r.state=8;}session.curRecognizer=null;},0);};recognizer.on('hammer.input',function(event){if(event.srcEvent.defaultPrevented){recognizer.reset(true);}});return recognizer;}function TouchInteractionEvents(injector,canvas,eventBus,elementRegistry,interactionEvents){var dragging=get('dragging',injector),move=get('move',injector),contextPad=get('contextPad',injector),palette=get('palette',injector);var recognizer;function handler(type){return function(event){log('element',type,event);interactionEvents.fire(type,event);};}function getGfx(target){var node=domClosest(target,'svg, .djs-element',true);return node;}function initEvents(svg){recognizer=createTouchRecognizer(svg);recognizer.on('doubletap',handler('element.dblclick'));recognizer.on('tap',handler('element.click'));function startGrabCanvas(event){log('canvas','grab start');var lx=0,ly=0;function update(e){var dx=e.deltaX-lx,dy=e.deltaY-ly;canvas.scroll({dx:dx,dy:dy});lx=e.deltaX;ly=e.deltaY;}function end(e){recognizer.off('panmove',update);recognizer.off('panend',end);recognizer.off('pancancel',end);log('canvas','grab end');}recognizer.on('panmove',update);recognizer.on('panend',end);recognizer.on('pancancel',end);}function startGrab(event){var gfx=getGfx(event.target),element=gfx&&elementRegistry.get(gfx);if(move&&canvas.getRootElement()!==element){log('element','move start',element,event,true);return move.start(event,element,true);}else{startGrabCanvas(event);}}function startZoom(e){log('canvas','zoom start');var zoom=canvas.zoom(),mid=e.center;function update(e){var ratio=1-(1-e.scale)/1.50,newZoom=Math.max(MIN_ZOOM,Math.min(MAX_ZOOM,ratio*zoom));canvas.zoom(newZoom,mid);Event.stopEvent(e,true);}function end(e){recognizer.off('pinchmove',update);recognizer.off('pinchend',end);recognizer.off('pinchcancel',end);recognizer.reset(true);log('canvas','zoom end');}recognizer.on('pinchmove',update);recognizer.on('pinchend',end);recognizer.on('pinchcancel',end);}recognizer.on('panstart',startGrab);recognizer.on('press',startGrab);recognizer.on('pinchstart',startZoom);}if(dragging){eventBus.on('drag.move',function(event){var originalEvent=event.originalEvent;if(!originalEvent||originalEvent instanceof MouseEvent){return;}var position=Event.toPoint(originalEvent);var node=document.elementFromPoint(position.x,position.y),gfx=getGfx(node),element=gfx&&elementRegistry.get(gfx);if(element!==event.hover){if(event.hover){dragging.out(event);}if(element){dragging.hover({element:element,gfx:gfx});event.hover=element;event.hoverGfx=gfx;}}});}if(contextPad){eventBus.on('contextPad.create',function(event){var node=event.pad.html;var padRecognizer=createTouchRecognizer(node);padRecognizer.on('panstart',function(event){log('context-pad','panstart',event);contextPad.trigger('dragstart',event,true);});padRecognizer.on('press',function(event){log('context-pad','press',event);contextPad.trigger('dragstart',event,true);});padRecognizer.on('tap',function(event){log('context-pad','tap',event);contextPad.trigger('click',event);});});}if(palette){eventBus.on('palette.create',function(event){var node=event.html;var padRecognizer=createTouchRecognizer(node);padRecognizer.on('panstart',function(event){log('palette','panstart',event);palette.trigger('dragstart',event,true);});padRecognizer.on('press',function(event){log('palette','press',event);palette.trigger('dragstart',event,true);});padRecognizer.on('tap',function(event){log('palette','tap',event);palette.trigger('click',event);});});}eventBus.on('canvas.init',function(event){initEvents(event.svg);});}TouchInteractionEvents.$inject=['injector','canvas','eventBus','elementRegistry','interactionEvents','touchFix'];module.exports=TouchInteractionEvents;},{"../../util/Event":374,"hammerjs":394,"lodash/collection/forEach":417,"min-dom/lib/closest":564,"min-dom/lib/event":567}],354:[function(require,module,exports){module.exports={__depends__:[require('../interaction-events')],__init__:['touchInteractionEvents'],touchInteractionEvents:['type',require('./TouchInteractionEvents')],touchFix:['type',require('./TouchFix')]};},{"../interaction-events":277,"./TouchFix":352,"./TouchInteractionEvents":353}],355:[function(require,module,exports){module.exports={translate:['value',require('./translate')]};},{"./translate":356}],356:[function(require,module,exports){'use strict';module.exports=function translate(template,replacements){replacements=replacements||{};return template.replace(/{([^}]+)}/g,function(_,key){return replacements[key]||'{'+key+'}';});};},{}],357:[function(require,module,exports){'use strict';var getMid=require('./LayoutUtil').getMid;function BaseLayouter(){}module.exports=BaseLayouter;BaseLayouter.prototype.layoutConnection=function(connection,hints){hints=hints||{};return[hints.connectionStart||getMid(connection.source),hints.connectionEnd||getMid(connection.target)];};},{"./LayoutUtil":359}],358:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign');var LayoutUtil=require('./LayoutUtil');function dockingToPoint(docking){return assign({original:docking.point.original||docking.point},docking.actual);}function CroppingConnectionDocking(elementRegistry,graphicsFactory){this._elementRegistry=elementRegistry;this._graphicsFactory=graphicsFactory;}CroppingConnectionDocking.$inject=['elementRegistry','graphicsFactory'];module.exports=CroppingConnectionDocking;CroppingConnectionDocking.prototype.getCroppedWaypoints=function(connection,source,target){source=source||connection.source;target=target||connection.target;var sourceDocking=this.getDockingPoint(connection,source,true),targetDocking=this.getDockingPoint(connection,target);var croppedWaypoints=connection.waypoints.slice(sourceDocking.idx+1,targetDocking.idx);croppedWaypoints.unshift(dockingToPoint(sourceDocking));croppedWaypoints.push(dockingToPoint(targetDocking));return croppedWaypoints;};CroppingConnectionDocking.prototype.getDockingPoint=function(connection,shape,dockStart){var waypoints=connection.waypoints,dockingIdx,dockingPoint,croppedPoint;dockingIdx=dockStart?0:waypoints.length-1;dockingPoint=waypoints[dockingIdx];croppedPoint=this._getIntersection(shape,connection,dockStart);return{point:dockingPoint,actual:croppedPoint||dockingPoint,idx:dockingIdx};};CroppingConnectionDocking.prototype._getIntersection=function(shape,connection,takeFirst){var shapePath=this._getShapePath(shape),connectionPath=this._getConnectionPath(connection);return LayoutUtil.getElementLineIntersection(shapePath,connectionPath,takeFirst);};CroppingConnectionDocking.prototype._getConnectionPath=function(connection){return this._graphicsFactory.getConnectionPath(connection);};CroppingConnectionDocking.prototype._getShapePath=function(shape){return this._graphicsFactory.getShapePath(shape);};CroppingConnectionDocking.prototype._getGfx=function(element){return this._elementRegistry.getGraphics(element);};},{"./LayoutUtil":359,"lodash/object/assign":547}],359:[function(require,module,exports){'use strict';var isObject=require('lodash/lang/isObject'),sortBy=require('lodash/collection/sortBy'),pointDistance=require('../util/Geometry').pointDistance;var intersection=require('../util/Intersection').intersection;function roundBounds(bounds){return{x:Math.round(bounds.x),y:Math.round(bounds.y),width:Math.round(bounds.width),height:Math.round(bounds.height)};}module.exports.roundBounds=roundBounds;function roundPoint(point){return{x:Math.round(point.x),y:Math.round(point.y)};}module.exports.roundPoint=roundPoint;function asTRBL(bounds){return{top:bounds.y,right:bounds.x+(bounds.width||0),bottom:bounds.y+(bounds.height||0),left:bounds.x};}module.exports.asTRBL=asTRBL;function asBounds(trbl){return{x:trbl.left,y:trbl.top,width:trbl.right-trbl.left,height:trbl.bottom-trbl.top};}module.exports.asBounds=asBounds;function getMid(bounds){return roundPoint({x:bounds.x+(bounds.width||0)/2,y:bounds.y+(bounds.height||0)/2});}module.exports.getMid=getMid;function getOrientation(rect,reference,padding){padding=padding||0;if(!isObject(padding)){padding={x:padding,y:padding};}var rectOrientation=asTRBL(rect),referenceOrientation=asTRBL(reference);var top=rectOrientation.bottom+padding.y<=referenceOrientation.top,right=rectOrientation.left-padding.x>=referenceOrientation.right,bottom=rectOrientation.top-padding.y>=referenceOrientation.bottom,left=rectOrientation.right+padding.x<=referenceOrientation.left;var vertical=top?'top':(bottom?'bottom':null),horizontal=left?'left':(right?'right':null);if(horizontal&&vertical){return vertical+'-'+horizontal;}else{return horizontal||vertical||'intersect';}}module.exports.getOrientation=getOrientation;function getElementLineIntersection(elementPath,linePath,cropStart){var intersections=getIntersections(elementPath,linePath);if(intersections.length===1){return roundPoint(intersections[0]);}else if(intersections.length===2&&pointDistance(intersections[0],intersections[1])<1){return roundPoint(intersections[0]);}else if(intersections.length>1){intersections=sortBy(intersections,function(i){var distance=Math.floor(i.t2*100)||1;distance=100-distance;distance=(distance<10?'0':'')+distance;return i.segment2+'#'+distance;});return roundPoint(intersections[cropStart?0:intersections.length-1]);}return null;}module.exports.getElementLineIntersection=getElementLineIntersection;function getIntersections(a,b){return intersection(a,b);}module.exports.getIntersections=getIntersections;},{"../util/Geometry":375,"../util/Intersection":378,"lodash/collection/sortBy":425,"lodash/lang/isObject":542}],360:[function(require,module,exports){'use strict';var isArray=require('lodash/lang/isArray'),find=require('lodash/collection/find'),without=require('lodash/array/without'),assign=require('lodash/object/assign');var LayoutUtil=require('./LayoutUtil'),Geometry=require('../util/Geometry');var getOrientation=LayoutUtil.getOrientation,getMid=LayoutUtil.getMid,pointsAligned=Geometry.pointsAligned;var pointInRect=Geometry.pointInRect,pointDistance=Geometry.pointDistance;var INTERSECTION_THRESHOLD=20,ORIENTATION_THRESHOLD={'h:h':20,'v:v':20,'h:v':-10,'v:h':-10};module.exports.getBendpoints=function(a,b,directions){directions=directions||'h:h';var xmid,ymid;if(directions==='h:v'){return[{x:b.x,y:a.y}];}else
if(directions==='v:h'){return[{x:a.x,y:b.y}];}else
if(directions==='h:h'){xmid=Math.round((b.x-a.x)/2+a.x);return[{x:xmid,y:a.y},{x:xmid,y:b.y}];}else
if(directions==='v:v'){ymid=Math.round((b.y-a.y)/2+a.y);return[{x:a.x,y:ymid},{x:b.x,y:ymid}];}else{throw new Error('unknown directions: <'+directions+'>: '+'directions must be specified as {a direction}:{b direction} (direction in h|v)');}};module.exports.connectPoints=function(a,b,directions){var points=[];if(!pointsAligned(a,b)){points=this.getBendpoints(a,b,directions);}points.unshift(a);points.push(b);return points;};module.exports.connectRectangles=function(source,target,start,end,hints){var preferredLayouts=hints&&hints.preferredLayouts||[];var preferredLayout=without(preferredLayouts,'straight')[0]||'h:h';var threshold=ORIENTATION_THRESHOLD[preferredLayout]||0;var orientation=getOrientation(source,target,threshold);var directions=getDirections(orientation,preferredLayout);start=start||getMid(source);end=end||getMid(target);if(!directions){return;}if(directions==='h:h'){switch(orientation){case'top-right':case'right':case'bottom-right':start={original:start,x:source.x,y:start.y};end={original:end,x:target.x+target.width,y:end.y};break;case'top-left':case'left':case'bottom-left':start={original:start,x:source.x+source.width,y:start.y};end={original:end,x:target.x,y:end.y};break;}}if(directions==='v:v'){switch(orientation){case'top-left':case'top':case'top-right':start={original:start,x:start.x,y:source.y+source.height};end={original:end,x:end.x,y:target.y};break;case'bottom-left':case'bottom':case'bottom-right':start={original:start,x:start.x,y:source.y};end={original:end,x:end.x,y:target.y+target.height};break;}}return this.connectPoints(start,end,directions);};module.exports.repairConnection=function(source,target,start,end,waypoints,hints){if(isArray(start)){waypoints=start;hints=end;start=getMid(source);end=getMid(target);}hints=assign({preferredLayouts:[]},hints);waypoints=waypoints||[];var preferredLayouts=hints.preferredLayouts,layoutStraight=preferredLayouts.indexOf('straight')!==-1,repairedWaypoints;if(layoutStraight){repairedWaypoints=this.layoutStraight(source,target,start,end,hints);}if(!repairedWaypoints){if(hints.connectionEnd){repairedWaypoints=this._repairConnectionSide(target,source,end,waypoints.slice().reverse());repairedWaypoints=repairedWaypoints&&repairedWaypoints.reverse();}else
if(hints.connectionStart){repairedWaypoints=this._repairConnectionSide(source,target,start,waypoints);}else
if(waypoints&&waypoints.length){repairedWaypoints=waypoints;}}if(!repairedWaypoints){repairedWaypoints=this.connectRectangles(source,target,start,end,hints);}return repairedWaypoints;};function inRange(a,start,end){return a>=start&&a<=end;}function isInRange(axis,a,b){var size={x:'width',y:'height'};return inRange(a[axis],b[axis],b[axis]+b[size[axis]]);}module.exports.layoutStraight=function(source,target,start,end,hints){var axis={},primaryAxis,orientation;orientation=getOrientation(source,target);if(!/^(top|bottom|left|right)$/.test(orientation)){return null;}if(/top|bottom/.test(orientation)){primaryAxis='x';}if(/left|right/.test(orientation)){primaryAxis='y';}if(hints.preserveDocking==='target'){if(!isInRange(primaryAxis,end,source)){return null;}axis[primaryAxis]=end[primaryAxis];return[{x:axis.x!==undefined?axis.x:start.x,y:axis.y!==undefined?axis.y:start.y,original:{x:axis.x!==undefined?axis.x:start.x,y:axis.y!==undefined?axis.y:start.y}},{x:end.x,y:end.y}];}else{if(!isInRange(primaryAxis,start,target)){return null;}axis[primaryAxis]=start[primaryAxis];return[{x:start.x,y:start.y},{x:axis.x!==undefined?axis.x:end.x,y:axis.y!==undefined?axis.y:end.y,original:{x:axis.x!==undefined?axis.x:end.x,y:axis.y!==undefined?axis.y:end.y}}];}};module.exports._repairConnectionSide=function(moved,other,newDocking,points){function needsRelayout(moved,other,points){if(points.length<3){return true;}if(points.length>4){return false;}return!!find(points,function(p,idx){var q=points[idx-1];return q&&pointDistance(p,q)<3;});}function repairBendpoint(candidate,oldPeer,newPeer){var alignment=pointsAligned(oldPeer,candidate);switch(alignment){case'v':return{x:candidate.x,y:newPeer.y};case'h':return{x:newPeer.x,y:candidate.y};}return{x:candidate.x,y:candidate.y};}function removeOverlapping(points,a,b){var i;for(i=points.length-2;i!==0;i--){if(pointInRect(points[i],a,INTERSECTION_THRESHOLD)||pointInRect(points[i],b,INTERSECTION_THRESHOLD)){return points.slice(i);}}return points;}if(needsRelayout(moved,other,points)){return null;}var oldDocking=points[0],newPoints=points.slice(),slicedPoints;newPoints[0]=newDocking;newPoints[1]=repairBendpoint(newPoints[1],oldDocking,newDocking);slicedPoints=removeOverlapping(newPoints,moved,other);if(slicedPoints!==newPoints){return this._repairConnectionSide(moved,other,newDocking,slicedPoints);}return newPoints;};function getDirections(orientation,defaultLayout){switch(orientation){case'intersect':return null;case'top':case'bottom':return'v:v';case'left':case'right':return'h:h';default:return defaultLayout;}}},{"../util/Geometry":375,"./LayoutUtil":359,"lodash/array/without":410,"lodash/collection/find":416,"lodash/lang/isArray":537,"lodash/object/assign":547}],361:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign'),inherits=require('inherits');var Refs=require('object-refs');var parentRefs=new Refs({name:'children',enumerable:true,collection:true},{name:'parent'}),labelRefs=new Refs({name:'label',enumerable:true},{name:'labelTarget'}),attacherRefs=new Refs({name:'attachers',collection:true},{name:'host'}),outgoingRefs=new Refs({name:'outgoing',collection:true},{name:'source'}),incomingRefs=new Refs({name:'incoming',collection:true},{name:'target'});function Base(){Object.defineProperty(this,'businessObject',{writable:true});parentRefs.bind(this,'parent');labelRefs.bind(this,'label');outgoingRefs.bind(this,'outgoing');incomingRefs.bind(this,'incoming');}function Shape(){Base.call(this);parentRefs.bind(this,'children');attacherRefs.bind(this,'host');attacherRefs.bind(this,'attachers');}inherits(Shape,Base);function Root(){Shape.call(this);}inherits(Root,Shape);function Label(){Shape.call(this);labelRefs.bind(this,'labelTarget');}inherits(Label,Shape);function Connection(){Base.call(this);outgoingRefs.bind(this,'source');incomingRefs.bind(this,'target');}inherits(Connection,Base);var types={connection:Connection,shape:Shape,label:Label,root:Root};module.exports.create=function(type,attrs){var Type=types[type];if(!Type){throw new Error('unknown type: <'+type+'>');}return assign(new Type(),attrs);};module.exports.Base=Base;module.exports.Root=Root;module.exports.Shape=Shape;module.exports.Connection=Connection;module.exports.Label=Label;},{"inherits":398,"lodash/object/assign":547,"object-refs":583}],362:[function(require,module,exports){'use strict';var Cursor=require('../../util/Cursor'),ClickTrap=require('../../util/ClickTrap'),substract=require('../../util/Math').substract,domEvent=require('min-dom/lib/event'),domClosest=require('min-dom/lib/closest'),EventUtil=require('../../util/Event');function length(point){return Math.sqrt(Math.pow(point.x,2)+Math.pow(point.y,2));}var THRESHOLD=15;function MoveCanvas(eventBus,canvas){var container=canvas._container,context;function handleMove(event){var start=context.start,position=EventUtil.toPoint(event),delta=substract(position,start);if(!context.dragging&&length(delta)>THRESHOLD){context.dragging=true;ClickTrap.install();Cursor.set('grab');}if(context.dragging){var lastPosition=context.last||context.start;delta=substract(position,lastPosition);canvas.scroll({dx:delta.x,dy:delta.y});context.last=position;}event.preventDefault();}function handleEnd(event){domEvent.unbind(document,'mousemove',handleMove);domEvent.unbind(document,'mouseup',handleEnd);context=null;Cursor.unset();}function handleStart(event){if(domClosest(event.target,'.djs-draggable')){return;}if(event.button||event.ctrlKey||event.shiftKey||event.altKey){return;}context={start:EventUtil.toPoint(event)};domEvent.bind(document,'mousemove',handleMove);domEvent.bind(document,'mouseup',handleEnd);}domEvent.bind(container,'mousedown',handleStart);}MoveCanvas.$inject=['eventBus','canvas'];module.exports=MoveCanvas;},{"../../util/ClickTrap":369,"../../util/Cursor":372,"../../util/Event":374,"../../util/Math":380,"min-dom/lib/closest":564,"min-dom/lib/event":567}],363:[function(require,module,exports){module.exports={__init__:['moveCanvas'],moveCanvas:['type',require('./MoveCanvas')]};},{"./MoveCanvas":362}],364:[function(require,module,exports){module.exports={__depends__:[require('../../features/touch')]};},{"../../features/touch":354}],365:[function(require,module,exports){'use strict';var domEvent=require('min-dom/lib/event'),domClosest=require('min-dom/lib/closest');var hasPrimaryModifier=require('../../util/Mouse').hasPrimaryModifier,hasSecondaryModifier=require('../../util/Mouse').hasSecondaryModifier;var isMac=require('../../util/Platform').isMac;var getStepRange=require('./ZoomUtil').getStepRange,cap=require('./ZoomUtil').cap;var log10=require('../../util/Math').log10;var bind=require('lodash/function/bind');var RANGE={min:0.2,max:4},NUM_STEPS=10;function ZoomScroll(eventBus,canvas,config){this._enabled=false;this._canvas=canvas;this._container=canvas._container;this._handleWheel=bind(this._handleWheel,this);var newEnabled=!config||config.enabled!==false;var self=this;eventBus.on('canvas.init',function(e){self._init(newEnabled);});}ZoomScroll.$inject=['eventBus','canvas','config.zoomScroll'];module.exports=ZoomScroll;ZoomScroll.prototype.scroll=function scroll(delta){this._canvas.scroll(delta);};ZoomScroll.prototype.reset=function reset(){this._canvas.zoom('fit-viewport');};ZoomScroll.prototype.zoom=function zoom(direction,position){var canvas=this._canvas;var currentZoom=canvas.zoom(false);var factor=Math.pow(1+Math.abs(direction),direction>0?1:-1);canvas.zoom(cap(RANGE,currentZoom*factor),position);};ZoomScroll.prototype._handleWheel=function handleWheel(event){if(domClosest(event.target,'.djs-scrollable',true)){return;}var element=this._container;event.preventDefault();var isVerticalScroll=hasPrimaryModifier(event),isHorizontalScroll=hasSecondaryModifier(event);var factor;if(isVerticalScroll||isHorizontalScroll){if(isMac){factor=event.deltaMode===0?1.25:50;}else{factor=event.deltaMode===0?1/40:1/2;}var delta={};if(isHorizontalScroll){delta.dx=(factor*(event.deltaX||event.deltaY));}else{delta.dy=(factor*event.deltaY);}this.scroll(delta);}else{factor=(event.deltaMode===0?1/40:1/2);var elementRect=element.getBoundingClientRect();var offset={x:event.clientX-elementRect.left,y:event.clientY-elementRect.top};this.zoom(event.deltaY*factor/(-5),offset);}};ZoomScroll.prototype.stepZoom=function stepZoom(direction,position){var canvas=this._canvas,stepRange=getStepRange(RANGE,NUM_STEPS);direction=direction>0?1:-1;var currentLinearZoomLevel=log10(canvas.zoom());var newLinearZoomLevel=Math.round(currentLinearZoomLevel/stepRange)*stepRange;newLinearZoomLevel+=stepRange*direction;var newLogZoomLevel=Math.pow(10,newLinearZoomLevel);canvas.zoom(cap(RANGE,newLogZoomLevel),position);};ZoomScroll.prototype.toggle=function toggle(newEnabled){var element=this._container;var handleWheel=this._handleWheel;var oldEnabled=this._enabled;if(typeof newEnabled==='undefined'){newEnabled=!oldEnabled;}if(oldEnabled!==newEnabled){domEvent[newEnabled?'bind':'unbind'](element,'wheel',handleWheel,false);}this._enabled=newEnabled;return newEnabled;};ZoomScroll.prototype._init=function(newEnabled){this.toggle(newEnabled);};},{"../../util/Math":380,"../../util/Mouse":381,"../../util/Platform":382,"./ZoomUtil":366,"lodash/function/bind":427,"min-dom/lib/closest":564,"min-dom/lib/event":567}],366:[function(require,module,exports){'use strict';var log10=require('../../util/Math').log10;module.exports.getStepRange=function(range,steps){var minLinearRange=log10(range.min),maxLinearRange=log10(range.max);var absoluteLinearRange=Math.abs(minLinearRange)+Math.abs(maxLinearRange);return absoluteLinearRange/steps;};module.exports.cap=function(range,scale){return Math.max(range.min,Math.min(range.max,scale));};},{"../../util/Math":380}],367:[function(require,module,exports){module.exports={__init__:['zoomScroll'],zoomScroll:['type',require('./ZoomScroll')]};},{"./ZoomScroll":365}],368:[function(require,module,exports){'use strict';var roundPoint=require('../layout/LayoutUtil').roundPoint;var center=require('./PositionUtil').center,delta=require('./PositionUtil').delta;function getNewAttachPoint(point,oldBounds,newBounds){var oldCenter=center(oldBounds),newCenter=center(newBounds),oldDelta=delta(point,oldCenter);var newDelta={x:oldDelta.x*(newBounds.width/oldBounds.width),y:oldDelta.y*(newBounds.height/oldBounds.height)};return roundPoint({x:newCenter.x+newDelta.x,y:newCenter.y+newDelta.y});}module.exports.getNewAttachPoint=getNewAttachPoint;function getNewAttachShapeDelta(shape,oldBounds,newBounds){var shapeCenter=center(shape),oldCenter=center(oldBounds),newCenter=center(newBounds),shapeDelta=delta(shape,shapeCenter),oldCenterDelta=delta(shapeCenter,oldCenter);var newCenterDelta={x:oldCenterDelta.x*(newBounds.width/oldBounds.width),y:oldCenterDelta.y*(newBounds.height/oldBounds.height)};var newShapeCenter={x:newCenter.x+newCenterDelta.x,y:newCenter.y+newCenterDelta.y};return roundPoint({x:newShapeCenter.x+shapeDelta.x-shape.x,y:newShapeCenter.y+shapeDelta.y-shape.y});}module.exports.getNewAttachShapeDelta=getNewAttachShapeDelta;},{"../layout/LayoutUtil":359,"./PositionUtil":383}],369:[function(require,module,exports){'use strict';var domEvent=require('min-dom/lib/event'),stopEvent=require('./Event').stopEvent;function trap(event){stopEvent(event);toggle(false);}function toggle(active){domEvent[active?'bind':'unbind'](document.body,'click',trap,true);}function install(){toggle(true);return function(){toggle(false);};}module.exports.install=install;},{"./Event":374,"min-dom/lib/event":567}],370:[function(require,module,exports){'use strict';module.exports.remove=function(collection,element){if(!collection||!element){return-1;}var idx=collection.indexOf(element);if(idx!==-1){collection.splice(idx,1);}return idx;};module.exports.add=function(collection,element,idx){if(!collection||!element){return;}if(typeof idx!=='number'){idx=-1;}var currentIdx=collection.indexOf(element);if(currentIdx!==-1){if(currentIdx===idx){return;}else{if(idx!==-1){collection.splice(currentIdx,1);}else{return;}}}if(idx!==-1){collection.splice(idx,0,element);}else{collection.push(element);}};module.exports.indexOf=function(collection,element){if(!collection||!element){return-1;}return collection.indexOf(element);};},{}],371:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');function getTopLevel(elements){var topLevel={},parents=[],result=[],clearedParents=[];forEach(elements,function(element){var parent=element.parent;if(!topLevel[parent.id]){topLevel[parent.id]=[];}if(parents.indexOf(parent.id)===-1){parents.push(parent.id);}topLevel[parent.id].push(element);});forEach(parents,function(parent){forEach(topLevel[parent],function(element){if(topLevel[element.id]){clearedParents.push(element.id);}});});forEach(parents,function(parent){var idx=clearedParents.indexOf(parent);if(idx===-1){result=result.concat(topLevel[parent]);}});return result;}module.exports.getTopLevel=getTopLevel;},{"lodash/collection/forEach":417}],372:[function(require,module,exports){'use strict';var domClasses=require('min-dom/lib/classes');var CURSOR_CLS_PATTERN=/^djs-cursor-.*$/;module.exports.set=function(mode){var classes=domClasses(document.body);classes.removeMatching(CURSOR_CLS_PATTERN);if(mode){classes.add('djs-cursor-'+mode);}};module.exports.unset=function(){this.set(null);};module.exports.has=function(mode){var classes=domClasses(document.body);return classes.has('djs-cursor-'+mode);};},{"min-dom/lib/classes":562}],373:[function(require,module,exports){'use strict';var isArray=require('lodash/lang/isArray'),isNumber=require('lodash/lang/isNumber'),groupBy=require('lodash/collection/groupBy'),forEach=require('lodash/collection/forEach');function add(elements,e,unique){var canAdd=!unique||elements.indexOf(e)===-1;if(canAdd){elements.push(e);}return canAdd;}function eachElement(elements,fn,depth){depth=depth||0;if(!isArray(elements)){elements=[elements];}forEach(elements,function(s,i){var filter=fn(s,i,depth);if(isArray(filter)&&filter.length){eachElement(filter,fn,depth+1);}});}function selfAndChildren(elements,unique,maxDepth){var result=[],processedChildren=[];eachElement(elements,function(element,i,depth){add(result,element,unique);var children=element.children;if(maxDepth===-1||depth<maxDepth){if(children&&add(processedChildren,children,unique)){return children;}}});return result;}function selfAndDirectChildren(elements,allowDuplicates){return selfAndChildren(elements,!allowDuplicates,1);}function selfAndAllChildren(elements,allowDuplicates){return selfAndChildren(elements,!allowDuplicates,-1);}function getClosure(elements){var topLevel=groupBy(elements,function(e){return e.id;});var allShapes={},allConnections={},enclosedElements={},enclosedConnections={};function handleConnection(c){if(topLevel[c.source.id]&&topLevel[c.target.id]){topLevel[c.id]=c;}if(allShapes[c.source.id]&&allShapes[c.target.id]){enclosedConnections[c.id]=enclosedElements[c.id]=c;}allConnections[c.id]=c;}function handleElement(element){enclosedElements[element.id]=element;if(element.waypoints){enclosedConnections[element.id]=allConnections[element.id]=element;}else{allShapes[element.id]=element;forEach(element.incoming,handleConnection);forEach(element.outgoing,handleConnection);return element.children;}}eachElement(elements,handleElement);return{allShapes:allShapes,allConnections:allConnections,topLevel:topLevel,enclosedConnections:enclosedConnections,enclosedElements:enclosedElements};}function getBBox(elements,stopRecursion){stopRecursion=!!stopRecursion;if(!isArray(elements)){elements=[elements];}var minX,minY,maxX,maxY;forEach(elements,function(element){var bbox=element;if(element.waypoints&&!stopRecursion){bbox=getBBox(element.waypoints,true);}var x=bbox.x,y=bbox.y,height=bbox.height||0,width=bbox.width||0;if(x<minX||minX===undefined){minX=x;}if(y<minY||minY===undefined){minY=y;}if((x+width)>maxX||maxX===undefined){maxX=x+width;}if((y+height)>maxY||maxY===undefined){maxY=y+height;}});return{x:minX,y:minY,height:maxY-minY,width:maxX-minX};}function getEnclosedElements(elements,bbox){var filteredElements={};forEach(elements,function(element){var e=element;if(e.waypoints){e=getBBox(e);}if(!isNumber(bbox.y)&&(e.x>bbox.x)){filteredElements[element.id]=element;}if(!isNumber(bbox.x)&&(e.y>bbox.y)){filteredElements[element.id]=element;}if(e.x>bbox.x&&e.y>bbox.y){if(isNumber(bbox.width)&&isNumber(bbox.height)&&e.width+e.x<bbox.width+bbox.x&&e.height+e.y<bbox.height+bbox.y){filteredElements[element.id]=element;}else if(!isNumber(bbox.width)||!isNumber(bbox.height)){filteredElements[element.id]=element;}}});return filteredElements;}module.exports.add=add;module.exports.eachElement=eachElement;module.exports.selfAndDirectChildren=selfAndDirectChildren;module.exports.selfAndAllChildren=selfAndAllChildren;module.exports.getBBox=getBBox;module.exports.getEnclosedElements=getEnclosedElements;module.exports.getClosure=getClosure;function getElementType(element){if('waypoints'in element){return'connection';}if('x'in element){return'shape';}return'root';}module.exports.getType=getElementType;},{"lodash/collection/forEach":417,"lodash/collection/groupBy":418,"lodash/lang/isArray":537,"lodash/lang/isNumber":541}],374:[function(require,module,exports){'use strict';function __preventDefault(event){return event&&event.preventDefault();}function __stopPropagation(event,immediate){if(!event){return;}if(event.stopPropagation){event.stopPropagation();}if(immediate&&event.stopImmediatePropagation){event.stopImmediatePropagation();}}function getOriginal(event){return event.originalEvent||event.srcEvent;}module.exports.getOriginal=getOriginal;function stopEvent(event,immediate){stopPropagation(event,immediate);preventDefault(event);}module.exports.stopEvent=stopEvent;function preventDefault(event){__preventDefault(event);__preventDefault(getOriginal(event));}module.exports.preventDefault=preventDefault;function stopPropagation(event,immediate){__stopPropagation(event,immediate);__stopPropagation(getOriginal(event),immediate);}module.exports.stopPropagation=stopPropagation;function toPoint(event){if(event.pointers&&event.pointers.length){event=event.pointers[0];}if(event.touches&&event.touches.length){event=event.touches[0];}return event?{x:event.clientX,y:event.clientY}:null;}module.exports.toPoint=toPoint;},{}],375:[function(require,module,exports){'use strict';function pointDistance(a,b){if(!a||!b){return-1;}return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2));}module.exports.pointDistance=pointDistance;module.exports.pointsOnLine=function(p,q,r){if(!p||!q||!r){return false;}var val=(q.x-p.x)*(r.y-p.y)-(q.y-p.y)*(r.x-p.x),dist=pointDistance(p,q);return Math.abs(val/dist)<5;};var ALIGNED_THRESHOLD=2;function pointsAligned(a,b){if(Math.abs(a.x-b.x)<=ALIGNED_THRESHOLD){return'h';}if(Math.abs(a.y-b.y)<=ALIGNED_THRESHOLD){return'v';}return false;}module.exports.pointsAligned=pointsAligned;module.exports.pointInRect=function(p,rect,tolerance){tolerance=tolerance||0;return p.x>rect.x-tolerance&&p.y>rect.y-tolerance&&p.x<rect.x+rect.width+tolerance&&p.y<rect.y+rect.height+tolerance;};module.exports.getMidPoint=function(p,q){return{x:Math.round(p.x+((q.x-p.x)/2.0)),y:Math.round(p.y+((q.y-p.y)/2.0))};};},{}],376:[function(require,module,exports){'use strict';var domQuery=require('min-dom/lib/query');function getVisual(gfx){return domQuery('.djs-visual',gfx);}function getChildren(gfx){return gfx.parentNode.childNodes[1];}module.exports.getVisual=getVisual;module.exports.getChildren=getChildren;},{"min-dom/lib/query":569}],377:[function(require,module,exports){'use strict';function IdGenerator(prefix){this._counter=0;this._prefix=(prefix?prefix+'-':'')+Math.floor(Math.random()*1000000000)+'-';}module.exports=IdGenerator;IdGenerator.prototype.next=function(){return this._prefix+(++this._counter);};},{}],378:[function(require,module,exports){'use strict';var has='hasOwnProperty',p2s=/,?([a-z]),?/gi,toFloat=parseFloat,math=Math,PI=math.PI,mmin=math.min,mmax=math.max,pow=math.pow,abs=math.abs,pathCommand=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/ig,pathValues=/(-?\d*\.?\d*(?:e[\-+]?\\d+)?)[\s]*,?[\s]*/ig;function is(o,type){type=String.prototype.toLowerCase.call(type);if(type=='finite'){return isFinite(o);}if(type=='array'&&(o instanceof Array||Array.isArray&&Array.isArray(o))){return true;}return(type=='null'&&o===null)||(type==typeof o&&o!==null)||(type=='object'&&o===Object(o))||Object.prototype.toString.call(o).slice(8,-1).toLowerCase()==type;}function clone(obj){if(typeof obj=='function'||Object(obj)!==obj){return obj;}var res=new obj.constructor;for(var key in obj)if(obj[has](key)){res[key]=clone(obj[key]);}return res;}function repush(array,item){for(var i=0,ii=array.length;i<ii;i++)if(array[i]===item){return array.push(array.splice(i,1)[0]);}}function cacher(f,scope,postprocessor){function newf(){var arg=Array.prototype.slice.call(arguments,0),args=arg.join('\u2400'),cache=newf.cache=newf.cache||{},count=newf.count=newf.count||[];if(cache[has](args)){repush(count,args);return postprocessor?postprocessor(cache[args]):cache[args];}count.length>=1e3&&delete cache[count.shift()];count.push(args);cache[args]=f.apply(scope,arg);return postprocessor?postprocessor(cache[args]):cache[args];}return newf;}function parsePathString(pathString){if(!pathString){return null;}var pth=paths(pathString);if(pth.arr){return clone(pth.arr);}var paramCounts={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},data=[];if(is(pathString,'array')&&is(pathString[0],'array')){data=clone(pathString);}if(!data.length){String(pathString).replace(pathCommand,function(a,b,c){var params=[],name=b.toLowerCase();c.replace(pathValues,function(a,b){b&&params.push(+b);});if(name=='m'&&params.length>2){data.push([b].concat(params.splice(0,2)));name='l';b=b=='m'?'l':'L';}if(name=='o'&&params.length==1){data.push([b,params[0]]);}if(name=='r'){data.push([b].concat(params));}else while(params.length>=paramCounts[name]){data.push([b].concat(params.splice(0,paramCounts[name])));if(!paramCounts[name]){break;}}});}data.toString=paths.toString;pth.arr=clone(data);return data;}function paths(ps){var p=paths.ps=paths.ps||{};if(p[ps]){p[ps].sleep=100;}else{p[ps]={sleep:100};}setTimeout(function(){for(var key in p)if(p[has](key)&&key!=ps){p[key].sleep--;!p[key].sleep&&delete p[key];}});return p[ps];}function box(x,y,width,height){if(x==null){x=y=width=height=0;}if(y==null){y=x.y;width=x.width;height=x.height;x=x.x;}return{x:x,y:y,width:width,w:width,height:height,h:height,x2:x+width,y2:y+height,cx:x+width/2,cy:y+height/2,r1:math.min(width,height)/2,r2:math.max(width,height)/2,r0:math.sqrt(width*width+height*height)/2,path:rectPath(x,y,width,height),vb:[x,y,width,height].join(' ')};}function toString(){return this.join(',').replace(p2s,'$1');}function pathClone(pathArray){var res=clone(pathArray);res.toString=toString;return res;}function getPointAtSegmentLength(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,length){if(length==null){return bezlen(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y);}else{return findDotsAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,getTotLen(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,length));}}function getLengthFactory(istotal,subpath){function O(val){return+(+val).toFixed(3);}return cacher(function(path,length,onlystart){if(path instanceof Element){path=path.attr('d');}path=path2curve(path);var x,y,p,l,sp='',subpaths={},point,len=0;for(var i=0,ii=path.length;i<ii;i++){p=path[i];if(p[0]=='M'){x=+p[1];y=+p[2];}else{l=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6]);if(len+l>length){if(subpath&&!subpaths.start){point=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6],length-len);sp+=['C'+O(point.start.x),O(point.start.y),O(point.m.x),O(point.m.y),O(point.x),O(point.y)];if(onlystart){return sp;}subpaths.start=sp;sp=['M'+O(point.x),O(point.y)+'C'+O(point.n.x),O(point.n.y),O(point.end.x),O(point.end.y),O(p[5]),O(p[6])].join();len+=l;x=+p[5];y=+p[6];continue;}if(!istotal&&!subpath){point=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6],length-len);return point;}}len+=l;x=+p[5];y=+p[6];}sp+=p.shift()+p;}subpaths.end=sp;point=istotal?len:subpath?subpaths:findDotsAtSegment(x,y,p[0],p[1],p[2],p[3],p[4],p[5],1);return point;},null,clone);}var getTotalLength=getLengthFactory(1),getPointAtLength=getLengthFactory();function findDotsAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t){var t1=1-t,t13=pow(t1,3),t12=pow(t1,2),t2=t*t,t3=t2*t,x=t13*p1x+t12*3*t*c1x+t1*3*t*t*c2x+t3*p2x,y=t13*p1y+t12*3*t*c1y+t1*3*t*t*c2y+t3*p2y,mx=p1x+2*t*(c1x-p1x)+t2*(c2x-2*c1x+p1x),my=p1y+2*t*(c1y-p1y)+t2*(c2y-2*c1y+p1y),nx=c1x+2*t*(c2x-c1x)+t2*(p2x-2*c2x+c1x),ny=c1y+2*t*(c2y-c1y)+t2*(p2y-2*c2y+c1y),ax=t1*p1x+t*c1x,ay=t1*p1y+t*c1y,cx=t1*c2x+t*p2x,cy=t1*c2y+t*p2y,alpha=(90-math.atan2(mx-nx,my-ny)*180/PI);return{x:x,y:y,m:{x:mx,y:my},n:{x:nx,y:ny},start:{x:ax,y:ay},end:{x:cx,y:cy},alpha:alpha};}function bezierBBox(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y){if(!is(p1x,'array')){p1x=[p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y];}var bbox=curveDim.apply(null,p1x);return box(bbox.min.x,bbox.min.y,bbox.max.x-bbox.min.x,bbox.max.y-bbox.min.y);}function isPointInsideBBox(bbox,x,y){return x>=bbox.x&&x<=bbox.x+bbox.width&&y>=bbox.y&&y<=bbox.y+bbox.height;}function isBBoxIntersect(bbox1,bbox2){bbox1=box(bbox1);bbox2=box(bbox2);return isPointInsideBBox(bbox2,bbox1.x,bbox1.y)||isPointInsideBBox(bbox2,bbox1.x2,bbox1.y)||isPointInsideBBox(bbox2,bbox1.x,bbox1.y2)||isPointInsideBBox(bbox2,bbox1.x2,bbox1.y2)||isPointInsideBBox(bbox1,bbox2.x,bbox2.y)||isPointInsideBBox(bbox1,bbox2.x2,bbox2.y)||isPointInsideBBox(bbox1,bbox2.x,bbox2.y2)||isPointInsideBBox(bbox1,bbox2.x2,bbox2.y2)||(bbox1.x<bbox2.x2&&bbox1.x>bbox2.x||bbox2.x<bbox1.x2&&bbox2.x>bbox1.x)&&(bbox1.y<bbox2.y2&&bbox1.y>bbox2.y||bbox2.y<bbox1.y2&&bbox2.y>bbox1.y);}function base3(t,p1,p2,p3,p4){var t1=-3*p1+9*p2-9*p3+3*p4,t2=t*t1+6*p1-12*p2+6*p3;return t*t2-3*p1+3*p2;}function bezlen(x1,y1,x2,y2,x3,y3,x4,y4,z){if(z==null){z=1;}z=z>1?1:z<0?0:z;var z2=z/2,n=12,Tvalues=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],Cvalues=[0.2491,0.2491,0.2335,0.2335,0.2032,0.2032,0.1601,0.1601,0.1069,0.1069,0.0472,0.0472],sum=0;for(var i=0;i<n;i++){var ct=z2*Tvalues[i]+z2,xbase=base3(ct,x1,x2,x3,x4),ybase=base3(ct,y1,y2,y3,y4),comb=xbase*xbase+ybase*ybase;sum+=Cvalues[i]*math.sqrt(comb);}return z2*sum;}function getTotLen(x1,y1,x2,y2,x3,y3,x4,y4,ll){if(ll<0||bezlen(x1,y1,x2,y2,x3,y3,x4,y4)<ll){return;}var t=1,step=t/2,t2=t-step,l,e=.01;l=bezlen(x1,y1,x2,y2,x3,y3,x4,y4,t2);while(abs(l-ll)>e){step/=2;t2+=(l<ll?1:-1)*step;l=bezlen(x1,y1,x2,y2,x3,y3,x4,y4,t2);}return t2;}function intersect(x1,y1,x2,y2,x3,y3,x4,y4){if(mmax(x1,x2)<mmin(x3,x4)||mmin(x1,x2)>mmax(x3,x4)||mmax(y1,y2)<mmin(y3,y4)||mmin(y1,y2)>mmax(y3,y4)){return;}var nx=(x1*y2-y1*x2)*(x3-x4)-(x1-x2)*(x3*y4-y3*x4),ny=(x1*y2-y1*x2)*(y3-y4)-(y1-y2)*(x3*y4-y3*x4),denominator=(x1-x2)*(y3-y4)-(y1-y2)*(x3-x4);if(!denominator){return;}var px=nx/denominator,py=ny/denominator,px2=+px.toFixed(2),py2=+py.toFixed(2);if(px2<+mmin(x1,x2).toFixed(2)||px2>+mmax(x1,x2).toFixed(2)||px2<+mmin(x3,x4).toFixed(2)||px2>+mmax(x3,x4).toFixed(2)||py2<+mmin(y1,y2).toFixed(2)||py2>+mmax(y1,y2).toFixed(2)||py2<+mmin(y3,y4).toFixed(2)||py2>+mmax(y3,y4).toFixed(2)){return;}return{x:px,y:py};}function interHelper(bez1,bez2,justCount){var bbox1=bezierBBox(bez1),bbox2=bezierBBox(bez2);if(!isBBoxIntersect(bbox1,bbox2)){return justCount?0:[];}var l1=bezlen.apply(0,bez1),l2=bezlen.apply(0,bez2),n1=~~(l1/8),n2=~~(l2/8),dots1=[],dots2=[],xy={},res=justCount?0:[];for(var i=0;i<n1+1;i++){var p=findDotsAtSegment.apply(0,bez1.concat(i/n1));dots1.push({x:p.x,y:p.y,t:i/n1});}for(i=0;i<n2+1;i++){p=findDotsAtSegment.apply(0,bez2.concat(i/n2));dots2.push({x:p.x,y:p.y,t:i/n2});}for(i=0;i<n1;i++){for(var j=0;j<n2;j++){var di=dots1[i],di1=dots1[i+1],dj=dots2[j],dj1=dots2[j+1],ci=abs(di1.x-di.x)<.001?'y':'x',cj=abs(dj1.x-dj.x)<.001?'y':'x',is=intersect(di.x,di.y,di1.x,di1.y,dj.x,dj.y,dj1.x,dj1.y);if(is){if(xy[is.x.toFixed(4)]==is.y.toFixed(4)){continue;}xy[is.x.toFixed(4)]=is.y.toFixed(4);var t1=di.t+abs((is[ci]-di[ci])/(di1[ci]-di[ci]))*(di1.t-di.t),t2=dj.t+abs((is[cj]-dj[cj])/(dj1[cj]-dj[cj]))*(dj1.t-dj.t);if(t1>=0&&t1<=1&&t2>=0&&t2<=1){if(justCount){res++;}else{res.push({x:is.x,y:is.y,t1:t1,t2:t2});}}}}}return res;}function pathIntersection(path1,path2){return interPathHelper(path1,path2);}function pathIntersectionNumber(path1,path2){return interPathHelper(path1,path2,1);}function interPathHelper(path1,path2,justCount){path1=path2curve(path1);path2=path2curve(path2);var x1,y1,x2,y2,x1m,y1m,x2m,y2m,bez1,bez2,res=justCount?0:[];for(var i=0,ii=path1.length;i<ii;i++){var pi=path1[i];if(pi[0]=='M'){x1=x1m=pi[1];y1=y1m=pi[2];}else{if(pi[0]=='C'){bez1=[x1,y1].concat(pi.slice(1));x1=bez1[6];y1=bez1[7];}else{bez1=[x1,y1,x1,y1,x1m,y1m,x1m,y1m];x1=x1m;y1=y1m;}for(var j=0,jj=path2.length;j<jj;j++){var pj=path2[j];if(pj[0]=='M'){x2=x2m=pj[1];y2=y2m=pj[2];}else{if(pj[0]=='C'){bez2=[x2,y2].concat(pj.slice(1));x2=bez2[6];y2=bez2[7];}else{bez2=[x2,y2,x2,y2,x2m,y2m,x2m,y2m];x2=x2m;y2=y2m;}var intr=interHelper(bez1,bez2,justCount);if(justCount){res+=intr;}else{for(var k=0,kk=intr.length;k<kk;k++){intr[k].segment1=i;intr[k].segment2=j;intr[k].bez1=bez1;intr[k].bez2=bez2;}res=res.concat(intr);}}}}}return res;}function isPointInsidePath(path,x,y){var bbox=pathBBox(path);return isPointInsideBBox(bbox,x,y)&&interPathHelper(path,[['M',x,y],['H',bbox.x2+10]],1)%2==1;}function pathBBox(path){var pth=paths(path);if(pth.bbox){return clone(pth.bbox);}if(!path){return box();}path=path2curve(path);var x=0,y=0,X=[],Y=[],p;for(var i=0,ii=path.length;i<ii;i++){p=path[i];if(p[0]=='M'){x=p[1];y=p[2];X.push(x);Y.push(y);}else{var dim=curveDim(x,y,p[1],p[2],p[3],p[4],p[5],p[6]);X=X.concat(dim.min.x,dim.max.x);Y=Y.concat(dim.min.y,dim.max.y);x=p[5];y=p[6];}}var xmin=mmin.apply(0,X),ymin=mmin.apply(0,Y),xmax=mmax.apply(0,X),ymax=mmax.apply(0,Y),bb=box(xmin,ymin,xmax-xmin,ymax-ymin);pth.bbox=clone(bb);return bb;}function rectPath(x,y,w,h,r){if(r){return[['M',+x+(+r),y],['l',w-r*2,0],['a',r,r,0,0,1,r,r],['l',0,h-r*2],['a',r,r,0,0,1,-r,r],['l',r*2-w,0],['a',r,r,0,0,1,-r,-r],['l',0,r*2-h],['a',r,r,0,0,1,r,-r],['z']];}var res=[['M',x,y],['l',w,0],['l',0,h],['l',-w,0],['z']];res.toString=toString;return res;}function ellipsePath(x,y,rx,ry,a){if(a==null&&ry==null){ry=rx;}x=+x;y=+y;rx=+rx;ry=+ry;if(a!=null){var rad=Math.PI/180,x1=x+rx*Math.cos(-ry*rad),x2=x+rx*Math.cos(-a*rad),y1=y+rx*Math.sin(-ry*rad),y2=y+rx*Math.sin(-a*rad),res=[['M',x1,y1],['A',rx,rx,0,+(a-ry>180),0,x2,y2]];}else{res=[['M',x,y],['m',0,-ry],['a',rx,ry,0,1,1,0,2*ry],['a',rx,ry,0,1,1,0,-2*ry],['z']];}res.toString=toString;return res;}function pathToRelative(pathArray){var pth=paths(pathArray),lowerCase=String.prototype.toLowerCase;if(pth.rel){return pathClone(pth.rel);}if(!is(pathArray,'array')||!is(pathArray&&pathArray[0],'array')){pathArray=parsePathString(pathArray);}var res=[],x=0,y=0,mx=0,my=0,start=0;if(pathArray[0][0]=='M'){x=pathArray[0][1];y=pathArray[0][2];mx=x;my=y;start++;res.push(['M',x,y]);}for(var i=start,ii=pathArray.length;i<ii;i++){var r=res[i]=[],pa=pathArray[i];if(pa[0]!=lowerCase.call(pa[0])){r[0]=lowerCase.call(pa[0]);switch(r[0]){case'a':r[1]=pa[1];r[2]=pa[2];r[3]=pa[3];r[4]=pa[4];r[5]=pa[5];r[6]=+(pa[6]-x).toFixed(3);r[7]=+(pa[7]-y).toFixed(3);break;case'v':r[1]=+(pa[1]-y).toFixed(3);break;case'm':mx=pa[1];my=pa[2];default:for(var j=1,jj=pa.length;j<jj;j++){r[j]=+(pa[j]-((j%2)?x:y)).toFixed(3);}}}else{r=res[i]=[];if(pa[0]=='m'){mx=pa[1]+x;my=pa[2]+y;}for(var k=0,kk=pa.length;k<kk;k++){res[i][k]=pa[k];}}var len=res[i].length;switch(res[i][0]){case'z':x=mx;y=my;break;case'h':x+=+res[i][len-1];break;case'v':y+=+res[i][len-1];break;default:x+=+res[i][len-2];y+=+res[i][len-1];}}res.toString=toString;pth.rel=pathClone(res);return res;}function pathToAbsolute(pathArray){var pth=paths(pathArray);if(pth.abs){return pathClone(pth.abs);}if(!is(pathArray,'array')||!is(pathArray&&pathArray[0],'array')){pathArray=parsePathString(pathArray);}if(!pathArray||!pathArray.length){return[['M',0,0]];}var res=[],x=0,y=0,mx=0,my=0,start=0,pa0;if(pathArray[0][0]=='M'){x=+pathArray[0][1];y=+pathArray[0][2];mx=x;my=y;start++;res[0]=['M',x,y];}var crz=pathArray.length==3&&pathArray[0][0]=='M'&&pathArray[1][0].toUpperCase()=='R'&&pathArray[2][0].toUpperCase()=='Z';for(var r,pa,i=start,ii=pathArray.length;i<ii;i++){res.push(r=[]);pa=pathArray[i];pa0=pa[0];if(pa0!=pa0.toUpperCase()){r[0]=pa0.toUpperCase();switch(r[0]){case'A':r[1]=pa[1];r[2]=pa[2];r[3]=pa[3];r[4]=pa[4];r[5]=pa[5];r[6]=+pa[6]+x;r[7]=+pa[7]+y;break;case'V':r[1]=+pa[1]+y;break;case'H':r[1]=+pa[1]+x;break;case'R':var dots=[x,y].concat(pa.slice(1));for(var j=2,jj=dots.length;j<jj;j++){dots[j]=+dots[j]+x;dots[++j]=+dots[j]+y;}res.pop();res=res.concat(catmullRom2bezier(dots,crz));break;case'O':res.pop();dots=ellipsePath(x,y,pa[1],pa[2]);dots.push(dots[0]);res=res.concat(dots);break;case'U':res.pop();res=res.concat(ellipsePath(x,y,pa[1],pa[2],pa[3]));r=['U'].concat(res[res.length-1].slice(-2));break;case'M':mx=+pa[1]+x;my=+pa[2]+y;default:for(j=1,jj=pa.length;j<jj;j++){r[j]=+pa[j]+((j%2)?x:y);}}}else if(pa0=='R'){dots=[x,y].concat(pa.slice(1));res.pop();res=res.concat(catmullRom2bezier(dots,crz));r=['R'].concat(pa.slice(-2));}else if(pa0=='O'){res.pop();dots=ellipsePath(x,y,pa[1],pa[2]);dots.push(dots[0]);res=res.concat(dots);}else if(pa0=='U'){res.pop();res=res.concat(ellipsePath(x,y,pa[1],pa[2],pa[3]));r=['U'].concat(res[res.length-1].slice(-2));}else{for(var k=0,kk=pa.length;k<kk;k++){r[k]=pa[k];}}pa0=pa0.toUpperCase();if(pa0!='O'){switch(r[0]){case'Z':x=+mx;y=+my;break;case'H':x=r[1];break;case'V':y=r[1];break;case'M':mx=r[r.length-2];my=r[r.length-1];default:x=r[r.length-2];y=r[r.length-1];}}}res.toString=toString;pth.abs=pathClone(res);return res;}function l2c(x1,y1,x2,y2){return[x1,y1,x2,y2,x2,y2];}function q2c(x1,y1,ax,ay,x2,y2){var _13=1/3,_23=2/3;return[_13*x1+_23*ax,_13*y1+_23*ay,_13*x2+_23*ax,_13*y2+_23*ay,x2,y2];}function a2c(x1,y1,rx,ry,angle,large_arc_flag,sweep_flag,x2,y2,recursive){var _120=PI*120/180,rad=PI/180*(+angle||0),res=[],xy,rotate=cacher(function(x,y,rad){var X=x*math.cos(rad)-y*math.sin(rad),Y=x*math.sin(rad)+y*math.cos(rad);return{x:X,y:Y};});if(!recursive){xy=rotate(x1,y1,-rad);x1=xy.x;y1=xy.y;xy=rotate(x2,y2,-rad);x2=xy.x;y2=xy.y;var x=(x1-x2)/2,y=(y1-y2)/2;var h=(x*x)/(rx*rx)+(y*y)/(ry*ry);if(h>1){h=math.sqrt(h);rx=h*rx;ry=h*ry;}var rx2=rx*rx,ry2=ry*ry,k=(large_arc_flag==sweep_flag?-1:1)*math.sqrt(abs((rx2*ry2-rx2*y*y-ry2*x*x)/(rx2*y*y+ry2*x*x))),cx=k*rx*y/ry+(x1+x2)/2,cy=k*-ry*x/rx+(y1+y2)/2,f1=math.asin(((y1-cy)/ry).toFixed(9)),f2=math.asin(((y2-cy)/ry).toFixed(9));f1=x1<cx?PI-f1:f1;f2=x2<cx?PI-f2:f2;f1<0&&(f1=PI*2+f1);f2<0&&(f2=PI*2+f2);if(sweep_flag&&f1>f2){f1=f1-PI*2;}if(!sweep_flag&&f2>f1){f2=f2-PI*2;}}else{f1=recursive[0];f2=recursive[1];cx=recursive[2];cy=recursive[3];}var df=f2-f1;if(abs(df)>_120){var f2old=f2,x2old=x2,y2old=y2;f2=f1+_120*(sweep_flag&&f2>f1?1:-1);x2=cx+rx*math.cos(f2);y2=cy+ry*math.sin(f2);res=a2c(x2,y2,rx,ry,angle,0,sweep_flag,x2old,y2old,[f2,f2old,cx,cy]);}df=f2-f1;var c1=math.cos(f1),s1=math.sin(f1),c2=math.cos(f2),s2=math.sin(f2),t=math.tan(df/4),hx=4/3*rx*t,hy=4/3*ry*t,m1=[x1,y1],m2=[x1+hx*s1,y1-hy*c1],m3=[x2+hx*s2,y2-hy*c2],m4=[x2,y2];m2[0]=2*m1[0]-m2[0];m2[1]=2*m1[1]-m2[1];if(recursive){return[m2,m3,m4].concat(res);}else{res=[m2,m3,m4].concat(res).join().split(',');var newres=[];for(var i=0,ii=res.length;i<ii;i++){newres[i]=i%2?rotate(res[i-1],res[i],rad).y:rotate(res[i],res[i+1],rad).x;}return newres;}}function curveDim(x0,y0,x1,y1,x2,y2,x3,y3){var tvalues=[],bounds=[[],[]],a,b,c,t,t1,t2,b2ac,sqrtb2ac;for(var i=0;i<2;++i){if(i==0){b=6*x0-12*x1+6*x2;a=-3*x0+9*x1-9*x2+3*x3;c=3*x1-3*x0;}else{b=6*y0-12*y1+6*y2;a=-3*y0+9*y1-9*y2+3*y3;c=3*y1-3*y0;}if(abs(a)<1e-12){if(abs(b)<1e-12){continue;}t=-c/b;if(0<t&&t<1){tvalues.push(t);}continue;}b2ac=b*b-4*c*a;sqrtb2ac=math.sqrt(b2ac);if(b2ac<0){continue;}t1=(-b+sqrtb2ac)/(2*a);if(0<t1&&t1<1){tvalues.push(t1);}t2=(-b-sqrtb2ac)/(2*a);if(0<t2&&t2<1){tvalues.push(t2);}}var j=tvalues.length,jlen=j,mt;while(j--){t=tvalues[j];mt=1-t;bounds[0][j]=(mt*mt*mt*x0)+(3*mt*mt*t*x1)+(3*mt*t*t*x2)+(t*t*t*x3);bounds[1][j]=(mt*mt*mt*y0)+(3*mt*mt*t*y1)+(3*mt*t*t*y2)+(t*t*t*y3);}bounds[0][jlen]=x0;bounds[1][jlen]=y0;bounds[0][jlen+1]=x3;bounds[1][jlen+1]=y3;bounds[0].length=bounds[1].length=jlen+2;return{min:{x:mmin.apply(0,bounds[0]),y:mmin.apply(0,bounds[1])},max:{x:mmax.apply(0,bounds[0]),y:mmax.apply(0,bounds[1])}};}function path2curve(path,path2){var pth=!path2&&paths(path);if(!path2&&pth.curve){return pathClone(pth.curve);}var p=pathToAbsolute(path),p2=path2&&pathToAbsolute(path2),attrs={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},attrs2={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},processPath=function(path,d,pcom){var nx,ny;if(!path){return['C',d.x,d.y,d.x,d.y,d.x,d.y];}!(path[0]in{T:1,Q:1})&&(d.qx=d.qy=null);switch(path[0]){case'M':d.X=path[1];d.Y=path[2];break;case'A':path=['C'].concat(a2c.apply(0,[d.x,d.y].concat(path.slice(1))));break;case'S':if(pcom=='C'||pcom=='S'){nx=d.x*2-d.bx;ny=d.y*2-d.by;}else{nx=d.x;ny=d.y;}path=['C',nx,ny].concat(path.slice(1));break;case'T':if(pcom=='Q'||pcom=='T'){d.qx=d.x*2-d.qx;d.qy=d.y*2-d.qy;}else{d.qx=d.x;d.qy=d.y;}path=['C'].concat(q2c(d.x,d.y,d.qx,d.qy,path[1],path[2]));break;case'Q':d.qx=path[1];d.qy=path[2];path=['C'].concat(q2c(d.x,d.y,path[1],path[2],path[3],path[4]));break;case'L':path=['C'].concat(l2c(d.x,d.y,path[1],path[2]));break;case'H':path=['C'].concat(l2c(d.x,d.y,path[1],d.y));break;case'V':path=['C'].concat(l2c(d.x,d.y,d.x,path[1]));break;case'Z':path=['C'].concat(l2c(d.x,d.y,d.X,d.Y));break;}return path;},fixArc=function(pp,i){if(pp[i].length>7){pp[i].shift();var pi=pp[i];while(pi.length){pcoms1[i]='A';p2&&(pcoms2[i]='A');pp.splice(i++,0,['C'].concat(pi.splice(0,6)));}pp.splice(i,1);ii=mmax(p.length,p2&&p2.length||0);}},fixM=function(path1,path2,a1,a2,i){if(path1&&path2&&path1[i][0]=='M'&&path2[i][0]!='M'){path2.splice(i,0,['M',a2.x,a2.y]);a1.bx=0;a1.by=0;a1.x=path1[i][1];a1.y=path1[i][2];ii=mmax(p.length,p2&&p2.length||0);}},pcoms1=[],pcoms2=[],pfirst='',pcom='';for(var i=0,ii=mmax(p.length,p2&&p2.length||0);i<ii;i++){p[i]&&(pfirst=p[i][0]);if(pfirst!='C'){pcoms1[i]=pfirst;i&&(pcom=pcoms1[i-1]);}p[i]=processPath(p[i],attrs,pcom);if(pcoms1[i]!='A'&&pfirst=='C')pcoms1[i]='C';fixArc(p,i);if(p2){p2[i]&&(pfirst=p2[i][0]);if(pfirst!='C'){pcoms2[i]=pfirst;i&&(pcom=pcoms2[i-1]);}p2[i]=processPath(p2[i],attrs2,pcom);if(pcoms2[i]!='A'&&pfirst=='C'){pcoms2[i]='C';}fixArc(p2,i);}fixM(p,p2,attrs,attrs2,i);fixM(p2,p,attrs2,attrs,i);var seg=p[i],seg2=p2&&p2[i],seglen=seg.length,seg2len=p2&&seg2.length;attrs.x=seg[seglen-2];attrs.y=seg[seglen-1];attrs.bx=toFloat(seg[seglen-4])||attrs.x;attrs.by=toFloat(seg[seglen-3])||attrs.y;attrs2.bx=p2&&(toFloat(seg2[seg2len-4])||attrs2.x);attrs2.by=p2&&(toFloat(seg2[seg2len-3])||attrs2.y);attrs2.x=p2&&seg2[seg2len-2];attrs2.y=p2&&seg2[seg2len-1];}if(!p2){pth.curve=pathClone(p);}return p2?[p,p2]:p;}function mapPath(path,matrix){if(!matrix){return path;}var x,y,i,j,ii,jj,pathi;path=path2curve(path);for(i=0,ii=path.length;i<ii;i++){pathi=path[i];for(j=1,jj=pathi.length;j<jj;j+=2){x=matrix.x(pathi[j],pathi[j+1]);y=matrix.y(pathi[j],pathi[j+1]);pathi[j]=x;pathi[j+1]=y;}}return path;}function catmullRom2bezier(crp,z){var d=[];for(var i=0,iLen=crp.length;iLen-2*!z>i;i+=2){var p=[{x:+crp[i-2],y:+crp[i-1]},{x:+crp[i],y:+crp[i+1]},{x:+crp[i+2],y:+crp[i+3]},{x:+crp[i+4],y:+crp[i+5]}];if(z){if(!i){p[0]={x:+crp[iLen-2],y:+crp[iLen-1]};}else if(iLen-4==i){p[3]={x:+crp[0],y:+crp[1]};}else if(iLen-2==i){p[2]={x:+crp[0],y:+crp[1]};p[3]={x:+crp[2],y:+crp[3]};}}else{if(iLen-4==i){p[3]=p[2];}else if(!i){p[0]={x:+crp[i],y:+crp[i+1]};}}d.push(['C',(-p[0].x+6*p[1].x+p[2].x)/6,(-p[0].y+6*p[1].y+p[2].y)/6,(p[1].x+6*p[2].x-p[3].x)/6,(p[1].y+6*p[2].y-p[3].y)/6,p[2].x,p[2].y]);}return d;}paths.getTotalLength=getTotalLength;paths.getPointAtLength=getPointAtLength;paths.findDotsAtSegment=findDotsAtSegment;paths.bezierBBox=bezierBBox;paths.isPointInsideBBox=isPointInsideBBox;paths.isBBoxIntersect=isBBoxIntersect;paths.intersection=pathIntersection;paths.intersectionNumber=pathIntersectionNumber;paths.isPointInside=isPointInsidePath;paths.getBBox=pathBBox;paths.toRelative=pathToRelative;paths.toAbsolute=pathToAbsolute;paths.toCubic=path2curve;paths.map=mapPath;paths.toString=toString;paths.clone=pathClone;module.exports.intersection=pathIntersection;},{}],379:[function(require,module,exports){'use strict';var pointDistance=require('./Geometry').pointDistance;var intersection=require('./Intersection').intersection;var round=Math.round,max=Math.max;function circlePath(center,r){var x=center.x,y=center.y;return[['M',x,y],['m',0,-r],['a',r,r,0,1,1,0,2*r],['a',r,r,0,1,1,0,-2*r],['z']];}function linePath(points){var segments=[];points.forEach(function(p,idx){segments.push([idx===0?'M':'L',p.x,p.y]);});return segments;}var INTERSECTION_THRESHOLD=10;function getBendpointIntersection(waypoints,reference){var i,w;for(i=0;(w=waypoints[i]);i++){if(pointDistance(w,reference)<=INTERSECTION_THRESHOLD){return{point:waypoints[i],bendpoint:true,index:i};}}return null;}function getPathIntersection(waypoints,reference){var intersections=intersection(circlePath(reference,INTERSECTION_THRESHOLD),linePath(waypoints));var a=intersections[0],b=intersections[intersections.length-1],idx;if(!a){return null;}if(a!==b){if(a.segment2!==b.segment2){idx=max(a.segment2,b.segment2)-1;return{point:waypoints[idx],bendpoint:true,index:idx};}return{point:{x:(round(a.x+b.x)/2),y:(round(a.y+b.y)/2)},index:a.segment2};}return{point:{x:round(a.x),y:round(a.y)},index:a.segment2};}module.exports.getApproxIntersection=function(waypoints,reference){return getBendpointIntersection(waypoints,reference)||getPathIntersection(waypoints,reference);};},{"./Geometry":375,"./Intersection":378}],380:[function(require,module,exports){'use strict';function log10(x){return Math.log(x)/Math.log(10);}module.exports.log10=log10;function substract(p1,p2){return{x:p1.x-p2.x,y:p1.y-p2.y};}module.exports.substract=substract;},{}],381:[function(require,module,exports){'use strict';var getOriginalEvent=require('./Event').getOriginal;var isMac=require('./Platform').isMac;function isPrimaryButton(event){return!(getOriginalEvent(event)||event).button;}module.exports.isPrimaryButton=isPrimaryButton;module.exports.isMac=isMac;module.exports.hasPrimaryModifier=function(event){var originalEvent=getOriginalEvent(event)||event;if(!isPrimaryButton(event)){return false;}if(isMac()){return originalEvent.metaKey;}else{return originalEvent.ctrlKey;}};module.exports.hasSecondaryModifier=function(event){var originalEvent=getOriginalEvent(event)||event;return isPrimaryButton(event)&&originalEvent.shiftKey;};},{"./Event":374,"./Platform":382}],382:[function(require,module,exports){'use strict';module.exports.isMac=function isMac(){return(/mac/i).test(navigator.platform);};},{}],383:[function(require,module,exports){'use strict';function center(bounds){return{x:bounds.x+(bounds.width/2),y:bounds.y+(bounds.height/2)};}module.exports.center=center;function delta(a,b){return{x:a.x-b.x,y:a.y-b.y};}module.exports.delta=delta;},{}],384:[function(require,module,exports){'use strict';module.exports.saveClear=function(collection,removeFn){if(typeof removeFn!=='function'){throw new Error('removeFn iterator must be a function');}if(!collection){return;}var e;while((e=collection[0])){removeFn(e);}return collection;};},{}],385:[function(require,module,exports){'use strict';var svgAttr=require('tiny-svg/lib/attr'),svgCreate=require('tiny-svg/lib/create');module.exports.componentsToPath=function(elements){return elements.join(',').replace(/,?([A-z]),?/g,'$1');};function toSVGPoints(points){var result='';for(var i=0,p;(p=points[i]);i++){result+=p.x+','+p.y+' ';}return result;}module.exports.toSVGPoints=toSVGPoints;module.exports.createLine=function(points,attrs){var line=svgCreate('polyline');svgAttr(line,{points:toSVGPoints(points)});if(attrs){svgAttr(line,attrs);}return line;};module.exports.updateLine=function(gfx,points){svgAttr(gfx,{points:toSVGPoints(points)});return gfx;};},{"tiny-svg/lib/attr":609,"tiny-svg/lib/create":613}],386:[function(require,module,exports){'use strict';var svgTransform=require('tiny-svg/lib/transform');var createTransform=require('tiny-svg/lib/geometry').createTransform;module.exports.transform=function(gfx,x,y,angle,amount){var translate=createTransform();translate.setTranslate(x,y);var rotate=createTransform();rotate.setRotate(angle,0,0);var scale=createTransform();scale.setScale(amount||1,amount||1);svgTransform(gfx,[translate,rotate,scale]);};module.exports.translate=function(gfx,x,y){var translate=createTransform();translate.setTranslate(x,y);svgTransform(gfx,translate);};module.exports.rotate=function(gfx,angle){var rotate=createTransform();rotate.setRotate(angle,0,0);svgTransform(gfx,rotate);};module.exports.scale=function(gfx,amount){var scale=createTransform();scale.setScale(amount,amount);svgTransform(gfx,scale);};},{"tiny-svg/lib/geometry":614,"tiny-svg/lib/transform":617}],387:[function(require,module,exports){'use strict';var isObject=require('lodash/lang/isObject'),assign=require('lodash/object/assign'),pick=require('lodash/object/pick'),forEach=require('lodash/collection/forEach'),reduce=require('lodash/collection/reduce'),merge=require('lodash/object/merge');var svgAppend=require('tiny-svg/lib/append'),svgAttr=require('tiny-svg/lib/attr'),svgCreate=require('tiny-svg/lib/create'),svgRemove=require('tiny-svg/lib/remove');var DEFAULT_BOX_PADDING=0;var DEFAULT_LABEL_SIZE={width:150,height:50};function parseAlign(align){var parts=align.split('-');return{horizontal:parts[0]||'center',vertical:parts[1]||'top'};}function parsePadding(padding){if(isObject(padding)){return assign({top:0,left:0,right:0,bottom:0},padding);}else{return{top:padding,left:padding,right:padding,bottom:padding};}}function getTextBBox(text,fakeText){fakeText.textContent=text;try{var bbox,emptyLine=text==='';fakeText.textContent=emptyLine?'dummy':text;bbox=pick(fakeText.getBBox(),['width','height']);if(emptyLine){bbox.width=0;}return bbox;}catch(e){return{width:0,height:0};}}function layoutNext(lines,maxWidth,fakeText){var originalLine=lines.shift(),fitLine=originalLine;var textBBox;for(;;){textBBox=getTextBBox(fitLine,fakeText);textBBox.width=fitLine?textBBox.width:0;if(fitLine===' '||fitLine===''||textBBox.width<Math.round(maxWidth)||fitLine.length<4){return fit(lines,fitLine,originalLine,textBBox);}fitLine=shortenLine(fitLine,textBBox.width,maxWidth);}}function fit(lines,fitLine,originalLine,textBBox){if(fitLine.length<originalLine.length){var nextLine=lines[0]||'',remainder=originalLine.slice(fitLine.length).trim();if(/-\s*$/.test(remainder)){nextLine=remainder+nextLine.replace(/^\s+/,'');}else{nextLine=remainder+' '+nextLine;}lines[0]=nextLine;}return{width:textBBox.width,height:textBBox.height,text:fitLine};}function semanticShorten(line,maxLength){var parts=line.split(/(\s|-)/g),part,shortenedParts=[],length=0;if(parts.length>1){while((part=parts.shift())){if(part.length+length<maxLength){shortenedParts.push(part);length+=part.length;}else{if(part==='-'){shortenedParts.pop();}break;}}}return shortenedParts.join('');}function shortenLine(line,width,maxWidth){var length=Math.max(line.length*(maxWidth/width),1);var shortenedLine=semanticShorten(line,length);if(!shortenedLine){shortenedLine=line.slice(0,Math.max(Math.round(length-1),1));}return shortenedLine;}function getHelperSvg(){var helperSvg=document.getElementById('helper-svg');if(!helperSvg){helperSvg=svgCreate('svg');svgAttr(helperSvg,{id:'helper-svg',width:0,height:0,style:'visibility: hidden; position: fixed'});document.body.appendChild(helperSvg);}return helperSvg;}function Text(config){this._config=assign({},{size:DEFAULT_LABEL_SIZE,padding:DEFAULT_BOX_PADDING,style:{},align:'center-top'},config||{});}Text.prototype.createText=function(text,options){return this.layoutText(text,options).element;};Text.prototype.getDimensions=function(text,options){return this.layoutText(text,options).dimensions;};Text.prototype.layoutText=function(text,options){var box=merge({},this._config.size,options.box||{}),style=merge({},this._config.style,options.style||{}),align=parseAlign(options.align||this._config.align),padding=parsePadding(options.padding!==undefined?options.padding:this._config.padding),fitBox=options.fitBox||false;var lines=text.split(/\r?\n/g),layouted=[];var maxWidth=box.width-padding.left-padding.right;var helperText=svgCreate('text');svgAttr(helperText,{x:0,y:0});svgAttr(helperText,style);var helperSvg=getHelperSvg();svgAppend(helperSvg,helperText);while(lines.length){layouted.push(layoutNext(lines,maxWidth,helperText));}var totalHeight=reduce(layouted,function(sum,line,idx){return sum+line.height;},0);var maxLineWidth=reduce(layouted,function(sum,line,idx){return line.width>sum?line.width:sum;},0);var y,x;switch(align.vertical){case'middle':y=(box.height-totalHeight)/2-layouted[0].height/4;break;default:y=padding.top;}var textElement=svgCreate('text');svgAttr(textElement,style);forEach(layouted,function(line){y+=line.height;switch(align.horizontal){case'left':x=padding.left;break;case'right':x=((fitBox?maxLineWidth:maxWidth)-padding.right-line.width);break;default:x=Math.max((((fitBox?maxLineWidth:maxWidth)-line.width)/2+padding.left),0);}var tspan=svgCreate('tspan');svgAttr(tspan,{x:x,y:y});tspan.textContent=line.text;svgAppend(textElement,tspan);});svgRemove(helperText);var dimensions={width:maxLineWidth,height:totalHeight};return{dimensions:dimensions,element:textElement};};module.exports=Text;},{"lodash/collection/forEach":417,"lodash/collection/reduce":421,"lodash/lang/isObject":542,"lodash/object/assign":547,"lodash/object/merge":552,"lodash/object/pick":555,"tiny-svg/lib/append":607,"tiny-svg/lib/attr":609,"tiny-svg/lib/create":613,"tiny-svg/lib/remove":616}],388:[function(require,module,exports){var isArray=function(obj){return Object.prototype.toString.call(obj)==='[object Array]';};var annotate=function(){var args=Array.prototype.slice.call(arguments);if(args.length===1&&isArray(args[0])){args=args[0];}var fn=args.pop();fn.$inject=args;return fn;};var FN_ARGS=/^function\s*[^\(]*\(\s*([^\)]*)\)/m;var FN_ARG=/\/\*([^\*]*)\*\//m;var parse=function(fn){if(typeof fn!=='function'){throw new Error('Cannot annotate "'+fn+'". Expected a function!');}var match=fn.toString().match(FN_ARGS);return match[1]&&match[1].split(',').map(function(arg){match=arg.match(FN_ARG);return match?match[1].trim():arg.trim();})||[];};exports.annotate=annotate;exports.parse=parse;exports.isArray=isArray;},{}],389:[function(require,module,exports){module.exports={annotate:require('./annotation').annotate,Module:require('./module'),Injector:require('./injector')};},{"./annotation":388,"./injector":390,"./module":391}],390:[function(require,module,exports){var Module=require('./module');var autoAnnotate=require('./annotation').parse;var annotate=require('./annotation').annotate;var isArray=require('./annotation').isArray;var Injector=function(modules,parent){parent=parent||{get:function(name,strict){currentlyResolving.push(name);if(strict===false){return null;}else{throw error('No provider for "'+name+'"!');}}};var currentlyResolving=[];var providers=this._providers=Object.create(parent._providers||null);var instances=this._instances=Object.create(null);var self=instances.injector=this;var error=function(msg){var stack=currentlyResolving.join(' -> ');currentlyResolving.length=0;return new Error(stack?msg+' (Resolving: '+stack+')':msg);};var get=function(name,strict){if(!providers[name]&&name.indexOf('.')!==-1){var parts=name.split('.');var pivot=get(parts.shift());while(parts.length){pivot=pivot[parts.shift()];}return pivot;}if(Object.hasOwnProperty.call(instances,name)){return instances[name];}if(Object.hasOwnProperty.call(providers,name)){if(currentlyResolving.indexOf(name)!==-1){currentlyResolving.push(name);throw error('Cannot resolve circular dependency!');}currentlyResolving.push(name);instances[name]=providers[name][0](providers[name][1]);currentlyResolving.pop();return instances[name];}return parent.get(name,strict);};var instantiate=function(Type){var instance=Object.create(Type.prototype);var returned=invoke(Type,instance);return typeof returned==='object'?returned:instance;};var invoke=function(fn,context){if(typeof fn!=='function'){if(isArray(fn)){fn=annotate(fn.slice());}else{throw new Error('Cannot invoke "'+fn+'". Expected a function!');}}var inject=fn.$inject&&fn.$inject||autoAnnotate(fn);var dependencies=inject.map(function(dep){return get(dep);});return fn.apply(context,dependencies);};var createPrivateInjectorFactory=function(privateChildInjector){return annotate(function(key){return privateChildInjector.get(key);});};var createChild=function(modules,forceNewInstances){if(forceNewInstances&&forceNewInstances.length){var fromParentModule=Object.create(null);var matchedScopes=Object.create(null);var privateInjectorsCache=[];var privateChildInjectors=[];var privateChildFactories=[];var provider;var cacheIdx;var privateChildInjector;var privateChildInjectorFactory;for(var name in providers){provider=providers[name];if(forceNewInstances.indexOf(name)!==-1){if(provider[2]==='private'){cacheIdx=privateInjectorsCache.indexOf(provider[3]);if(cacheIdx===-1){privateChildInjector=provider[3].createChild([],forceNewInstances);privateChildInjectorFactory=createPrivateInjectorFactory(privateChildInjector);privateInjectorsCache.push(provider[3]);privateChildInjectors.push(privateChildInjector);privateChildFactories.push(privateChildInjectorFactory);fromParentModule[name]=[privateChildInjectorFactory,name,'private',privateChildInjector];}else{fromParentModule[name]=[privateChildFactories[cacheIdx],name,'private',privateChildInjectors[cacheIdx]];}}else{fromParentModule[name]=[provider[2],provider[1]];}matchedScopes[name]=true;}if((provider[2]==='factory'||provider[2]==='type')&&provider[1].$scope){forceNewInstances.forEach(function(scope){if(provider[1].$scope.indexOf(scope)!==-1){fromParentModule[name]=[provider[2],provider[1]];matchedScopes[scope]=true;}});}}forceNewInstances.forEach(function(scope){if(!matchedScopes[scope]){throw new Error('No provider for "'+scope+'". Cannot use provider from the parent!');}});modules.unshift(fromParentModule);}return new Injector(modules,self);};var factoryMap={factory:invoke,type:instantiate,value:function(value){return value;}};modules.forEach(function(module){function arrayUnwrap(type,value){if(type!=='value'&&isArray(value)){value=annotate(value.slice());}return value;}if(module instanceof Module){module.forEach(function(provider){var name=provider[0];var type=provider[1];var value=provider[2];providers[name]=[factoryMap[type],arrayUnwrap(type,value),type];});}else if(typeof module==='object'){if(module.__exports__){var clonedModule=Object.keys(module).reduce(function(m,key){if(key.substring(0,2)!=='__'){m[key]=module[key];}return m;},Object.create(null));var privateInjector=new Injector((module.__modules__||[]).concat([clonedModule]),self);var getFromPrivateInjector=annotate(function(key){return privateInjector.get(key);});module.__exports__.forEach(function(key){providers[key]=[getFromPrivateInjector,key,'private',privateInjector];});}else{Object.keys(module).forEach(function(name){if(module[name][2]==='private'){providers[name]=module[name];return;}var type=module[name][0];var value=module[name][1];providers[name]=[factoryMap[type],arrayUnwrap(type,value),type];});}}});this.get=get;this.invoke=invoke;this.instantiate=instantiate;this.createChild=createChild;};module.exports=Injector;},{"./annotation":388,"./module":391}],391:[function(require,module,exports){var Module=function(){var providers=[];this.factory=function(name,factory){providers.push([name,'factory',factory]);return this;};this.value=function(name,value){providers.push([name,'value',value]);return this;};this.type=function(name,type){providers.push([name,'type',type]);return this;};this.forEach=function(iterator){providers.forEach(iterator);};};module.exports=Module;},{}],392:[function(require,module,exports){module.exports=parse;var innerHTMLBug=false;var bugTestDiv;if(typeof document!=='undefined'){bugTestDiv=document.createElement('div');bugTestDiv.innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>';innerHTMLBug=!bugTestDiv.getElementsByTagName('link').length;bugTestDiv=undefined;}var map={legend:[1,'<fieldset>','</fieldset>'],tr:[2,'<table><tbody>','</tbody></table>'],col:[2,'<table><tbody></tbody><colgroup>','</colgroup></table>'],_default:innerHTMLBug?[1,'X<div>','</div>']:[0,'','']};map.td=map.th=[3,'<table><tbody><tr>','</tr></tbody></table>'];map.option=map.optgroup=[1,'<select multiple="multiple">','</select>'];map.thead=map.tbody=map.colgroup=map.caption=map.tfoot=[1,'<table>','</table>'];map.polyline=map.ellipse=map.polygon=map.circle=map.text=map.line=map.path=map.rect=map.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">','</svg>'];function parse(html,doc){if('string'!=typeof html)throw new TypeError('String expected');if(!doc)doc=document;var m=/<([\w:]+)/.exec(html);if(!m)return doc.createTextNode(html);html=html.replace(/^\s+|\s+$/g,'');var tag=m[1];if(tag=='body'){var el=doc.createElement('html');el.innerHTML=html;return el.removeChild(el.lastChild);}var wrap=map[tag]||map._default;var depth=wrap[0];var prefix=wrap[1];var suffix=wrap[2];var el=doc.createElement('div');el.innerHTML=prefix+html+suffix;while(depth--)el=el.lastChild;if(el.firstChild==el.lastChild){return el.removeChild(el.firstChild);}var fragment=doc.createDocumentFragment();while(el.firstChild){fragment.appendChild(el.removeChild(el.firstChild));}return fragment;}},{}],393:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined;}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError('n must be a positive number');this._maxListeners=n;return this;};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==='error'){if(!this._events.error||(isObject(this._events.error)&&!this._events.error.length)){er=arguments[1];if(er instanceof Error){throw er;}else{var err=new Error('Uncaught, unspecified "error" event. ('+er+')');err.context=er;throw err;}}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args);}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args);}return true;};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError('listener must be a function');if(!this._events)this._events={};if(this._events.newListener)this.emit('newListener',type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else
this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners;}else{m=EventEmitter.defaultMaxListeners;}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error('(node) warning: possible EventEmitter memory '+'leak detected. %d listeners added. '+'Use emitter.setMaxListeners() to increase limit.',this._events[type].length);if(typeof console.trace==='function'){console.trace();}}}return this;};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError('listener must be a function');var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments);}}g.listener=listener;this.on(type,g);return this;};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError('listener must be a function');if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||(isFunction(list.listener)&&list.listener===listener)){delete this._events[type];if(this._events.removeListener)this.emit('removeListener',type,listener);}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||(list[i].listener&&list[i].listener===listener)){position=i;break;}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type];}else{list.splice(position,1);}if(this._events.removeListener)this.emit('removeListener',type,listener);}return this;};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this;}if(arguments.length===0){for(key in this._events){if(key==='removeListener')continue;this.removeAllListeners(key);}this.removeAllListeners('removeListener');this._events={};return this;}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners);}else if(listeners){while(listeners.length)this.removeListener(type,listeners[listeners.length-1]);}delete this._events[type];return this;};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else
ret=this._events[type].slice();return ret;};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length;}return 0;};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type);};function isFunction(arg){return typeof arg==='function';}function isNumber(arg){return typeof arg==='number';}function isObject(arg){return typeof arg==='object'&&arg!==null;}function isUndefined(arg){return arg===void 0;}},{}],394:[function(require,module,exports){/*! Hammer.JS - v2.0.7 - 2016-04-22
  http://hammerjs.github.io/
 
  Copyright (c) 2016 Jorik Tangelder;
  Licensed under the MIT license */(function(window,document,exportName,undefined){'use strict';var VENDOR_PREFIXES=['','webkit','Moz','MS','ms','o'];var TEST_ELEMENT=document.createElement('div');var TYPE_FUNCTION='function';var round=Math.round;var abs=Math.abs;var now=Date.now;function setTimeoutContext(fn,timeout,context){return setTimeout(bindFn(fn,context),timeout);}function invokeArrayArg(arg,fn,context){if(Array.isArray(arg)){each(arg,context[fn],context);return true;}return false;}function each(obj,iterator,context){var i;if(!obj){return;}if(obj.forEach){obj.forEach(iterator,context);}else if(obj.length!==undefined){i=0;while(i<obj.length){iterator.call(context,obj[i],i,obj);i++;}}else{for(i in obj){obj.hasOwnProperty(i)&&iterator.call(context,obj[i],i,obj);}}}function deprecate(method,name,message){var deprecationMessage='DEPRECATED METHOD: '+name+'\n'+message+' AT \n';return function(){var e=new Error('get-stack-trace');var stack=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,'').replace(/^\s+at\s+/gm,'').replace(/^Object.<anonymous>\s*\(/gm,'{anonymous}()@'):'Unknown Stack Trace';var log=window.console&&(window.console.warn||window.console.log);if(log){log.call(window.console,deprecationMessage,stack);}return method.apply(this,arguments);};}var assign;if(typeof Object.assign!=='function'){assign=function assign(target){if(target===undefined||target===null){throw new TypeError('Cannot convert undefined or null to object');}var output=Object(target);for(var index=1;index<arguments.length;index++){var source=arguments[index];if(source!==undefined&&source!==null){for(var nextKey in source){if(source.hasOwnProperty(nextKey)){output[nextKey]=source[nextKey];}}}}return output;};}else{assign=Object.assign;}var extend=deprecate(function extend(dest,src,merge){var keys=Object.keys(src);var i=0;while(i<keys.length){if(!merge||(merge&&dest[keys[i]]===undefined)){dest[keys[i]]=src[keys[i]];}i++;}return dest;},'extend','Use `assign`.');var merge=deprecate(function merge(dest,src){return extend(dest,src,true);},'merge','Use `assign`.');function inherit(child,base,properties){var baseP=base.prototype,childP;childP=child.prototype=Object.create(baseP);childP.constructor=child;childP._super=baseP;if(properties){assign(childP,properties);}}function bindFn(fn,context){return function boundFn(){return fn.apply(context,arguments);};}function boolOrFn(val,args){if(typeof val==TYPE_FUNCTION){return val.apply(args?args[0]||undefined:undefined,args);}return val;}function ifUndefined(val1,val2){return(val1===undefined)?val2:val1;}function addEventListeners(target,types,handler){each(splitStr(types),function(type){target.addEventListener(type,handler,false);});}function removeEventListeners(target,types,handler){each(splitStr(types),function(type){target.removeEventListener(type,handler,false);});}function hasParent(node,parent){while(node){if(node==parent){return true;}node=node.parentNode;}return false;}function inStr(str,find){return str.indexOf(find)>-1;}function splitStr(str){return str.trim().split(/\s+/g);}function inArray(src,find,findByKey){if(src.indexOf&&!findByKey){return src.indexOf(find);}else{var i=0;while(i<src.length){if((findByKey&&src[i][findByKey]==find)||(!findByKey&&src[i]===find)){return i;}i++;}return-1;}}function toArray(obj){return Array.prototype.slice.call(obj,0);}function uniqueArray(src,key,sort){var results=[];var values=[];var i=0;while(i<src.length){var val=key?src[i][key]:src[i];if(inArray(values,val)<0){results.push(src[i]);}values[i]=val;i++;}if(sort){if(!key){results=results.sort();}else{results=results.sort(function sortUniqueArray(a,b){return a[key]>b[key];});}}return results;}function prefixed(obj,property){var prefix,prop;var camelProp=property[0].toUpperCase()+property.slice(1);var i=0;while(i<VENDOR_PREFIXES.length){prefix=VENDOR_PREFIXES[i];prop=(prefix)?prefix+camelProp:property;if(prop in obj){return prop;}i++;}return undefined;}var _uniqueId=1;function uniqueId(){return _uniqueId++;}function getWindowForElement(element){var doc=element.ownerDocument||element;return(doc.defaultView||doc.parentWindow||window);}var MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i;var SUPPORT_TOUCH=('ontouchstart'in window);var SUPPORT_POINTER_EVENTS=prefixed(window,'PointerEvent')!==undefined;var SUPPORT_ONLY_TOUCH=SUPPORT_TOUCH&&MOBILE_REGEX.test(navigator.userAgent);var INPUT_TYPE_TOUCH='touch';var INPUT_TYPE_PEN='pen';var INPUT_TYPE_MOUSE='mouse';var INPUT_TYPE_KINECT='kinect';var COMPUTE_INTERVAL=25;var INPUT_START=1;var INPUT_MOVE=2;var INPUT_END=4;var INPUT_CANCEL=8;var DIRECTION_NONE=1;var DIRECTION_LEFT=2;var DIRECTION_RIGHT=4;var DIRECTION_UP=8;var DIRECTION_DOWN=16;var DIRECTION_HORIZONTAL=DIRECTION_LEFT|DIRECTION_RIGHT;var DIRECTION_VERTICAL=DIRECTION_UP|DIRECTION_DOWN;var DIRECTION_ALL=DIRECTION_HORIZONTAL|DIRECTION_VERTICAL;var PROPS_XY=['x','y'];var PROPS_CLIENT_XY=['clientX','clientY'];function Input(manager,callback){var self=this;this.manager=manager;this.callback=callback;this.element=manager.element;this.target=manager.options.inputTarget;this.domHandler=function(ev){if(boolOrFn(manager.options.enable,[manager])){self.handler(ev);}};this.init();}Input.prototype={handler:function(){},init:function(){this.evEl&&addEventListeners(this.element,this.evEl,this.domHandler);this.evTarget&&addEventListeners(this.target,this.evTarget,this.domHandler);this.evWin&&addEventListeners(getWindowForElement(this.element),this.evWin,this.domHandler);},destroy:function(){this.evEl&&removeEventListeners(this.element,this.evEl,this.domHandler);this.evTarget&&removeEventListeners(this.target,this.evTarget,this.domHandler);this.evWin&&removeEventListeners(getWindowForElement(this.element),this.evWin,this.domHandler);}};function createInputInstance(manager){var Type;var inputClass=manager.options.inputClass;if(inputClass){Type=inputClass;}else if(SUPPORT_POINTER_EVENTS){Type=PointerEventInput;}else if(SUPPORT_ONLY_TOUCH){Type=TouchInput;}else if(!SUPPORT_TOUCH){Type=MouseInput;}else{Type=TouchMouseInput;}return new(Type)(manager,inputHandler);}function inputHandler(manager,eventType,input){var pointersLen=input.pointers.length;var changedPointersLen=input.changedPointers.length;var isFirst=(eventType&INPUT_START&&(pointersLen-changedPointersLen===0));var isFinal=(eventType&(INPUT_END|INPUT_CANCEL)&&(pointersLen-changedPointersLen===0));input.isFirst=!!isFirst;input.isFinal=!!isFinal;if(isFirst){manager.session={};}input.eventType=eventType;computeInputData(manager,input);manager.emit('hammer.input',input);manager.recognize(input);manager.session.prevInput=input;}function computeInputData(manager,input){var session=manager.session;var pointers=input.pointers;var pointersLength=pointers.length;if(!session.firstInput){session.firstInput=simpleCloneInputData(input);}if(pointersLength>1&&!session.firstMultiple){session.firstMultiple=simpleCloneInputData(input);}else if(pointersLength===1){session.firstMultiple=false;}var firstInput=session.firstInput;var firstMultiple=session.firstMultiple;var offsetCenter=firstMultiple?firstMultiple.center:firstInput.center;var center=input.center=getCenter(pointers);input.timeStamp=now();input.deltaTime=input.timeStamp-firstInput.timeStamp;input.angle=getAngle(offsetCenter,center);input.distance=getDistance(offsetCenter,center);computeDeltaXY(session,input);input.offsetDirection=getDirection(input.deltaX,input.deltaY);var overallVelocity=getVelocity(input.deltaTime,input.deltaX,input.deltaY);input.overallVelocityX=overallVelocity.x;input.overallVelocityY=overallVelocity.y;input.overallVelocity=(abs(overallVelocity.x)>abs(overallVelocity.y))?overallVelocity.x:overallVelocity.y;input.scale=firstMultiple?getScale(firstMultiple.pointers,pointers):1;input.rotation=firstMultiple?getRotation(firstMultiple.pointers,pointers):0;input.maxPointers=!session.prevInput?input.pointers.length:((input.pointers.length>session.prevInput.maxPointers)?input.pointers.length:session.prevInput.maxPointers);computeIntervalInputData(session,input);var target=manager.element;if(hasParent(input.srcEvent.target,target)){target=input.srcEvent.target;}input.target=target;}function computeDeltaXY(session,input){var center=input.center;var offset=session.offsetDelta||{};var prevDelta=session.prevDelta||{};var prevInput=session.prevInput||{};if(input.eventType===INPUT_START||prevInput.eventType===INPUT_END){prevDelta=session.prevDelta={x:prevInput.deltaX||0,y:prevInput.deltaY||0};offset=session.offsetDelta={x:center.x,y:center.y};}input.deltaX=prevDelta.x+(center.x-offset.x);input.deltaY=prevDelta.y+(center.y-offset.y);}function computeIntervalInputData(session,input){var last=session.lastInterval||input,deltaTime=input.timeStamp-last.timeStamp,velocity,velocityX,velocityY,direction;if(input.eventType!=INPUT_CANCEL&&(deltaTime>COMPUTE_INTERVAL||last.velocity===undefined)){var deltaX=input.deltaX-last.deltaX;var deltaY=input.deltaY-last.deltaY;var v=getVelocity(deltaTime,deltaX,deltaY);velocityX=v.x;velocityY=v.y;velocity=(abs(v.x)>abs(v.y))?v.x:v.y;direction=getDirection(deltaX,deltaY);session.lastInterval=input;}else{velocity=last.velocity;velocityX=last.velocityX;velocityY=last.velocityY;direction=last.direction;}input.velocity=velocity;input.velocityX=velocityX;input.velocityY=velocityY;input.direction=direction;}function simpleCloneInputData(input){var pointers=[];var i=0;while(i<input.pointers.length){pointers[i]={clientX:round(input.pointers[i].clientX),clientY:round(input.pointers[i].clientY)};i++;}return{timeStamp:now(),pointers:pointers,center:getCenter(pointers),deltaX:input.deltaX,deltaY:input.deltaY};}function getCenter(pointers){var pointersLength=pointers.length;if(pointersLength===1){return{x:round(pointers[0].clientX),y:round(pointers[0].clientY)};}var x=0,y=0,i=0;while(i<pointersLength){x+=pointers[i].clientX;y+=pointers[i].clientY;i++;}return{x:round(x/pointersLength),y:round(y/pointersLength)};}function getVelocity(deltaTime,x,y){return{x:x/deltaTime||0,y:y/deltaTime||0};}function getDirection(x,y){if(x===y){return DIRECTION_NONE;}if(abs(x)>=abs(y)){return x<0?DIRECTION_LEFT:DIRECTION_RIGHT;}return y<0?DIRECTION_UP:DIRECTION_DOWN;}function getDistance(p1,p2,props){if(!props){props=PROPS_XY;}var x=p2[props[0]]-p1[props[0]],y=p2[props[1]]-p1[props[1]];return Math.sqrt((x*x)+(y*y));}function getAngle(p1,p2,props){if(!props){props=PROPS_XY;}var x=p2[props[0]]-p1[props[0]],y=p2[props[1]]-p1[props[1]];return Math.atan2(y,x)*180/Math.PI;}function getRotation(start,end){return getAngle(end[1],end[0],PROPS_CLIENT_XY)+getAngle(start[1],start[0],PROPS_CLIENT_XY);}function getScale(start,end){return getDistance(end[0],end[1],PROPS_CLIENT_XY)/getDistance(start[0],start[1],PROPS_CLIENT_XY);}var MOUSE_INPUT_MAP={mousedown:INPUT_START,mousemove:INPUT_MOVE,mouseup:INPUT_END};var MOUSE_ELEMENT_EVENTS='mousedown';var MOUSE_WINDOW_EVENTS='mousemove mouseup';function MouseInput(){this.evEl=MOUSE_ELEMENT_EVENTS;this.evWin=MOUSE_WINDOW_EVENTS;this.pressed=false;Input.apply(this,arguments);}inherit(MouseInput,Input,{handler:function MEhandler(ev){var eventType=MOUSE_INPUT_MAP[ev.type];if(eventType&INPUT_START&&ev.button===0){this.pressed=true;}if(eventType&INPUT_MOVE&&ev.which!==1){eventType=INPUT_END;}if(!this.pressed){return;}if(eventType&INPUT_END){this.pressed=false;}this.callback(this.manager,eventType,{pointers:[ev],changedPointers:[ev],pointerType:INPUT_TYPE_MOUSE,srcEvent:ev});}});var POINTER_INPUT_MAP={pointerdown:INPUT_START,pointermove:INPUT_MOVE,pointerup:INPUT_END,pointercancel:INPUT_CANCEL,pointerout:INPUT_CANCEL};var IE10_POINTER_TYPE_ENUM={2:INPUT_TYPE_TOUCH,3:INPUT_TYPE_PEN,4:INPUT_TYPE_MOUSE,5:INPUT_TYPE_KINECT};var POINTER_ELEMENT_EVENTS='pointerdown';var POINTER_WINDOW_EVENTS='pointermove pointerup pointercancel';if(window.MSPointerEvent&&!window.PointerEvent){POINTER_ELEMENT_EVENTS='MSPointerDown';POINTER_WINDOW_EVENTS='MSPointerMove MSPointerUp MSPointerCancel';}function PointerEventInput(){this.evEl=POINTER_ELEMENT_EVENTS;this.evWin=POINTER_WINDOW_EVENTS;Input.apply(this,arguments);this.store=(this.manager.session.pointerEvents=[]);}inherit(PointerEventInput,Input,{handler:function PEhandler(ev){var store=this.store;var removePointer=false;var eventTypeNormalized=ev.type.toLowerCase().replace('ms','');var eventType=POINTER_INPUT_MAP[eventTypeNormalized];var pointerType=IE10_POINTER_TYPE_ENUM[ev.pointerType]||ev.pointerType;var isTouch=(pointerType==INPUT_TYPE_TOUCH);var storeIndex=inArray(store,ev.pointerId,'pointerId');if(eventType&INPUT_START&&(ev.button===0||isTouch)){if(storeIndex<0){store.push(ev);storeIndex=store.length-1;}}else if(eventType&(INPUT_END|INPUT_CANCEL)){removePointer=true;}if(storeIndex<0){return;}store[storeIndex]=ev;this.callback(this.manager,eventType,{pointers:store,changedPointers:[ev],pointerType:pointerType,srcEvent:ev});if(removePointer){store.splice(storeIndex,1);}}});var SINGLE_TOUCH_INPUT_MAP={touchstart:INPUT_START,touchmove:INPUT_MOVE,touchend:INPUT_END,touchcancel:INPUT_CANCEL};var SINGLE_TOUCH_TARGET_EVENTS='touchstart';var SINGLE_TOUCH_WINDOW_EVENTS='touchstart touchmove touchend touchcancel';function SingleTouchInput(){this.evTarget=SINGLE_TOUCH_TARGET_EVENTS;this.evWin=SINGLE_TOUCH_WINDOW_EVENTS;this.started=false;Input.apply(this,arguments);}inherit(SingleTouchInput,Input,{handler:function TEhandler(ev){var type=SINGLE_TOUCH_INPUT_MAP[ev.type];if(type===INPUT_START){this.started=true;}if(!this.started){return;}var touches=normalizeSingleTouches.call(this,ev,type);if(type&(INPUT_END|INPUT_CANCEL)&&touches[0].length-touches[1].length===0){this.started=false;}this.callback(this.manager,type,{pointers:touches[0],changedPointers:touches[1],pointerType:INPUT_TYPE_TOUCH,srcEvent:ev});}});function normalizeSingleTouches(ev,type){var all=toArray(ev.touches);var changed=toArray(ev.changedTouches);if(type&(INPUT_END|INPUT_CANCEL)){all=uniqueArray(all.concat(changed),'identifier',true);}return[all,changed];}var TOUCH_INPUT_MAP={touchstart:INPUT_START,touchmove:INPUT_MOVE,touchend:INPUT_END,touchcancel:INPUT_CANCEL};var TOUCH_TARGET_EVENTS='touchstart touchmove touchend touchcancel';function TouchInput(){this.evTarget=TOUCH_TARGET_EVENTS;this.targetIds={};Input.apply(this,arguments);}inherit(TouchInput,Input,{handler:function MTEhandler(ev){var type=TOUCH_INPUT_MAP[ev.type];var touches=getTouches.call(this,ev,type);if(!touches){return;}this.callback(this.manager,type,{pointers:touches[0],changedPointers:touches[1],pointerType:INPUT_TYPE_TOUCH,srcEvent:ev});}});function getTouches(ev,type){var allTouches=toArray(ev.touches);var targetIds=this.targetIds;if(type&(INPUT_START|INPUT_MOVE)&&allTouches.length===1){targetIds[allTouches[0].identifier]=true;return[allTouches,allTouches];}var i,targetTouches,changedTouches=toArray(ev.changedTouches),changedTargetTouches=[],target=this.target;targetTouches=allTouches.filter(function(touch){return hasParent(touch.target,target);});if(type===INPUT_START){i=0;while(i<targetTouches.length){targetIds[targetTouches[i].identifier]=true;i++;}}i=0;while(i<changedTouches.length){if(targetIds[changedTouches[i].identifier]){changedTargetTouches.push(changedTouches[i]);}if(type&(INPUT_END|INPUT_CANCEL)){delete targetIds[changedTouches[i].identifier];}i++;}if(!changedTargetTouches.length){return;}return[uniqueArray(targetTouches.concat(changedTargetTouches),'identifier',true),changedTargetTouches];}var DEDUP_TIMEOUT=2500;var DEDUP_DISTANCE=25;function TouchMouseInput(){Input.apply(this,arguments);var handler=bindFn(this.handler,this);this.touch=new TouchInput(this.manager,handler);this.mouse=new MouseInput(this.manager,handler);this.primaryTouch=null;this.lastTouches=[];}inherit(TouchMouseInput,Input,{handler:function TMEhandler(manager,inputEvent,inputData){var isTouch=(inputData.pointerType==INPUT_TYPE_TOUCH),isMouse=(inputData.pointerType==INPUT_TYPE_MOUSE);if(isMouse&&inputData.sourceCapabilities&&inputData.sourceCapabilities.firesTouchEvents){return;}if(isTouch){recordTouches.call(this,inputEvent,inputData);}else if(isMouse&&isSyntheticEvent.call(this,inputData)){return;}this.callback(manager,inputEvent,inputData);},destroy:function destroy(){this.touch.destroy();this.mouse.destroy();}});function recordTouches(eventType,eventData){if(eventType&INPUT_START){this.primaryTouch=eventData.changedPointers[0].identifier;setLastTouch.call(this,eventData);}else if(eventType&(INPUT_END|INPUT_CANCEL)){setLastTouch.call(this,eventData);}}function setLastTouch(eventData){var touch=eventData.changedPointers[0];if(touch.identifier===this.primaryTouch){var lastTouch={x:touch.clientX,y:touch.clientY};this.lastTouches.push(lastTouch);var lts=this.lastTouches;var removeLastTouch=function(){var i=lts.indexOf(lastTouch);if(i>-1){lts.splice(i,1);}};setTimeout(removeLastTouch,DEDUP_TIMEOUT);}}function isSyntheticEvent(eventData){var x=eventData.srcEvent.clientX,y=eventData.srcEvent.clientY;for(var i=0;i<this.lastTouches.length;i++){var t=this.lastTouches[i];var dx=Math.abs(x-t.x),dy=Math.abs(y-t.y);if(dx<=DEDUP_DISTANCE&&dy<=DEDUP_DISTANCE){return true;}}return false;}var PREFIXED_TOUCH_ACTION=prefixed(TEST_ELEMENT.style,'touchAction');var NATIVE_TOUCH_ACTION=PREFIXED_TOUCH_ACTION!==undefined;var TOUCH_ACTION_COMPUTE='compute';var TOUCH_ACTION_AUTO='auto';var TOUCH_ACTION_MANIPULATION='manipulation';var TOUCH_ACTION_NONE='none';var TOUCH_ACTION_PAN_X='pan-x';var TOUCH_ACTION_PAN_Y='pan-y';var TOUCH_ACTION_MAP=getTouchActionProps();function TouchAction(manager,value){this.manager=manager;this.set(value);}TouchAction.prototype={set:function(value){if(value==TOUCH_ACTION_COMPUTE){value=this.compute();}if(NATIVE_TOUCH_ACTION&&this.manager.element.style&&TOUCH_ACTION_MAP[value]){this.manager.element.style[PREFIXED_TOUCH_ACTION]=value;}this.actions=value.toLowerCase().trim();},update:function(){this.set(this.manager.options.touchAction);},compute:function(){var actions=[];each(this.manager.recognizers,function(recognizer){if(boolOrFn(recognizer.options.enable,[recognizer])){actions=actions.concat(recognizer.getTouchAction());}});return cleanTouchActions(actions.join(' '));},preventDefaults:function(input){var srcEvent=input.srcEvent;var direction=input.offsetDirection;if(this.manager.session.prevented){srcEvent.preventDefault();return;}var actions=this.actions;var hasNone=inStr(actions,TOUCH_ACTION_NONE)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_NONE];var hasPanY=inStr(actions,TOUCH_ACTION_PAN_Y)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_Y];var hasPanX=inStr(actions,TOUCH_ACTION_PAN_X)&&!TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_X];if(hasNone){var isTapPointer=input.pointers.length===1;var isTapMovement=input.distance<2;var isTapTouchTime=input.deltaTime<250;if(isTapPointer&&isTapMovement&&isTapTouchTime){return;}}if(hasPanX&&hasPanY){return;}if(hasNone||(hasPanY&&direction&DIRECTION_HORIZONTAL)||(hasPanX&&direction&DIRECTION_VERTICAL)){return this.preventSrc(srcEvent);}},preventSrc:function(srcEvent){this.manager.session.prevented=true;srcEvent.preventDefault();}};function cleanTouchActions(actions){if(inStr(actions,TOUCH_ACTION_NONE)){return TOUCH_ACTION_NONE;}var hasPanX=inStr(actions,TOUCH_ACTION_PAN_X);var hasPanY=inStr(actions,TOUCH_ACTION_PAN_Y);if(hasPanX&&hasPanY){return TOUCH_ACTION_NONE;}if(hasPanX||hasPanY){return hasPanX?TOUCH_ACTION_PAN_X:TOUCH_ACTION_PAN_Y;}if(inStr(actions,TOUCH_ACTION_MANIPULATION)){return TOUCH_ACTION_MANIPULATION;}return TOUCH_ACTION_AUTO;}function getTouchActionProps(){if(!NATIVE_TOUCH_ACTION){return false;}var touchMap={};var cssSupports=window.CSS&&window.CSS.supports;['auto','manipulation','pan-y','pan-x','pan-x pan-y','none'].forEach(function(val){touchMap[val]=cssSupports?window.CSS.supports('touch-action',val):true;});return touchMap;}var STATE_POSSIBLE=1;var STATE_BEGAN=2;var STATE_CHANGED=4;var STATE_ENDED=8;var STATE_RECOGNIZED=STATE_ENDED;var STATE_CANCELLED=16;var STATE_FAILED=32;function Recognizer(options){this.options=assign({},this.defaults,options||{});this.id=uniqueId();this.manager=null;this.options.enable=ifUndefined(this.options.enable,true);this.state=STATE_POSSIBLE;this.simultaneous={};this.requireFail=[];}Recognizer.prototype={defaults:{},set:function(options){assign(this.options,options);this.manager&&this.manager.touchAction.update();return this;},recognizeWith:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,'recognizeWith',this)){return this;}var simultaneous=this.simultaneous;otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this);if(!simultaneous[otherRecognizer.id]){simultaneous[otherRecognizer.id]=otherRecognizer;otherRecognizer.recognizeWith(this);}return this;},dropRecognizeWith:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,'dropRecognizeWith',this)){return this;}otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this);delete this.simultaneous[otherRecognizer.id];return this;},requireFailure:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,'requireFailure',this)){return this;}var requireFail=this.requireFail;otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this);if(inArray(requireFail,otherRecognizer)===-1){requireFail.push(otherRecognizer);otherRecognizer.requireFailure(this);}return this;},dropRequireFailure:function(otherRecognizer){if(invokeArrayArg(otherRecognizer,'dropRequireFailure',this)){return this;}otherRecognizer=getRecognizerByNameIfManager(otherRecognizer,this);var index=inArray(this.requireFail,otherRecognizer);if(index>-1){this.requireFail.splice(index,1);}return this;},hasRequireFailures:function(){return this.requireFail.length>0;},canRecognizeWith:function(otherRecognizer){return!!this.simultaneous[otherRecognizer.id];},emit:function(input){var self=this;var state=this.state;function emit(event){self.manager.emit(event,input);}if(state<STATE_ENDED){emit(self.options.event+stateStr(state));}emit(self.options.event);if(input.additionalEvent){emit(input.additionalEvent);}if(state>=STATE_ENDED){emit(self.options.event+stateStr(state));}},tryEmit:function(input){if(this.canEmit()){return this.emit(input);}this.state=STATE_FAILED;},canEmit:function(){var i=0;while(i<this.requireFail.length){if(!(this.requireFail[i].state&(STATE_FAILED|STATE_POSSIBLE))){return false;}i++;}return true;},recognize:function(inputData){var inputDataClone=assign({},inputData);if(!boolOrFn(this.options.enable,[this,inputDataClone])){this.reset();this.state=STATE_FAILED;return;}if(this.state&(STATE_RECOGNIZED|STATE_CANCELLED|STATE_FAILED)){this.state=STATE_POSSIBLE;}this.state=this.process(inputDataClone);if(this.state&(STATE_BEGAN|STATE_CHANGED|STATE_ENDED|STATE_CANCELLED)){this.tryEmit(inputDataClone);}},process:function(inputData){},getTouchAction:function(){},reset:function(){}};function stateStr(state){if(state&STATE_CANCELLED){return'cancel';}else if(state&STATE_ENDED){return'end';}else if(state&STATE_CHANGED){return'move';}else if(state&STATE_BEGAN){return'start';}return'';}function directionStr(direction){if(direction==DIRECTION_DOWN){return'down';}else if(direction==DIRECTION_UP){return'up';}else if(direction==DIRECTION_LEFT){return'left';}else if(direction==DIRECTION_RIGHT){return'right';}return'';}function getRecognizerByNameIfManager(otherRecognizer,recognizer){var manager=recognizer.manager;if(manager){return manager.get(otherRecognizer);}return otherRecognizer;}function AttrRecognizer(){Recognizer.apply(this,arguments);}inherit(AttrRecognizer,Recognizer,{defaults:{pointers:1},attrTest:function(input){var optionPointers=this.options.pointers;return optionPointers===0||input.pointers.length===optionPointers;},process:function(input){var state=this.state;var eventType=input.eventType;var isRecognized=state&(STATE_BEGAN|STATE_CHANGED);var isValid=this.attrTest(input);if(isRecognized&&(eventType&INPUT_CANCEL||!isValid)){return state|STATE_CANCELLED;}else if(isRecognized||isValid){if(eventType&INPUT_END){return state|STATE_ENDED;}else if(!(state&STATE_BEGAN)){return STATE_BEGAN;}return state|STATE_CHANGED;}return STATE_FAILED;}});function PanRecognizer(){AttrRecognizer.apply(this,arguments);this.pX=null;this.pY=null;}inherit(PanRecognizer,AttrRecognizer,{defaults:{event:'pan',threshold:10,pointers:1,direction:DIRECTION_ALL},getTouchAction:function(){var direction=this.options.direction;var actions=[];if(direction&DIRECTION_HORIZONTAL){actions.push(TOUCH_ACTION_PAN_Y);}if(direction&DIRECTION_VERTICAL){actions.push(TOUCH_ACTION_PAN_X);}return actions;},directionTest:function(input){var options=this.options;var hasMoved=true;var distance=input.distance;var direction=input.direction;var x=input.deltaX;var y=input.deltaY;if(!(direction&options.direction)){if(options.direction&DIRECTION_HORIZONTAL){direction=(x===0)?DIRECTION_NONE:(x<0)?DIRECTION_LEFT:DIRECTION_RIGHT;hasMoved=x!=this.pX;distance=Math.abs(input.deltaX);}else{direction=(y===0)?DIRECTION_NONE:(y<0)?DIRECTION_UP:DIRECTION_DOWN;hasMoved=y!=this.pY;distance=Math.abs(input.deltaY);}}input.direction=direction;return hasMoved&&distance>options.threshold&&direction&options.direction;},attrTest:function(input){return AttrRecognizer.prototype.attrTest.call(this,input)&&(this.state&STATE_BEGAN||(!(this.state&STATE_BEGAN)&&this.directionTest(input)));},emit:function(input){this.pX=input.deltaX;this.pY=input.deltaY;var direction=directionStr(input.direction);if(direction){input.additionalEvent=this.options.event+direction;}this._super.emit.call(this,input);}});function PinchRecognizer(){AttrRecognizer.apply(this,arguments);}inherit(PinchRecognizer,AttrRecognizer,{defaults:{event:'pinch',threshold:0,pointers:2},getTouchAction:function(){return[TOUCH_ACTION_NONE];},attrTest:function(input){return this._super.attrTest.call(this,input)&&(Math.abs(input.scale-1)>this.options.threshold||this.state&STATE_BEGAN);},emit:function(input){if(input.scale!==1){var inOut=input.scale<1?'in':'out';input.additionalEvent=this.options.event+inOut;}this._super.emit.call(this,input);}});function PressRecognizer(){Recognizer.apply(this,arguments);this._timer=null;this._input=null;}inherit(PressRecognizer,Recognizer,{defaults:{event:'press',pointers:1,time:251,threshold:9},getTouchAction:function(){return[TOUCH_ACTION_AUTO];},process:function(input){var options=this.options;var validPointers=input.pointers.length===options.pointers;var validMovement=input.distance<options.threshold;var validTime=input.deltaTime>options.time;this._input=input;if(!validMovement||!validPointers||(input.eventType&(INPUT_END|INPUT_CANCEL)&&!validTime)){this.reset();}else if(input.eventType&INPUT_START){this.reset();this._timer=setTimeoutContext(function(){this.state=STATE_RECOGNIZED;this.tryEmit();},options.time,this);}else if(input.eventType&INPUT_END){return STATE_RECOGNIZED;}return STATE_FAILED;},reset:function(){clearTimeout(this._timer);},emit:function(input){if(this.state!==STATE_RECOGNIZED){return;}if(input&&(input.eventType&INPUT_END)){this.manager.emit(this.options.event+'up',input);}else{this._input.timeStamp=now();this.manager.emit(this.options.event,this._input);}}});function RotateRecognizer(){AttrRecognizer.apply(this,arguments);}inherit(RotateRecognizer,AttrRecognizer,{defaults:{event:'rotate',threshold:0,pointers:2},getTouchAction:function(){return[TOUCH_ACTION_NONE];},attrTest:function(input){return this._super.attrTest.call(this,input)&&(Math.abs(input.rotation)>this.options.threshold||this.state&STATE_BEGAN);}});function SwipeRecognizer(){AttrRecognizer.apply(this,arguments);}inherit(SwipeRecognizer,AttrRecognizer,{defaults:{event:'swipe',threshold:10,velocity:0.3,direction:DIRECTION_HORIZONTAL|DIRECTION_VERTICAL,pointers:1},getTouchAction:function(){return PanRecognizer.prototype.getTouchAction.call(this);},attrTest:function(input){var direction=this.options.direction;var velocity;if(direction&(DIRECTION_HORIZONTAL|DIRECTION_VERTICAL)){velocity=input.overallVelocity;}else if(direction&DIRECTION_HORIZONTAL){velocity=input.overallVelocityX;}else if(direction&DIRECTION_VERTICAL){velocity=input.overallVelocityY;}return this._super.attrTest.call(this,input)&&direction&input.offsetDirection&&input.distance>this.options.threshold&&input.maxPointers==this.options.pointers&&abs(velocity)>this.options.velocity&&input.eventType&INPUT_END;},emit:function(input){var direction=directionStr(input.offsetDirection);if(direction){this.manager.emit(this.options.event+direction,input);}this.manager.emit(this.options.event,input);}});function TapRecognizer(){Recognizer.apply(this,arguments);this.pTime=false;this.pCenter=false;this._timer=null;this._input=null;this.count=0;}inherit(TapRecognizer,Recognizer,{defaults:{event:'tap',pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[TOUCH_ACTION_MANIPULATION];},process:function(input){var options=this.options;var validPointers=input.pointers.length===options.pointers;var validMovement=input.distance<options.threshold;var validTouchTime=input.deltaTime<options.time;this.reset();if((input.eventType&INPUT_START)&&(this.count===0)){return this.failTimeout();}if(validMovement&&validTouchTime&&validPointers){if(input.eventType!=INPUT_END){return this.failTimeout();}var validInterval=this.pTime?(input.timeStamp-this.pTime<options.interval):true;var validMultiTap=!this.pCenter||getDistance(this.pCenter,input.center)<options.posThreshold;this.pTime=input.timeStamp;this.pCenter=input.center;if(!validMultiTap||!validInterval){this.count=1;}else{this.count+=1;}this._input=input;var tapCount=this.count%options.taps;if(tapCount===0){if(!this.hasRequireFailures()){return STATE_RECOGNIZED;}else{this._timer=setTimeoutContext(function(){this.state=STATE_RECOGNIZED;this.tryEmit();},options.interval,this);return STATE_BEGAN;}}}return STATE_FAILED;},failTimeout:function(){this._timer=setTimeoutContext(function(){this.state=STATE_FAILED;},this.options.interval,this);return STATE_FAILED;},reset:function(){clearTimeout(this._timer);},emit:function(){if(this.state==STATE_RECOGNIZED){this._input.tapCount=this.count;this.manager.emit(this.options.event,this._input);}}});function Hammer(element,options){options=options||{};options.recognizers=ifUndefined(options.recognizers,Hammer.defaults.preset);return new Manager(element,options);}Hammer.VERSION='2.0.7';Hammer.defaults={domEvents:false,touchAction:TOUCH_ACTION_COMPUTE,enable:true,inputTarget:null,inputClass:null,preset:[[RotateRecognizer,{enable:false}],[PinchRecognizer,{enable:false},['rotate']],[SwipeRecognizer,{direction:DIRECTION_HORIZONTAL}],[PanRecognizer,{direction:DIRECTION_HORIZONTAL},['swipe']],[TapRecognizer],[TapRecognizer,{event:'doubletap',taps:2},['tap']],[PressRecognizer]],cssProps:{userSelect:'none',touchSelect:'none',touchCallout:'none',contentZooming:'none',userDrag:'none',tapHighlightColor:'rgba(0,0,0,0)'}};var STOP=1;var FORCED_STOP=2;function Manager(element,options){this.options=assign({},Hammer.defaults,options||{});this.options.inputTarget=this.options.inputTarget||element;this.handlers={};this.session={};this.recognizers=[];this.oldCssProps={};this.element=element;this.input=createInputInstance(this);this.touchAction=new TouchAction(this,this.options.touchAction);toggleCssProps(this,true);each(this.options.recognizers,function(item){var recognizer=this.add(new(item[0])(item[1]));item[2]&&recognizer.recognizeWith(item[2]);item[3]&&recognizer.requireFailure(item[3]);},this);}Manager.prototype={set:function(options){assign(this.options,options);if(options.touchAction){this.touchAction.update();}if(options.inputTarget){this.input.destroy();this.input.target=options.inputTarget;this.input.init();}return this;},stop:function(force){this.session.stopped=force?FORCED_STOP:STOP;},recognize:function(inputData){var session=this.session;if(session.stopped){return;}this.touchAction.preventDefaults(inputData);var recognizer;var recognizers=this.recognizers;var curRecognizer=session.curRecognizer;if(!curRecognizer||(curRecognizer&&curRecognizer.state&STATE_RECOGNIZED)){curRecognizer=session.curRecognizer=null;}var i=0;while(i<recognizers.length){recognizer=recognizers[i];if(session.stopped!==FORCED_STOP&&(!curRecognizer||recognizer==curRecognizer||recognizer.canRecognizeWith(curRecognizer))){recognizer.recognize(inputData);}else{recognizer.reset();}if(!curRecognizer&&recognizer.state&(STATE_BEGAN|STATE_CHANGED|STATE_ENDED)){curRecognizer=session.curRecognizer=recognizer;}i++;}},get:function(recognizer){if(recognizer instanceof Recognizer){return recognizer;}var recognizers=this.recognizers;for(var i=0;i<recognizers.length;i++){if(recognizers[i].options.event==recognizer){return recognizers[i];}}return null;},add:function(recognizer){if(invokeArrayArg(recognizer,'add',this)){return this;}var existing=this.get(recognizer.options.event);if(existing){this.remove(existing);}this.recognizers.push(recognizer);recognizer.manager=this;this.touchAction.update();return recognizer;},remove:function(recognizer){if(invokeArrayArg(recognizer,'remove',this)){return this;}recognizer=this.get(recognizer);if(recognizer){var recognizers=this.recognizers;var index=inArray(recognizers,recognizer);if(index!==-1){recognizers.splice(index,1);this.touchAction.update();}}return this;},on:function(events,handler){if(events===undefined){return;}if(handler===undefined){return;}var handlers=this.handlers;each(splitStr(events),function(event){handlers[event]=handlers[event]||[];handlers[event].push(handler);});return this;},off:function(events,handler){if(events===undefined){return;}var handlers=this.handlers;each(splitStr(events),function(event){if(!handler){delete handlers[event];}else{handlers[event]&&handlers[event].splice(inArray(handlers[event],handler),1);}});return this;},emit:function(event,data){if(this.options.domEvents){triggerDomEvent(event,data);}var handlers=this.handlers[event]&&this.handlers[event].slice();if(!handlers||!handlers.length){return;}data.type=event;data.preventDefault=function(){data.srcEvent.preventDefault();};var i=0;while(i<handlers.length){handlers[i](data);i++;}},destroy:function(){this.element&&toggleCssProps(this,false);this.handlers={};this.session={};this.input.destroy();this.element=null;}};function toggleCssProps(manager,add){var element=manager.element;if(!element.style){return;}var prop;each(manager.options.cssProps,function(value,name){prop=prefixed(element.style,name);if(add){manager.oldCssProps[prop]=element.style[prop];element.style[prop]=value;}else{element.style[prop]=manager.oldCssProps[prop]||'';}});if(!add){manager.oldCssProps={};}}function triggerDomEvent(event,data){var gestureEvent=document.createEvent('Event');gestureEvent.initEvent(event,true,true);gestureEvent.gesture=data;data.target.dispatchEvent(gestureEvent);}assign(Hammer,{INPUT_START:INPUT_START,INPUT_MOVE:INPUT_MOVE,INPUT_END:INPUT_END,INPUT_CANCEL:INPUT_CANCEL,STATE_POSSIBLE:STATE_POSSIBLE,STATE_BEGAN:STATE_BEGAN,STATE_CHANGED:STATE_CHANGED,STATE_ENDED:STATE_ENDED,STATE_RECOGNIZED:STATE_RECOGNIZED,STATE_CANCELLED:STATE_CANCELLED,STATE_FAILED:STATE_FAILED,DIRECTION_NONE:DIRECTION_NONE,DIRECTION_LEFT:DIRECTION_LEFT,DIRECTION_RIGHT:DIRECTION_RIGHT,DIRECTION_UP:DIRECTION_UP,DIRECTION_DOWN:DIRECTION_DOWN,DIRECTION_HORIZONTAL:DIRECTION_HORIZONTAL,DIRECTION_VERTICAL:DIRECTION_VERTICAL,DIRECTION_ALL:DIRECTION_ALL,Manager:Manager,Input:Input,TouchAction:TouchAction,TouchInput:TouchInput,MouseInput:MouseInput,PointerEventInput:PointerEventInput,TouchMouseInput:TouchMouseInput,SingleTouchInput:SingleTouchInput,Recognizer:Recognizer,AttrRecognizer:AttrRecognizer,Tap:TapRecognizer,Pan:PanRecognizer,Swipe:SwipeRecognizer,Pinch:PinchRecognizer,Rotate:RotateRecognizer,Press:PressRecognizer,on:addEventListeners,off:removeEventListeners,each:each,merge:merge,extend:extend,assign:assign,inherit:inherit,bindFn:bindFn,prefixed:prefixed});var freeGlobal=(typeof window!=='undefined'?window:(typeof self!=='undefined'?self:{}));freeGlobal.Hammer=Hammer;if(typeof define==='function'&&define.amd){define(function(){return Hammer;});}else if(typeof module!='undefined'&&module.exports){module.exports=Hammer;}else{window[exportName]=Hammer;}})(window,document,'Hammer');},{}],395:[function(require,module,exports){var hat=module.exports=function(bits,base){if(!base)base=16;if(bits===undefined)bits=128;if(bits<=0)return'0';var digits=Math.log(Math.pow(2,bits))/Math.log(base);for(var i=2;digits===Infinity;i*=2){digits=Math.log(Math.pow(2,bits/i))/Math.log(base)*i;}var rem=digits-Math.floor(digits);var res='';for(var i=0;i<Math.floor(digits);i++){var x=Math.floor(Math.random()*base).toString(base);res=x+res;}if(rem){var b=Math.pow(base,rem);var x=Math.floor(Math.random()*b).toString(base);res=x+res;}var parsed=parseInt(res,base);if(parsed!==Infinity&&parsed>=Math.pow(2,bits)){return hat(bits,base)}else return res;};hat.rack=function(bits,base,expandBy){var fn=function(data){var iters=0;do{if(iters++>10){if(expandBy)bits+=expandBy;else throw new Error('too many ID collisions, use more bits')}var id=hat(bits,base);}while(Object.hasOwnProperty.call(hats,id));hats[id]=data;return id;};var hats=fn.hats={};fn.get=function(id){return fn.hats[id];};fn.set=function(id,value){fn.hats[id]=value;return fn;};fn.bits=bits||128;fn.base=base||16;return fn;};},{}],396:[function(require,module,exports){'use strict';var hat=require('hat');function Ids(seed){if(!(this instanceof Ids)){return new Ids(seed);}seed=seed||[128,36,1];this._seed=seed.length?hat.rack(seed[0],seed[1],seed[2]):seed;}module.exports=Ids;Ids.prototype.next=function(element){return this._seed(element||true);};Ids.prototype.nextPrefixed=function(prefix,element){var id;do{id=prefix+this.next(true);}while(this.assigned(id));this.claim(id,element);return id;};Ids.prototype.claim=function(id,element){this._seed.set(id,element||true);};Ids.prototype.assigned=function(id){return this._seed.get(id)||false;};Ids.prototype.unclaim=function(id){delete this._seed.hats[id];};Ids.prototype.clear=function(){var hats=this._seed.hats,id;for(id in hats){this.unclaim(id);}};},{"hat":395}],397:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?(nBytes-1):0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&((1<<(-nBits))-1);s>>=(-nBits);nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&((1<<(-nBits))-1);e>>=(-nBits);nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias;}else if(e===eMax){return m?NaN:((s?-1:1)*Infinity);}else{m=m+Math.pow(2,mLen);e=e-eBias;}return(s?-1:1)*m*Math.pow(2,e-mLen);};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=(mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0);var i=isLE?0:(nBytes-1);var d=isLE?1:-1;var s=value<0||(value===0&&1/value<0)?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax;}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2;}if(e+eBias>=1){value+=rt/c;}else{value+=rt*Math.pow(2,1-eBias);}if(value*c>=2){e++;c/=2;}if(e+eBias>=eMax){m=0;e=eMax;}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias;}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0;}}for(;mLen>=8;buffer[offset+i]=m&0xff,i+=d,m/=256,mLen-=8){}e=(e<<mLen)|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&0xff,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128;};},{}],398:[function(require,module,exports){if(typeof Object.create==='function'){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor
ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}});};}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor();ctor.prototype.constructor=ctor;};}},{}],399:[function(require,module,exports){/*!
  Determine if an object is a Buffer
 
  @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
  @license  MIT
 */module.exports=function(obj){return obj!=null&&(isBuffer(obj)||isSlowBuffer(obj)||!!obj._isBuffer);};function isBuffer(obj){return!!obj.constructor&&typeof obj.constructor.isBuffer==='function'&&obj.constructor.isBuffer(obj);}function isSlowBuffer(obj){return typeof obj.readFloatLE==='function'&&typeof obj.slice==='function'&&isBuffer(obj.slice(0,0));}},{}],400:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return toString.call(arr)=='[object Array]';};},{}],401:[function(require,module,exports){/*!
  jQuery JavaScript Library v2.2.4
  http://jquery.com/
 
  Includes Sizzle.js
  http://sizzlejs.com/
 
  Copyright jQuery Foundation and other contributors
  Released under the MIT license
  http://jquery.org/license
 
  Date: 2016-05-20T17:23Z
 */(function(global,factory){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=global.document?factory(global,true):function(w){if(!w.document){throw new Error("jQuery requires a window with a document");}return factory(w);};}else{factory(global);}}(typeof window!=="undefined"?window:this,function(window,noGlobal){var arr=[];var document=window.document;var slice=arr.slice;var concat=arr.concat;var push=arr.push;var indexOf=arr.indexOf;var class2type={};var toString=class2type.toString;var hasOwn=class2type.hasOwnProperty;var support={};var
version="2.2.4",jQuery=function(selector,context){return new jQuery.fn.init(selector,context);},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase();};jQuery.fn=jQuery.prototype={jquery:version,constructor:jQuery,selector:"",length:0,toArray:function(){return slice.call(this);},get:function(num){return num!=null?(num<0?this[num+this.length]:this[num]):slice.call(this);},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;return ret;},each:function(callback){return jQuery.each(this,callback);},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem);}));},slice:function(){return this.pushStack(slice.apply(this,arguments));},first:function(){return this.eq(0);},last:function(){return this.eq(-1);},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[]);},end:function(){return this.prevObject||this.constructor();},push:push,sort:arr.sort,splice:arr.splice};jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[i]||{};i++;}if(typeof target!=="object"&&!jQuery.isFunction(target)){target={};}if(i===length){target=this;i--;}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue;}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[];}else{clone=src&&jQuery.isPlainObject(src)?src:{};}target[name]=jQuery.extend(deep,clone,copy);}else if(copy!==undefined){target[name]=copy;}}}}return target;};jQuery.extend({expando:"jQuery"+(version+Math.random()).replace(/\D/g,""),isReady:true,error:function(msg){throw new Error(msg);},noop:function(){},isFunction:function(obj){return jQuery.type(obj)==="function";},isArray:Array.isArray,isWindow:function(obj){return obj!=null&&obj===obj.window;},isNumeric:function(obj){var realStringObj=obj&&obj.toString();return!jQuery.isArray(obj)&&(realStringObj-parseFloat(realStringObj)+1)>=0;},isPlainObject:function(obj){var key;if(jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false;}if(obj.constructor&&!hasOwn.call(obj,"constructor")&&!hasOwn.call(obj.constructor.prototype||{},"isPrototypeOf")){return false;}for(key in obj){}return key===undefined||hasOwn.call(obj,key);},isEmptyObject:function(obj){var name;for(name in obj){return false;}return true;},type:function(obj){if(obj==null){return obj+"";}return typeof obj==="object"||typeof obj==="function"?class2type[toString.call(obj)]||"object":typeof obj;},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code);if(code){if(code.indexOf("use strict")===1){script=document.createElement("script");script.text=code;document.head.appendChild(script).parentNode.removeChild(script);}else{indirect(code);}}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase);},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase();},each:function(obj,callback){var length,i=0;if(isArrayLike(obj)){length=obj.length;for(;i<length;i++){if(callback.call(obj[i],i,obj[i])===false){break;}}}else{for(i in obj){if(callback.call(obj[i],i,obj[i])===false){break;}}}return obj;},trim:function(text){return text==null?"":(text+"").replace(rtrim,"");},makeArray:function(arr,results){var ret=results||[];if(arr!=null){if(isArrayLike(Object(arr))){jQuery.merge(ret,typeof arr==="string"?[arr]:arr);}else{push.call(ret,arr);}}return ret;},inArray:function(elem,arr,i){return arr==null?-1:indexOf.call(arr,elem,i);},merge:function(first,second){var len=+second.length,j=0,i=first.length;for(;j<len;j++){first[i++]=second[j];}first.length=i;return first;},grep:function(elems,callback,invert){var callbackInverse,matches=[],i=0,length=elems.length,callbackExpect=!invert;for(;i<length;i++){callbackInverse=!callback(elems[i],i);if(callbackInverse!==callbackExpect){matches.push(elems[i]);}}return matches;},map:function(elems,callback,arg){var length,value,i=0,ret=[];if(isArrayLike(elems)){length=elems.length;for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret.push(value);}}}else{for(i in elems){value=callback(elems[i],i,arg);if(value!=null){ret.push(value);}}}return concat.apply([],ret);},guid:1,proxy:function(fn,context){var tmp,args,proxy;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp;}if(!jQuery.isFunction(fn)){return undefined;}args=slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)));};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy;},now:Date.now,support:support});if(typeof Symbol==="function"){jQuery.fn[Symbol.iterator]=arr[Symbol.iterator];}jQuery.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase();});function isArrayLike(obj){var length=!!obj&&"length"in obj&&obj.length,type=jQuery.type(obj);if(type==="function"||jQuery.isWindow(obj)){return false;}return type==="array"||length===0||typeof length==="number"&&length>0&&(length-1)in obj;}var Sizzle=/*!
  Sizzle CSS Selector Engine v2.2.1
  http://sizzlejs.com/
 
  Copyright jQuery Foundation and other contributors
  Released under the MIT license
  http://jquery.org/license
 
  Date: 2015-10-17
 */(function(window){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+1*new Date(),preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){if(a===b){hasDuplicate=true;}return 0;},MAX_NEGATIVE=1<<31,hasOwn=({}).hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){var i=0,len=list.length;for(;i<len;i++){if(list[i]===elem){return i;}}return-1;},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",attributes="\\["+whitespace+"*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\(("+"('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|"+"((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|"+".*"+")\\)|)",rwhitespace=new RegExp(whitespace+"+","g"),rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={"ID":new RegExp("^#("+identifier+")"),"CLASS":new RegExp("^\\.("+identifier+")"),"TAG":new RegExp("^("+identifier+"|[*])"),"ATTR":new RegExp("^"+attributes),"PSEUDO":new RegExp("^"+pseudos),"CHILD":new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),"bool":new RegExp("^(?:"+booleans+")$","i"),"needsContext":new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-0x10000;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+0x10000):String.fromCharCode(high>>10|0xD800,high&0x3FF|0xDC00);},unloadHandler=function(){setDocument();};try{push.apply((arr=slice.call(preferredDoc.childNodes)),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType;}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els));}:function(target,els){var j=target.length,i=0;while((target[j++]=els[i++])){}target.length=j-1;}};}function Sizzle(selector,context,results,seed){var m,i,elem,nid,nidselect,match,groups,newSelector,newContext=context&&context.ownerDocument,nodeType=context?context.nodeType:9;results=results||[];if(typeof selector!=="string"||!selector||nodeType!==1&&nodeType!==9&&nodeType!==11){return results;}if(!seed){if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context);}context=context||document;if(documentIsHTML){if(nodeType!==11&&(match=rquickExpr.exec(selector))){if((m=match[1])){if(nodeType===9){if((elem=context.getElementById(m))){if(elem.id===m){results.push(elem);return results;}}else{return results;}}else{if(newContext&&(elem=newContext.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results;}}}else if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results;}else if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results;}}if(support.qsa&&!compilerCache[selector+" "]&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(nodeType!==1){newContext=context;newSelector=selector;}else if(context.nodeName.toLowerCase()!=="object"){if((nid=context.getAttribute("id"))){nid=nid.replace(rescape,"\\$&");}else{context.setAttribute("id",(nid=expando));}groups=tokenize(selector);i=groups.length;nidselect=ridentifier.test(nid)?"#"+nid:"[id='"+nid+"']";while(i--){groups[i]=nidselect+" "+toSelector(groups[i]);}newSelector=groups.join(",");newContext=rsibling.test(selector)&&testContext(context.parentNode)||context;}if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results;}catch(qsaError){}finally{if(nid===expando){context.removeAttribute("id");}}}}}}return select(selector.replace(rtrim,"$1"),context,results,seed);}function createCache(){var keys=[];function cache(key,value){if(keys.push(key+" ")>Expr.cacheLength){delete cache[keys.shift()];}return(cache[key+" "]=value);}return cache;}function markFunction(fn){fn[expando]=true;return fn;}function assert(fn){var div=document.createElement("div");try{return!!fn(div);}catch(e){return false;}finally{if(div.parentNode){div.parentNode.removeChild(div);}div=null;}}function addHandle(attrs,handler){var arr=attrs.split("|"),i=arr.length;while(i--){Expr.attrHandle[arr[i]]=handler;}}function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff){return diff;}if(cur){while((cur=cur.nextSibling)){if(cur===b){return-1;}}}return a?1:-1;}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type;};}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type;};}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[(j=matchIndexes[i])]){seed[j]=!(matches[j]=seed[j]);}}});});}function testContext(context){return context&&typeof context.getElementsByTagName!=="undefined"&&context;}support=Sizzle.support={};isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false;};setDocument=Sizzle.setDocument=function(node){var hasCompare,parent,doc=node?node.ownerDocument||node:preferredDoc;if(doc===document||doc.nodeType!==9||!doc.documentElement){return document;}document=doc;docElem=document.documentElement;documentIsHTML=!isXML(document);if((parent=document.defaultView)&&parent.top!==parent){if(parent.addEventListener){parent.addEventListener("unload",unloadHandler,false);}else if(parent.attachEvent){parent.attachEvent("onunload",unloadHandler);}}support.attributes=assert(function(div){div.className="i";return!div.getAttribute("className");});support.getElementsByTagName=assert(function(div){div.appendChild(document.createComment(""));return!div.getElementsByTagName("*").length;});support.getElementsByClassName=rnative.test(document.getElementsByClassName);support.getById=assert(function(div){docElem.appendChild(div).id=expando;return!document.getElementsByName||!document.getElementsByName(expando).length;});if(support.getById){Expr.find["ID"]=function(id,context){if(typeof context.getElementById!=="undefined"&&documentIsHTML){var m=context.getElementById(id);return m?[m]:[];}};Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId;};};}else{delete Expr.find["ID"];Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!=="undefined"&&elem.getAttributeNode("id");return node&&node.value===attrId;};};}Expr.find["TAG"]=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!=="undefined"){return context.getElementsByTagName(tag);}else if(support.qsa){return context.querySelectorAll(tag);}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while((elem=results[i++])){if(elem.nodeType===1){tmp.push(elem);}}return tmp;}return results;};Expr.find["CLASS"]=support.getElementsByClassName&&function(className,context){if(typeof context.getElementsByClassName!=="undefined"&&documentIsHTML){return context.getElementsByClassName(className);}};rbuggyMatches=[];rbuggyQSA=[];if((support.qsa=rnative.test(document.querySelectorAll))){assert(function(div){docElem.appendChild(div).innerHTML="<a id='"+expando+"'></a>"+"<select id='"+expando+"-\r\\' msallowcapture=''>"+"<option selected=''></option></select>";if(div.querySelectorAll("[msallowcapture^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")");}if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")");}if(!div.querySelectorAll("[id~="+expando+"-]").length){rbuggyQSA.push("~=");}if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked");}if(!div.querySelectorAll("a#"+expando+"+*").length){rbuggyQSA.push(".#.+[+~]");}});assert(function(div){var input=document.createElement("input");input.setAttribute("type","hidden");div.appendChild(input).setAttribute("name","D");if(div.querySelectorAll("[name=d]").length){rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?=");}if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled");}div.querySelectorAll("*,:x");rbuggyQSA.push(",.*:");});}if((support.matchesSelector=rnative.test((matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)))){assert(function(div){support.disconnectedMatch=matches.call(div,"div");matches.call(div,"[s!='']:x");rbuggyMatches.push("!=",pseudos);});}rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));hasCompare=rnative.test(docElem.compareDocumentPosition);contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16));}:function(a,b){if(b){while((b=b.parentNode)){if(b===a){return true;}}}return false;};sortOrder=hasCompare?function(a,b){if(a===b){hasDuplicate=true;return 0;}var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;if(compare){return compare;}compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1;if(compare&1||(!support.sortDetached&&b.compareDocumentPosition(a)===compare)){if(a===document||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)){return-1;}if(b===document||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)){return 1;}return sortInput?(indexOf(sortInput,a)-indexOf(sortInput,b)):0;}return compare&4?-1:1;}:function(a,b){if(a===b){hasDuplicate=true;return 0;}var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup){return a===document?-1:b===document?1:aup?-1:bup?1:sortInput?(indexOf(sortInput,a)-indexOf(sortInput,b)):0;}else if(aup===bup){return siblingCheck(a,b);}cur=a;while((cur=cur.parentNode)){ap.unshift(cur);}cur=b;while((cur=cur.parentNode)){bp.unshift(cur);}while(ap[i]===bp[i]){i++;}return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0;};return document;};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements);};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem);}expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector&&documentIsHTML&&!compilerCache[expr+" "]&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret;}}catch(e){}}return Sizzle(expr,document,null,[elem]).length>0;};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context);}return contains(context,elem);};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem);}var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val!==undefined?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null;};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg);};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){while((elem=results[i++])){if(elem===results[i]){j=duplicates.push(i);}}while(j--){results.splice(duplicates[j],1);}}sortInput=null;return results;};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType){while((node=elem[i++])){ret+=getText(node);}}else if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent;}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem);}}}else if(nodeType===3||nodeType===4){return elem.nodeValue;}return ret;};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{"ATTR":function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape);if(match[2]==="~="){match[3]=" "+match[3]+" ";}return match.slice(0,4);},"CHILD":function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0]);}match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+((match[7]+match[8])||match[3]==="odd");}else if(match[3]){Sizzle.error(match[0]);}return match;},"PSEUDO":function(match){var excess,unquoted=!match[6]&&match[2];if(matchExpr["CHILD"].test(match[0])){return null;}if(match[3]){match[2]=match[4]||match[5]||"";}else if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess);}return match.slice(0,3);}},filter:{"TAG":function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*"?function(){return true;}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName;};},"CLASS":function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className==="string"&&elem.className||typeof elem.getAttribute!=="undefined"&&elem.getAttribute("class")||"");});},"ATTR":function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!=";}if(!operator){return true;}result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result.replace(rwhitespace," ")+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":false;};},"CHILD":function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1&&last===0?function(elem){return!!elem.parentNode;}:function(elem,context,xml){var cache,uniqueCache,outerCache,node,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType,diff=false;if(parent){if(simple){while(dir){node=elem;while((node=node[dir])){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false;}}start=dir=type==="only"&&!start&&"nextSibling";}return true;}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){node=parent;outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});cache=uniqueCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=nodeIndex&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while((node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())){if(node.nodeType===1&&++diff&&node===elem){uniqueCache[type]=[dirruns,nodeIndex,diff];break;}}}else{if(useCache){node=elem;outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});cache=uniqueCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=nodeIndex;}if(diff===false){while((node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});uniqueCache[type]=[dirruns,diff];}if(node===elem){break;}}}}}diff-=last;return diff===first||(diff%first===0&&diff/first>=0);}};},"PSEUDO":function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument);}if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i]);}}):function(elem){return fn(elem,0,args);};}return fn;}},pseudos:{"not":markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if((elem=unmatched[i])){seed[i]=!(matches[i]=elem);}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);input[0]=null;return!results.pop();};}),"has":markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0;};}),"contains":markFunction(function(text){text=text.replace(runescape,funescape);return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1;};}),"lang":markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang);}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if((elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+"-")===0;}}while((elem=elem.parentNode)&&elem.nodeType===1);return false;};}),"target":function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id;},"root":function(elem){return elem===docElem;},"focus":function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex);},"enabled":function(elem){return elem.disabled===false;},"disabled":function(elem){return elem.disabled===true;},"checked":function(elem){var nodeName=elem.nodeName.toLowerCase();return(nodeName==="input"&&!!elem.checked)||(nodeName==="option"&&!!elem.selected);},"selected":function(elem){if(elem.parentNode){elem.parentNode.selectedIndex;}return elem.selected===true;},"empty":function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeType<6){return false;}}return true;},"parent":function(elem){return!Expr.pseudos["empty"](elem);},"header":function(elem){return rheader.test(elem.nodeName);},"input":function(elem){return rinputs.test(elem.nodeName);},"button":function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button";},"text":function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()==="text");},"first":createPositionalPseudo(function(){return[0];}),"last":createPositionalPseudo(function(matchIndexes,length){return[length-1];}),"eq":createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument];}),"even":createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i);}return matchIndexes;}),"odd":createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i);}return matchIndexes;}),"lt":createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;){matchIndexes.push(i);}return matchIndexes;}),"gt":createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i);}return matchIndexes;})}};Expr.pseudos["nth"]=Expr.pseudos["eq"];for(i in{radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i);}for(i in{submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i);}function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters();tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached){return parseOnly?0:cached.slice(0);}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar;}groups.push((tokens=[]));}matched=false;if((match=rcombinators.exec(soFar))){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length);}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length);}}if(!matched){break;}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0);};function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++){selector+=tokens[i].value;}return selector;}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml);}}}:function(elem,context,xml){var oldCache,uniqueCache,outerCache,newCache=[dirruns,doneName];if(xml){while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true;}}}}else{while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});uniqueCache=outerCache[elem.uniqueID]||(outerCache[elem.uniqueID]={});if((oldCache=uniqueCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName){return(newCache[2]=oldCache[2]);}else{uniqueCache[dir]=newCache;if((newCache[2]=matcher(elem,context,xml))){return true;}}}}}};}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false;}}return true;}:matchers[0];}function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results);}return results;}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if((elem=unmatched[i])){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i);}}}}return newUnmatched;}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter);}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector);}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml);}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if((elem=temp[i])){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem);}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if((elem=matcherOut[i])){temp.push((matcherIn[i]=elem));}}postFinder(null,(matcherOut=[]),temp,xml);}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem);}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml);}else{push.apply(results,matcherOut);}}});}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext;},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf(checkContext,elem)>-1;},implicitRelative,true),matchers=[function(elem,context,xml){var ret=(!leadingRelative&&(xml||context!==outermostContext))||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));checkContext=null;return ret;}];for(;i<len;i++){if((matcher=Expr.relative[tokens[i].type])){matchers=[addCombinator(elementMatcher(matchers),matcher)];}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break;}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" "?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens((tokens=tokens.slice(j))),j<len&&toSelector(tokens));}matchers.push(matcher);}}return elementMatcher(matchers);}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find["TAG"]("*",outermost),dirrunsUnique=(dirruns+=contextBackup==null?1:Math.random()||0.1),len=elems.length;if(outermost){outermostContext=context===document||context||outermost;}for(;i!==len&&(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;if(!context&&elem.ownerDocument!==document){setDocument(elem);xml=!documentIsHTML;}while((matcher=elementMatchers[j++])){if(matcher(elem,context||document,xml)){results.push(elem);break;}}if(outermost){dirruns=dirrunsUnique;}}if(bySet){if((elem=!matcher&&elem)){matchedCount--;}if(seed){unmatched.push(elem);}}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while((matcher=setMatchers[j++])){matcher(unmatched,setMatched,context,xml);}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results);}}}setMatched=condense(setMatched);}push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&(matchedCount+setMatchers.length)>1){Sizzle.uniqueSort(results);}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup;}return unmatched;};return bySet?markFunction(superMatcher):superMatcher;}compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){if(!match){match=tokenize(selector);}i=match.length;while(i--){cached=matcherFromTokens(match[i]);if(cached[expando]){setMatchers.push(cached);}else{elementMatchers.push(cached);}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers));cached.selector=selector;}return cached;};select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled=typeof selector==="function"&&selector,match=!seed&&tokenize((selector=compiled.selector||selector));results=results||[];if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&support.getById&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find["ID"](token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results;}else if(compiled){context=context.parentNode;}selector=selector.slice(tokens.shift().value.length);}i=matchExpr["needsContext"].test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[(type=token.type)]){break;}if((find=Expr.find[type])){if((seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results;}break;}}}}(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,!context||rsibling.test(selector)&&testContext(context.parentNode)||context);return results;};support.sortStable=expando.split("").sort(sortOrder).join("")===expando;support.detectDuplicates=!!hasDuplicate;setDocument();support.sortDetached=assert(function(div1){return div1.compareDocumentPosition(document.createElement("div"))&1;});if(!assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild.getAttribute("href")==="#";})){addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML){return elem.getAttribute(name,name.toLowerCase()==="type"?1:2);}});}if(!support.attributes||!assert(function(div){div.innerHTML="<input/>";div.firstChild.setAttribute("value","");return div.firstChild.getAttribute("value")==="";})){addHandle("value",function(elem,name,isXML){if(!isXML&&elem.nodeName.toLowerCase()==="input"){return elem.defaultValue;}});}if(!assert(function(div){return div.getAttribute("disabled")==null;})){addHandle(booleans,function(elem,name,isXML){var val;if(!isXML){return elem[name]===true?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null;}});}return Sizzle;})(window);jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.uniqueSort=jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains;var dir=function(elem,dir,until){var matched=[],truncate=until!==undefined;while((elem=elem[dir])&&elem.nodeType!==9){if(elem.nodeType===1){if(truncate&&jQuery(elem).is(until)){break;}matched.push(elem);}}return matched;};var siblings=function(n,elem){var matched=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){matched.push(n);}}return matched;};var rneedsContext=jQuery.expr.match.needsContext;var rsingleTag=(/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/);var risSimple=/^.[^:#\[\.,]*$/;function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not;});}if(qualifier.nodeType){return jQuery.grep(elements,function(elem){return(elem===qualifier)!==not;});}if(typeof qualifier==="string"){if(risSimple.test(qualifier)){return jQuery.filter(qualifier,elements,not);}qualifier=jQuery.filter(qualifier,elements);}return jQuery.grep(elements,function(elem){return(indexOf.call(qualifier,elem)>-1)!==not;});}jQuery.filter=function(expr,elems,not){var elem=elems[0];if(not){expr=":not("+expr+")";}return elems.length===1&&elem.nodeType===1?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1;}));};jQuery.fn.extend({find:function(selector){var i,len=this.length,ret=[],self=this;if(typeof selector!=="string"){return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++){if(jQuery.contains(self[i],this)){return true;}}}));}for(i=0;i<len;i++){jQuery.find(selector,self[i],ret);}ret=this.pushStack(len>1?jQuery.unique(ret):ret);ret.selector=this.selector?this.selector+" "+selector:selector;return ret;},filter:function(selector){return this.pushStack(winnow(this,selector||[],false));},not:function(selector){return this.pushStack(winnow(this,selector||[],true));},is:function(selector){return!!winnow(this,typeof selector==="string"&&rneedsContext.test(selector)?jQuery(selector):selector||[],false).length;}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,init=jQuery.fn.init=function(selector,context,root){var match,elem;if(!selector){return this;}root=root||rootjQuery;if(typeof selector==="string"){if(selector[0]==="<"&&selector[selector.length-1]===">"&&selector.length>=3){match=[null,selector,null];}else{match=rquickExpr.exec(selector);}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){for(match in context){if(jQuery.isFunction(this[match])){this[match](context[match]);}else{this.attr(match,context[match]);}}}return this;}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){this.length=1;this[0]=elem;}this.context=document;this.selector=selector;return this;}}else if(!context||context.jquery){return(context||root).find(selector);}else{return this.constructor(context).find(selector);}}else if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this;}else if(jQuery.isFunction(selector)){return root.ready!==undefined?root.ready(selector):selector(jQuery);}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context;}return jQuery.makeArray(selector,this);};init.prototype=jQuery.fn;rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter(function(){var i=0;for(;i<l;i++){if(jQuery.contains(this,targets[i])){return true;}}});},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++){for(cur=this[i];cur&&cur!==context;cur=cur.parentNode){if(cur.nodeType<11&&(pos?pos.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break;}}}return this.pushStack(matched.length>1?jQuery.uniqueSort(matched):matched);},index:function(elem){if(!elem){return(this[0]&&this[0].parentNode)?this.first().prevAll().length:-1;}if(typeof elem==="string"){return indexOf.call(jQuery(elem),this[0]);}return indexOf.call(this,elem.jquery?elem[0]:elem);},add:function(selector,context){return this.pushStack(jQuery.uniqueSort(jQuery.merge(this.get(),jQuery(selector,context))));},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector));}});function sibling(cur,dir){while((cur=cur[dir])&&cur.nodeType!==1){}return cur;}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null;},parents:function(elem){return dir(elem,"parentNode");},parentsUntil:function(elem,i,until){return dir(elem,"parentNode",until);},next:function(elem){return sibling(elem,"nextSibling");},prev:function(elem){return sibling(elem,"previousSibling");},nextAll:function(elem){return dir(elem,"nextSibling");},prevAll:function(elem){return dir(elem,"previousSibling");},nextUntil:function(elem,i,until){return dir(elem,"nextSibling",until);},prevUntil:function(elem,i,until){return dir(elem,"previousSibling",until);},siblings:function(elem){return siblings((elem.parentNode||{}).firstChild,elem);},children:function(elem){return siblings(elem.firstChild);},contents:function(elem){return elem.contentDocument||jQuery.merge([],elem.childNodes);}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);if(name.slice(-5)!=="Until"){selector=until;}if(selector&&typeof selector==="string"){matched=jQuery.filter(selector,matched);}if(this.length>1){if(!guaranteedUnique[name]){jQuery.uniqueSort(matched);}if(rparentsprev.test(name)){matched.reverse();}}return this.pushStack(matched);};});var rnotwhite=(/\S+/g);function createOptions(options){var object={};jQuery.each(options.match(rnotwhite)||[],function(_,flag){object[flag]=true;});return object;}jQuery.Callbacks=function(options){options=typeof options==="string"?createOptions(options):jQuery.extend({},options);var
firing,memory,fired,locked,list=[],queue=[],firingIndex=-1,fire=function(){locked=options.once;fired=firing=true;for(;queue.length;firingIndex=-1){memory=queue.shift();while(++firingIndex<list.length){if(list[firingIndex].apply(memory[0],memory[1])===false&&options.stopOnFalse){firingIndex=list.length;memory=false;}}}if(!options.memory){memory=false;}firing=false;if(locked){if(memory){list=[];}else{list="";}}},self={add:function(){if(list){if(memory&&!firing){firingIndex=list.length-1;queue.push(memory);}(function add(args){jQuery.each(args,function(_,arg){if(jQuery.isFunction(arg)){if(!options.unique||!self.has(arg)){list.push(arg);}}else if(arg&&arg.length&&jQuery.type(arg)!=="string"){add(arg);}});})(arguments);if(memory&&!firing){fire();}}return this;},remove:function(){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(index<=firingIndex){firingIndex--;}}});return this;},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:list.length>0;},empty:function(){if(list){list=[];}return this;},disable:function(){locked=queue=[];list=memory="";return this;},disabled:function(){return!list;},lock:function(){locked=queue=[];if(!memory){list=memory="";}return this;},locked:function(){return!!locked;},fireWith:function(context,args){if(!locked){args=args||[];args=[context,args.slice?args.slice():args];queue.push(args);if(!firing){fire();}}return this;},fire:function(){self.fireWith(this,arguments);return this;},fired:function(){return!!fired;}};return self;};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state;},always:function(){deferred.done(arguments).fail(arguments);return this;},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().progress(newDefer.notify).done(newDefer.resolve).fail(newDefer.reject);}else{newDefer[tuple[0]+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments);}});});fns=null;}).promise();},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise;}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString;},tuples[i^1][2].disable,tuples[2][2].lock);}deferred[tuple[0]]=function(){deferred[tuple[0]+"With"](this===deferred?promise:this,arguments);return this;};deferred[tuple[0]+"With"]=list.fireWith;});promise.promise(deferred);if(func){func.call(deferred,deferred);}return deferred;},when:function(subordinate){var i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=length!==1||(subordinate&&jQuery.isFunction(subordinate.promise))?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values);}else if(!(--remaining)){deferred.resolveWith(contexts,values);}};},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().progress(updateFunc(i,progressContexts,progressValues)).done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject);}else{--remaining;}}}if(!remaining){deferred.resolveWith(resolveContexts,resolveValues);}return deferred.promise();}});var readyList;jQuery.fn.ready=function(fn){jQuery.ready.promise().done(fn);return this;};jQuery.extend({isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++;}else{jQuery.ready(true);}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return;}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return;}readyList.resolveWith(document,[jQuery]);if(jQuery.fn.triggerHandler){jQuery(document).triggerHandler("ready");jQuery(document).off("ready");}}});function completed(){document.removeEventListener("DOMContentLoaded",completed);window.removeEventListener("load",completed);jQuery.ready();}jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"||(document.readyState!=="loading"&&!document.documentElement.doScroll)){window.setTimeout(jQuery.ready);}else{document.addEventListener("DOMContentLoaded",completed);window.addEventListener("load",completed);}}return readyList.promise(obj);};jQuery.ready.promise();var access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,len=elems.length,bulk=key==null;if(jQuery.type(key)==="object"){chainable=true;for(i in key){access(elems,fn,i,key[i],true,emptyGet,raw);}}else if(value!==undefined){chainable=true;if(!jQuery.isFunction(value)){raw=true;}if(bulk){if(raw){fn.call(elems,value);fn=null;}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value);};}}if(fn){for(;i<len;i++){fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)));}}}return chainable?elems:bulk?fn.call(elems):len?fn(elems[0],key):emptyGet;};var acceptData=function(owner){return owner.nodeType===1||owner.nodeType===9||!(+owner.nodeType);};function Data(){this.expando=jQuery.expando+Data.uid++;}Data.uid=1;Data.prototype={register:function(owner,initial){var value=initial||{};if(owner.nodeType){owner[this.expando]=value;}else{Object.defineProperty(owner,this.expando,{value:value,writable:true,configurable:true});}return owner[this.expando];},cache:function(owner){if(!acceptData(owner)){return{};}var value=owner[this.expando];if(!value){value={};if(acceptData(owner)){if(owner.nodeType){owner[this.expando]=value;}else{Object.defineProperty(owner,this.expando,{value:value,configurable:true});}}}return value;},set:function(owner,data,value){var prop,cache=this.cache(owner);if(typeof data==="string"){cache[data]=value;}else{for(prop in data){cache[prop]=data[prop];}}return cache;},get:function(owner,key){return key===undefined?this.cache(owner):owner[this.expando]&&owner[this.expando][key];},access:function(owner,key,value){var stored;if(key===undefined||((key&&typeof key==="string")&&value===undefined)){stored=this.get(owner,key);return stored!==undefined?stored:this.get(owner,jQuery.camelCase(key));}this.set(owner,key,value);return value!==undefined?value:key;},remove:function(owner,key){var i,name,camel,cache=owner[this.expando];if(cache===undefined){return;}if(key===undefined){this.register(owner);}else{if(jQuery.isArray(key)){name=key.concat(key.map(jQuery.camelCase));}else{camel=jQuery.camelCase(key);if(key in cache){name=[key,camel];}else{name=camel;name=name in cache?[name]:(name.match(rnotwhite)||[]);}}i=name.length;while(i--){delete cache[name[i]];}}if(key===undefined||jQuery.isEmptyObject(cache)){if(owner.nodeType){owner[this.expando]=undefined;}else{delete owner[this.expando];}}},hasData:function(owner){var cache=owner[this.expando];return cache!==undefined&&!jQuery.isEmptyObject(cache);}};var dataPriv=new Data();var dataUser=new Data();var rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/[A-Z]/g;function dataAttr(elem,key,data){var name;if(data===undefined&&elem.nodeType===1){name="data-"+key.replace(rmultiDash,"-$&").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data;}catch(e){}dataUser.set(elem,key,data);}else{data=undefined;}}return data;}jQuery.extend({hasData:function(elem){return dataUser.hasData(elem)||dataPriv.hasData(elem);},data:function(elem,name,data){return dataUser.access(elem,name,data);},removeData:function(elem,name){dataUser.remove(elem,name);},_data:function(elem,name,data){return dataPriv.access(elem,name,data);},_removeData:function(elem,name){dataPriv.remove(elem,name);}});jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(key===undefined){if(this.length){data=dataUser.get(elem);if(elem.nodeType===1&&!dataPriv.get(elem,"hasDataAttrs")){i=attrs.length;while(i--){if(attrs[i]){name=attrs[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.slice(5));dataAttr(elem,name,data[name]);}}}dataPriv.set(elem,"hasDataAttrs",true);}}return data;}if(typeof key==="object"){return this.each(function(){dataUser.set(this,key);});}return access(this,function(value){var data,camelKey;if(elem&&value===undefined){data=dataUser.get(elem,key)||dataUser.get(elem,key.replace(rmultiDash,"-$&").toLowerCase());if(data!==undefined){return data;}camelKey=jQuery.camelCase(key);data=dataUser.get(elem,camelKey);if(data!==undefined){return data;}data=dataAttr(elem,camelKey,undefined);if(data!==undefined){return data;}return;}camelKey=jQuery.camelCase(key);this.each(function(){var data=dataUser.get(this,camelKey);dataUser.set(this,camelKey,value);if(key.indexOf("-")>-1&&data!==undefined){dataUser.set(this,key,value);}});},null,value,arguments.length>1,null,true);},removeData:function(key){return this.each(function(){dataUser.remove(this,key);});}});jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=dataPriv.get(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=dataPriv.access(elem,type,jQuery.makeArray(data));}else{queue.push(data);}}return queue||[];}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type);};if(fn==="inprogress"){fn=queue.shift();startLength--;}if(fn){if(type==="fx"){queue.unshift("inprogress");}delete hooks.stop;fn.call(elem,next,hooks);}if(!startLength&&hooks){hooks.empty.fire();}},_queueHooks:function(elem,type){var key=type+"queueHooks";return dataPriv.get(elem,key)||dataPriv.access(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){dataPriv.remove(elem,[type+"queue",key]);})});}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--;}if(arguments.length<setter){return jQuery.queue(this[0],type);}return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type);}});},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type);});},clearQueue:function(type){return this.queue(type||"fx",[]);},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!(--count)){defer.resolveWith(elements,[elements]);}};if(typeof type!=="string"){obj=type;type=undefined;}type=type||"fx";while(i--){tmp=dataPriv.get(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve);}}resolve();return defer.promise(obj);}});var pnum=(/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/).source;var rcssNum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i");var cssExpand=["Top","Right","Bottom","Left"];var isHidden=function(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem);};function adjustCSS(elem,prop,valueParts,tween){var adjusted,scale=1,maxIterations=20,currentValue=tween?function(){return tween.cur();}:function(){return jQuery.css(elem,prop,"");},initial=currentValue(),unit=valueParts&&valueParts[3]||(jQuery.cssNumber[prop]?"":"px"),initialInUnit=(jQuery.cssNumber[prop]||unit!=="px"&&+initial)&&rcssNum.exec(jQuery.css(elem,prop));if(initialInUnit&&initialInUnit[3]!==unit){unit=unit||initialInUnit[3];valueParts=valueParts||[];initialInUnit=+initial||1;do{scale=scale||".5";initialInUnit=initialInUnit/scale;jQuery.style(elem,prop,initialInUnit+unit);}while(scale!==(scale=currentValue()/initial)&&scale!==1&&--maxIterations);}if(valueParts){initialInUnit=+initialInUnit||+initial||0;adjusted=valueParts[1]?initialInUnit+(valueParts[1]+1)*valueParts[2]:+valueParts[2];if(tween){tween.unit=unit;tween.start=initialInUnit;tween.end=adjusted;}}return adjusted;}var rcheckableType=(/^(?:checkbox|radio)$/i);var rtagName=(/<([\w:-]+)/);var rscriptType=(/^$|\/(?:java|ecma)script/i);var wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;function getAll(context,tag){var ret=typeof context.getElementsByTagName!=="undefined"?context.getElementsByTagName(tag||"*"):typeof context.querySelectorAll!=="undefined"?context.querySelectorAll(tag||"*"):[];return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],ret):ret;}function setGlobalEval(elems,refElements){var i=0,l=elems.length;for(;i<l;i++){dataPriv.set(elems[i],"globalEval",!refElements||dataPriv.get(refElements[i],"globalEval"));}}var rhtml=/<|&#?\w+;/;function buildFragment(elems,context,scripts,selection,ignored){var elem,tmp,tag,wrap,contains,j,fragment=context.createDocumentFragment(),nodes=[],i=0,l=elems.length;for(;i<l;i++){elem=elems[i];if(elem||elem===0){if(jQuery.type(elem)==="object"){jQuery.merge(nodes,elem.nodeType?[elem]:elem);}else if(!rhtml.test(elem)){nodes.push(context.createTextNode(elem));}else{tmp=tmp||fragment.appendChild(context.createElement("div"));tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+jQuery.htmlPrefilter(elem)+wrap[2];j=wrap[0];while(j--){tmp=tmp.lastChild;}jQuery.merge(nodes,tmp.childNodes);tmp=fragment.firstChild;tmp.textContent="";}}}fragment.textContent="";i=0;while((elem=nodes[i++])){if(selection&&jQuery.inArray(elem,selection)>-1){if(ignored){ignored.push(elem);}continue;}contains=jQuery.contains(elem.ownerDocument,elem);tmp=getAll(fragment.appendChild(elem),"script");if(contains){setGlobalEval(tmp);}if(scripts){j=0;while((elem=tmp[j++])){if(rscriptType.test(elem.type||"")){scripts.push(elem);}}}}return fragment;}(function(){var fragment=document.createDocumentFragment(),div=fragment.appendChild(document.createElement("div")),input=document.createElement("input");input.setAttribute("type","radio");input.setAttribute("checked","checked");input.setAttribute("name","t");div.appendChild(input);support.checkClone=div.cloneNode(true).cloneNode(true).lastChild.checked;div.innerHTML="<textarea>x</textarea>";support.noCloneChecked=!!div.cloneNode(true).lastChild.defaultValue;})();var
rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,rtypenamespace=/^([^.]*)(?:\.(.+)|)/;function returnTrue(){return true;}function returnFalse(){return false;}function safeActiveElement(){try{return document.activeElement;}catch(err){}}function on(elem,types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined;}for(type in types){on(elem,type,selector,data,types[type],one);}return elem;}if(data==null&&fn==null){fn=selector;data=selector=undefined;}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined;}else{fn=data;data=selector;selector=undefined;}}if(fn===false){fn=returnFalse;}else if(!fn){return elem;}if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments);};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++);}return elem.each(function(){jQuery.event.add(this,types,fn,data,selector);});}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.get(elem);if(!elemData){return;}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector;}if(!handler.guid){handler.guid=jQuery.guid++;}if(!(events=elemData.events)){events=elemData.events={};}if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery!=="undefined"&&jQuery.event.triggered!==e.type?jQuery.event.dispatch.apply(elem,arguments):undefined;};}types=(types||"").match(rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){continue;}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle);}}}if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid;}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj);}else{handlers.push(handleObj);}jQuery.event.global[type]=true;}},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.hasData(elem)&&dataPriv.get(elem);if(!elemData||!(events=elemData.events)){return;}types=(types||"").match(rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true);}continue;}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)");origCount=j=handlers.length;while(j--){handleObj=handlers[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){handlers.splice(j,1);if(handleObj.selector){handlers.delegateCount--;}if(special.remove){special.remove.call(elem,handleObj);}}}if(origCount&&!handlers.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle);}delete events[type];}}if(jQuery.isEmptyObject(events)){dataPriv.remove(elem,"handle events");}},dispatch:function(event){event=jQuery.event.fix(event);var i,j,ret,matched,handleObj,handlerQueue=[],args=slice.call(arguments),handlers=(dataPriv.get(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return;}handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem;j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped()){if(!event.rnamespace||event.rnamespace.test(handleObj.namespace)){event.handleObj=handleObj;event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){if((event.result=ret)===false){event.preventDefault();event.stopPropagation();}}}}}if(special.postDispatch){special.postDispatch.call(this,event);}return event.result;},handlers:function(event,handlers){var i,matches,sel,handleObj,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(event.type!=="click"||isNaN(event.button)||event.button<1)){for(;cur!==this;cur=cur.parentNode||this){if(cur.nodeType===1&&(cur.disabled!==true||event.type!=="click")){matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector+" ";if(matches[sel]===undefined){matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>-1:jQuery.find(sel,this,null,[cur]).length;}if(matches[sel]){matches.push(handleObj);}}if(matches.length){handlerQueue.push({elem:cur,handlers:matches});}}}}if(delegateCount<handlers.length){handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)});}return handlerQueue;},props:("altKey bubbles cancelable ctrlKey currentTarget detail eventPhase "+"metaKey relatedTarget shiftKey target timeStamp view which").split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode;}return event;}},mouseHooks:{props:("button buttons clientX clientY offsetX offsetY pageX pageY "+"screenX screenY toElement").split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0);}if(!event.which&&button!==undefined){event.which=(button&1?1:(button&2?3:(button&4?2:0)));}return event;}},fix:function(event){if(event[jQuery.expando]){return event;}var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];if(!fixHook){this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{};}copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=new jQuery.Event(originalEvent);i=copy.length;while(i--){prop=copy[i];event[prop]=originalEvent[prop];}if(!event.target){event.target=document;}if(event.target.nodeType===3){event.target=event.target.parentNode;}return fixHook.filter?fixHook.filter(event,originalEvent):event;},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){this.focus();return false;}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return false;}},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input")){this.click();return false;}},_default:function(event){return jQuery.nodeName(event.target,"a");}},beforeunload:{postDispatch:function(event){if(event.result!==undefined&&event.originalEvent){event.originalEvent.returnValue=event.result;}}}}};jQuery.removeEvent=function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle);}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props);}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented||src.defaultPrevented===undefined&&src.returnValue===false?returnTrue:returnFalse;}else{this.type=src;}if(props){jQuery.extend(this,props);}this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true;};jQuery.Event.prototype={constructor:jQuery.Event,isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,isSimulated:false,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;if(e&&!this.isSimulated){e.preventDefault();}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(e&&!this.isSimulated){e.stopPropagation();}},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue;if(e&&!this.isSimulated){e.stopImmediatePropagation();}this.stopPropagation();}};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||(related!==target&&!jQuery.contains(target,related))){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix;}return ret;}};});jQuery.fn.extend({on:function(types,selector,data,fn){return on(this,types,selector,data,fn);},one:function(types,selector,data,fn){return on(this,types,selector,data,fn,1);},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this;}if(typeof types==="object"){for(type in types){this.off(type,selector,types[type]);}return this;}if(selector===false||typeof selector==="function"){fn=selector;selector=undefined;}if(fn===false){fn=returnFalse;}return this.each(function(){jQuery.event.remove(this,types,fn,selector);});}});var
rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,rnoInnerhtml=/<script|<style|<link/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(content.nodeType!==11?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem;}function disableScript(elem){elem.type=(elem.getAttribute("type")!==null)+"/"+elem.type;return elem;}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);if(match){elem.type=match[1];}else{elem.removeAttribute("type");}return elem;}function cloneCopyEvent(src,dest){var i,l,type,pdataOld,pdataCur,udataOld,udataCur,events;if(dest.nodeType!==1){return;}if(dataPriv.hasData(src)){pdataOld=dataPriv.access(src);pdataCur=dataPriv.set(dest,pdataOld);events=pdataOld.events;if(events){delete pdataCur.handle;pdataCur.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i]);}}}}if(dataUser.hasData(src)){udataOld=dataUser.access(src);udataCur=jQuery.extend({},udataOld);dataUser.set(dest,udataCur);}}function fixInput(src,dest){var nodeName=dest.nodeName.toLowerCase();if(nodeName==="input"&&rcheckableType.test(src.type)){dest.checked=src.checked;}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue;}}function domManip(collection,args,callback,ignored){args=concat.apply([],args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=collection.length,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||(l>1&&typeof value==="string"&&!support.checkClone&&rchecked.test(value))){return collection.each(function(index){var self=collection.eq(index);if(isFunction){args[0]=value.call(this,index,self.html());}domManip(self,args,callback,ignored);});}if(l){fragment=buildFragment(args,collection[0].ownerDocument,false,collection,ignored);first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first;}if(first||ignored){scripts=jQuery.map(getAll(fragment,"script"),disableScript);hasScripts=scripts.length;for(;i<l;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,true,true);if(hasScripts){jQuery.merge(scripts,getAll(node,"script"));}}callback.call(collection[i],node,i);}if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++){node=scripts[i];if(rscriptType.test(node.type||"")&&!dataPriv.access(node,"globalEval")&&jQuery.contains(doc,node)){if(node.src){if(jQuery._evalUrl){jQuery._evalUrl(node.src);}}else{jQuery.globalEval(node.textContent.replace(rcleanScript,""));}}}}}}return collection;}function remove(elem,selector,keepData){var node,nodes=selector?jQuery.filter(selector,elem):elem,i=0;for(;(node=nodes[i])!=null;i++){if(!keepData&&node.nodeType===1){jQuery.cleanData(getAll(node));}if(node.parentNode){if(keepData&&jQuery.contains(node.ownerDocument,node)){setGlobalEval(getAll(node,"script"));}node.parentNode.removeChild(node);}}return elem;}jQuery.extend({htmlPrefilter:function(html){return html.replace(rxhtmlTag,"<$1></$2>");},clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,clone=elem.cloneNode(true),inPage=jQuery.contains(elem.ownerDocument,elem);if(!support.noCloneChecked&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone);srcElements=getAll(elem);for(i=0,l=srcElements.length;i<l;i++){fixInput(srcElements[i],destElements[i]);}}if(dataAndEvents){if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);for(i=0,l=srcElements.length;i<l;i++){cloneCopyEvent(srcElements[i],destElements[i]);}}else{cloneCopyEvent(elem,clone);}}destElements=getAll(clone,"script");if(destElements.length>0){setGlobalEval(destElements,!inPage&&getAll(elem,"script"));}return clone;},cleanData:function(elems){var data,elem,type,special=jQuery.event.special,i=0;for(;(elem=elems[i])!==undefined;i++){if(acceptData(elem)){if((data=elem[dataPriv.expando])){if(data.events){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type);}else{jQuery.removeEvent(elem,type,data.handle);}}}elem[dataPriv.expando]=undefined;}if(elem[dataUser.expando]){elem[dataUser.expando]=undefined;}}}}});jQuery.fn.extend({domManip:domManip,detach:function(selector){return remove(this,selector,true);},remove:function(selector){return remove(this,selector);},text:function(value){return access(this,function(value){return value===undefined?jQuery.text(this):this.empty().each(function(){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){this.textContent=value;}});},null,value,arguments.length);},append:function(){return domManip(this,arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.appendChild(elem);}});},prepend:function(){return domManip(this,arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild);}});},before:function(){return domManip(this,arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this);}});},after:function(){return domManip(this,arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this.nextSibling);}});},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.textContent="";}}return this;},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents);});},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined&&elem.nodeType===1){return elem.innerHTML;}if(typeof value==="string"&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=jQuery.htmlPrefilter(value);try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.innerHTML=value;}}elem=0;}catch(e){}}if(elem){this.empty().append(value);}},null,value,arguments.length);},replaceWith:function(){var ignored=[];return domManip(this,arguments,function(elem){var parent=this.parentNode;if(jQuery.inArray(this,ignored)<0){jQuery.cleanData(getAll(this));if(parent){parent.replaceChild(elem,this);}}},ignored);}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;for(;i<=last;i++){elems=i===last?this:this.clone(true);jQuery(insert[i])[original](elems);push.apply(ret,elems.get());}return this.pushStack(ret);};});var iframe,elemdisplay={HTML:"block",BODY:"block"};function actualDisplay(name,doc){var elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=jQuery.css(elem[0],"display");elem.detach();return display;}function defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];if(!display){display=actualDisplay(nodeName,doc);if(display==="none"||!display){iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>")).appendTo(doc.documentElement);doc=iframe[0].contentDocument;doc.write();doc.close();display=actualDisplay(nodeName,doc);iframe.detach();}elemdisplay[nodeName]=display;}return display;}var rmargin=(/^margin/);var rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i");var getStyles=function(elem){var view=elem.ownerDocument.defaultView;if(!view||!view.opener){view=window;}return view.getComputedStyle(elem);};var swap=function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name];}ret=callback.apply(elem,args||[]);for(name in options){elem.style[name]=old[name];}return ret;};var documentElement=document.documentElement;(function(){var pixelPositionVal,boxSizingReliableVal,pixelMarginRightVal,reliableMarginLeftVal,container=document.createElement("div"),div=document.createElement("div");if(!div.style){return;}div.style.backgroundClip="content-box";div.cloneNode(true).style.backgroundClip="";support.clearCloneStyle=div.style.backgroundClip==="content-box";container.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;"+"padding:0;margin-top:1px;position:absolute";container.appendChild(div);function computeStyleTests(){div.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;"+"position:relative;display:block;"+"margin:auto;border:1px;padding:1px;"+"top:1%;width:50%";div.innerHTML="";documentElement.appendChild(container);var divStyle=window.getComputedStyle(div);pixelPositionVal=divStyle.top!=="1%";reliableMarginLeftVal=divStyle.marginLeft==="2px";boxSizingReliableVal=divStyle.width==="4px";div.style.marginRight="50%";pixelMarginRightVal=divStyle.marginRight==="4px";documentElement.removeChild(container);}jQuery.extend(support,{pixelPosition:function(){computeStyleTests();return pixelPositionVal;},boxSizingReliable:function(){if(boxSizingReliableVal==null){computeStyleTests();}return boxSizingReliableVal;},pixelMarginRight:function(){if(boxSizingReliableVal==null){computeStyleTests();}return pixelMarginRightVal;},reliableMarginLeft:function(){if(boxSizingReliableVal==null){computeStyleTests();}return reliableMarginLeftVal;},reliableMarginRight:function(){var ret,marginDiv=div.appendChild(document.createElement("div"));marginDiv.style.cssText=div.style.cssText="-webkit-box-sizing:content-box;box-sizing:content-box;"+"display:block;margin:0;border:0;padding:0";marginDiv.style.marginRight=marginDiv.style.width="0";div.style.width="1px";documentElement.appendChild(container);ret=!parseFloat(window.getComputedStyle(marginDiv).marginRight);documentElement.removeChild(container);div.removeChild(marginDiv);return ret;}});})();function curCSS(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;computed=computed||getStyles(elem);ret=computed?computed.getPropertyValue(name)||computed[name]:undefined;if((ret===""||ret===undefined)&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name);}if(computed){if(!support.pixelMarginRight()&&rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth;}}return ret!==undefined?ret+"":ret;}function addGetHookIf(conditionFn,hookFn){return{get:function(){if(conditionFn()){delete this.get;return;}return(this.get=hookFn).apply(this,arguments);}};}var
rdisplayswap=/^(none|table(?!-c[ea]).+)/,cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"},cssPrefixes=["Webkit","O","Moz","ms"],emptyStyle=document.createElement("div").style;function vendorPropName(name){if(name in emptyStyle){return name;}var capName=name[0].toUpperCase()+name.slice(1),i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in emptyStyle){return name;}}}function setPositiveNumber(elem,value,subtract){var matches=rcssNum.exec(value);return matches?Math.max(0,matches[2]-(subtract||0))+(matches[3]||"px"):value;}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true,styles);}if(isBorderBox){if(extra==="content"){val-=jQuery.css(elem,"padding"+cssExpand[i],true,styles);}if(extra!=="margin"){val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles);}}else{val+=jQuery.css(elem,"padding"+cssExpand[i],true,styles);if(extra!=="padding"){val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles);}}}return val;}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=true,val=name==="width"?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=jQuery.css(elem,"boxSizing",false,styles)==="border-box";if(val<=0||val==null){val=curCSS(elem,name,styles);if(val<0||val==null){val=elem.style[name];}if(rnumnonpx.test(val)){return val;}valueIsBorderBox=isBorderBox&&(support.boxSizingReliable()||val===elem.style[name]);val=parseFloat(val)||0;}return(val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles))+"px";}function showHide(elements,show){var display,elem,hidden,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue;}values[index]=dataPriv.get(elem,"olddisplay");display=elem.style.display;if(show){if(!values[index]&&display==="none"){elem.style.display="";}if(elem.style.display===""&&isHidden(elem)){values[index]=dataPriv.access(elem,"olddisplay",defaultDisplay(elem.nodeName));}}else{hidden=isHidden(elem);if(display!=="none"||!hidden){dataPriv.set(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"));}}}for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue;}if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none";}}return elements;}jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret;}}}},cssNumber:{"animationIterationCount":true,"columnCount":true,"fillOpacity":true,"flexGrow":true,"flexShrink":true,"fontWeight":true,"lineHeight":true,"opacity":true,"order":true,"orphans":true,"widows":true,"zIndex":true,"zoom":true},cssProps:{"float":"cssFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return;}var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(origName)||origName);hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rcssNum.exec(value))&&ret[1]){value=adjustCSS(elem,name,ret);type="number";}if(value==null||value!==value){return;}if(type==="number"){value+=ret&&ret[3]||(jQuery.cssNumber[origName]?"":"px");}if(!support.clearCloneStyle&&value===""&&name.indexOf("background")===0){style[name]="inherit";}if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined){style[name]=value;}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret;}return style[name];}},css:function(elem,name,extra,styles){var val,num,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(origName)||origName);hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get"in hooks){val=hooks.get(elem,true,extra);}if(val===undefined){val=curCSS(elem,name,styles);}if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name];}if(extra===""||extra){num=parseFloat(val);return extra===true||isFinite(num)?num||0:val;}return val;}});jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){return rdisplayswap.test(jQuery.css(elem,"display"))&&elem.offsetWidth===0?swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra);}):getWidthOrHeight(elem,name,extra);}},set:function(elem,value,extra){var matches,styles=extra&&getStyles(elem),subtract=extra&&augmentWidthOrHeight(elem,name,extra,jQuery.css(elem,"boxSizing",false,styles)==="border-box",styles);if(subtract&&(matches=rcssNum.exec(value))&&(matches[3]||"px")!=="px"){elem.style[name]=value;value=jQuery.css(elem,name);}return setPositiveNumber(elem,value,subtract);}};});jQuery.cssHooks.marginLeft=addGetHookIf(support.reliableMarginLeft,function(elem,computed){if(computed){return(parseFloat(curCSS(elem,"marginLeft"))||elem.getBoundingClientRect().left-swap(elem,{marginLeft:0},function(){return elem.getBoundingClientRect().left;}))+"px";}});jQuery.cssHooks.marginRight=addGetHookIf(support.reliableMarginRight,function(elem,computed){if(computed){return swap(elem,{"display":"inline-block"},curCSS,[elem,"marginRight"]);}});jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value==="string"?value.split(" "):[value];for(;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];}return expanded;}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber;}});jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){styles=getStyles(elem);len=name.length;for(;i<len;i++){map[name[i]]=jQuery.css(elem,name[i],false,styles);}return map;}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name);},name,value,arguments.length>1);},show:function(){return showHide(this,true);},hide:function(){return showHide(this);},toggle:function(state){if(typeof state==="boolean"){return state?this.show():this.hide();}return this.each(function(){if(isHidden(this)){jQuery(this).show();}else{jQuery(this).hide();}});}});function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing);}jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||jQuery.easing._default;this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px");},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this);},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration);}else{this.pos=eased=percent;}this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this);}if(hooks&&hooks.set){hooks.set(this);}else{Tween.propHooks._default.set(this);}return this;}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem.nodeType!==1||tween.elem[tween.prop]!=null&&tween.elem.style[tween.prop]==null){return tween.elem[tween.prop];}result=jQuery.css(tween.elem,tween.prop,"");return!result||result==="auto"?0:result;},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween);}else if(tween.elem.nodeType===1&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit);}else{tween.elem[tween.prop]=tween.now;}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now;}}};jQuery.easing={linear:function(p){return p;},swing:function(p){return 0.5-Math.cos(p*Math.PI)/2;},_default:"swing"};jQuery.fx=Tween.prototype.init;jQuery.fx.step={};var
fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rrun=/queueHooks$/;function createFxNow(){window.setTimeout(function(){fxNow=undefined;});return(fxNow=jQuery.now());}function genFx(type,includeWidth){var which,i=0,attrs={height:type};includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type;}if(includeWidth){attrs.opacity=attrs.width=type;}return attrs;}function createTween(value,prop,animation){var tween,collection=(Animation.tweeners[prop]||[]).concat(Animation.tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if((tween=collection[index].call(animation,prop,value))){return tween;}}}function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,display,checkDisplay,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=dataPriv.get(elem,"fxshow");if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire();}};}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire();}});});}if(elem.nodeType===1&&("height"in props||"width"in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];display=jQuery.css(elem,"display");checkDisplay=display==="none"?dataPriv.get(elem,"olddisplay")||defaultDisplay(elem.nodeName):display;if(checkDisplay==="inline"&&jQuery.css(elem,"float")==="none"){style.display="inline-block";}}if(opts.overflow){style.overflow="hidden";anim.always(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2];});}for(prop in props){value=props[prop];if(rfxtypes.exec(value)){delete props[prop];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){if(value==="show"&&dataShow&&dataShow[prop]!==undefined){hidden=true;}else{continue;}}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop);}else{display=undefined;}}if(!jQuery.isEmptyObject(orig)){if(dataShow){if("hidden"in dataShow){hidden=dataShow.hidden;}}else{dataShow=dataPriv.access(elem,"fxshow",{});}if(toggle){dataShow.hidden=!hidden;}if(hidden){jQuery(elem).show();}else{anim.done(function(){jQuery(elem).hide();});}anim.done(function(){var prop;dataPriv.remove(elem,"fxshow");for(prop in orig){jQuery.style(elem,prop,orig[prop]);}});for(prop in orig){tween=createTween(hidden?dataShow[prop]:0,prop,anim);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0;}}}}else if((display==="none"?defaultDisplay(elem.nodeName):display)==="inline"){style.display=display;}}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0];}if(index!==name){props[name]=value;delete props[index];}hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing;}}}else{specialEasing[name]=easing;}}}function Animation(elem,properties,options){var result,stopped,index=0,length=Animation.prefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem;}),tick=function(){if(stopped){return false;}var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent);}deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining;}else{deferred.resolveWith(elem,[animation]);return false;}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{},easing:jQuery.easing._default},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween;},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped){return this;}stopped=true;for(;index<length;index++){animation.tweens[index].run(1);}if(gotoEnd){deferred.notifyWith(elem,[animation,1,0]);deferred.resolveWith(elem,[animation,gotoEnd]);}else{deferred.rejectWith(elem,[animation,gotoEnd]);}return this;}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=Animation.prefilters[index].call(animation,elem,props,animation.opts);if(result){if(jQuery.isFunction(result.stop)){jQuery._queueHooks(animation.elem,animation.opts.queue).stop=jQuery.proxy(result.stop,result);}return result;}}jQuery.map(props,createTween,animation);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation);}jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always);}jQuery.Animation=jQuery.extend(Animation,{tweeners:{"*":[function(prop,value){var tween=this.createTween(prop,value);adjustCSS(tween.elem,prop,rcssNum.exec(value),tween);return tween;}]},tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"];}else{props=props.match(rnotwhite);}var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];Animation.tweeners[prop]=Animation.tweeners[prop]||[];Animation.tweeners[prop].unshift(callback);}},prefilters:[defaultPrefilter],prefilter:function(callback,prepend){if(prepend){Animation.prefilters.unshift(callback);}else{Animation.prefilters.push(callback);}}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx";}opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this);}if(opt.queue){jQuery.dequeue(this,opt.queue);}};return opt;};jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback);},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty||dataPriv.get(this,"finish")){anim.stop(true);}};doAnimation.finish=doAnimation;return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation);},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd);};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined;}if(clearQueue&&type!==false){this.queue(type||"fx",[]);}return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=dataPriv.get(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index]);}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index]);}}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1);}}if(dequeue||!gotoEnd){jQuery.dequeue(this,type);}});},finish:function(type){if(type!==false){type=type||"fx";}return this.each(function(){var index,data=dataPriv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;data.finish=true;jQuery.queue(this,type,[]);if(hooks&&hooks.stop){hooks.stop.call(this,true);}for(index=timers.length;index--;){if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(true);timers.splice(index,1);}}for(index=0;index<length;index++){if(queue[index]&&queue[index].finish){queue[index].finish.call(this);}}delete data.finish;});}});jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback);};});jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback);};});jQuery.timers=[];jQuery.fx.tick=function(){var timer,i=0,timers=jQuery.timers;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1);}}if(!timers.length){jQuery.fx.stop();}fxNow=undefined;};jQuery.fx.timer=function(timer){jQuery.timers.push(timer);if(timer()){jQuery.fx.start();}else{jQuery.timers.pop();}};jQuery.fx.interval=13;jQuery.fx.start=function(){if(!timerId){timerId=window.setInterval(jQuery.fx.tick,jQuery.fx.interval);}};jQuery.fx.stop=function(){window.clearInterval(timerId);timerId=null;};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fn.delay=function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=window.setTimeout(next,time);hooks.stop=function(){window.clearTimeout(timeout);};});};(function(){var input=document.createElement("input"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));input.type="checkbox";support.checkOn=input.value!=="";support.optSelected=opt.selected;select.disabled=true;support.optDisabled=!opt.disabled;input=document.createElement("input");input.value="t";input.type="radio";support.radioValue=input.value==="t";})();var boolHook,attrHandle=jQuery.expr.attrHandle;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1);},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name);});}});jQuery.extend({attr:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(nType===3||nType===8||nType===2){return;}if(typeof elem.getAttribute==="undefined"){return jQuery.prop(elem,name,value);}if(nType!==1||!jQuery.isXMLDoc(elem)){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:undefined);}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name);return;}if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret;}elem.setAttribute(name,value+"");return value;}if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret;}ret=jQuery.find.attr(elem,name);return ret==null?undefined:ret;},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val;}return value;}}}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(rnotwhite);if(attrNames&&elem.nodeType===1){while((name=attrNames[i++])){propName=jQuery.propFix[name]||name;if(jQuery.expr.match.bool.test(name)){elem[propName]=false;}elem.removeAttribute(name);}}}});boolHook={set:function(elem,value,name){if(value===false){jQuery.removeAttr(elem,name);}else{elem.setAttribute(name,name);}return name;}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=function(elem,name,isXML){var ret,handle;if(!isXML){handle=attrHandle[name];attrHandle[name]=ret;ret=getter(elem,name,isXML)!=null?name.toLowerCase():null;attrHandle[name]=handle;}return ret;};});var rfocusable=/^(?:input|select|textarea|button)$/i,rclickable=/^(?:a|area)$/i;jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1);},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name];});}});jQuery.extend({prop:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(nType===3||nType===8||nType===2){return;}if(nType!==1||!jQuery.isXMLDoc(elem)){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name];}if(value!==undefined){if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret;}return(elem[name]=value);}if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret;}return elem[name];},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,"tabindex");return tabindex?parseInt(tabindex,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:-1;}}},propFix:{"for":"htmlFor","class":"className"}});if(!support.optSelected){jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;if(parent&&parent.parentNode){parent.parentNode.selectedIndex;}return null;},set:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex;}}}};}jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this;});var rclass=/[\t\r\n\f]/g;function getClass(elem){return elem.getAttribute&&elem.getAttribute("class")||"";}jQuery.fn.extend({addClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,getClass(this)));});}if(typeof value==="string"&&value){classes=value.match(rnotwhite)||[];while((elem=this[i++])){curValue=getClass(elem);cur=elem.nodeType===1&&(" "+curValue+" ").replace(rclass," ");if(cur){j=0;while((clazz=classes[j++])){if(cur.indexOf(" "+clazz+" ")<0){cur+=clazz+" ";}}finalValue=jQuery.trim(cur);if(curValue!==finalValue){elem.setAttribute("class",finalValue);}}}}return this;},removeClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,getClass(this)));});}if(!arguments.length){return this.attr("class","");}if(typeof value==="string"&&value){classes=value.match(rnotwhite)||[];while((elem=this[i++])){curValue=getClass(elem);cur=elem.nodeType===1&&(" "+curValue+" ").replace(rclass," ");if(cur){j=0;while((clazz=classes[j++])){while(cur.indexOf(" "+clazz+" ")>-1){cur=cur.replace(" "+clazz+" "," ");}}finalValue=jQuery.trim(cur);if(curValue!==finalValue){elem.setAttribute("class",finalValue);}}}}return this;},toggleClass:function(value,stateVal){var type=typeof value;if(typeof stateVal==="boolean"&&type==="string"){return stateVal?this.addClass(value):this.removeClass(value);}if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,getClass(this),stateVal),stateVal);});}return this.each(function(){var className,i,self,classNames;if(type==="string"){i=0;self=jQuery(this);classNames=value.match(rnotwhite)||[];while((className=classNames[i++])){if(self.hasClass(className)){self.removeClass(className);}else{self.addClass(className);}}}else if(value===undefined||type==="boolean"){className=getClass(this);if(className){dataPriv.set(this,"__className__",className);}if(this.setAttribute){this.setAttribute("class",className||value===false?"":dataPriv.get(this,"__className__")||"");}}});},hasClass:function(selector){var className,elem,i=0;className=" "+selector+" ";while((elem=this[i++])){if(elem.nodeType===1&&(" "+getClass(elem)+" ").replace(rclass," ").indexOf(className)>-1){return true;}}return false;}});var rreturn=/\r/g,rspaces=/[\x20\t\r\n\f]+/g;jQuery.fn.extend({val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret;}ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret;}return;}isFunction=jQuery.isFunction(value);return this.each(function(i){var val;if(this.nodeType!==1){return;}if(isFunction){val=value.call(this,i,jQuery(this).val());}else{val=value;}if(val==null){val="";}else if(typeof val==="number"){val+="";}else if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+"";});}hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val;}});}});jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return val!=null?val:jQuery.trim(jQuery.text(elem)).replace(rspaces," ");}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value;}values.push(value);}}return values;},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;while(i--){option=options[i];if(option.selected=jQuery.inArray(jQuery.valHooks.option.get(option),values)>-1){optionSet=true;}}if(!optionSet){elem.selectedIndex=-1;}return values;}}}});jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value)){return(elem.checked=jQuery.inArray(jQuery(elem).val(),value)>-1);}}};if(!support.checkOn){jQuery.valHooks[this].get=function(elem){return elem.getAttribute("value")===null?"on":elem.value;};}});var rfocusMorph=/^(?:focusinfocus|focusoutblur)$/;jQuery.extend(jQuery.event,{trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];cur=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8){return;}if(rfocusMorph.test(type+jQuery.event.triggered)){return;}if(type.indexOf(".")>-1){namespaces=type.split(".");type=namespaces.shift();namespaces.sort();}ontype=type.indexOf(":")<0&&"on"+type;event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event==="object"&&event);event.isTrigger=onlyHandlers?2:3;event.namespace=namespaces.join(".");event.rnamespace=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;event.result=undefined;if(!event.target){event.target=elem;}data=data==null?[event]:jQuery.makeArray(data,[event]);special=jQuery.event.special[type]||{};if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===false){return;}if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;if(!rfocusMorph.test(bubbleType+type)){cur=cur.parentNode;}for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur;}if(tmp===(elem.ownerDocument||document)){eventPath.push(tmp.defaultView||tmp.parentWindow||window);}}i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped()){event.type=i>1?bubbleType:special.bindType||type;handle=(dataPriv.get(cur,"events")||{})[event.type]&&dataPriv.get(cur,"handle");if(handle){handle.apply(cur,data);}handle=ontype&&cur[ontype];if(handle&&handle.apply&&acceptData(cur)){event.result=handle.apply(cur,data);if(event.result===false){event.preventDefault();}}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(eventPath.pop(),data)===false)&&acceptData(elem)){if(ontype&&jQuery.isFunction(elem[type])&&!jQuery.isWindow(elem)){tmp=elem[ontype];if(tmp){elem[ontype]=null;}jQuery.event.triggered=type;elem[type]();jQuery.event.triggered=undefined;if(tmp){elem[ontype]=tmp;}}}}return event.result;},simulate:function(type,elem,event){var e=jQuery.extend(new jQuery.Event(),event,{type:type,isSimulated:true});jQuery.event.trigger(e,null,elem);}});jQuery.fn.extend({trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this);});},triggerHandler:function(type,data){var elem=this[0];if(elem){return jQuery.event.trigger(type,data,elem,true);}}});jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name);};});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver);}});support.focusin="onfocusin"in window;if(!support.focusin){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event));};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=dataPriv.access(doc,fix);if(!attaches){doc.addEventListener(orig,handler,true);}dataPriv.access(doc,fix,(attaches||0)+1);},teardown:function(){var doc=this.ownerDocument||this,attaches=dataPriv.access(doc,fix)-1;if(!attaches){doc.removeEventListener(orig,handler,true);dataPriv.remove(doc,fix);}else{dataPriv.access(doc,fix,attaches);}}};});}var location=window.location;var nonce=jQuery.now();var rquery=(/\?/);jQuery.parseJSON=function(data){return JSON.parse(data+"");};jQuery.parseXML=function(data){var xml;if(!data||typeof data!=="string"){return null;}try{xml=(new window.DOMParser()).parseFromString(data,"text/xml");}catch(e){xml=undefined;}if(!xml||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data);}return xml;};var
rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/mg,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,prefilters={},transports={},allTypes="*/".concat("*"),originAnchor=document.createElement("a");originAnchor.href=location.href;function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*";}var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnotwhite)||[];if(jQuery.isFunction(func)){while((dataType=dataTypes[i++])){if(dataType[0]==="+"){dataType=dataType.slice(1)||"*";(structure[dataType]=structure[dataType]||[]).unshift(func);}else{(structure[dataType]=structure[dataType]||[]).push(func);}}}};}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=(structure===transports);function inspect(dataType){var selected;inspected[dataType]=true;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if(typeof dataTypeOrTransport==="string"&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return false;}else if(seekingTransport){return!(selected=dataTypeOrTransport);}});return selected;}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*");}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:(deep||(deep={})))[key]=src[key];}}if(deep){jQuery.extend(true,target,deep);}return target;}function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("Content-Type");}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break;}}}if(dataTypes[0]in responses){finalDataType=dataTypes[0];}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break;}if(!firstDataType){firstDataType=type;}}finalDataType=finalDataType||firstDataType;}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType);}return responses[finalDataType];}}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv];}}current=dataTypes.shift();while(current){if(s.responseFields[current]){jqXHR[s.responseFields[current]]=response;}if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType);}prev=current;current=dataTypes.shift();if(current){if(current==="*"){current=prev;}else if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2];}else if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1]);}break;}}}}if(conv!==true){if(conv&&s.throws){response=conv(response);}else{try{response=conv(response);}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current};}}}}}}return{state:"success",data:response};}jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:location.href,type:"GET",isLocal:rlocalProtocol.test(location.protocol),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target);},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined;}options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,urlAnchor,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while((match=rheaders.exec(responseHeadersString))){responseHeaders[match[1].toLowerCase()]=match[2];}}match=responseHeaders[key.toLowerCase()];}return match==null?null:match;},getAllResponseHeaders:function(){return state===2?responseHeadersString:null;},setRequestHeader:function(name,value){var lname=name.toLowerCase();if(!state){name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value;}return this;},overrideMimeType:function(type){if(!state){s.mimeType=type;}return this;},statusCode:function(map){var code;if(map){if(state<2){for(code in map){statusCode[code]=[statusCode[code],map[code]];}}else{jqXHR.always(map[jqXHR.status]);}}return this;},abort:function(statusText){var finalText=statusText||strAbort;if(transport){transport.abort(finalText);}done(0,finalText);return this;}};deferred.promise(jqXHR).complete=completeDeferred.add;jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;s.url=((url||s.url||location.href)+"").replace(rhash,"").replace(rprotocol,location.protocol+"//");s.type=options.method||options.type||s.method||s.type;s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(rnotwhite)||[""];if(s.crossDomain==null){urlAnchor=document.createElement("a");try{urlAnchor.href=s.url;urlAnchor.href=urlAnchor.href;s.crossDomain=originAnchor.protocol+"//"+originAnchor.host!==urlAnchor.protocol+"//"+urlAnchor.host;}catch(e){s.crossDomain=true;}}if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional);}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR;}fireGlobals=jQuery.event&&s.global;if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart");}s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url;if(!s.hasContent){if(s.data){cacheURL=(s.url+=(rquery.test(cacheURL)?"&":"?")+s.data);delete s.data;}if(s.cache===false){s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+nonce++):cacheURL+(rquery.test(cacheURL)?"&":"?")+"_="+nonce++;}}if(s.ifModified){if(jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL]);}if(jQuery.etag[cacheURL]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL]);}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType);}jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i]);}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort();}strAbort="abort";for(i in{success:1,error:1,complete:1}){jqXHR[i](s[i]);}transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport");}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s]);}if(state===2){return jqXHR;}if(s.async&&s.timeout>0){timeoutTimer=window.setTimeout(function(){jqXHR.abort("timeout");},s.timeout);}try{state=1;transport.send(requestHeaders,done);}catch(e){if(state<2){done(-1,e);}else{throw e;}}}function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return;}state=2;if(timeoutTimer){window.clearTimeout(timeoutTimer);}transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;if(responses){response=ajaxHandleResponses(s,jqXHR,responses);}response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[cacheURL]=modified;}modified=jqXHR.getResponseHeader("etag");if(modified){jQuery.etag[cacheURL]=modified;}}if(status===204||s.type==="HEAD"){statusText="nocontent";}else if(status===304){statusText="notmodified";}else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error;}}else{error=statusText;if(status||!statusText){statusText="error";if(status<0){status=0;}}}jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR]);}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error]);}jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error]);}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!(--jQuery.active)){jQuery.event.trigger("ajaxStop");}}}return jqXHR;},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json");},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script");}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined;}return jQuery.ajax(jQuery.extend({url:url,type:method,dataType:type,data:data,success:callback},jQuery.isPlainObject(url)&&url));};});jQuery._evalUrl=function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:false,global:false,"throws":true});};jQuery.fn.extend({wrapAll:function(html){var wrap;if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i));});}if(this[0]){wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0]);}wrap.map(function(){var elem=this;while(elem.firstElementChild){elem=elem.firstElementChild;}return elem;}).append(this);}return this;},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i));});}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html);}else{self.append(html);}});},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html);});},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes);}}).end();}});jQuery.expr.filters.hidden=function(elem){return!jQuery.expr.filters.visible(elem);};jQuery.expr.filters.visible=function(elem){return elem.offsetWidth>0||elem.offsetHeight>0||elem.getClientRects().length>0;};var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v);}else{buildParams(prefix+"["+(typeof v==="object"&&v!=null?i:"")+"]",v,traditional,add);}});}else if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add);}}else{add(prefix,obj);}}jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():(value==null?"":value);s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value);};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional;}if(jQuery.isArray(a)||(a.jquery&&!jQuery.isPlainObject(a))){jQuery.each(a,function(){add(this.name,this.value);});}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add);}}return s.join("&").replace(r20,"+");};jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray());},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this;}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type));}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")};}):{name:elem.name,value:val.replace(rCRLF,"\r\n")};}).get();}});jQuery.ajaxSettings.xhr=function(){try{return new window.XMLHttpRequest();}catch(e){}};var xhrSuccessStatus={0:200,1223:204},xhrSupported=jQuery.ajaxSettings.xhr();support.cors=!!xhrSupported&&("withCredentials"in xhrSupported);support.ajax=xhrSupported=!!xhrSupported;jQuery.ajaxTransport(function(options){var callback,errorCallback;if(support.cors||xhrSupported&&!options.crossDomain){return{send:function(headers,complete){var i,xhr=options.xhr();xhr.open(options.type,options.url,options.async,options.username,options.password);if(options.xhrFields){for(i in options.xhrFields){xhr[i]=options.xhrFields[i];}}if(options.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType);}if(!options.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest";}for(i in headers){xhr.setRequestHeader(i,headers[i]);}callback=function(type){return function(){if(callback){callback=errorCallback=xhr.onload=xhr.onerror=xhr.onabort=xhr.onreadystatechange=null;if(type==="abort"){xhr.abort();}else if(type==="error"){if(typeof xhr.status!=="number"){complete(0,"error");}else{complete(xhr.status,xhr.statusText);}}else{complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,(xhr.responseType||"text")!=="text"||typeof xhr.responseText!=="string"?{binary:xhr.response}:{text:xhr.responseText},xhr.getAllResponseHeaders());}}};};xhr.onload=callback();errorCallback=xhr.onerror=callback("error");if(xhr.onabort!==undefined){xhr.onabort=errorCallback;}else{xhr.onreadystatechange=function(){if(xhr.readyState===4){window.setTimeout(function(){if(callback){errorCallback();}});}};}callback=callback("abort");try{xhr.send(options.hasContent&&options.data||null);}catch(e){if(callback){throw e;}}},abort:function(){if(callback){callback();}}};}});jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, "+"application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(text){jQuery.globalEval(text);return text;}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false;}if(s.crossDomain){s.type="GET";}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,callback;return{send:function(_,complete){script=jQuery("<script>").prop({charset:s.scriptCharset,src:s.url}).on("load error",callback=function(evt){script.remove();callback=null;if(evt){complete(evt.type==="error"?404:200,evt.type);}});document.head.appendChild(script[0]);},abort:function(){if(callback){callback();}}};}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||(jQuery.expando+"_"+(nonce++));this[callback]=true;return callback;}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==false&&(rjsonp.test(s.url)?"url":typeof s.data==="string"&&(s.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&rjsonp.test(s.data)&&"data");if(jsonProp||s.dataTypes[0]==="jsonp"){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;if(jsonProp){s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName);}else if(s.jsonp!==false){s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName;}s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called");}return responseContainer[0];};s.dataTypes[0]="json";overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments;};jqXHR.always(function(){if(overwritten===undefined){jQuery(window).removeProp(callbackName);}else{window[callbackName]=overwritten;}if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName);}if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0]);}responseContainer=overwritten=undefined;});return"script";}});jQuery.parseHTML=function(data,context,keepScripts){if(!data||typeof data!=="string"){return null;}if(typeof context==="boolean"){keepScripts=context;context=false;}context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];if(parsed){return[context.createElement(parsed[1])];}parsed=buildFragment([data],context,scripts);if(scripts&&scripts.length){jQuery(scripts).remove();}return jQuery.merge([],parsed.childNodes);};var _load=jQuery.fn.load;jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments);}var selector,type,response,self=this,off=url.indexOf(" ");if(off>-1){selector=jQuery.trim(url.slice(off));url=url.slice(0,off);}if(jQuery.isFunction(params)){callback=params;params=undefined;}else if(params&&typeof params==="object"){type="POST";}if(self.length>0){jQuery.ajax({url:url,type:type||"GET",dataType:"html",data:params}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText);}).always(callback&&function(jqXHR,status){self.each(function(){callback.apply(this,response||[jqXHR.responseText,status,jqXHR]);});});}return this;};jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn);};});jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem;}).length;};function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9&&elem.defaultView;}jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};if(position==="static"){elem.style.position="relative";}curOffset=curElem.offset();curCSSTop=jQuery.css(elem,"top");curCSSLeft=jQuery.css(elem,"left");calculatePosition=(position==="absolute"||position==="fixed")&&(curCSSTop+curCSSLeft).indexOf("auto")>-1;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left;}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0;}if(jQuery.isFunction(options)){options=options.call(elem,i,jQuery.extend({},curOffset));}if(options.top!=null){props.top=(options.top-curOffset.top)+curTop;}if(options.left!=null){props.left=(options.left-curOffset.left)+curLeft;}if("using"in options){options.using.call(elem,props);}else{curElem.css(props);}}};jQuery.fn.extend({offset:function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i);});}var docElem,win,elem=this[0],box={top:0,left:0},doc=elem&&elem.ownerDocument;if(!doc){return;}docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box;}box=elem.getBoundingClientRect();win=getWindow(doc);return{top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft};},position:function(){if(!this[0]){return;}var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};if(jQuery.css(elem,"position")==="fixed"){offset=elem.getBoundingClientRect();}else{offsetParent=this.offsetParent();offset=this.offset();if(!jQuery.nodeName(offsetParent[0],"html")){parentOffset=offsetParent.offset();}parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",true);parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",true);}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",true),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",true)};},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent;while(offsetParent&&jQuery.css(offsetParent,"position")==="static"){offsetParent=offsetParent.offsetParent;}return offsetParent||documentElement;});}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?win[prop]:elem[method];}if(win){win.scrollTo(!top?val:win.pageXOffset,top?val:win.pageYOffset);}else{elem[method]=val;}},method,val,arguments.length);};});jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){if(computed){computed=curCSS(elem,prop);return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed;}});});jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name];}if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name]);}return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra);},type,chainable?margin:undefined,chainable,null);};});});jQuery.fn.extend({bind:function(types,data,fn){return this.on(types,null,data,fn);},unbind:function(types,fn){return this.off(types,null,fn);},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn);},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn);},size:function(){return this.length;}});jQuery.fn.andSelf=jQuery.fn.addBack;if(typeof define==="function"&&define.amd){define("jquery",[],function(){return jQuery;});}var
_jQuery=window.jQuery,_$=window.$;jQuery.noConflict=function(deep){if(window.$===jQuery){window.$=_$;}if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery;}return jQuery;};if(!noGlobal){window.jQuery=window.$=jQuery;}return jQuery;}));},{}],402:[function(require,module,exports){var createFindIndex=require('../internal/createFindIndex');var findIndex=createFindIndex();module.exports=findIndex;},{"../internal/createFindIndex":496}],403:[function(require,module,exports){var baseFlatten=require('../internal/baseFlatten'),isIterateeCall=require('../internal/isIterateeCall');function flatten(array,isDeep,guard){var length=array?array.length:0;if(guard&&isIterateeCall(array,isDeep,guard)){isDeep=false;}return length?baseFlatten(array,isDeep):[];}module.exports=flatten;},{"../internal/baseFlatten":456,"../internal/isIterateeCall":516}],404:[function(require,module,exports){var baseFlatten=require('../internal/baseFlatten');function flattenDeep(array){var length=array?array.length:0;return length?baseFlatten(array,true):[];}module.exports=flattenDeep;},{"../internal/baseFlatten":456}],405:[function(require,module,exports){var baseIndexOf=require('../internal/baseIndexOf'),cacheIndexOf=require('../internal/cacheIndexOf'),createCache=require('../internal/createCache'),isArrayLike=require('../internal/isArrayLike'),restParam=require('../function/restParam');var intersection=restParam(function(arrays){var othLength=arrays.length,othIndex=othLength,caches=Array(length),indexOf=baseIndexOf,isCommon=true,result=[];while(othIndex--){var value=arrays[othIndex]=isArrayLike(value=arrays[othIndex])?value:[];caches[othIndex]=(isCommon&&value.length>=120)?createCache(othIndex&&value):null;}var array=arrays[0],index=-1,length=array?array.length:0,seen=caches[0];outer:while(++index<length){value=array[index];if((seen?cacheIndexOf(seen,value):indexOf(result,value,0))<0){var othIndex=othLength;while(--othIndex){var cache=caches[othIndex];if((cache?cacheIndexOf(cache,value):indexOf(arrays[othIndex],value,0))<0){continue outer;}}if(seen){seen.push(value);}result.push(value);}}return result;});module.exports=intersection;},{"../function/restParam":430,"../internal/baseIndexOf":461,"../internal/cacheIndexOf":483,"../internal/createCache":493,"../internal/isArrayLike":514}],406:[function(require,module,exports){function last(array){var length=array?array.length:0;return length?array[length-1]:undefined;}module.exports=last;},{}],407:[function(require,module,exports){var baseFlatten=require('../internal/baseFlatten'),baseUniq=require('../internal/baseUniq'),restParam=require('../function/restParam');var union=restParam(function(arrays){return baseUniq(baseFlatten(arrays,false,true));});module.exports=union;},{"../function/restParam":430,"../internal/baseFlatten":456,"../internal/baseUniq":479}],408:[function(require,module,exports){var baseCallback=require('../internal/baseCallback'),baseUniq=require('../internal/baseUniq'),isIterateeCall=require('../internal/isIterateeCall'),sortedUniq=require('../internal/sortedUniq');function uniq(array,isSorted,iteratee,thisArg){var length=array?array.length:0;if(!length){return[];}if(isSorted!=null&&typeof isSorted!='boolean'){thisArg=iteratee;iteratee=isIterateeCall(array,isSorted,thisArg)?undefined:isSorted;isSorted=false;}iteratee=iteratee==null?iteratee:baseCallback(iteratee,thisArg,3);return(isSorted)?sortedUniq(array,iteratee):baseUniq(array,iteratee);}module.exports=uniq;},{"../internal/baseCallback":444,"../internal/baseUniq":479,"../internal/isIterateeCall":516,"../internal/sortedUniq":531}],409:[function(require,module,exports){module.exports=require('./uniq');},{"./uniq":408}],410:[function(require,module,exports){var baseDifference=require('../internal/baseDifference'),isArrayLike=require('../internal/isArrayLike'),restParam=require('../function/restParam');var without=restParam(function(array,values){return isArrayLike(array)?baseDifference(array,values):[];});module.exports=without;},{"../function/restParam":430,"../internal/baseDifference":450,"../internal/isArrayLike":514}],411:[function(require,module,exports){var arrayPush=require('../internal/arrayPush'),baseDifference=require('../internal/baseDifference'),baseUniq=require('../internal/baseUniq'),isArrayLike=require('../internal/isArrayLike');function xor(){var index=-1,length=arguments.length;while(++index<length){var array=arguments[index];if(isArrayLike(array)){var result=result?arrayPush(baseDifference(result,array),baseDifference(array,result)):array;}}return result?baseUniq(result):[];}module.exports=xor;},{"../internal/arrayPush":439,"../internal/baseDifference":450,"../internal/baseUniq":479,"../internal/isArrayLike":514}],412:[function(require,module,exports){var LazyWrapper=require('../internal/LazyWrapper'),LodashWrapper=require('../internal/LodashWrapper'),baseLodash=require('../internal/baseLodash'),isArray=require('../lang/isArray'),isObjectLike=require('../internal/isObjectLike'),wrapperClone=require('../internal/wrapperClone');var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper){return value;}if(hasOwnProperty.call(value,'__chain__')&&hasOwnProperty.call(value,'__wrapped__')){return wrapperClone(value);}}return new LodashWrapper(value);}lodash.prototype=baseLodash.prototype;module.exports=lodash;},{"../internal/LazyWrapper":431,"../internal/LodashWrapper":432,"../internal/baseLodash":465,"../internal/isObjectLike":520,"../internal/wrapperClone":534,"../lang/isArray":537}],413:[function(require,module,exports){module.exports=require('./some');},{"./some":424}],414:[function(require,module,exports){var arrayEvery=require('../internal/arrayEvery'),baseCallback=require('../internal/baseCallback'),baseEvery=require('../internal/baseEvery'),isArray=require('../lang/isArray'),isIterateeCall=require('../internal/isIterateeCall');function every(collection,predicate,thisArg){var func=isArray(collection)?arrayEvery:baseEvery;if(thisArg&&isIterateeCall(collection,predicate,thisArg)){predicate=undefined;}if(typeof predicate!='function'||thisArg!==undefined){predicate=baseCallback(predicate,thisArg,3);}return func(collection,predicate);}module.exports=every;},{"../internal/arrayEvery":436,"../internal/baseCallback":444,"../internal/baseEvery":452,"../internal/isIterateeCall":516,"../lang/isArray":537}],415:[function(require,module,exports){var arrayFilter=require('../internal/arrayFilter'),baseCallback=require('../internal/baseCallback'),baseFilter=require('../internal/baseFilter'),isArray=require('../lang/isArray');function filter(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;predicate=baseCallback(predicate,thisArg,3);return func(collection,predicate);}module.exports=filter;},{"../internal/arrayFilter":437,"../internal/baseCallback":444,"../internal/baseFilter":453,"../lang/isArray":537}],416:[function(require,module,exports){var baseEach=require('../internal/baseEach'),createFind=require('../internal/createFind');var find=createFind(baseEach);module.exports=find;},{"../internal/baseEach":451,"../internal/createFind":495}],417:[function(require,module,exports){var arrayEach=require('../internal/arrayEach'),baseEach=require('../internal/baseEach'),createForEach=require('../internal/createForEach');var forEach=createForEach(arrayEach,baseEach);module.exports=forEach;},{"../internal/arrayEach":435,"../internal/baseEach":451,"../internal/createForEach":497}],418:[function(require,module,exports){var createAggregator=require('../internal/createAggregator');var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var groupBy=createAggregator(function(result,value,key){if(hasOwnProperty.call(result,key)){result[key].push(value);}else{result[key]=[value];}});module.exports=groupBy;},{"../internal/createAggregator":488}],419:[function(require,module,exports){var createAggregator=require('../internal/createAggregator');var indexBy=createAggregator(function(result,value,key){result[key]=value;});module.exports=indexBy;},{"../internal/createAggregator":488}],420:[function(require,module,exports){var arrayMap=require('../internal/arrayMap'),baseCallback=require('../internal/baseCallback'),baseMap=require('../internal/baseMap'),isArray=require('../lang/isArray');function map(collection,iteratee,thisArg){var func=isArray(collection)?arrayMap:baseMap;iteratee=baseCallback(iteratee,thisArg,3);return func(collection,iteratee);}module.exports=map;},{"../internal/arrayMap":438,"../internal/baseCallback":444,"../internal/baseMap":466,"../lang/isArray":537}],421:[function(require,module,exports){var arrayReduce=require('../internal/arrayReduce'),baseEach=require('../internal/baseEach'),createReduce=require('../internal/createReduce');var reduce=createReduce(arrayReduce,baseEach);module.exports=reduce;},{"../internal/arrayReduce":440,"../internal/baseEach":451,"../internal/createReduce":500}],422:[function(require,module,exports){var arrayFilter=require('../internal/arrayFilter'),baseCallback=require('../internal/baseCallback'),baseFilter=require('../internal/baseFilter'),isArray=require('../lang/isArray');function reject(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;predicate=baseCallback(predicate,thisArg,3);return func(collection,function(value,index,collection){return!predicate(value,index,collection);});}module.exports=reject;},{"../internal/arrayFilter":437,"../internal/baseCallback":444,"../internal/baseFilter":453,"../lang/isArray":537}],423:[function(require,module,exports){var getLength=require('../internal/getLength'),isLength=require('../internal/isLength'),keys=require('../object/keys');function size(collection){var length=collection?getLength(collection):0;return isLength(length)?length:keys(collection).length;}module.exports=size;},{"../internal/getLength":507,"../internal/isLength":519,"../object/keys":550}],424:[function(require,module,exports){var arraySome=require('../internal/arraySome'),baseCallback=require('../internal/baseCallback'),baseSome=require('../internal/baseSome'),isArray=require('../lang/isArray'),isIterateeCall=require('../internal/isIterateeCall');function some(collection,predicate,thisArg){var func=isArray(collection)?arraySome:baseSome;if(thisArg&&isIterateeCall(collection,predicate,thisArg)){predicate=undefined;}if(typeof predicate!='function'||thisArg!==undefined){predicate=baseCallback(predicate,thisArg,3);}return func(collection,predicate);}module.exports=some;},{"../internal/arraySome":441,"../internal/baseCallback":444,"../internal/baseSome":476,"../internal/isIterateeCall":516,"../lang/isArray":537}],425:[function(require,module,exports){var baseCallback=require('../internal/baseCallback'),baseMap=require('../internal/baseMap'),baseSortBy=require('../internal/baseSortBy'),compareAscending=require('../internal/compareAscending'),isIterateeCall=require('../internal/isIterateeCall');function sortBy(collection,iteratee,thisArg){if(collection==null){return[];}if(thisArg&&isIterateeCall(collection,iteratee,thisArg)){iteratee=undefined;}var index=-1;iteratee=baseCallback(iteratee,thisArg,3);var result=baseMap(collection,function(value,key,collection){return{'criteria':iteratee(value,key,collection),'index':++index,'value':value};});return baseSortBy(result,compareAscending);}module.exports=sortBy;},{"../internal/baseCallback":444,"../internal/baseMap":466,"../internal/baseSortBy":477,"../internal/compareAscending":485,"../internal/isIterateeCall":516}],426:[function(require,module,exports){var getNative=require('../internal/getNative');var nativeNow=getNative(Date,'now');var now=nativeNow||function(){return new Date().getTime();};module.exports=now;},{"../internal/getNative":509}],427:[function(require,module,exports){var createWrapper=require('../internal/createWrapper'),replaceHolders=require('../internal/replaceHolders'),restParam=require('./restParam');var BIND_FLAG=1,PARTIAL_FLAG=32;var bind=restParam(function(func,thisArg,partials){var bitmask=BIND_FLAG;if(partials.length){var holders=replaceHolders(partials,bind.placeholder);bitmask|=PARTIAL_FLAG;}return createWrapper(func,bitmask,thisArg,partials,holders);});bind.placeholder={};module.exports=bind;},{"../internal/createWrapper":501,"../internal/replaceHolders":528,"./restParam":430}],428:[function(require,module,exports){var isObject=require('../lang/isObject'),now=require('../date/now');var FUNC_ERROR_TEXT='Expected a function';var nativeMax=Math.max;function debounce(func,wait,options){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=false,trailing=true;if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}wait=wait<0?0:(+wait||0);if(options===true){var leading=true;trailing=false;}else if(isObject(options)){leading=!!options.leading;maxWait='maxWait'in options&&nativeMax(+options.maxWait||0,wait);trailing='trailing'in options?!!options.trailing:trailing;}function cancel(){if(timeoutId){clearTimeout(timeoutId);}if(maxTimeoutId){clearTimeout(maxTimeoutId);}lastCalled=0;maxTimeoutId=timeoutId=trailingCall=undefined;}function complete(isCalled,id){if(id){clearTimeout(id);}maxTimeoutId=timeoutId=trailingCall=undefined;if(isCalled){lastCalled=now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=undefined;}}}function delayed(){var remaining=wait-(now()-stamp);if(remaining<=0||remaining>wait){complete(trailingCall,maxTimeoutId);}else{timeoutId=setTimeout(delayed,remaining);}}function maxDelayed(){complete(trailing,timeoutId);}function debounced(){args=arguments;stamp=now();thisArg=this;trailingCall=trailing&&(timeoutId||!leading);if(maxWait===false){var leadingCall=leading&&!timeoutId;}else{if(!maxTimeoutId&&!leading){lastCalled=stamp;}var remaining=maxWait-(stamp-lastCalled),isCalled=remaining<=0||remaining>maxWait;if(isCalled){if(maxTimeoutId){maxTimeoutId=clearTimeout(maxTimeoutId);}lastCalled=stamp;result=func.apply(thisArg,args);}else if(!maxTimeoutId){maxTimeoutId=setTimeout(maxDelayed,remaining);}}if(isCalled&&timeoutId){timeoutId=clearTimeout(timeoutId);}else if(!timeoutId&&wait!==maxWait){timeoutId=setTimeout(delayed,wait);}if(leadingCall){isCalled=true;result=func.apply(thisArg,args);}if(isCalled&&!timeoutId&&!maxTimeoutId){args=thisArg=undefined;}return result;}debounced.cancel=cancel;return debounced;}module.exports=debounce;},{"../date/now":426,"../lang/isObject":542}],429:[function(require,module,exports){var baseDelay=require('../internal/baseDelay'),restParam=require('./restParam');var defer=restParam(function(func,args){return baseDelay(func,1,args);});module.exports=defer;},{"../internal/baseDelay":449,"./restParam":430}],430:[function(require,module,exports){var FUNC_ERROR_TEXT='Expected a function';var nativeMax=Math.max;function restParam(func,start){if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}start=nativeMax(start===undefined?(func.length-1):(+start||0),0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),rest=Array(length);while(++index<length){rest[index]=args[start+index];}switch(start){case 0:return func.call(this,rest);case 1:return func.call(this,args[0],rest);case 2:return func.call(this,args[0],args[1],rest);}var otherArgs=Array(start+1);index=-1;while(++index<start){otherArgs[index]=args[index];}otherArgs[start]=rest;return func.apply(this,otherArgs);};}module.exports=restParam;},{}],431:[function(require,module,exports){var baseCreate=require('./baseCreate'),baseLodash=require('./baseLodash');var POSITIVE_INFINITY=Number.POSITIVE_INFINITY;function LazyWrapper(value){this.__wrapped__=value;this.__actions__=[];this.__dir__=1;this.__filtered__=false;this.__iteratees__=[];this.__takeCount__=POSITIVE_INFINITY;this.__views__=[];}LazyWrapper.prototype=baseCreate(baseLodash.prototype);LazyWrapper.prototype.constructor=LazyWrapper;module.exports=LazyWrapper;},{"./baseCreate":448,"./baseLodash":465}],432:[function(require,module,exports){var baseCreate=require('./baseCreate'),baseLodash=require('./baseLodash');function LodashWrapper(value,chainAll,actions){this.__wrapped__=value;this.__actions__=actions||[];this.__chain__=!!chainAll;}LodashWrapper.prototype=baseCreate(baseLodash.prototype);LodashWrapper.prototype.constructor=LodashWrapper;module.exports=LodashWrapper;},{"./baseCreate":448,"./baseLodash":465}],433:[function(require,module,exports){(function(global){var cachePush=require('./cachePush'),getNative=require('./getNative');var Set=getNative(global,'Set');var nativeCreate=getNative(Object,'create');function SetCache(values){var length=values?values.length:0;this.data={'hash':nativeCreate(null),'set':new Set};while(length--){this.push(values[length]);}}SetCache.prototype.push=cachePush;module.exports=SetCache;}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./cachePush":484,"./getNative":509}],434:[function(require,module,exports){function arrayCopy(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index];}return array;}module.exports=arrayCopy;},{}],435:[function(require,module,exports){function arrayEach(array,iteratee){var index=-1,length=array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break;}}return array;}module.exports=arrayEach;},{}],436:[function(require,module,exports){function arrayEvery(array,predicate){var index=-1,length=array.length;while(++index<length){if(!predicate(array[index],index,array)){return false;}}return true;}module.exports=arrayEvery;},{}],437:[function(require,module,exports){function arrayFilter(array,predicate){var index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[++resIndex]=value;}}return result;}module.exports=arrayFilter;},{}],438:[function(require,module,exports){function arrayMap(array,iteratee){var index=-1,length=array.length,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array);}return result;}module.exports=arrayMap;},{}],439:[function(require,module,exports){function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index];}return array;}module.exports=arrayPush;},{}],440:[function(require,module,exports){function arrayReduce(array,iteratee,accumulator,initFromArray){var index=-1,length=array.length;if(initFromArray&&length){accumulator=array[++index];}while(++index<length){accumulator=iteratee(accumulator,array[index],index,array);}return accumulator;}module.exports=arrayReduce;},{}],441:[function(require,module,exports){function arraySome(array,predicate){var index=-1,length=array.length;while(++index<length){if(predicate(array[index],index,array)){return true;}}return false;}module.exports=arraySome;},{}],442:[function(require,module,exports){var keys=require('../object/keys');function assignWith(object,source,customizer){var index=-1,props=keys(source),length=props.length;while(++index<length){var key=props[index],value=object[key],result=customizer(value,source[key],key,object,source);if((result===result?(result!==value):(value===value))||(value===undefined&&!(key in object))){object[key]=result;}}return object;}module.exports=assignWith;},{"../object/keys":550}],443:[function(require,module,exports){var baseCopy=require('./baseCopy'),keys=require('../object/keys');function baseAssign(object,source){return source==null?object:baseCopy(source,keys(source),object);}module.exports=baseAssign;},{"../object/keys":550,"./baseCopy":447}],444:[function(require,module,exports){var baseMatches=require('./baseMatches'),baseMatchesProperty=require('./baseMatchesProperty'),bindCallback=require('./bindCallback'),identity=require('../utility/identity'),property=require('../utility/property');function baseCallback(func,thisArg,argCount){var type=typeof func;if(type=='function'){return thisArg===undefined?func:bindCallback(func,thisArg,argCount);}if(func==null){return identity;}if(type=='object'){return baseMatches(func);}return thisArg===undefined?property(func):baseMatchesProperty(func,thisArg);}module.exports=baseCallback;},{"../utility/identity":558,"../utility/property":560,"./baseMatches":467,"./baseMatchesProperty":468,"./bindCallback":481}],445:[function(require,module,exports){var arrayCopy=require('./arrayCopy'),arrayEach=require('./arrayEach'),baseAssign=require('./baseAssign'),baseForOwn=require('./baseForOwn'),initCloneArray=require('./initCloneArray'),initCloneByTag=require('./initCloneByTag'),initCloneObject=require('./initCloneObject'),isArray=require('../lang/isArray'),isObject=require('../lang/isObject');var argsTag='[object Arguments]',arrayTag='[object Array]',boolTag='[object Boolean]',dateTag='[object Date]',errorTag='[object Error]',funcTag='[object Function]',mapTag='[object Map]',numberTag='[object Number]',objectTag='[object Object]',regexpTag='[object RegExp]',setTag='[object Set]',stringTag='[object String]',weakMapTag='[object WeakMap]';var arrayBufferTag='[object ArrayBuffer]',float32Tag='[object Float32Array]',float64Tag='[object Float64Array]',int8Tag='[object Int8Array]',int16Tag='[object Int16Array]',int32Tag='[object Int32Array]',uint8Tag='[object Uint8Array]',uint8ClampedTag='[object Uint8ClampedArray]',uint16Tag='[object Uint16Array]',uint32Tag='[object Uint32Array]';var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[stringTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=true;cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[mapTag]=cloneableTags[setTag]=cloneableTags[weakMapTag]=false;var objectProto=Object.prototype;var objToString=objectProto.toString;function baseClone(value,isDeep,customizer,key,object,stackA,stackB){var result;if(customizer){result=object?customizer(value,key,object):customizer(value);}if(result!==undefined){return result;}if(!isObject(value)){return value;}var isArr=isArray(value);if(isArr){result=initCloneArray(value);if(!isDeep){return arrayCopy(value,result);}}else{var tag=objToString.call(value),isFunc=tag==funcTag;if(tag==objectTag||tag==argsTag||(isFunc&&!object)){result=initCloneObject(isFunc?{}:value);if(!isDeep){return baseAssign(result,value);}}else{return cloneableTags[tag]?initCloneByTag(value,tag,isDeep):(object?value:{});}}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==value){return stackB[length];}}stackA.push(value);stackB.push(result);(isArr?arrayEach:baseForOwn)(value,function(subValue,key){result[key]=baseClone(subValue,isDeep,customizer,key,value,stackA,stackB);});return result;}module.exports=baseClone;},{"../lang/isArray":537,"../lang/isObject":542,"./arrayCopy":434,"./arrayEach":435,"./baseAssign":443,"./baseForOwn":459,"./initCloneArray":511,"./initCloneByTag":512,"./initCloneObject":513}],446:[function(require,module,exports){function baseCompareAscending(value,other){if(value!==other){var valIsNull=value===null,valIsUndef=value===undefined,valIsReflexive=value===value;var othIsNull=other===null,othIsUndef=other===undefined,othIsReflexive=other===other;if((value>other&&!othIsNull)||!valIsReflexive||(valIsNull&&!othIsUndef&&othIsReflexive)||(valIsUndef&&othIsReflexive)){return 1;}if((value<other&&!valIsNull)||!othIsReflexive||(othIsNull&&!valIsUndef&&valIsReflexive)||(othIsUndef&&valIsReflexive)){return-1;}}return 0;}module.exports=baseCompareAscending;},{}],447:[function(require,module,exports){function baseCopy(source,props,object){object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];object[key]=source[key];}return object;}module.exports=baseCopy;},{}],448:[function(require,module,exports){var isObject=require('../lang/isObject');var baseCreate=(function(){function object(){}return function(prototype){if(isObject(prototype)){object.prototype=prototype;var result=new object;object.prototype=undefined;}return result||{};};}());module.exports=baseCreate;},{"../lang/isObject":542}],449:[function(require,module,exports){var FUNC_ERROR_TEXT='Expected a function';function baseDelay(func,wait,args){if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}return setTimeout(function(){func.apply(undefined,args);},wait);}module.exports=baseDelay;},{}],450:[function(require,module,exports){var baseIndexOf=require('./baseIndexOf'),cacheIndexOf=require('./cacheIndexOf'),createCache=require('./createCache');var LARGE_ARRAY_SIZE=200;function baseDifference(array,values){var length=array?array.length:0,result=[];if(!length){return result;}var index=-1,indexOf=baseIndexOf,isCommon=true,cache=(isCommon&&values.length>=LARGE_ARRAY_SIZE)?createCache(values):null,valuesLength=values.length;if(cache){indexOf=cacheIndexOf;isCommon=false;values=cache;}outer:while(++index<length){var value=array[index];if(isCommon&&value===value){var valuesIndex=valuesLength;while(valuesIndex--){if(values[valuesIndex]===value){continue outer;}}result.push(value);}else if(indexOf(values,value,0)<0){result.push(value);}}return result;}module.exports=baseDifference;},{"./baseIndexOf":461,"./cacheIndexOf":483,"./createCache":493}],451:[function(require,module,exports){var baseForOwn=require('./baseForOwn'),createBaseEach=require('./createBaseEach');var baseEach=createBaseEach(baseForOwn);module.exports=baseEach;},{"./baseForOwn":459,"./createBaseEach":490}],452:[function(require,module,exports){var baseEach=require('./baseEach');function baseEvery(collection,predicate){var result=true;baseEach(collection,function(value,index,collection){result=!!predicate(value,index,collection);return result;});return result;}module.exports=baseEvery;},{"./baseEach":451}],453:[function(require,module,exports){var baseEach=require('./baseEach');function baseFilter(collection,predicate){var result=[];baseEach(collection,function(value,index,collection){if(predicate(value,index,collection)){result.push(value);}});return result;}module.exports=baseFilter;},{"./baseEach":451}],454:[function(require,module,exports){function baseFind(collection,predicate,eachFunc,retKey){var result;eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection)){result=retKey?key:value;return false;}});return result;}module.exports=baseFind;},{}],455:[function(require,module,exports){function baseFindIndex(array,predicate,fromRight){var length=array.length,index=fromRight?length:-1;while((fromRight?index--:++index<length)){if(predicate(array[index],index,array)){return index;}}return-1;}module.exports=baseFindIndex;},{}],456:[function(require,module,exports){var arrayPush=require('./arrayPush'),isArguments=require('../lang/isArguments'),isArray=require('../lang/isArray'),isArrayLike=require('./isArrayLike'),isObjectLike=require('./isObjectLike');function baseFlatten(array,isDeep,isStrict,result){result||(result=[]);var index=-1,length=array.length;while(++index<length){var value=array[index];if(isObjectLike(value)&&isArrayLike(value)&&(isStrict||isArray(value)||isArguments(value))){if(isDeep){baseFlatten(value,isDeep,isStrict,result);}else{arrayPush(result,value);}}else if(!isStrict){result[result.length]=value;}}return result;}module.exports=baseFlatten;},{"../lang/isArguments":536,"../lang/isArray":537,"./arrayPush":439,"./isArrayLike":514,"./isObjectLike":520}],457:[function(require,module,exports){var createBaseFor=require('./createBaseFor');var baseFor=createBaseFor();module.exports=baseFor;},{"./createBaseFor":491}],458:[function(require,module,exports){var baseFor=require('./baseFor'),keysIn=require('../object/keysIn');function baseForIn(object,iteratee){return baseFor(object,iteratee,keysIn);}module.exports=baseForIn;},{"../object/keysIn":551,"./baseFor":457}],459:[function(require,module,exports){var baseFor=require('./baseFor'),keys=require('../object/keys');function baseForOwn(object,iteratee){return baseFor(object,iteratee,keys);}module.exports=baseForOwn;},{"../object/keys":550,"./baseFor":457}],460:[function(require,module,exports){var toObject=require('./toObject');function baseGet(object,path,pathKey){if(object==null){return;}if(pathKey!==undefined&&pathKey in toObject(object)){path=[pathKey];}var index=0,length=path.length;while(object!=null&&index<length){object=object[path[index++]];}return(index&&index==length)?object:undefined;}module.exports=baseGet;},{"./toObject":532}],461:[function(require,module,exports){var indexOfNaN=require('./indexOfNaN');function baseIndexOf(array,value,fromIndex){if(value!==value){return indexOfNaN(array,fromIndex);}var index=fromIndex-1,length=array.length;while(++index<length){if(array[index]===value){return index;}}return-1;}module.exports=baseIndexOf;},{"./indexOfNaN":510}],462:[function(require,module,exports){var baseIsEqualDeep=require('./baseIsEqualDeep'),isObject=require('../lang/isObject'),isObjectLike=require('./isObjectLike');function baseIsEqual(value,other,customizer,isLoose,stackA,stackB){if(value===other){return true;}if(value==null||other==null||(!isObject(value)&&!isObjectLike(other))){return value!==value&&other!==other;}return baseIsEqualDeep(value,other,baseIsEqual,customizer,isLoose,stackA,stackB);}module.exports=baseIsEqual;},{"../lang/isObject":542,"./baseIsEqualDeep":463,"./isObjectLike":520}],463:[function(require,module,exports){var equalArrays=require('./equalArrays'),equalByTag=require('./equalByTag'),equalObjects=require('./equalObjects'),isArray=require('../lang/isArray'),isTypedArray=require('../lang/isTypedArray');var argsTag='[object Arguments]',arrayTag='[object Array]',objectTag='[object Object]';var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;function baseIsEqualDeep(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;if(!objIsArr){objTag=objToString.call(object);if(objTag==argsTag){objTag=objectTag;}else if(objTag!=objectTag){objIsArr=isTypedArray(object);}}if(!othIsArr){othTag=objToString.call(other);if(othTag==argsTag){othTag=objectTag;}else if(othTag!=objectTag){othIsArr=isTypedArray(other);}}var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&!(objIsArr||objIsObj)){return equalByTag(object,other,objTag);}if(!isLoose){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,'__wrapped__'),othIsWrapped=othIsObj&&hasOwnProperty.call(other,'__wrapped__');if(objIsWrapped||othIsWrapped){return equalFunc(objIsWrapped?object.value():object,othIsWrapped?other.value():other,customizer,isLoose,stackA,stackB);}}if(!isSameTag){return false;}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==object){return stackB[length]==other;}}stackA.push(object);stackB.push(other);var result=(objIsArr?equalArrays:equalObjects)(object,other,equalFunc,customizer,isLoose,stackA,stackB);stackA.pop();stackB.pop();return result;}module.exports=baseIsEqualDeep;},{"../lang/isArray":537,"../lang/isTypedArray":545,"./equalArrays":502,"./equalByTag":503,"./equalObjects":504}],464:[function(require,module,exports){var baseIsEqual=require('./baseIsEqual'),toObject=require('./toObject');function baseIsMatch(object,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(object==null){return!length;}object=toObject(object);while(index--){var data=matchData[index];if((noCustomizer&&data[2])?data[1]!==object[data[0]]:!(data[0]in object)){return false;}}while(++index<length){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object)){return false;}}else{var result=customizer?customizer(objValue,srcValue,key):undefined;if(!(result===undefined?baseIsEqual(srcValue,objValue,customizer,true):result)){return false;}}}return true;}module.exports=baseIsMatch;},{"./baseIsEqual":462,"./toObject":532}],465:[function(require,module,exports){function baseLodash(){}module.exports=baseLodash;},{}],466:[function(require,module,exports){var baseEach=require('./baseEach'),isArrayLike=require('./isArrayLike');function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection);});return result;}module.exports=baseMap;},{"./baseEach":451,"./isArrayLike":514}],467:[function(require,module,exports){var baseIsMatch=require('./baseIsMatch'),getMatchData=require('./getMatchData'),toObject=require('./toObject');function baseMatches(source){var matchData=getMatchData(source);if(matchData.length==1&&matchData[0][2]){var key=matchData[0][0],value=matchData[0][1];return function(object){if(object==null){return false;}return object[key]===value&&(value!==undefined||(key in toObject(object)));};}return function(object){return baseIsMatch(object,matchData);};}module.exports=baseMatches;},{"./baseIsMatch":464,"./getMatchData":508,"./toObject":532}],468:[function(require,module,exports){var baseGet=require('./baseGet'),baseIsEqual=require('./baseIsEqual'),baseSlice=require('./baseSlice'),isArray=require('../lang/isArray'),isKey=require('./isKey'),isStrictComparable=require('./isStrictComparable'),last=require('../array/last'),toObject=require('./toObject'),toPath=require('./toPath');function baseMatchesProperty(path,srcValue){var isArr=isArray(path),isCommon=isKey(path)&&isStrictComparable(srcValue),pathKey=(path+'');path=toPath(path);return function(object){if(object==null){return false;}var key=pathKey;object=toObject(object);if((isArr||!isCommon)&&!(key in object)){object=path.length==1?object:baseGet(object,baseSlice(path,0,-1));if(object==null){return false;}key=last(path);object=toObject(object);}return object[key]===srcValue?(srcValue!==undefined||(key in object)):baseIsEqual(srcValue,object[key],undefined,true);};}module.exports=baseMatchesProperty;},{"../array/last":406,"../lang/isArray":537,"./baseGet":460,"./baseIsEqual":462,"./baseSlice":475,"./isKey":517,"./isStrictComparable":521,"./toObject":532,"./toPath":533}],469:[function(require,module,exports){var arrayEach=require('./arrayEach'),baseMergeDeep=require('./baseMergeDeep'),isArray=require('../lang/isArray'),isArrayLike=require('./isArrayLike'),isObject=require('../lang/isObject'),isObjectLike=require('./isObjectLike'),isTypedArray=require('../lang/isTypedArray'),keys=require('../object/keys');function baseMerge(object,source,customizer,stackA,stackB){if(!isObject(object)){return object;}var isSrcArr=isArrayLike(source)&&(isArray(source)||isTypedArray(source)),props=isSrcArr?undefined:keys(source);arrayEach(props||source,function(srcValue,key){if(props){key=srcValue;srcValue=source[key];}if(isObjectLike(srcValue)){stackA||(stackA=[]);stackB||(stackB=[]);baseMergeDeep(object,source,key,baseMerge,customizer,stackA,stackB);}else{var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=result===undefined;if(isCommon){result=srcValue;}if((result!==undefined||(isSrcArr&&!(key in object)))&&(isCommon||(result===result?(result!==value):(value===value)))){object[key]=result;}}});return object;}module.exports=baseMerge;},{"../lang/isArray":537,"../lang/isObject":542,"../lang/isTypedArray":545,"../object/keys":550,"./arrayEach":435,"./baseMergeDeep":470,"./isArrayLike":514,"./isObjectLike":520}],470:[function(require,module,exports){var arrayCopy=require('./arrayCopy'),isArguments=require('../lang/isArguments'),isArray=require('../lang/isArray'),isArrayLike=require('./isArrayLike'),isPlainObject=require('../lang/isPlainObject'),isTypedArray=require('../lang/isTypedArray'),toPlainObject=require('../lang/toPlainObject');function baseMergeDeep(object,source,key,mergeFunc,customizer,stackA,stackB){var length=stackA.length,srcValue=source[key];while(length--){if(stackA[length]==srcValue){object[key]=stackB[length];return;}}var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=result===undefined;if(isCommon){result=srcValue;if(isArrayLike(srcValue)&&(isArray(srcValue)||isTypedArray(srcValue))){result=isArray(value)?value:(isArrayLike(value)?arrayCopy(value):[]);}else if(isPlainObject(srcValue)||isArguments(srcValue)){result=isArguments(value)?toPlainObject(value):(isPlainObject(value)?value:{});}else{isCommon=false;}}stackA.push(srcValue);stackB.push(result);if(isCommon){object[key]=mergeFunc(result,srcValue,customizer,stackA,stackB);}else if(result===result?(result!==value):(value===value)){object[key]=result;}}module.exports=baseMergeDeep;},{"../lang/isArguments":536,"../lang/isArray":537,"../lang/isPlainObject":543,"../lang/isTypedArray":545,"../lang/toPlainObject":546,"./arrayCopy":434,"./isArrayLike":514}],471:[function(require,module,exports){function baseProperty(key){return function(object){return object==null?undefined:object[key];};}module.exports=baseProperty;},{}],472:[function(require,module,exports){var baseGet=require('./baseGet'),toPath=require('./toPath');function basePropertyDeep(path){var pathKey=(path+'');path=toPath(path);return function(object){return baseGet(object,path,pathKey);};}module.exports=basePropertyDeep;},{"./baseGet":460,"./toPath":533}],473:[function(require,module,exports){function baseReduce(collection,iteratee,accumulator,initFromCollection,eachFunc){eachFunc(collection,function(value,index,collection){accumulator=initFromCollection?(initFromCollection=false,value):iteratee(accumulator,value,index,collection);});return accumulator;}module.exports=baseReduce;},{}],474:[function(require,module,exports){var identity=require('../utility/identity'),metaMap=require('./metaMap');var baseSetData=!metaMap?identity:function(func,data){metaMap.set(func,data);return func;};module.exports=baseSetData;},{"../utility/identity":558,"./metaMap":523}],475:[function(require,module,exports){function baseSlice(array,start,end){var index=-1,length=array.length;start=start==null?0:(+start||0);if(start<0){start=-start>length?0:(length+start);}end=(end===undefined||end>length)?length:(+end||0);if(end<0){end+=length;}length=start>end?0:((end-start)>>>0);start>>>=0;var result=Array(length);while(++index<length){result[index]=array[index+start];}return result;}module.exports=baseSlice;},{}],476:[function(require,module,exports){var baseEach=require('./baseEach');function baseSome(collection,predicate){var result;baseEach(collection,function(value,index,collection){result=predicate(value,index,collection);return!result;});return!!result;}module.exports=baseSome;},{"./baseEach":451}],477:[function(require,module,exports){function baseSortBy(array,comparer){var length=array.length;array.sort(comparer);while(length--){array[length]=array[length].value;}return array;}module.exports=baseSortBy;},{}],478:[function(require,module,exports){function baseToString(value){return value==null?'':(value+'');}module.exports=baseToString;},{}],479:[function(require,module,exports){var baseIndexOf=require('./baseIndexOf'),cacheIndexOf=require('./cacheIndexOf'),createCache=require('./createCache');var LARGE_ARRAY_SIZE=200;function baseUniq(array,iteratee){var index=-1,indexOf=baseIndexOf,length=array.length,isCommon=true,isLarge=isCommon&&length>=LARGE_ARRAY_SIZE,seen=isLarge?createCache():null,result=[];if(seen){indexOf=cacheIndexOf;isCommon=false;}else{isLarge=false;seen=iteratee?[]:result;}outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value,index,array):value;if(isCommon&&value===value){var seenIndex=seen.length;while(seenIndex--){if(seen[seenIndex]===computed){continue outer;}}if(iteratee){seen.push(computed);}result.push(value);}else if(indexOf(seen,computed,0)<0){if(iteratee||isLarge){seen.push(computed);}result.push(value);}}return result;}module.exports=baseUniq;},{"./baseIndexOf":461,"./cacheIndexOf":483,"./createCache":493}],480:[function(require,module,exports){function baseValues(object,props){var index=-1,length=props.length,result=Array(length);while(++index<length){result[index]=object[props[index]];}return result;}module.exports=baseValues;},{}],481:[function(require,module,exports){var identity=require('../utility/identity');function bindCallback(func,thisArg,argCount){if(typeof func!='function'){return identity;}if(thisArg===undefined){return func;}switch(argCount){case 1:return function(value){return func.call(thisArg,value);};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection);};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection);};case 5:return function(value,other,key,object,source){return func.call(thisArg,value,other,key,object,source);};}return function(){return func.apply(thisArg,arguments);};}module.exports=bindCallback;},{"../utility/identity":558}],482:[function(require,module,exports){(function(global){var ArrayBuffer=global.ArrayBuffer,Uint8Array=global.Uint8Array;function bufferClone(buffer){var result=new ArrayBuffer(buffer.byteLength),view=new Uint8Array(result);view.set(new Uint8Array(buffer));return result;}module.exports=bufferClone;}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],483:[function(require,module,exports){var isObject=require('../lang/isObject');function cacheIndexOf(cache,value){var data=cache.data,result=(typeof value=='string'||isObject(value))?data.set.has(value):data.hash[value];return result?0:-1;}module.exports=cacheIndexOf;},{"../lang/isObject":542}],484:[function(require,module,exports){var isObject=require('../lang/isObject');function cachePush(value){var data=this.data;if(typeof value=='string'||isObject(value)){data.set.add(value);}else{data.hash[value]=true;}}module.exports=cachePush;},{"../lang/isObject":542}],485:[function(require,module,exports){var baseCompareAscending=require('./baseCompareAscending');function compareAscending(object,other){return baseCompareAscending(object.criteria,other.criteria)||(object.index-other.index);}module.exports=compareAscending;},{"./baseCompareAscending":446}],486:[function(require,module,exports){var nativeMax=Math.max;function composeArgs(args,partials,holders){var holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),leftIndex=-1,leftLength=partials.length,result=Array(leftLength+argsLength);while(++leftIndex<leftLength){result[leftIndex]=partials[leftIndex];}while(++argsIndex<holdersLength){result[holders[argsIndex]]=args[argsIndex];}while(argsLength--){result[leftIndex++]=args[argsIndex++];}return result;}module.exports=composeArgs;},{}],487:[function(require,module,exports){var nativeMax=Math.max;function composeArgsRight(args,partials,holders){var holdersIndex=-1,holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),rightIndex=-1,rightLength=partials.length,result=Array(argsLength+rightLength);while(++argsIndex<argsLength){result[argsIndex]=args[argsIndex];}var offset=argsIndex;while(++rightIndex<rightLength){result[offset+rightIndex]=partials[rightIndex];}while(++holdersIndex<holdersLength){result[offset+holders[holdersIndex]]=args[argsIndex++];}return result;}module.exports=composeArgsRight;},{}],488:[function(require,module,exports){var baseCallback=require('./baseCallback'),baseEach=require('./baseEach'),isArray=require('../lang/isArray');function createAggregator(setter,initializer){return function(collection,iteratee,thisArg){var result=initializer?initializer():{};iteratee=baseCallback(iteratee,thisArg,3);if(isArray(collection)){var index=-1,length=collection.length;while(++index<length){var value=collection[index];setter(result,value,iteratee(value,index,collection),collection);}}else{baseEach(collection,function(value,key,collection){setter(result,value,iteratee(value,key,collection),collection);});}return result;};}module.exports=createAggregator;},{"../lang/isArray":537,"./baseCallback":444,"./baseEach":451}],489:[function(require,module,exports){var bindCallback=require('./bindCallback'),isIterateeCall=require('./isIterateeCall'),restParam=require('../function/restParam');function createAssigner(assigner){return restParam(function(object,sources){var index=-1,length=object==null?0:sources.length,customizer=length>2?sources[length-2]:undefined,guard=length>2?sources[2]:undefined,thisArg=length>1?sources[length-1]:undefined;if(typeof customizer=='function'){customizer=bindCallback(customizer,thisArg,5);length-=2;}else{customizer=typeof thisArg=='function'?thisArg:undefined;length-=(customizer?1:0);}if(guard&&isIterateeCall(sources[0],sources[1],guard)){customizer=length<3?undefined:customizer;length=1;}while(++index<length){var source=sources[index];if(source){assigner(object,source,customizer);}}return object;});}module.exports=createAssigner;},{"../function/restParam":430,"./bindCallback":481,"./isIterateeCall":516}],490:[function(require,module,exports){var getLength=require('./getLength'),isLength=require('./isLength'),toObject=require('./toObject');function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){var length=collection?getLength(collection):0;if(!isLength(length)){return eachFunc(collection,iteratee);}var index=fromRight?length:-1,iterable=toObject(collection);while((fromRight?index--:++index<length)){if(iteratee(iterable[index],index,iterable)===false){break;}}return collection;};}module.exports=createBaseEach;},{"./getLength":507,"./isLength":519,"./toObject":532}],491:[function(require,module,exports){var toObject=require('./toObject');function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var iterable=toObject(object),props=keysFunc(object),length=props.length,index=fromRight?length:-1;while((fromRight?index--:++index<length)){var key=props[index];if(iteratee(iterable[key],key,iterable)===false){break;}}return object;};}module.exports=createBaseFor;},{"./toObject":532}],492:[function(require,module,exports){(function(global){var createCtorWrapper=require('./createCtorWrapper');function createBindWrapper(func,thisArg){var Ctor=createCtorWrapper(func);function wrapper(){var fn=(this&&this!==global&&this instanceof wrapper)?Ctor:func;return fn.apply(thisArg,arguments);}return wrapper;}module.exports=createBindWrapper;}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./createCtorWrapper":494}],493:[function(require,module,exports){(function(global){var SetCache=require('./SetCache'),getNative=require('./getNative');var Set=getNative(global,'Set');var nativeCreate=getNative(Object,'create');function createCache(values){return(nativeCreate&&Set)?new SetCache(values):null;}module.exports=createCache;}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./SetCache":433,"./getNative":509}],494:[function(require,module,exports){var baseCreate=require('./baseCreate'),isObject=require('../lang/isObject');function createCtorWrapper(Ctor){return function(){var args=arguments;switch(args.length){case 0:return new Ctor;case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6]);}var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);return isObject(result)?result:thisBinding;};}module.exports=createCtorWrapper;},{"../lang/isObject":542,"./baseCreate":448}],495:[function(require,module,exports){var baseCallback=require('./baseCallback'),baseFind=require('./baseFind'),baseFindIndex=require('./baseFindIndex'),isArray=require('../lang/isArray');function createFind(eachFunc,fromRight){return function(collection,predicate,thisArg){predicate=baseCallback(predicate,thisArg,3);if(isArray(collection)){var index=baseFindIndex(collection,predicate,fromRight);return index>-1?collection[index]:undefined;}return baseFind(collection,predicate,eachFunc);};}module.exports=createFind;},{"../lang/isArray":537,"./baseCallback":444,"./baseFind":454,"./baseFindIndex":455}],496:[function(require,module,exports){var baseCallback=require('./baseCallback'),baseFindIndex=require('./baseFindIndex');function createFindIndex(fromRight){return function(array,predicate,thisArg){if(!(array&&array.length)){return-1;}predicate=baseCallback(predicate,thisArg,3);return baseFindIndex(array,predicate,fromRight);};}module.exports=createFindIndex;},{"./baseCallback":444,"./baseFindIndex":455}],497:[function(require,module,exports){var bindCallback=require('./bindCallback'),isArray=require('../lang/isArray');function createForEach(arrayFunc,eachFunc){return function(collection,iteratee,thisArg){return(typeof iteratee=='function'&&thisArg===undefined&&isArray(collection))?arrayFunc(collection,iteratee):eachFunc(collection,bindCallback(iteratee,thisArg,3));};}module.exports=createForEach;},{"../lang/isArray":537,"./bindCallback":481}],498:[function(require,module,exports){(function(global){var arrayCopy=require('./arrayCopy'),composeArgs=require('./composeArgs'),composeArgsRight=require('./composeArgsRight'),createCtorWrapper=require('./createCtorWrapper'),isLaziable=require('./isLaziable'),reorder=require('./reorder'),replaceHolders=require('./replaceHolders'),setData=require('./setData');var BIND_FLAG=1,BIND_KEY_FLAG=2,CURRY_BOUND_FLAG=4,CURRY_FLAG=8,CURRY_RIGHT_FLAG=16,PARTIAL_FLAG=32,PARTIAL_RIGHT_FLAG=64,ARY_FLAG=128;var nativeMax=Math.max;function createHybridWrapper(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){var isAry=bitmask&ARY_FLAG,isBind=bitmask&BIND_FLAG,isBindKey=bitmask&BIND_KEY_FLAG,isCurry=bitmask&CURRY_FLAG,isCurryBound=bitmask&CURRY_BOUND_FLAG,isCurryRight=bitmask&CURRY_RIGHT_FLAG,Ctor=isBindKey?undefined:createCtorWrapper(func);function wrapper(){var length=arguments.length,index=length,args=Array(length);while(index--){args[index]=arguments[index];}if(partials){args=composeArgs(args,partials,holders);}if(partialsRight){args=composeArgsRight(args,partialsRight,holdersRight);}if(isCurry||isCurryRight){var placeholder=wrapper.placeholder,argsHolders=replaceHolders(args,placeholder);length-=argsHolders.length;if(length<arity){var newArgPos=argPos?arrayCopy(argPos):undefined,newArity=nativeMax(arity-length,0),newsHolders=isCurry?argsHolders:undefined,newHoldersRight=isCurry?undefined:argsHolders,newPartials=isCurry?args:undefined,newPartialsRight=isCurry?undefined:args;bitmask|=(isCurry?PARTIAL_FLAG:PARTIAL_RIGHT_FLAG);bitmask&=~(isCurry?PARTIAL_RIGHT_FLAG:PARTIAL_FLAG);if(!isCurryBound){bitmask&=~(BIND_FLAG|BIND_KEY_FLAG);}var newData=[func,bitmask,thisArg,newPartials,newsHolders,newPartialsRight,newHoldersRight,newArgPos,ary,newArity],result=createHybridWrapper.apply(undefined,newData);if(isLaziable(func)){setData(result,newData);}result.placeholder=placeholder;return result;}}var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;if(argPos){args=reorder(args,argPos);}if(isAry&&ary<args.length){args.length=ary;}if(this&&this!==global&&this instanceof wrapper){fn=Ctor||createCtorWrapper(func);}return fn.apply(thisBinding,args);}return wrapper;}module.exports=createHybridWrapper;}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./arrayCopy":434,"./composeArgs":486,"./composeArgsRight":487,"./createCtorWrapper":494,"./isLaziable":518,"./reorder":527,"./replaceHolders":528,"./setData":529}],499:[function(require,module,exports){(function(global){var createCtorWrapper=require('./createCtorWrapper');var BIND_FLAG=1;function createPartialWrapper(func,bitmask,thisArg,partials){var isBind=bitmask&BIND_FLAG,Ctor=createCtorWrapper(func);function wrapper(){var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength);while(++leftIndex<leftLength){args[leftIndex]=partials[leftIndex];}while(argsLength--){args[leftIndex++]=arguments[++argsIndex];}var fn=(this&&this!==global&&this instanceof wrapper)?Ctor:func;return fn.apply(isBind?thisArg:this,args);}return wrapper;}module.exports=createPartialWrapper;}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./createCtorWrapper":494}],500:[function(require,module,exports){var baseCallback=require('./baseCallback'),baseReduce=require('./baseReduce'),isArray=require('../lang/isArray');function createReduce(arrayFunc,eachFunc){return function(collection,iteratee,accumulator,thisArg){var initFromArray=arguments.length<3;return(typeof iteratee=='function'&&thisArg===undefined&&isArray(collection))?arrayFunc(collection,iteratee,accumulator,initFromArray):baseReduce(collection,baseCallback(iteratee,thisArg,4),accumulator,initFromArray,eachFunc);};}module.exports=createReduce;},{"../lang/isArray":537,"./baseCallback":444,"./baseReduce":473}],501:[function(require,module,exports){var baseSetData=require('./baseSetData'),createBindWrapper=require('./createBindWrapper'),createHybridWrapper=require('./createHybridWrapper'),createPartialWrapper=require('./createPartialWrapper'),getData=require('./getData'),mergeData=require('./mergeData'),setData=require('./setData');var BIND_FLAG=1,BIND_KEY_FLAG=2,PARTIAL_FLAG=32,PARTIAL_RIGHT_FLAG=64;var FUNC_ERROR_TEXT='Expected a function';var nativeMax=Math.max;function createWrapper(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&BIND_KEY_FLAG;if(!isBindKey&&typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}var length=partials?partials.length:0;if(!length){bitmask&=~(PARTIAL_FLAG|PARTIAL_RIGHT_FLAG);partials=holders=undefined;}length-=(holders?holders.length:0);if(bitmask&PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=undefined;}var data=isBindKey?undefined:getData(func),newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data){mergeData(newData,data);bitmask=newData[1];arity=newData[9];}newData[9]=arity==null?(isBindKey?0:func.length):(nativeMax(arity-length,0)||0);if(bitmask==BIND_FLAG){var result=createBindWrapper(newData[0],newData[2]);}else if((bitmask==PARTIAL_FLAG||bitmask==(BIND_FLAG|PARTIAL_FLAG))&&!newData[4].length){result=createPartialWrapper.apply(undefined,newData);}else{result=createHybridWrapper.apply(undefined,newData);}var setter=data?baseSetData:setData;return setter(result,newData);}module.exports=createWrapper;},{"./baseSetData":474,"./createBindWrapper":492,"./createHybridWrapper":498,"./createPartialWrapper":499,"./getData":505,"./mergeData":522,"./setData":529}],502:[function(require,module,exports){var arraySome=require('./arraySome');function equalArrays(array,other,equalFunc,customizer,isLoose,stackA,stackB){var index=-1,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isLoose&&othLength>arrLength)){return false;}while(++index<arrLength){var arrValue=array[index],othValue=other[index],result=customizer?customizer(isLoose?othValue:arrValue,isLoose?arrValue:othValue,index):undefined;if(result!==undefined){if(result){continue;}return false;}if(isLoose){if(!arraySome(other,function(othValue){return arrValue===othValue||equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB);})){return false;}}else if(!(arrValue===othValue||equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB))){return false;}}return true;}module.exports=equalArrays;},{"./arraySome":441}],503:[function(require,module,exports){var boolTag='[object Boolean]',dateTag='[object Date]',errorTag='[object Error]',numberTag='[object Number]',regexpTag='[object RegExp]',stringTag='[object String]';function equalByTag(object,other,tag){switch(tag){case boolTag:case dateTag:return+object==+other;case errorTag:return object.name==other.name&&object.message==other.message;case numberTag:return(object!=+object)?other!=+other:object==+other;case regexpTag:case stringTag:return object==(other+'');}return false;}module.exports=equalByTag;},{}],504:[function(require,module,exports){var keys=require('../object/keys');var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function equalObjects(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objProps=keys(object),objLength=objProps.length,othProps=keys(other),othLength=othProps.length;if(objLength!=othLength&&!isLoose){return false;}var index=objLength;while(index--){var key=objProps[index];if(!(isLoose?key in other:hasOwnProperty.call(other,key))){return false;}}var skipCtor=isLoose;while(++index<objLength){key=objProps[index];var objValue=object[key],othValue=other[key],result=customizer?customizer(isLoose?othValue:objValue,isLoose?objValue:othValue,key):undefined;if(!(result===undefined?equalFunc(objValue,othValue,customizer,isLoose,stackA,stackB):result)){return false;}skipCtor||(skipCtor=key=='constructor');}if(!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&('constructor'in object&&'constructor'in other)&&!(typeof objCtor=='function'&&objCtor instanceof objCtor&&typeof othCtor=='function'&&othCtor instanceof othCtor)){return false;}}return true;}module.exports=equalObjects;},{"../object/keys":550}],505:[function(require,module,exports){var metaMap=require('./metaMap'),noop=require('../utility/noop');var getData=!metaMap?noop:function(func){return metaMap.get(func);};module.exports=getData;},{"../utility/noop":559,"./metaMap":523}],506:[function(require,module,exports){var realNames=require('./realNames');function getFuncName(func){var result=(func.name+''),array=realNames[result],length=array?array.length:0;while(length--){var data=array[length],otherFunc=data.func;if(otherFunc==null||otherFunc==func){return data.name;}}return result;}module.exports=getFuncName;},{"./realNames":526}],507:[function(require,module,exports){var baseProperty=require('./baseProperty');var getLength=baseProperty('length');module.exports=getLength;},{"./baseProperty":471}],508:[function(require,module,exports){var isStrictComparable=require('./isStrictComparable'),pairs=require('../object/pairs');function getMatchData(object){var result=pairs(object),length=result.length;while(length--){result[length][2]=isStrictComparable(result[length][1]);}return result;}module.exports=getMatchData;},{"../object/pairs":554,"./isStrictComparable":521}],509:[function(require,module,exports){var isNative=require('../lang/isNative');function getNative(object,key){var value=object==null?undefined:object[key];return isNative(value)?value:undefined;}module.exports=getNative;},{"../lang/isNative":540}],510:[function(require,module,exports){function indexOfNaN(array,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?0:-1);while((fromRight?index--:++index<length)){var other=array[index];if(other!==other){return index;}}return-1;}module.exports=indexOfNaN;},{}],511:[function(require,module,exports){var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function initCloneArray(array){var length=array.length,result=new array.constructor(length);if(length&&typeof array[0]=='string'&&hasOwnProperty.call(array,'index')){result.index=array.index;result.input=array.input;}return result;}module.exports=initCloneArray;},{}],512:[function(require,module,exports){var bufferClone=require('./bufferClone');var boolTag='[object Boolean]',dateTag='[object Date]',numberTag='[object Number]',regexpTag='[object RegExp]',stringTag='[object String]';var arrayBufferTag='[object ArrayBuffer]',float32Tag='[object Float32Array]',float64Tag='[object Float64Array]',int8Tag='[object Int8Array]',int16Tag='[object Int16Array]',int32Tag='[object Int32Array]',uint8Tag='[object Uint8Array]',uint8ClampedTag='[object Uint8ClampedArray]',uint16Tag='[object Uint16Array]',uint32Tag='[object Uint32Array]';var reFlags=/\w*$/;function initCloneByTag(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return bufferClone(object);case boolTag:case dateTag:return new Ctor(+object);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:var buffer=object.buffer;return new Ctor(isDeep?bufferClone(buffer):buffer,object.byteOffset,object.length);case numberTag:case stringTag:return new Ctor(object);case regexpTag:var result=new Ctor(object.source,reFlags.exec(object));result.lastIndex=object.lastIndex;}return result;}module.exports=initCloneByTag;},{"./bufferClone":482}],513:[function(require,module,exports){function initCloneObject(object){var Ctor=object.constructor;if(!(typeof Ctor=='function'&&Ctor instanceof Ctor)){Ctor=Object;}return new Ctor;}module.exports=initCloneObject;},{}],514:[function(require,module,exports){var getLength=require('./getLength'),isLength=require('./isLength');function isArrayLike(value){return value!=null&&isLength(getLength(value));}module.exports=isArrayLike;},{"./getLength":507,"./isLength":519}],515:[function(require,module,exports){var reIsUint=/^\d+$/;var MAX_SAFE_INTEGER=9007199254740991;function isIndex(value,length){value=(typeof value=='number'||reIsUint.test(value))?+value:-1;length=length==null?MAX_SAFE_INTEGER:length;return value>-1&&value%1==0&&value<length;}module.exports=isIndex;},{}],516:[function(require,module,exports){var isArrayLike=require('./isArrayLike'),isIndex=require('./isIndex'),isObject=require('../lang/isObject');function isIterateeCall(value,index,object){if(!isObject(object)){return false;}var type=typeof index;if(type=='number'?(isArrayLike(object)&&isIndex(index,object.length)):(type=='string'&&index in object)){var other=object[index];return value===value?(value===other):(other!==other);}return false;}module.exports=isIterateeCall;},{"../lang/isObject":542,"./isArrayLike":514,"./isIndex":515}],517:[function(require,module,exports){var isArray=require('../lang/isArray'),toObject=require('./toObject');var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey(value,object){var type=typeof value;if((type=='string'&&reIsPlainProp.test(value))||type=='number'){return true;}if(isArray(value)){return false;}var result=!reIsDeepProp.test(value);return result||(object!=null&&value in toObject(object));}module.exports=isKey;},{"../lang/isArray":537,"./toObject":532}],518:[function(require,module,exports){var LazyWrapper=require('./LazyWrapper'),getData=require('./getData'),getFuncName=require('./getFuncName'),lodash=require('../chain/lodash');function isLaziable(func){var funcName=getFuncName(func),other=lodash[funcName];if(typeof other!='function'||!(funcName in LazyWrapper.prototype)){return false;}if(func===other){return true;}var data=getData(other);return!!data&&func===data[0];}module.exports=isLaziable;},{"../chain/lodash":412,"./LazyWrapper":431,"./getData":505,"./getFuncName":506}],519:[function(require,module,exports){var MAX_SAFE_INTEGER=9007199254740991;function isLength(value){return typeof value=='number'&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER;}module.exports=isLength;},{}],520:[function(require,module,exports){function isObjectLike(value){return!!value&&typeof value=='object';}module.exports=isObjectLike;},{}],521:[function(require,module,exports){var isObject=require('../lang/isObject');function isStrictComparable(value){return value===value&&!isObject(value);}module.exports=isStrictComparable;},{"../lang/isObject":542}],522:[function(require,module,exports){var arrayCopy=require('./arrayCopy'),composeArgs=require('./composeArgs'),composeArgsRight=require('./composeArgsRight'),replaceHolders=require('./replaceHolders');var BIND_FLAG=1,CURRY_BOUND_FLAG=4,CURRY_FLAG=8,ARY_FLAG=128,REARG_FLAG=256;var PLACEHOLDER='__lodash_placeholder__';var nativeMin=Math.min;function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=newBitmask<ARY_FLAG;var isCombo=(srcBitmask==ARY_FLAG&&bitmask==CURRY_FLAG)||(srcBitmask==ARY_FLAG&&bitmask==REARG_FLAG&&data[7].length<=source[8])||(srcBitmask==(ARY_FLAG|REARG_FLAG)&&bitmask==CURRY_FLAG);if(!(isCommon||isCombo)){return data;}if(srcBitmask&BIND_FLAG){data[2]=source[2];newBitmask|=(bitmask&BIND_FLAG)?0:CURRY_BOUND_FLAG;}var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):arrayCopy(value);data[4]=partials?replaceHolders(data[3],PLACEHOLDER):arrayCopy(source[4]);}value=source[5];if(value){partials=data[5];data[5]=partials?composeArgsRight(partials,value,source[6]):arrayCopy(value);data[6]=partials?replaceHolders(data[5],PLACEHOLDER):arrayCopy(source[6]);}value=source[7];if(value){data[7]=arrayCopy(value);}if(srcBitmask&ARY_FLAG){data[8]=data[8]==null?source[8]:nativeMin(data[8],source[8]);}if(data[9]==null){data[9]=source[9];}data[0]=source[0];data[1]=newBitmask;return data;}module.exports=mergeData;},{"./arrayCopy":434,"./composeArgs":486,"./composeArgsRight":487,"./replaceHolders":528}],523:[function(require,module,exports){(function(global){var getNative=require('./getNative');var WeakMap=getNative(global,'WeakMap');var metaMap=WeakMap&&new WeakMap;module.exports=metaMap;}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./getNative":509}],524:[function(require,module,exports){var toObject=require('./toObject');function pickByArray(object,props){object=toObject(object);var index=-1,length=props.length,result={};while(++index<length){var key=props[index];if(key in object){result[key]=object[key];}}return result;}module.exports=pickByArray;},{"./toObject":532}],525:[function(require,module,exports){var baseForIn=require('./baseForIn');function pickByCallback(object,predicate){var result={};baseForIn(object,function(value,key,object){if(predicate(value,key,object)){result[key]=value;}});return result;}module.exports=pickByCallback;},{"./baseForIn":458}],526:[function(require,module,exports){var realNames={};module.exports=realNames;},{}],527:[function(require,module,exports){var arrayCopy=require('./arrayCopy'),isIndex=require('./isIndex');var nativeMin=Math.min;function reorder(array,indexes){var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=arrayCopy(array);while(length--){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined;}return array;}module.exports=reorder;},{"./arrayCopy":434,"./isIndex":515}],528:[function(require,module,exports){var PLACEHOLDER='__lodash_placeholder__';function replaceHolders(array,placeholder){var index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){if(array[index]===placeholder){array[index]=PLACEHOLDER;result[++resIndex]=index;}}return result;}module.exports=replaceHolders;},{}],529:[function(require,module,exports){var baseSetData=require('./baseSetData'),now=require('../date/now');var HOT_COUNT=150,HOT_SPAN=16;var setData=(function(){var count=0,lastCalled=0;return function(key,value){var stamp=now(),remaining=HOT_SPAN-(stamp-lastCalled);lastCalled=stamp;if(remaining>0){if(++count>=HOT_COUNT){return key;}}else{count=0;}return baseSetData(key,value);};}());module.exports=setData;},{"../date/now":426,"./baseSetData":474}],530:[function(require,module,exports){var isArguments=require('../lang/isArguments'),isArray=require('../lang/isArray'),isIndex=require('./isIndex'),isLength=require('./isLength'),keysIn=require('../object/keysIn');var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function shimKeys(object){var props=keysIn(object),propsLength=props.length,length=propsLength&&object.length;var allowIndexes=!!length&&isLength(length)&&(isArray(object)||isArguments(object));var index=-1,result=[];while(++index<propsLength){var key=props[index];if((allowIndexes&&isIndex(key,length))||hasOwnProperty.call(object,key)){result.push(key);}}return result;}module.exports=shimKeys;},{"../lang/isArguments":536,"../lang/isArray":537,"../object/keysIn":551,"./isIndex":515,"./isLength":519}],531:[function(require,module,exports){function sortedUniq(array,iteratee){var seen,index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index],computed=iteratee?iteratee(value,index,array):value;if(!index||seen!==computed){seen=computed;result[++resIndex]=value;}}return result;}module.exports=sortedUniq;},{}],532:[function(require,module,exports){var isObject=require('../lang/isObject');function toObject(value){return isObject(value)?value:Object(value);}module.exports=toObject;},{"../lang/isObject":542}],533:[function(require,module,exports){var baseToString=require('./baseToString'),isArray=require('../lang/isArray');var rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g;var reEscapeChar=/\\(\\)?/g;function toPath(value){if(isArray(value)){return value;}var result=[];baseToString(value).replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,'$1'):(number||match));});return result;}module.exports=toPath;},{"../lang/isArray":537,"./baseToString":478}],534:[function(require,module,exports){var LazyWrapper=require('./LazyWrapper'),LodashWrapper=require('./LodashWrapper'),arrayCopy=require('./arrayCopy');function wrapperClone(wrapper){return wrapper instanceof LazyWrapper?wrapper.clone():new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__,arrayCopy(wrapper.__actions__));}module.exports=wrapperClone;},{"./LazyWrapper":431,"./LodashWrapper":432,"./arrayCopy":434}],535:[function(require,module,exports){var baseClone=require('../internal/baseClone'),bindCallback=require('../internal/bindCallback'),isIterateeCall=require('../internal/isIterateeCall');function clone(value,isDeep,customizer,thisArg){if(isDeep&&typeof isDeep!='boolean'&&isIterateeCall(value,isDeep,customizer)){isDeep=false;}else if(typeof isDeep=='function'){thisArg=customizer;customizer=isDeep;isDeep=false;}return typeof customizer=='function'?baseClone(value,isDeep,bindCallback(customizer,thisArg,3)):baseClone(value,isDeep);}module.exports=clone;},{"../internal/baseClone":445,"../internal/bindCallback":481,"../internal/isIterateeCall":516}],536:[function(require,module,exports){var isArrayLike=require('../internal/isArrayLike'),isObjectLike=require('../internal/isObjectLike');var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var propertyIsEnumerable=objectProto.propertyIsEnumerable;function isArguments(value){return isObjectLike(value)&&isArrayLike(value)&&hasOwnProperty.call(value,'callee')&&!propertyIsEnumerable.call(value,'callee');}module.exports=isArguments;},{"../internal/isArrayLike":514,"../internal/isObjectLike":520}],537:[function(require,module,exports){var getNative=require('../internal/getNative'),isLength=require('../internal/isLength'),isObjectLike=require('../internal/isObjectLike');var arrayTag='[object Array]';var objectProto=Object.prototype;var objToString=objectProto.toString;var nativeIsArray=getNative(Array,'isArray');var isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)==arrayTag;};module.exports=isArray;},{"../internal/getNative":509,"../internal/isLength":519,"../internal/isObjectLike":520}],538:[function(require,module,exports){var isArguments=require('./isArguments'),isArray=require('./isArray'),isArrayLike=require('../internal/isArrayLike'),isFunction=require('./isFunction'),isObjectLike=require('../internal/isObjectLike'),isString=require('./isString'),keys=require('../object/keys');function isEmpty(value){if(value==null){return true;}if(isArrayLike(value)&&(isArray(value)||isString(value)||isArguments(value)||(isObjectLike(value)&&isFunction(value.splice)))){return!value.length;}return!keys(value).length;}module.exports=isEmpty;},{"../internal/isArrayLike":514,"../internal/isObjectLike":520,"../object/keys":550,"./isArguments":536,"./isArray":537,"./isFunction":539,"./isString":544}],539:[function(require,module,exports){var isObject=require('./isObject');var funcTag='[object Function]';var objectProto=Object.prototype;var objToString=objectProto.toString;function isFunction(value){return isObject(value)&&objToString.call(value)==funcTag;}module.exports=isFunction;},{"./isObject":542}],540:[function(require,module,exports){var isFunction=require('./isFunction'),isObjectLike=require('../internal/isObjectLike');var reIsHostCtor=/^\[object .+?Constructor\]$/;var objectProto=Object.prototype;var fnToString=Function.prototype.toString;var hasOwnProperty=objectProto.hasOwnProperty;var reIsNative=RegExp('^'+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,'\\$&').replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,'$1.*?')+'$');function isNative(value){if(value==null){return false;}if(isFunction(value)){return reIsNative.test(fnToString.call(value));}return isObjectLike(value)&&reIsHostCtor.test(value);}module.exports=isNative;},{"../internal/isObjectLike":520,"./isFunction":539}],541:[function(require,module,exports){var isObjectLike=require('../internal/isObjectLike');var numberTag='[object Number]';var objectProto=Object.prototype;var objToString=objectProto.toString;function isNumber(value){return typeof value=='number'||(isObjectLike(value)&&objToString.call(value)==numberTag);}module.exports=isNumber;},{"../internal/isObjectLike":520}],542:[function(require,module,exports){function isObject(value){var type=typeof value;return!!value&&(type=='object'||type=='function');}module.exports=isObject;},{}],543:[function(require,module,exports){var baseForIn=require('../internal/baseForIn'),isArguments=require('./isArguments'),isObjectLike=require('../internal/isObjectLike');var objectTag='[object Object]';var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;function isPlainObject(value){var Ctor;if(!(isObjectLike(value)&&objToString.call(value)==objectTag&&!isArguments(value))||(!hasOwnProperty.call(value,'constructor')&&(Ctor=value.constructor,typeof Ctor=='function'&&!(Ctor instanceof Ctor)))){return false;}var result;baseForIn(value,function(subValue,key){result=key;});return result===undefined||hasOwnProperty.call(value,result);}module.exports=isPlainObject;},{"../internal/baseForIn":458,"../internal/isObjectLike":520,"./isArguments":536}],544:[function(require,module,exports){var isObjectLike=require('../internal/isObjectLike');var stringTag='[object String]';var objectProto=Object.prototype;var objToString=objectProto.toString;function isString(value){return typeof value=='string'||(isObjectLike(value)&&objToString.call(value)==stringTag);}module.exports=isString;},{"../internal/isObjectLike":520}],545:[function(require,module,exports){var isLength=require('../internal/isLength'),isObjectLike=require('../internal/isObjectLike');var argsTag='[object Arguments]',arrayTag='[object Array]',boolTag='[object Boolean]',dateTag='[object Date]',errorTag='[object Error]',funcTag='[object Function]',mapTag='[object Map]',numberTag='[object Number]',objectTag='[object Object]',regexpTag='[object RegExp]',setTag='[object Set]',stringTag='[object String]',weakMapTag='[object WeakMap]';var arrayBufferTag='[object ArrayBuffer]',float32Tag='[object Float32Array]',float64Tag='[object Float64Array]',int8Tag='[object Int8Array]',int16Tag='[object Int16Array]',int32Tag='[object Int32Array]',uint8Tag='[object Uint8Array]',uint8ClampedTag='[object Uint8ClampedArray]',uint16Tag='[object Uint16Array]',uint32Tag='[object Uint32Array]';var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;var objectProto=Object.prototype;var objToString=objectProto.toString;function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objToString.call(value)];}module.exports=isTypedArray;},{"../internal/isLength":519,"../internal/isObjectLike":520}],546:[function(require,module,exports){var baseCopy=require('../internal/baseCopy'),keysIn=require('../object/keysIn');function toPlainObject(value){return baseCopy(value,keysIn(value));}module.exports=toPlainObject;},{"../internal/baseCopy":447,"../object/keysIn":551}],547:[function(require,module,exports){var assignWith=require('../internal/assignWith'),baseAssign=require('../internal/baseAssign'),createAssigner=require('../internal/createAssigner');var assign=createAssigner(function(object,source,customizer){return customizer?assignWith(object,source,customizer):baseAssign(object,source);});module.exports=assign;},{"../internal/assignWith":442,"../internal/baseAssign":443,"../internal/createAssigner":489}],548:[function(require,module,exports){var baseGet=require('../internal/baseGet'),toPath=require('../internal/toPath');function get(object,path,defaultValue){var result=object==null?undefined:baseGet(object,toPath(path),(path+''));return result===undefined?defaultValue:result;}module.exports=get;},{"../internal/baseGet":460,"../internal/toPath":533}],549:[function(require,module,exports){var baseGet=require('../internal/baseGet'),baseSlice=require('../internal/baseSlice'),isArguments=require('../lang/isArguments'),isArray=require('../lang/isArray'),isIndex=require('../internal/isIndex'),isKey=require('../internal/isKey'),isLength=require('../internal/isLength'),last=require('../array/last'),toPath=require('../internal/toPath');var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function has(object,path){if(object==null){return false;}var result=hasOwnProperty.call(object,path);if(!result&&!isKey(path)){path=toPath(path);object=path.length==1?object:baseGet(object,baseSlice(path,0,-1));if(object==null){return false;}path=last(path);result=hasOwnProperty.call(object,path);}return result||(isLength(object.length)&&isIndex(path,object.length)&&(isArray(object)||isArguments(object)));}module.exports=has;},{"../array/last":406,"../internal/baseGet":460,"../internal/baseSlice":475,"../internal/isIndex":515,"../internal/isKey":517,"../internal/isLength":519,"../internal/toPath":533,"../lang/isArguments":536,"../lang/isArray":537}],550:[function(require,module,exports){var getNative=require('../internal/getNative'),isArrayLike=require('../internal/isArrayLike'),isObject=require('../lang/isObject'),shimKeys=require('../internal/shimKeys');var nativeKeys=getNative(Object,'keys');var keys=!nativeKeys?shimKeys:function(object){var Ctor=object==null?undefined:object.constructor;if((typeof Ctor=='function'&&Ctor.prototype===object)||(typeof object!='function'&&isArrayLike(object))){return shimKeys(object);}return isObject(object)?nativeKeys(object):[];};module.exports=keys;},{"../internal/getNative":509,"../internal/isArrayLike":514,"../internal/shimKeys":530,"../lang/isObject":542}],551:[function(require,module,exports){var isArguments=require('../lang/isArguments'),isArray=require('../lang/isArray'),isIndex=require('../internal/isIndex'),isLength=require('../internal/isLength'),isObject=require('../lang/isObject');var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function keysIn(object){if(object==null){return[];}if(!isObject(object)){object=Object(object);}var length=object.length;length=(length&&isLength(length)&&(isArray(object)||isArguments(object))&&length)||0;var Ctor=object.constructor,index=-1,isProto=typeof Ctor=='function'&&Ctor.prototype===object,result=Array(length),skipIndexes=length>0;while(++index<length){result[index]=(index+'');}for(var key in object){if(!(skipIndexes&&isIndex(key,length))&&!(key=='constructor'&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key);}}return result;}module.exports=keysIn;},{"../internal/isIndex":515,"../internal/isLength":519,"../lang/isArguments":536,"../lang/isArray":537,"../lang/isObject":542}],552:[function(require,module,exports){var baseMerge=require('../internal/baseMerge'),createAssigner=require('../internal/createAssigner');var merge=createAssigner(baseMerge);module.exports=merge;},{"../internal/baseMerge":469,"../internal/createAssigner":489}],553:[function(require,module,exports){var arrayMap=require('../internal/arrayMap'),baseDifference=require('../internal/baseDifference'),baseFlatten=require('../internal/baseFlatten'),bindCallback=require('../internal/bindCallback'),keysIn=require('./keysIn'),pickByArray=require('../internal/pickByArray'),pickByCallback=require('../internal/pickByCallback'),restParam=require('../function/restParam');var omit=restParam(function(object,props){if(object==null){return{};}if(typeof props[0]!='function'){var props=arrayMap(baseFlatten(props),String);return pickByArray(object,baseDifference(keysIn(object),props));}var predicate=bindCallback(props[0],props[1],3);return pickByCallback(object,function(value,key,object){return!predicate(value,key,object);});});module.exports=omit;},{"../function/restParam":430,"../internal/arrayMap":438,"../internal/baseDifference":450,"../internal/baseFlatten":456,"../internal/bindCallback":481,"../internal/pickByArray":524,"../internal/pickByCallback":525,"./keysIn":551}],554:[function(require,module,exports){var keys=require('./keys'),toObject=require('../internal/toObject');function pairs(object){object=toObject(object);var index=-1,props=keys(object),length=props.length,result=Array(length);while(++index<length){var key=props[index];result[index]=[key,object[key]];}return result;}module.exports=pairs;},{"../internal/toObject":532,"./keys":550}],555:[function(require,module,exports){var baseFlatten=require('../internal/baseFlatten'),bindCallback=require('../internal/bindCallback'),pickByArray=require('../internal/pickByArray'),pickByCallback=require('../internal/pickByCallback'),restParam=require('../function/restParam');var pick=restParam(function(object,props){if(object==null){return{};}return typeof props[0]=='function'?pickByCallback(object,bindCallback(props[0],props[1],3)):pickByArray(object,baseFlatten(props));});module.exports=pick;},{"../function/restParam":430,"../internal/baseFlatten":456,"../internal/bindCallback":481,"../internal/pickByArray":524,"../internal/pickByCallback":525}],556:[function(require,module,exports){var arrayEach=require('../internal/arrayEach'),baseCallback=require('../internal/baseCallback'),baseCreate=require('../internal/baseCreate'),baseForOwn=require('../internal/baseForOwn'),isArray=require('../lang/isArray'),isFunction=require('../lang/isFunction'),isObject=require('../lang/isObject'),isTypedArray=require('../lang/isTypedArray');function transform(object,iteratee,accumulator,thisArg){var isArr=isArray(object)||isTypedArray(object);iteratee=baseCallback(iteratee,thisArg,4);if(accumulator==null){if(isArr||isObject(object)){var Ctor=object.constructor;if(isArr){accumulator=isArray(object)?new Ctor:[];}else{accumulator=baseCreate(isFunction(Ctor)?Ctor.prototype:undefined);}}else{accumulator={};}}(isArr?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object);});return accumulator;}module.exports=transform;},{"../internal/arrayEach":435,"../internal/baseCallback":444,"../internal/baseCreate":448,"../internal/baseForOwn":459,"../lang/isArray":537,"../lang/isFunction":539,"../lang/isObject":542,"../lang/isTypedArray":545}],557:[function(require,module,exports){var baseValues=require('../internal/baseValues'),keys=require('./keys');function values(object){return baseValues(object,keys(object));}module.exports=values;},{"../internal/baseValues":480,"./keys":550}],558:[function(require,module,exports){function identity(value){return value;}module.exports=identity;},{}],559:[function(require,module,exports){function noop(){}module.exports=noop;},{}],560:[function(require,module,exports){var baseProperty=require('../internal/baseProperty'),basePropertyDeep=require('../internal/basePropertyDeep'),isKey=require('../internal/isKey');function property(path){return isKey(path)?baseProperty(path):basePropertyDeep(path);}module.exports=property;},{"../internal/baseProperty":471,"../internal/basePropertyDeep":472,"../internal/isKey":517}],561:[function(require,module,exports){module.exports=function(el,name,val){if(arguments.length==2){return el.getAttribute(name);}if(val===null){return el.removeAttribute(name);}el.setAttribute(name,val);return el;};},{}],562:[function(require,module,exports){module.exports=require('component-classes');},{"component-classes":213}],563:[function(require,module,exports){module.exports=function(el){var c;while(el.childNodes.length){c=el.childNodes[0];el.removeChild(c);}return el;};},{}],564:[function(require,module,exports){module.exports=require('component-closest');},{"component-closest":214}],565:[function(require,module,exports){module.exports=require('component-delegate');},{"component-delegate":215}],566:[function(require,module,exports){module.exports=require('domify');},{"domify":392}],567:[function(require,module,exports){module.exports=require('component-event');},{"component-event":216}],568:[function(require,module,exports){module.exports=require('component-matches-selector');},{"component-matches-selector":218}],569:[function(require,module,exports){module.exports=require('component-query');},{"component-query":219}],570:[function(require,module,exports){module.exports=function(el){el.parentNode&&el.parentNode.removeChild(el);};},{}],571:[function(require,module,exports){'use strict';function capitalize(string){return string.charAt(0).toUpperCase()+string.slice(1);}function lower(string){return string.charAt(0).toLowerCase()+string.slice(1);}function hasLowerCaseAlias(pkg){return pkg.xml&&pkg.xml.tagAlias==='lowerCase';}module.exports.aliasToName=function(alias,pkg){if(hasLowerCaseAlias(pkg)){return capitalize(alias);}else{return alias;}};module.exports.nameToAlias=function(name,pkg){if(hasLowerCaseAlias(pkg)){return lower(name);}else{return name;}};module.exports.DEFAULT_NS_MAP={'xsi':'http://www.w3.org/2001/XMLSchema-instance'};var XSI_TYPE=module.exports.XSI_TYPE='xsi:type';function serializeFormat(element){return element.xml&&element.xml.serialize;}module.exports.serializeAsType=function(element){return serializeFormat(element)===XSI_TYPE;};module.exports.serializeAsProperty=function(element){return serializeFormat(element)==='property';};},{}],572:[function(require,module,exports){'use strict';var reduce=require('lodash/collection/reduce'),forEach=require('lodash/collection/forEach'),find=require('lodash/collection/find'),assign=require('lodash/object/assign'),defer=require('lodash/function/defer');var Stack=require('tiny-stack'),SaxParser=require('sax').parser,Moddle=require('moddle'),parseNameNs=require('moddle/lib/ns').parseName,Types=require('moddle/lib/types'),coerceType=Types.coerceType,isSimpleType=Types.isSimple,common=require('./common'),XSI_TYPE=common.XSI_TYPE,XSI_URI=common.DEFAULT_NS_MAP.xsi,serializeAsType=common.serializeAsType,aliasToName=common.aliasToName;function parseNodeAttributes(node){var nodeAttrs=node.attributes;return reduce(nodeAttrs,function(result,v,k){var name,ns;if(!v.local){name=v.prefix;}else{ns=parseNameNs(v.name,v.prefix);name=ns.name;}result[name]=v.value;return result;},{});}function normalizeType(node,attr,model){var nameNs=parseNameNs(attr.value);var uri=node.ns[nameNs.prefix||''],localName=nameNs.localName,pkg=uri&&model.getPackage(uri),typePrefix;if(pkg){typePrefix=pkg.xml&&pkg.xml.typePrefix;if(typePrefix&&localName.indexOf(typePrefix)===0){localName=localName.slice(typePrefix.length);}attr.value=pkg.prefix+':'+localName;}}function normalizeNamespaces(node,model,defaultNsUri){var uri,prefix;uri=node.uri||defaultNsUri;if(uri){var pkg=model.getPackage(uri);if(pkg){prefix=pkg.prefix;}else{prefix=node.prefix;}node.prefix=prefix;node.uri=uri;}forEach(node.attributes,function(attr){if(attr.uri===XSI_URI&&attr.local==='type'){normalizeType(node,attr,model);}normalizeNamespaces(attr,model,null);});}function error(message){return new Error(message);}function getModdleDescriptor(element){return element.$descriptor;}function Context(options){assign(this,options);this.elementsById={};this.references=[];this.warnings=[];this.addReference=function(reference){this.references.push(reference);};this.addElement=function(element){if(!element){throw error('expected element');}var elementsById=this.elementsById;var descriptor=getModdleDescriptor(element);var idProperty=descriptor.idProperty,id;if(idProperty){id=element.get(idProperty.name);if(id){if(elementsById[id]){throw error('duplicate ID <'+id+'>');}elementsById[id]=element;}}};this.addWarning=function(warning){this.warnings.push(warning);};}function BaseHandler(){}BaseHandler.prototype.handleEnd=function(){};BaseHandler.prototype.handleText=function(){};BaseHandler.prototype.handleNode=function(){};function NoopHandler(){}NoopHandler.prototype=Object.create(BaseHandler.prototype);NoopHandler.prototype.handleNode=function(){return this;};function BodyHandler(){}BodyHandler.prototype=Object.create(BaseHandler.prototype);BodyHandler.prototype.handleText=function(text){this.body=(this.body||'')+text;};function ReferenceHandler(property,context){this.property=property;this.context=context;}ReferenceHandler.prototype=Object.create(BodyHandler.prototype);ReferenceHandler.prototype.handleNode=function(node){if(this.element){throw error('expected no sub nodes');}else{this.element=this.createReference(node);}return this;};ReferenceHandler.prototype.handleEnd=function(){this.element.id=this.body;};ReferenceHandler.prototype.createReference=function(node){return{property:this.property.ns.name,id:''};};function ValueHandler(propertyDesc,element){this.element=element;this.propertyDesc=propertyDesc;}ValueHandler.prototype=Object.create(BodyHandler.prototype);ValueHandler.prototype.handleEnd=function(){var value=this.body||'',element=this.element,propertyDesc=this.propertyDesc;value=coerceType(propertyDesc.type,value);if(propertyDesc.isMany){element.get(propertyDesc.name).push(value);}else{element.set(propertyDesc.name,value);}};function BaseElementHandler(){}BaseElementHandler.prototype=Object.create(BodyHandler.prototype);BaseElementHandler.prototype.handleNode=function(node){var parser=this,element=this.element;if(!element){element=this.element=this.createElement(node);this.context.addElement(element);}else{parser=this.handleChild(node);}return parser;};function ElementHandler(model,type,context){this.model=model;this.type=model.getType(type);this.context=context;}ElementHandler.prototype=Object.create(BaseElementHandler.prototype);ElementHandler.prototype.addReference=function(reference){this.context.addReference(reference);};ElementHandler.prototype.handleEnd=function(){var value=this.body,element=this.element,descriptor=getModdleDescriptor(element),bodyProperty=descriptor.bodyProperty;if(bodyProperty&&value!==undefined){value=coerceType(bodyProperty.type,value);element.set(bodyProperty.name,value);}};ElementHandler.prototype.createElement=function(node){var attributes=parseNodeAttributes(node),Type=this.type,descriptor=getModdleDescriptor(Type),context=this.context,instance=new Type({});forEach(attributes,function(value,name){var prop=descriptor.propertiesByName[name],values;if(prop&&prop.isReference){if(!prop.isMany){context.addReference({element:instance,property:prop.ns.name,id:value});}else{values=value.split(' ');forEach(values,function(v){context.addReference({element:instance,property:prop.ns.name,id:v});});}}else{if(prop){value=coerceType(prop.type,value);}instance.set(name,value);}});return instance;};ElementHandler.prototype.getPropertyForNode=function(node){var nameNs=parseNameNs(node.local,node.prefix);var type=this.type,model=this.model,descriptor=getModdleDescriptor(type);var propertyName=nameNs.name,property=descriptor.propertiesByName[propertyName],elementTypeName,elementType,typeAnnotation;if(property){if(serializeAsType(property)){typeAnnotation=node.attributes[XSI_TYPE];if(typeAnnotation){elementTypeName=typeAnnotation.value;elementType=model.getType(elementTypeName);return assign({},property,{effectiveType:getModdleDescriptor(elementType).name});}}return property;}var pkg=model.getPackage(nameNs.prefix);if(pkg){elementTypeName=nameNs.prefix+':'+aliasToName(nameNs.localName,descriptor.$pkg);elementType=model.getType(elementTypeName);property=find(descriptor.properties,function(p){return!p.isVirtual&&!p.isReference&&!p.isAttribute&&elementType.hasType(p.type);});if(property){return assign({},property,{effectiveType:getModdleDescriptor(elementType).name});}}else{property=find(descriptor.properties,function(p){return!p.isReference&&!p.isAttribute&&p.type==='Element';});if(property){return property;}}throw error('unrecognized element <'+nameNs.name+'>');};ElementHandler.prototype.toString=function(){return'ElementDescriptor['+getModdleDescriptor(this.type).name+']';};ElementHandler.prototype.valueHandler=function(propertyDesc,element){return new ValueHandler(propertyDesc,element);};ElementHandler.prototype.referenceHandler=function(propertyDesc){return new ReferenceHandler(propertyDesc,this.context);};ElementHandler.prototype.handler=function(type){if(type==='Element'){return new GenericElementHandler(this.model,type,this.context);}else{return new ElementHandler(this.model,type,this.context);}};ElementHandler.prototype.handleChild=function(node){var propertyDesc,type,element,childHandler;propertyDesc=this.getPropertyForNode(node);element=this.element;type=propertyDesc.effectiveType||propertyDesc.type;if(isSimpleType(type)){return this.valueHandler(propertyDesc,element);}if(propertyDesc.isReference){childHandler=this.referenceHandler(propertyDesc).handleNode(node);}else{childHandler=this.handler(type).handleNode(node);}var newElement=childHandler.element;if(newElement!==undefined){if(propertyDesc.isMany){element.get(propertyDesc.name).push(newElement);}else{element.set(propertyDesc.name,newElement);}if(propertyDesc.isReference){assign(newElement,{element:element});this.context.addReference(newElement);}else{newElement.$parent=element;}}return childHandler;};function GenericElementHandler(model,type,context){this.model=model;this.context=context;}GenericElementHandler.prototype=Object.create(BaseElementHandler.prototype);GenericElementHandler.prototype.createElement=function(node){var name=node.name,prefix=node.prefix,uri=node.ns[prefix],attributes=node.attributes;return this.model.createAny(name,uri,attributes);};GenericElementHandler.prototype.handleChild=function(node){var handler=new GenericElementHandler(this.model,'Element',this.context).handleNode(node),element=this.element;var newElement=handler.element,children;if(newElement!==undefined){children=element.$children=element.$children||[];children.push(newElement);newElement.$parent=element;}return handler;};GenericElementHandler.prototype.handleText=function(text){this.body=this.body||''+text;};GenericElementHandler.prototype.handleEnd=function(){if(this.body){this.element.$body=this.body;}};function XMLReader(options){if(options instanceof Moddle){options={model:options};}assign(this,{lax:false},options);}XMLReader.prototype.fromXML=function(xml,options,done){var rootHandler=options.rootHandler;if(options instanceof ElementHandler){rootHandler=options;options={};}else{if(typeof options==='string'){rootHandler=this.handler(options);options={};}else if(typeof rootHandler==='string'){rootHandler=this.handler(rootHandler);}}var model=this.model,lax=this.lax;var context=new Context(assign({},options,{rootHandler:rootHandler})),parser=new SaxParser(true,{xmlns:true,trim:true}),stack=new Stack();rootHandler.context=context;stack.push(rootHandler);function resolveReferences(){var elementsById=context.elementsById;var references=context.references;var i,r;for(i=0;!!(r=references[i]);i++){var element=r.element;var reference=elementsById[r.id];var property=getModdleDescriptor(element).propertiesByName[r.property];if(!reference){context.addWarning({message:'unresolved reference <'+r.id+'>',element:r.element,property:r.property,value:r.id});}if(property.isMany){var collection=element.get(property.name),idx=collection.indexOf(r);if(idx===-1){idx=collection.length;}if(!reference){collection.splice(idx,1);}else{collection[idx]=reference;}}else{element.set(property.name,reference);}}}function handleClose(tagName){stack.pop().handleEnd();}function handleOpen(node){var handler=stack.peek();normalizeNamespaces(node,model);try{stack.push(handler.handleNode(node));}catch(e){var line=this.line,column=this.column;var message='unparsable content <'+node.name+'> detected\n\t'+'line: '+line+'\n\t'+'column: '+column+'\n\t'+'nested error: '+e.message;if(lax){context.addWarning({message:message,error:e});console.warn('could not parse node');console.warn(e);stack.push(new NoopHandler());}else{console.error('could not parse document');console.error(e);throw error(message);}}}function handleText(text){stack.peek().handleText(text);}parser.onopentag=handleOpen;parser.oncdata=parser.ontext=handleText;parser.onclosetag=handleClose;parser.onend=resolveReferences;defer(function(){var error;try{parser.write(xml).close();}catch(e){error=e;}done(error,error?undefined:rootHandler.element,context);});};XMLReader.prototype.handler=function(name){return new ElementHandler(this.model,name);};module.exports=XMLReader;module.exports.ElementHandler=ElementHandler;},{"./common":571,"lodash/collection/find":416,"lodash/collection/forEach":417,"lodash/collection/reduce":421,"lodash/function/defer":429,"lodash/object/assign":547,"moddle":574,"moddle/lib/ns":579,"moddle/lib/types":582,"sax":601,"tiny-stack":606}],573:[function(require,module,exports){'use strict';var map=require('lodash/collection/map'),forEach=require('lodash/collection/forEach'),isString=require('lodash/lang/isString'),filter=require('lodash/collection/filter'),assign=require('lodash/object/assign');var Types=require('moddle/lib/types'),parseNameNs=require('moddle/lib/ns').parseName,common=require('./common'),nameToAlias=common.nameToAlias,serializeAsType=common.serializeAsType,serializeAsProperty=common.serializeAsProperty;var XML_PREAMBLE='<?xml version="1.0" encoding="UTF-8"?>\n',ESCAPE_CHARS=/(<|>|'|"|&|\n\r|\n)/g,DEFAULT_NS_MAP=common.DEFAULT_NS_MAP,XSI_TYPE=common.XSI_TYPE;function nsName(ns){if(isString(ns)){return ns;}else{return(ns.prefix?ns.prefix+':':'')+ns.localName;}}function getNsAttrs(namespaces){function isUsed(ns){return namespaces.used[ns.uri];}function toAttr(ns){var name='xmlns'+(ns.prefix?':'+ns.prefix:'');return{name:name,value:ns.uri};}var allNs=[].concat(namespaces.wellknown,namespaces.custom);return map(filter(allNs,isUsed),toAttr);}function getElementNs(ns,descriptor){if(descriptor.isGeneric){return descriptor.name;}else{return assign({localName:nameToAlias(descriptor.ns.localName,descriptor.$pkg)},ns);}}function getPropertyNs(ns,descriptor){return assign({localName:descriptor.ns.localName},ns);}function getSerializableProperties(element){var descriptor=element.$descriptor;return filter(descriptor.properties,function(p){var name=p.name;if(p.isVirtual){return false;}if(!element.hasOwnProperty(name)){return false;}var value=element[name];if(value===p.default){return false;}if(value===null){return false;}return p.isMany?value.length:true;});}var ESCAPE_MAP={'\n':'10','\n\r':'10','"':'34','\'':'39','<':'60','>':'62','&':'38'};function escapeAttr(str){str=isString(str)?str:''+str;return str.replace(ESCAPE_CHARS,function(str){return'&#'+ESCAPE_MAP[str]+';';});}function filterAttributes(props){return filter(props,function(p){return p.isAttr;});}function filterContained(props){return filter(props,function(p){return!p.isAttr;});}function ReferenceSerializer(parent,ns){this.ns=ns;}ReferenceSerializer.prototype.build=function(element){this.element=element;return this;};ReferenceSerializer.prototype.serializeTo=function(writer){writer.appendIndent().append('<'+nsName(this.ns)+'>'+this.element.id+'</'+nsName(this.ns)+'>').appendNewLine();};function BodySerializer(){}BodySerializer.prototype.serializeValue=BodySerializer.prototype.serializeTo=function(writer){var escape=this.escape;if(escape){writer.append('<![CDATA[');}writer.append(this.value);if(escape){writer.append(']]>');}};BodySerializer.prototype.build=function(prop,value){this.value=value;if(prop.type==='String'&&value.search(ESCAPE_CHARS)!==-1){this.escape=true;}return this;};function ValueSerializer(ns){this.ns=ns;}ValueSerializer.prototype=new BodySerializer();ValueSerializer.prototype.serializeTo=function(writer){writer.appendIndent().append('<'+nsName(this.ns)+'>');this.serializeValue(writer);writer.append('</'+nsName(this.ns)+'>').appendNewLine();};function ElementSerializer(parent,ns){this.body=[];this.attrs=[];this.parent=parent;this.ns=ns;}ElementSerializer.prototype.build=function(element){this.element=element;var otherAttrs=this.parseNsAttributes(element);if(!this.ns){this.ns=this.nsTagName(element.$descriptor);}if(element.$descriptor.isGeneric){this.parseGeneric(element);}else{var properties=getSerializableProperties(element);this.parseAttributes(filterAttributes(properties));this.parseContainments(filterContained(properties));this.parseGenericAttributes(element,otherAttrs);}return this;};ElementSerializer.prototype.nsTagName=function(descriptor){var effectiveNs=this.logNamespaceUsed(descriptor.ns);return getElementNs(effectiveNs,descriptor);};ElementSerializer.prototype.nsPropertyTagName=function(descriptor){var effectiveNs=this.logNamespaceUsed(descriptor.ns);return getPropertyNs(effectiveNs,descriptor);};ElementSerializer.prototype.isLocalNs=function(ns){return ns.uri===this.ns.uri;};ElementSerializer.prototype.nsAttributeName=function(element){var ns;if(isString(element)){ns=parseNameNs(element);}else{ns=element.ns;}if(element.inherited){return{localName:ns.localName};}var effectiveNs=this.logNamespaceUsed(ns);if(this.isLocalNs(effectiveNs)){return{localName:ns.localName};}else{return assign({localName:ns.localName},effectiveNs);}};ElementSerializer.prototype.parseGeneric=function(element){var self=this,body=this.body,attrs=this.attrs;forEach(element,function(val,key){if(key==='$body'){body.push(new BodySerializer().build({type:'String'},val));}else
if(key==='$children'){forEach(val,function(child){body.push(new ElementSerializer(self).build(child));});}else
if(key.indexOf('$')!==0){attrs.push({name:key,value:escapeAttr(val)});}});};ElementSerializer.prototype.parseNsAttributes=function(element){var self=this;var genericAttrs=element.$attrs;var model=element.$model;var attributes=[];forEach(genericAttrs,function(value,name){var nameNs=parseNameNs(name);var ns;if(nameNs.prefix==='xmlns'){ns={prefix:nameNs.localName,uri:value};}if(!nameNs.prefix&&nameNs.localName==='xmlns'){ns={uri:value};}if(ns){if(model.getPackage(value)){self.logNamespace(ns,true);}else{self.logNamespaceUsed(ns);}}else{attributes.push({name:name,value:value});}});return attributes;};ElementSerializer.prototype.parseGenericAttributes=function(element,attributes){var self=this;forEach(attributes,function(attr){if(attr.name===XSI_TYPE){return;}try{self.addAttribute(self.nsAttributeName(attr.name),attr.value);}catch(e){console.warn('missing namespace information for ',attr.name,'=',attr.value,'on',element,e);}});};ElementSerializer.prototype.parseContainments=function(properties){var self=this,body=this.body,element=this.element;forEach(properties,function(p){var value=element.get(p.name),isReference=p.isReference,isMany=p.isMany;var ns=self.nsPropertyTagName(p);if(!isMany){value=[value];}if(p.isBody){body.push(new BodySerializer().build(p,value[0]));}else
if(Types.isSimple(p.type)){forEach(value,function(v){body.push(new ValueSerializer(ns).build(p,v));});}else
if(isReference){forEach(value,function(v){body.push(new ReferenceSerializer(self,ns).build(v));});}else{var asType=serializeAsType(p),asProperty=serializeAsProperty(p);forEach(value,function(v){var serializer;if(asType){serializer=new TypeSerializer(self,ns);}else
if(asProperty){serializer=new ElementSerializer(self,ns);}else{serializer=new ElementSerializer(self);}body.push(serializer.build(v));});}});};ElementSerializer.prototype.getNamespaces=function(){var namespaces=this.namespaces,parent=this.parent;if(!namespaces){namespaces=this.namespaces=parent?parent.getNamespaces():{prefixMap:{},uriMap:{},used:{},wellknown:[],custom:[]};}return namespaces;};ElementSerializer.prototype.logNamespace=function(ns,wellknown){var namespaces=this.getNamespaces();var nsUri=ns.uri;var existing=namespaces.uriMap[nsUri];if(!existing){namespaces.uriMap[nsUri]=ns;if(wellknown){namespaces.wellknown.push(ns);}else{namespaces.custom.push(ns);}}namespaces.prefixMap[ns.prefix]=nsUri;return ns;};ElementSerializer.prototype.logNamespaceUsed=function(ns){var element=this.element,model=element.$model,namespaces=this.getNamespaces();var prefix=ns.prefix;var wellknownUri=DEFAULT_NS_MAP[prefix]||model&&(model.getPackage(prefix)||{}).uri;var uri=ns.uri||namespaces.prefixMap[prefix]||wellknownUri;if(!uri){}ns=namespaces.uriMap[uri];if(!ns){ns=this.logNamespace({prefix:prefix,uri:uri},wellknownUri);}if(!namespaces.used[ns.uri]){namespaces.used[ns.uri]=ns;}return ns;};ElementSerializer.prototype.parseAttributes=function(properties){var self=this,element=this.element;forEach(properties,function(p){var value=element.get(p.name);if(p.isReference){if(!p.isMany){value=value.id;}else{var values=[];forEach(value,function(v){values.push(v.id);});value=values.join(' ');}}self.addAttribute(self.nsAttributeName(p),value);});};ElementSerializer.prototype.addAttribute=function(name,value){var attrs=this.attrs;if(isString(value)){value=escapeAttr(value);}attrs.push({name:name,value:value});};ElementSerializer.prototype.serializeAttributes=function(writer){var attrs=this.attrs,root=!this.parent;if(root){attrs=getNsAttrs(this.namespaces).concat(attrs);}forEach(attrs,function(a){writer.append(' ').append(nsName(a.name)).append('="').append(a.value).append('"');});};ElementSerializer.prototype.serializeTo=function(writer){var hasBody=this.body.length,indent=!(this.body.length===1&&this.body[0]instanceof BodySerializer);writer.appendIndent().append('<'+nsName(this.ns));this.serializeAttributes(writer);writer.append(hasBody?'>':' />');if(hasBody){if(indent){writer.appendNewLine().indent();}forEach(this.body,function(b){b.serializeTo(writer);});if(indent){writer.unindent().appendIndent();}writer.append('</'+nsName(this.ns)+'>');}writer.appendNewLine();};function TypeSerializer(parent,ns){ElementSerializer.call(this,parent,ns);}TypeSerializer.prototype=new ElementSerializer();TypeSerializer.prototype.build=function(element){var descriptor=element.$descriptor;this.element=element;this.typeNs=this.nsTagName(descriptor);var typeNs=this.typeNs,pkg=element.$model.getPackage(typeNs.uri),typePrefix=(pkg.xml&&pkg.xml.typePrefix)||'';this.addAttribute(this.nsAttributeName(XSI_TYPE),(typeNs.prefix?typeNs.prefix+':':'')+typePrefix+descriptor.ns.localName);return ElementSerializer.prototype.build.call(this,element);};TypeSerializer.prototype.isLocalNs=function(ns){return ns.uri===this.typeNs.uri;};function SavingWriter(){this.value='';this.write=function(str){this.value+=str;};}function FormatingWriter(out,format){var indent=[''];this.append=function(str){out.write(str);return this;};this.appendNewLine=function(){if(format){out.write('\n');}return this;};this.appendIndent=function(){if(format){out.write(indent.join('  '));}return this;};this.indent=function(){indent.push('');return this;};this.unindent=function(){indent.pop();return this;};}function XMLWriter(options){options=assign({format:false,preamble:true},options||{});function toXML(tree,writer){var internalWriter=writer||new SavingWriter();var formatingWriter=new FormatingWriter(internalWriter,options.format);if(options.preamble){formatingWriter.append(XML_PREAMBLE);}new ElementSerializer().build(tree).serializeTo(formatingWriter);if(!writer){return internalWriter.value;}}return{toXML:toXML};}module.exports=XMLWriter;},{"./common":571,"lodash/collection/filter":415,"lodash/collection/forEach":417,"lodash/collection/map":420,"lodash/lang/isString":544,"lodash/object/assign":547,"moddle/lib/ns":579,"moddle/lib/types":582}],574:[function(require,module,exports){module.exports=require('./lib/moddle');},{"./lib/moddle":578}],575:[function(require,module,exports){'use strict';function Base(){}Base.prototype.get=function(name){return this.$model.properties.get(this,name);};Base.prototype.set=function(name,value){this.$model.properties.set(this,name,value);};module.exports=Base;},{}],576:[function(require,module,exports){'use strict';var pick=require('lodash/object/pick'),assign=require('lodash/object/assign'),forEach=require('lodash/collection/forEach');var parseNameNs=require('./ns').parseName;function DescriptorBuilder(nameNs){this.ns=nameNs;this.name=nameNs.name;this.allTypes=[];this.properties=[];this.propertiesByName={};}module.exports=DescriptorBuilder;DescriptorBuilder.prototype.build=function(){return pick(this,['ns','name','allTypes','properties','propertiesByName','bodyProperty','idProperty']);};DescriptorBuilder.prototype.addProperty=function(p,idx,validate){if(typeof idx==='boolean'){validate=idx;idx=undefined;}this.addNamedProperty(p,validate!==false);var properties=this.properties;if(idx!==undefined){properties.splice(idx,0,p);}else{properties.push(p);}};DescriptorBuilder.prototype.replaceProperty=function(oldProperty,newProperty,replace){var oldNameNs=oldProperty.ns;var props=this.properties,propertiesByName=this.propertiesByName,rename=oldProperty.name!==newProperty.name;if(oldProperty.isId){if(!newProperty.isId){throw new Error('property <'+newProperty.ns.name+'> must be id property '+'to refine <'+oldProperty.ns.name+'>');}this.setIdProperty(newProperty,false);}if(oldProperty.isBody){if(!newProperty.isBody){throw new Error('property <'+newProperty.ns.name+'> must be body property '+'to refine <'+oldProperty.ns.name+'>');}this.setBodyProperty(newProperty,false);}var idx=props.indexOf(oldProperty);if(idx===-1){throw new Error('property <'+oldNameNs.name+'> not found in property list');}props.splice(idx,1);this.addProperty(newProperty,replace?undefined:idx,rename);propertiesByName[oldNameNs.name]=propertiesByName[oldNameNs.localName]=newProperty;};DescriptorBuilder.prototype.redefineProperty=function(p,targetPropertyName,replace){var nsPrefix=p.ns.prefix;var parts=targetPropertyName.split('#');var name=parseNameNs(parts[0],nsPrefix);var attrName=parseNameNs(parts[1],name.prefix).name;var redefinedProperty=this.propertiesByName[attrName];if(!redefinedProperty){throw new Error('refined property <'+attrName+'> not found');}else{this.replaceProperty(redefinedProperty,p,replace);}delete p.redefines;};DescriptorBuilder.prototype.addNamedProperty=function(p,validate){var ns=p.ns,propsByName=this.propertiesByName;if(validate){this.assertNotDefined(p,ns.name);this.assertNotDefined(p,ns.localName);}propsByName[ns.name]=propsByName[ns.localName]=p;};DescriptorBuilder.prototype.removeNamedProperty=function(p){var ns=p.ns,propsByName=this.propertiesByName;delete propsByName[ns.name];delete propsByName[ns.localName];};DescriptorBuilder.prototype.setBodyProperty=function(p,validate){if(validate&&this.bodyProperty){throw new Error('body property defined multiple times '+'(<'+this.bodyProperty.ns.name+'>, <'+p.ns.name+'>)');}this.bodyProperty=p;};DescriptorBuilder.prototype.setIdProperty=function(p,validate){if(validate&&this.idProperty){throw new Error('id property defined multiple times '+'(<'+this.idProperty.ns.name+'>, <'+p.ns.name+'>)');}this.idProperty=p;};DescriptorBuilder.prototype.assertNotDefined=function(p,name){var propertyName=p.name,definedProperty=this.propertiesByName[propertyName];if(definedProperty){throw new Error('property <'+propertyName+'> already defined; '+'override of <'+definedProperty.definedBy.ns.name+'#'+definedProperty.ns.name+'> by '+'<'+p.definedBy.ns.name+'#'+p.ns.name+'> not allowed without redefines');}};DescriptorBuilder.prototype.hasProperty=function(name){return this.propertiesByName[name];};DescriptorBuilder.prototype.addTrait=function(t,inherited){var allTypes=this.allTypes;if(allTypes.indexOf(t)!==-1){return;}forEach(t.properties,function(p){p=assign({},p,{name:p.ns.localName,inherited:inherited});Object.defineProperty(p,'definedBy',{value:t});var replaces=p.replaces,redefines=p.redefines;if(replaces||redefines){this.redefineProperty(p,replaces||redefines,replaces);}else{if(p.isBody){this.setBodyProperty(p);}if(p.isId){this.setIdProperty(p);}this.addProperty(p);}},this);allTypes.push(t);};},{"./ns":579,"lodash/collection/forEach":417,"lodash/object/assign":547,"lodash/object/pick":555}],577:[function(require,module,exports){'use strict';var forEach=require('lodash/collection/forEach');var Base=require('./base');function Factory(model,properties){this.model=model;this.properties=properties;}module.exports=Factory;Factory.prototype.createType=function(descriptor){var model=this.model;var props=this.properties,prototype=Object.create(Base.prototype);forEach(descriptor.properties,function(p){if(!p.isMany&&p.default!==undefined){prototype[p.name]=p.default;}});props.defineModel(prototype,model);props.defineDescriptor(prototype,descriptor);var name=descriptor.ns.name;function ModdleElement(attrs){props.define(this,'$type',{value:name,enumerable:true});props.define(this,'$attrs',{value:{}});props.define(this,'$parent',{writable:true});forEach(attrs,function(val,key){this.set(key,val);},this);}ModdleElement.prototype=prototype;ModdleElement.hasType=prototype.$instanceOf=this.model.hasType;props.defineModel(ModdleElement,model);props.defineDescriptor(ModdleElement,descriptor);return ModdleElement;};},{"./base":575,"lodash/collection/forEach":417}],578:[function(require,module,exports){'use strict';var isString=require('lodash/lang/isString'),isObject=require('lodash/lang/isObject'),forEach=require('lodash/collection/forEach'),find=require('lodash/collection/find');var Factory=require('./factory'),Registry=require('./registry'),Properties=require('./properties');var parseNameNs=require('./ns').parseName;function Moddle(packages){this.properties=new Properties(this);this.factory=new Factory(this,this.properties);this.registry=new Registry(packages,this.properties);this.typeCache={};}module.exports=Moddle;Moddle.prototype.create=function(descriptor,attrs){var Type=this.getType(descriptor);if(!Type){throw new Error('unknown type <'+descriptor+'>');}return new Type(attrs);};Moddle.prototype.getType=function(descriptor){var cache=this.typeCache;var name=isString(descriptor)?descriptor:descriptor.ns.name;var type=cache[name];if(!type){descriptor=this.registry.getEffectiveDescriptor(name);type=cache[name]=this.factory.createType(descriptor);}return type;};Moddle.prototype.createAny=function(name,nsUri,properties){var nameNs=parseNameNs(name);var element={$type:name};var descriptor={name:name,isGeneric:true,ns:{prefix:nameNs.prefix,localName:nameNs.localName,uri:nsUri}};this.properties.defineDescriptor(element,descriptor);this.properties.defineModel(element,this);this.properties.define(element,'$parent',{enumerable:false,writable:true});forEach(properties,function(a,key){if(isObject(a)&&a.value!==undefined){element[a.name]=a.value;}else{element[key]=a;}});return element;};Moddle.prototype.getPackage=function(uriOrPrefix){return this.registry.getPackage(uriOrPrefix);};Moddle.prototype.getPackages=function(){return this.registry.getPackages();};Moddle.prototype.getElementDescriptor=function(element){return element.$descriptor;};Moddle.prototype.hasType=function(element,type){if(type===undefined){type=element;element=this;}var descriptor=element.$model.getElementDescriptor(element);return!!find(descriptor.allTypes,function(t){return t.name===type;});};Moddle.prototype.getPropertyDescriptor=function(element,property){return this.getElementDescriptor(element).propertiesByName[property];};Moddle.prototype.getTypeDescriptor=function(type){return this.registry.typeMap[type];};},{"./factory":577,"./ns":579,"./properties":580,"./registry":581,"lodash/collection/find":416,"lodash/collection/forEach":417,"lodash/lang/isObject":542,"lodash/lang/isString":544}],579:[function(require,module,exports){'use strict';module.exports.parseName=function(name,defaultPrefix){var parts=name.split(/:/),localName,prefix;if(parts.length===1){localName=name;prefix=defaultPrefix;}else
if(parts.length===2){localName=parts[1];prefix=parts[0];}else{throw new Error('expected <prefix:localName> or <localName>, got '+name);}name=(prefix?prefix+':':'')+localName;return{name:name,prefix:prefix,localName:localName};};},{}],580:[function(require,module,exports){'use strict';function Properties(model){this.model=model;}module.exports=Properties;Properties.prototype.set=function(target,name,value){var property=this.model.getPropertyDescriptor(target,name);var propertyName=property&&property.name;if(isUndefined(value)){if(property){delete target[propertyName];}else{delete target.$attrs[name];}}else{if(property){if(propertyName in target){target[propertyName]=value;}else{defineProperty(target,property,value);}}else{target.$attrs[name]=value;}}};Properties.prototype.get=function(target,name){var property=this.model.getPropertyDescriptor(target,name);if(!property){return target.$attrs[name];}var propertyName=property.name;if(!target[propertyName]&&property.isMany){defineProperty(target,property,[]);}return target[propertyName];};Properties.prototype.define=function(target,name,options){Object.defineProperty(target,name,options);};Properties.prototype.defineDescriptor=function(target,descriptor){this.define(target,'$descriptor',{value:descriptor});};Properties.prototype.defineModel=function(target,model){this.define(target,'$model',{value:model});};function isUndefined(val){return typeof val==='undefined';}function defineProperty(target,property,value){Object.defineProperty(target,property.name,{enumerable:!property.isReference,writable:true,value:value,configurable:true});}},{}],581:[function(require,module,exports){'use strict';var assign=require('lodash/object/assign'),forEach=require('lodash/collection/forEach');var Types=require('./types'),DescriptorBuilder=require('./descriptor-builder');var parseNameNs=require('./ns').parseName,isBuiltInType=Types.isBuiltIn;function Registry(packages,properties){this.packageMap={};this.typeMap={};this.packages=[];this.properties=properties;forEach(packages,this.registerPackage,this);}module.exports=Registry;Registry.prototype.getPackage=function(uriOrPrefix){return this.packageMap[uriOrPrefix];};Registry.prototype.getPackages=function(){return this.packages;};Registry.prototype.registerPackage=function(pkg){pkg=assign({},pkg);forEach(pkg.types,function(descriptor){this.registerType(descriptor,pkg);},this);this.packageMap[pkg.uri]=this.packageMap[pkg.prefix]=pkg;this.packages.push(pkg);};Registry.prototype.registerType=function(type,pkg){type=assign({},type,{superClass:(type.superClass||[]).slice(),extends:(type.extends||[]).slice(),properties:(type.properties||[]).slice(),meta:assign(({},type.meta||{}))});var ns=parseNameNs(type.name,pkg.prefix),name=ns.name,propertiesByName={};forEach(type.properties,function(p){var propertyNs=parseNameNs(p.name,ns.prefix),propertyName=propertyNs.name;if(!isBuiltInType(p.type)){p.type=parseNameNs(p.type,propertyNs.prefix).name;}assign(p,{ns:propertyNs,name:propertyName});propertiesByName[propertyName]=p;});assign(type,{ns:ns,name:name,propertiesByName:propertiesByName});forEach(type.extends,function(extendsName){var extended=this.typeMap[extendsName];extended.traits=extended.traits||[];extended.traits.push(name);},this);this.definePackage(type,pkg);this.typeMap[name]=type;};Registry.prototype.mapTypes=function(nsName,iterator,trait){var type=isBuiltInType(nsName.name)?{name:nsName.name}:this.typeMap[nsName.name];var self=this;function traverseTrait(cls){return traverseSuper(cls,true);}function traverseSuper(cls,trait){var parentNs=parseNameNs(cls,isBuiltInType(cls)?'':nsName.prefix);self.mapTypes(parentNs,iterator,trait);}if(!type){throw new Error('unknown type <'+nsName.name+'>');}forEach(type.superClass,trait?traverseTrait:traverseSuper);iterator(type,!trait);forEach(type.traits,traverseTrait);};Registry.prototype.getEffectiveDescriptor=function(name){var nsName=parseNameNs(name);var builder=new DescriptorBuilder(nsName);this.mapTypes(nsName,function(type,inherited){builder.addTrait(type,inherited);});var descriptor=builder.build();this.definePackage(descriptor,descriptor.allTypes[descriptor.allTypes.length-1].$pkg);return descriptor;};Registry.prototype.definePackage=function(target,pkg){this.properties.define(target,'$pkg',{value:pkg});};},{"./descriptor-builder":576,"./ns":579,"./types":582,"lodash/collection/forEach":417,"lodash/object/assign":547}],582:[function(require,module,exports){'use strict';var BUILTINS={String:true,Boolean:true,Integer:true,Real:true,Element:true};var TYPE_CONVERTERS={String:function(s){return s;},Boolean:function(s){return s==='true';},Integer:function(s){return parseInt(s,10);},Real:function(s){return parseFloat(s,10);}};module.exports.coerceType=function(type,value){var converter=TYPE_CONVERTERS[type];if(converter){return converter(value);}else{return value;}};module.exports.isBuiltIn=function(type){return!!BUILTINS[type];};module.exports.isSimple=function(type){return!!TYPE_CONVERTERS[type];};},{}],583:[function(require,module,exports){module.exports=require('./lib/refs');module.exports.Collection=require('./lib/collection');},{"./lib/collection":584,"./lib/refs":585}],584:[function(require,module,exports){'use strict';function extend(collection,refs,property,target){var inverseProperty=property.inverse;Object.defineProperty(collection,'remove',{value:function(element){var idx=this.indexOf(element);if(idx!==-1){this.splice(idx,1);refs.unset(element,inverseProperty,target);}return element;}});Object.defineProperty(collection,'contains',{value:function(element){return this.indexOf(element)!==-1;}});Object.defineProperty(collection,'add',{value:function(element){if(!this.contains(element)){this.push(element);refs.set(element,inverseProperty,target);}}});Object.defineProperty(collection,'__refs_collection',{value:true});return collection;}function isExtended(collection){return collection.__refs_collection===true;}module.exports.extend=extend;module.exports.isExtended=isExtended;},{}],585:[function(require,module,exports){'use strict';var Collection=require('./collection');function hasOwnProperty(e,property){return Object.prototype.hasOwnProperty.call(e,property.name||property);}function defineCollectionProperty(ref,property,target){Object.defineProperty(target,property.name,{enumerable:property.enumerable,value:Collection.extend(target[property.name]||[],ref,property,target)});}function defineProperty(ref,property,target){var inverseProperty=property.inverse;var _value=target[property.name];Object.defineProperty(target,property.name,{enumerable:property.enumerable,get:function(){return _value;},set:function(value){if(value===_value){return;}var old=_value;_value=null;if(old){ref.unset(old,inverseProperty,target);}_value=value;ref.set(_value,inverseProperty,target);}});}function Refs(a,b){if(!(this instanceof Refs)){return new Refs(a,b);}a.inverse=b;b.inverse=a;this.props={};this.props[a.name]=a;this.props[b.name]=b;}Refs.prototype.bind=function(target,property){if(typeof property==='string'){if(!this.props[property]){throw new Error('no property <'+property+'> in ref');}property=this.props[property];}if(property.collection){defineCollectionProperty(this,property,target);}else{defineProperty(this,property,target);}};Refs.prototype.ensureRefsCollection=function(target,property){var collection=target[property.name];if(!Collection.isExtended(collection)){defineCollectionProperty(this,property,target);}return collection;};Refs.prototype.ensureBound=function(target,property){if(!hasOwnProperty(target,property)){this.bind(target,property);}};Refs.prototype.unset=function(target,property,value){if(target){this.ensureBound(target,property);if(property.collection){this.ensureRefsCollection(target,property).remove(value);}else{target[property.name]=undefined;}}};Refs.prototype.set=function(target,property,value){if(target){this.ensureBound(target,property);if(property.collection){this.ensureRefsCollection(target,property).add(value);}else{target[property.name]=value;}}};module.exports=Refs;},{"./collection":584}],586:[function(require,module,exports){(function(process){'use strict';if(!process.version||process.version.indexOf('v0.')===0||process.version.indexOf('v1.')===0&&process.version.indexOf('v1.8.')!==0){module.exports=nextTick;}else{module.exports=process.nextTick;}function nextTick(fn,arg1,arg2,arg3){if(typeof fn!=='function'){throw new TypeError('"callback" argument must be a function');}var len=arguments.length;var args,i;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function afterTickOne(){fn.call(null,arg1);});case 3:return process.nextTick(function afterTickTwo(){fn.call(null,arg1,arg2);});case 4:return process.nextTick(function afterTickThree(){fn.call(null,arg1,arg2,arg3);});default:args=new Array(len-1);i=0;while(i<args.length){args[i++]=arguments[i];}return process.nextTick(function afterTick(){fn.apply(null,args);});}}}).call(this,undefined)},{}],587:[function(require,module,exports){module.exports=require('./lib/_stream_duplex.js');},{"./lib/_stream_duplex.js":588}],588:[function(require,module,exports){'use strict';var processNextTick=require('process-nextick-args');var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){keys.push(key);}return keys;};module.exports=Duplex;var util=require('core-util-is');util.inherits=require('inherits');var Readable=require('./_stream_readable');var Writable=require('./_stream_writable');util.inherits(Duplex,Readable);var keys=objectKeys(Writable.prototype);for(var v=0;v<keys.length;v++){var method=keys[v];if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method];}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once('end',onend);}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;processNextTick(onEndNT,this);}function onEndNT(self){self.end();}Object.defineProperty(Duplex.prototype,'destroyed',{get:function(){if(this._readableState===undefined||this._writableState===undefined){return false;}return this._readableState.destroyed&&this._writableState.destroyed;},set:function(value){if(this._readableState===undefined||this._writableState===undefined){return;}this._readableState.destroyed=value;this._writableState.destroyed=value;}});Duplex.prototype._destroy=function(err,cb){this.push(null);this.end();processNextTick(cb,err);};function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i);}}},{"./_stream_readable":590,"./_stream_writable":592,"core-util-is":220,"inherits":398,"process-nextick-args":586}],589:[function(require,module,exports){'use strict';module.exports=PassThrough;var Transform=require('./_stream_transform');var util=require('core-util-is');util.inherits=require('inherits');util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options);}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk);};},{"./_stream_transform":591,"core-util-is":220,"inherits":398}],590:[function(require,module,exports){(function(process,global){'use strict';var processNextTick=require('process-nextick-args');module.exports=Readable;var isArray=require('isarray');var Duplex;Readable.ReadableState=ReadableState;var EE=require('events').EventEmitter;var EElistenerCount=function(emitter,type){return emitter.listeners(type).length;};var Stream=require('./internal/streams/stream');var Buffer=require('safe-buffer').Buffer;var OurUint8Array=global.Uint8Array||function(){};function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk);}function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array;}var util=require('core-util-is');util.inherits=require('inherits');var debugUtil=require('util');var debug=void 0;if(debugUtil&&debugUtil.debuglog){debug=debugUtil.debuglog('stream');}else{debug=function(){};}var BufferList=require('./internal/streams/BufferList');var destroyImpl=require('./internal/streams/destroy');var StringDecoder;util.inherits(Readable,Stream);var kProxyEvents=['error','close','destroy','pause','resume'];function prependListener(emitter,event,fn){if(typeof emitter.prependListener==='function'){return emitter.prependListener(event,fn);}else{if(!emitter._events||!emitter._events[event])emitter.on(event,fn);else if(isArray(emitter._events[event]))emitter._events[event].unshift(fn);else emitter._events[event]=[fn,emitter._events[event]];}}function ReadableState(options,stream){Duplex=Duplex||require('./_stream_duplex');options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.readableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=Math.floor(this.highWaterMark);this.buffer=new BufferList();this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.resumeScheduled=false;this.destroyed=false;this.defaultEncoding=options.defaultEncoding||'utf8';this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require('string_decoder/').StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding;}}function Readable(options){Duplex=Duplex||require('./_stream_duplex');if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;if(options){if(typeof options.read==='function')this._read=options.read;if(typeof options.destroy==='function')this._destroy=options.destroy;}Stream.call(this);}Object.defineProperty(Readable.prototype,'destroyed',{get:function(){if(this._readableState===undefined){return false;}return this._readableState.destroyed;},set:function(value){if(!this._readableState){return;}this._readableState.destroyed=value;}});Readable.prototype.destroy=destroyImpl.destroy;Readable.prototype._undestroy=destroyImpl.undestroy;Readable.prototype._destroy=function(err,cb){this.push(null);cb(err);};Readable.prototype.push=function(chunk,encoding){var state=this._readableState;var skipChunkCheck;if(!state.objectMode){if(typeof chunk==='string'){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=Buffer.from(chunk,encoding);encoding='';}skipChunkCheck=true;}}else{skipChunkCheck=true;}return readableAddChunk(this,chunk,encoding,false,skipChunkCheck);};Readable.prototype.unshift=function(chunk){return readableAddChunk(this,chunk,null,true,false);};function readableAddChunk(stream,chunk,encoding,addToFront,skipChunkCheck){var state=stream._readableState;if(chunk===null){state.reading=false;onEofChunk(stream,state);}else{var er;if(!skipChunkCheck)er=chunkInvalid(state,chunk);if(er){stream.emit('error',er);}else if(state.objectMode||chunk&&chunk.length>0){if(typeof chunk!=='string'&&!state.objectMode&&Object.getPrototypeOf(chunk)!==Buffer.prototype){chunk=_uint8ArrayToBuffer(chunk);}if(addToFront){if(state.endEmitted)stream.emit('error',new Error('stream.unshift() after end event'));else addChunk(stream,state,chunk,true);}else if(state.ended){stream.emit('error',new Error('stream.push() after EOF'));}else{state.reading=false;if(state.decoder&&!encoding){chunk=state.decoder.write(chunk);if(state.objectMode||chunk.length!==0)addChunk(stream,state,chunk,false);else maybeReadMore(stream,state);}else{addChunk(stream,state,chunk,false);}}}else if(!addToFront){state.reading=false;}}return needMoreData(state);}function addChunk(stream,state,chunk,addToFront){if(state.flowing&&state.length===0&&!state.sync){stream.emit('data',chunk);stream.read(0);}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream);}maybeReadMore(stream,state);}function chunkInvalid(state,chunk){var er;if(!_isUint8Array(chunk)&&typeof chunk!=='string'&&chunk!==undefined&&!state.objectMode){er=new TypeError('Invalid non-string/buffer chunk');}return er;}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0);}Readable.prototype.isPaused=function(){return this._readableState.flowing===false;};Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require('string_decoder/').StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this;};var MAX_HWM=0x800000;function computeNewHighWaterMark(n){if(n>=MAX_HWM){n=MAX_HWM;}else{n--;n|=n>>>1;n|=n>>>2;n|=n>>>4;n|=n>>>8;n|=n>>>16;n++;}return n;}function howMuchToRead(n,state){if(n<=0||state.length===0&&state.ended)return 0;if(state.objectMode)return 1;if(n!==n){if(state.flowing&&state.length)return state.buffer.head.data.length;else return state.length;}if(n>state.highWaterMark)state.highWaterMark=computeNewHighWaterMark(n);if(n<=state.length)return n;if(!state.ended){state.needReadable=true;return 0;}return state.length;}Readable.prototype.read=function(n){debug('read',n);n=parseInt(n,10);var state=this._readableState;var nOrig=n;if(n!==0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug('read: emitReadable',state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null;}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null;}var doRead=state.needReadable;debug('need readable',doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=true;debug('length less than watermark',doRead);}if(state.ended||state.reading){doRead=false;debug('reading or ended',doRead);}else if(doRead){debug('do read');state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false;if(!state.reading)n=howMuchToRead(nOrig,state);}var ret;if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0;}else{state.length-=n;}if(state.length===0){if(!state.ended)state.needReadable=true;if(nOrig!==n&&state.ended)endReadable(this);}if(ret!==null)this.emit('data',ret);return ret;};function onEofChunk(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length;}}state.ended=true;emitReadable(stream);}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(!state.emittedReadable){debug('emitReadable',state.flowing);state.emittedReadable=true;if(state.sync)processNextTick(emitReadable_,stream);else emitReadable_(stream);}}function emitReadable_(stream){debug('emit readable');stream.emit('readable');flow(stream);}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;processNextTick(maybeReadMore_,stream,state);}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug('maybeReadMore read 0');stream.read(0);if(len===state.length)break;else len=state.length;}state.readingMore=false;}Readable.prototype._read=function(n){this.emit('error',new Error('_read() is not implemented'));};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break;}state.pipesCount+=1;debug('pipe count=%d opts=%j',state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:unpipe;if(state.endEmitted)processNextTick(endFn);else src.once('end',endFn);dest.on('unpipe',onunpipe);function onunpipe(readable,unpipeInfo){debug('onunpipe');if(readable===src){if(unpipeInfo&&unpipeInfo.hasUnpiped===false){unpipeInfo.hasUnpiped=true;cleanup();}}}function onend(){debug('onend');dest.end();}var ondrain=pipeOnDrain(src);dest.on('drain',ondrain);var cleanedUp=false;function cleanup(){debug('cleanup');dest.removeListener('close',onclose);dest.removeListener('finish',onfinish);dest.removeListener('drain',ondrain);dest.removeListener('error',onerror);dest.removeListener('unpipe',onunpipe);src.removeListener('end',onend);src.removeListener('end',unpipe);src.removeListener('data',ondata);cleanedUp=true;if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain();}var increasedAwaitDrain=false;src.on('data',ondata);function ondata(chunk){debug('ondata');increasedAwaitDrain=false;var ret=dest.write(chunk);if(false===ret&&!increasedAwaitDrain){if((state.pipesCount===1&&state.pipes===dest||state.pipesCount>1&&indexOf(state.pipes,dest)!==-1)&&!cleanedUp){debug('false write response, pause',src._readableState.awaitDrain);src._readableState.awaitDrain++;increasedAwaitDrain=true;}src.pause();}}function onerror(er){debug('onerror',er);unpipe();dest.removeListener('error',onerror);if(EElistenerCount(dest,'error')===0)dest.emit('error',er);}prependListener(dest,'error',onerror);function onclose(){dest.removeListener('finish',onfinish);unpipe();}dest.once('close',onclose);function onfinish(){debug('onfinish');dest.removeListener('close',onclose);unpipe();}dest.once('finish',onfinish);function unpipe(){debug('unpipe');src.unpipe(dest);}dest.emit('pipe',src);if(!state.flowing){debug('pipe resume');src.resume();}return dest;};function pipeOnDrain(src){return function(){var state=src._readableState;debug('pipeOnDrain',state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EElistenerCount(src,'data')){state.flowing=true;flow(src);}};}Readable.prototype.unpipe=function(dest){var state=this._readableState;var unpipeInfo={hasUnpiped:false};if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=false;if(dest)dest.emit('unpipe',this,unpipeInfo);return this;}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=false;for(var i=0;i<len;i++){dests[i].emit('unpipe',this,unpipeInfo);}return this;}var index=indexOf(state.pipes,dest);if(index===-1)return this;state.pipes.splice(index,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit('unpipe',this,unpipeInfo);return this;};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==='data'){if(this._readableState.flowing!==false)this.resume();}else if(ev==='readable'){var state=this._readableState;if(!state.endEmitted&&!state.readableListening){state.readableListening=state.needReadable=true;state.emittedReadable=false;if(!state.reading){processNextTick(nReadingNextTick,this);}else if(state.length){emitReadable(this);}}}return res;};Readable.prototype.addListener=Readable.prototype.on;function nReadingNextTick(self){debug('readable nexttick read 0');self.read(0);}Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug('resume');state.flowing=true;resume(this,state);}return this;};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=true;processNextTick(resume_,stream,state);}}function resume_(stream,state){if(!state.reading){debug('resume read 0');stream.read(0);}state.resumeScheduled=false;state.awaitDrain=0;stream.emit('resume');flow(stream);if(state.flowing&&!state.reading)stream.read(0);}Readable.prototype.pause=function(){debug('call pause flowing=%j',this._readableState.flowing);if(false!==this._readableState.flowing){debug('pause');this._readableState.flowing=false;this.emit('pause');}return this;};function flow(stream){var state=stream._readableState;debug('flow',state.flowing);while(state.flowing&&stream.read()!==null){}}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on('end',function(){debug('wrapped end');if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk);}self.push(null);});stream.on('data',function(chunk){debug('wrapped data');if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause();}});for(var i in stream){if(this[i]===undefined&&typeof stream[i]==='function'){this[i]=function(method){return function(){return stream[method].apply(stream,arguments);};}(i);}}for(var n=0;n<kProxyEvents.length;n++){stream.on(kProxyEvents[n],self.emit.bind(self,kProxyEvents[n]));}self._read=function(n){debug('wrapped _read',n);if(paused){paused=false;stream.resume();}};return self;};Readable._fromList=fromList;function fromList(n,state){if(state.length===0)return null;var ret;if(state.objectMode)ret=state.buffer.shift();else if(!n||n>=state.length){if(state.decoder)ret=state.buffer.join('');else if(state.buffer.length===1)ret=state.buffer.head.data;else ret=state.buffer.concat(state.length);state.buffer.clear();}else{ret=fromListPartial(n,state.buffer,state.decoder);}return ret;}function fromListPartial(n,list,hasStrings){var ret;if(n<list.head.data.length){ret=list.head.data.slice(0,n);list.head.data=list.head.data.slice(n);}else if(n===list.head.data.length){ret=list.shift();}else{ret=hasStrings?copyFromBufferString(n,list):copyFromBuffer(n,list);}return ret;}function copyFromBufferString(n,list){var p=list.head;var c=1;var ret=p.data;n-=ret.length;while(p=p.next){var str=p.data;var nb=n>str.length?str.length:n;if(nb===str.length)ret+=str;else ret+=str.slice(0,n);n-=nb;if(n===0){if(nb===str.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null;}else{list.head=p;p.data=str.slice(nb);}break;}++c;}list.length-=c;return ret;}function copyFromBuffer(n,list){var ret=Buffer.allocUnsafe(n);var p=list.head;var c=1;p.data.copy(ret);n-=p.data.length;while(p=p.next){var buf=p.data;var nb=n>buf.length?buf.length:n;buf.copy(ret,ret.length-n,0,nb);n-=nb;if(n===0){if(nb===buf.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null;}else{list.head=p;p.data=buf.slice(nb);}break;}++c;}list.length-=c;return ret;}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error('"endReadable()" called on non-empty stream');if(!state.endEmitted){state.ended=true;processNextTick(endReadableNT,state,stream);}}function endReadableNT(state,stream){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit('end');}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i);}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i;}return-1;}}).call(this,undefined,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./_stream_duplex":588,"./internal/streams/BufferList":593,"./internal/streams/destroy":594,"./internal/streams/stream":595,"core-util-is":220,"events":393,"inherits":398,"isarray":400,"process-nextick-args":586,"safe-buffer":600,"string_decoder/":605,"util":209}],591:[function(require,module,exports){'use strict';module.exports=Transform;var Duplex=require('./_stream_duplex');var util=require('core-util-is');util.inherits=require('inherits');util.inherits(Transform,Duplex);function TransformState(stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data);};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null;this.writeencoding=null;}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb){return stream.emit('error',new Error('write callback called multiple times'));}ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)stream.push(data);cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark);}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;if(options){if(typeof options.transform==='function')this._transform=options.transform;if(typeof options.flush==='function')this._flush=options.flush;}this.once('prefinish',function(){if(typeof this._flush==='function')this._flush(function(er,data){done(stream,er,data);});else done(stream);});}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding);};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error('_transform() is not implemented');};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark);}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform);}else{ts.needTransform=true;}};Transform.prototype._destroy=function(err,cb){var _this=this;Duplex.prototype._destroy.call(this,err,function(err2){cb(err2);_this.emit('close');});};function done(stream,er,data){if(er)return stream.emit('error',er);if(data!==null&&data!==undefined)stream.push(data);var ws=stream._writableState;var ts=stream._transformState;if(ws.length)throw new Error('Calling transform done when ws.length != 0');if(ts.transforming)throw new Error('Calling transform done when still transforming');return stream.push(null);}},{"./_stream_duplex":588,"core-util-is":220,"inherits":398}],592:[function(require,module,exports){(function(process,global){'use strict';var processNextTick=require('process-nextick-args');module.exports=Writable;function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb;this.next=null;}function CorkedRequest(state){var _this=this;this.next=null;this.entry=null;this.finish=function(){onCorkedFinish(_this,state);};}var asyncWrite=!process.browser&&['v0.10','v0.9.'].indexOf(process.version.slice(0,5))>-1?setImmediate:processNextTick;var Duplex;Writable.WritableState=WritableState;var util=require('core-util-is');util.inherits=require('inherits');var internalUtil={deprecate:require('util-deprecate')};var Stream=require('./internal/streams/stream');var Buffer=require('safe-buffer').Buffer;var OurUint8Array=global.Uint8Array||function(){};function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk);}function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array;}var destroyImpl=require('./internal/streams/destroy');util.inherits(Writable,Stream);function nop(){}function WritableState(options,stream){Duplex=Duplex||require('./_stream_duplex');options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.writableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=Math.floor(this.highWaterMark);this.finalCalled=false;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;this.destroyed=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||'utf8';this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er);};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=false;this.errorEmitted=false;this.bufferedRequestCount=0;this.corkedRequestsFree=new CorkedRequest(this);}WritableState.prototype.getBuffer=function getBuffer(){var current=this.bufferedRequest;var out=[];while(current){out.push(current);current=current.next;}return out;};(function(){try{Object.defineProperty(WritableState.prototype,'buffer',{get:internalUtil.deprecate(function(){return this.getBuffer();},'_writableState.buffer is deprecated. Use _writableState.getBuffer '+'instead.','DEP0003')});}catch(_){}})();var realHasInstance;if(typeof Symbol==='function'&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]==='function'){realHasInstance=Function.prototype[Symbol.hasInstance];Object.defineProperty(Writable,Symbol.hasInstance,{value:function(object){if(realHasInstance.call(this,object))return true;return object&&object._writableState instanceof WritableState;}});}else{realHasInstance=function(object){return object instanceof this;};}function Writable(options){Duplex=Duplex||require('./_stream_duplex');if(!realHasInstance.call(Writable,this)&&!(this instanceof Duplex)){return new Writable(options);}this._writableState=new WritableState(options,this);this.writable=true;if(options){if(typeof options.write==='function')this._write=options.write;if(typeof options.writev==='function')this._writev=options.writev;if(typeof options.destroy==='function')this._destroy=options.destroy;if(typeof options.final==='function')this._final=options.final;}Stream.call(this);}Writable.prototype.pipe=function(){this.emit('error',new Error('Cannot pipe, not readable'));};function writeAfterEnd(stream,cb){var er=new Error('write after end');stream.emit('error',er);processNextTick(cb,er);}function validChunk(stream,state,chunk,cb){var valid=true;var er=false;if(chunk===null){er=new TypeError('May not write null values to stream');}else if(typeof chunk!=='string'&&chunk!==undefined&&!state.objectMode){er=new TypeError('Invalid non-string/buffer chunk');}if(er){stream.emit('error',er);processNextTick(cb,er);valid=false;}return valid;}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;var isBuf=_isUint8Array(chunk)&&!state.objectMode;if(isBuf&&!Buffer.isBuffer(chunk)){chunk=_uint8ArrayToBuffer(chunk);}if(typeof encoding==='function'){cb=encoding;encoding=null;}if(isBuf)encoding='buffer';else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=='function')cb=nop;if(state.ended)writeAfterEnd(this,cb);else if(isBuf||validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,isBuf,chunk,encoding,cb);}return ret;};Writable.prototype.cork=function(){var state=this._writableState;state.corked++;};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.bufferedRequest)clearBuffer(this,state);}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if(typeof encoding==='string')encoding=encoding.toLowerCase();if(!(['hex','utf8','utf-8','ascii','binary','base64','ucs2','ucs-2','utf16le','utf-16le','raw'].indexOf((encoding+'').toLowerCase())>-1))throw new TypeError('Unknown encoding: '+encoding);this._writableState.defaultEncoding=encoding;return this;};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==='string'){chunk=Buffer.from(chunk,encoding);}return chunk;}function writeOrBuffer(stream,state,isBuf,chunk,encoding,cb){if(!isBuf){var newChunk=decodeChunk(state,chunk,encoding);if(chunk!==newChunk){isBuf=true;encoding='buffer';chunk=newChunk;}}var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest={chunk:chunk,encoding:encoding,isBuf:isBuf,callback:cb,next:null};if(last){last.next=state.lastBufferedRequest;}else{state.bufferedRequest=state.lastBufferedRequest;}state.bufferedRequestCount+=1;}else{doWrite(stream,state,false,len,chunk,encoding,cb);}return ret;}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=false;}function onwriteError(stream,state,sync,er,cb){--state.pendingcb;if(sync){processNextTick(cb,er);processNextTick(finishMaybe,stream,state);stream._writableState.errorEmitted=true;stream.emit('error',er);}else{cb(er);stream._writableState.errorEmitted=true;stream.emit('error',er);finishMaybe(stream,state);}}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0;}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest){clearBuffer(stream,state);}if(sync){asyncWrite(afterWrite,stream,state,finished,cb);}else{afterWrite(stream,state,finished,cb);}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state);}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit('drain');}}function clearBuffer(stream,state){state.bufferProcessing=true;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount;var buffer=new Array(l);var holder=state.corkedRequestsFree;holder.entry=entry;var count=0;var allBuffers=true;while(entry){buffer[count]=entry;if(!entry.isBuf)allBuffers=false;entry=entry.next;count+=1;}buffer.allBuffers=allBuffers;doWrite(stream,state,true,state.length,buffer,'',holder.finish);state.pendingcb++;state.lastBufferedRequest=null;if(holder.next){state.corkedRequestsFree=holder.next;holder.next=null;}else{state.corkedRequestsFree=new CorkedRequest(state);}}else{while(entry){var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,false,len,chunk,encoding,cb);entry=entry.next;if(state.writing){break;}}if(entry===null)state.lastBufferedRequest=null;}state.bufferedRequestCount=0;state.bufferedRequest=entry;state.bufferProcessing=false;}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error('_write() is not implemented'));};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==='function'){cb=chunk;chunk=null;encoding=null;}else if(typeof encoding==='function'){cb=encoding;encoding=null;}if(chunk!==null&&chunk!==undefined)this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork();}if(!state.ending&&!state.finished)endWritable(this,state,cb);};function needFinish(state){return state.ending&&state.length===0&&state.bufferedRequest===null&&!state.finished&&!state.writing;}function callFinal(stream,state){stream._final(function(err){state.pendingcb--;if(err){stream.emit('error',err);}state.prefinished=true;stream.emit('prefinish');finishMaybe(stream,state);});}function prefinish(stream,state){if(!state.prefinished&&!state.finalCalled){if(typeof stream._final==='function'){state.pendingcb++;state.finalCalled=true;processNextTick(callFinal,stream,state);}else{state.prefinished=true;stream.emit('prefinish');}}}function finishMaybe(stream,state){var need=needFinish(state);if(need){prefinish(stream,state);if(state.pendingcb===0){state.finished=true;stream.emit('finish');}}return need;}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)processNextTick(cb);else stream.once('finish',cb);}state.ended=true;stream.writable=false;}function onCorkedFinish(corkReq,state,err){var entry=corkReq.entry;corkReq.entry=null;while(entry){var cb=entry.callback;state.pendingcb--;cb(err);entry=entry.next;}if(state.corkedRequestsFree){state.corkedRequestsFree.next=corkReq;}else{state.corkedRequestsFree=corkReq;}}Object.defineProperty(Writable.prototype,'destroyed',{get:function(){if(this._writableState===undefined){return false;}return this._writableState.destroyed;},set:function(value){if(!this._writableState){return;}this._writableState.destroyed=value;}});Writable.prototype.destroy=destroyImpl.destroy;Writable.prototype._undestroy=destroyImpl.undestroy;Writable.prototype._destroy=function(err,cb){this.end();cb(err);};}).call(this,undefined,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./_stream_duplex":588,"./internal/streams/destroy":594,"./internal/streams/stream":595,"core-util-is":220,"inherits":398,"process-nextick-args":586,"safe-buffer":600,"util-deprecate":622}],593:[function(require,module,exports){'use strict';function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var Buffer=require('safe-buffer').Buffer;function copyBuffer(src,target,offset){src.copy(target,offset);}module.exports=function(){function BufferList(){_classCallCheck(this,BufferList);this.head=null;this.tail=null;this.length=0;}BufferList.prototype.push=function push(v){var entry={data:v,next:null};if(this.length>0)this.tail.next=entry;else this.head=entry;this.tail=entry;++this.length;};BufferList.prototype.unshift=function unshift(v){var entry={data:v,next:this.head};if(this.length===0)this.tail=entry;this.head=entry;++this.length;};BufferList.prototype.shift=function shift(){if(this.length===0)return;var ret=this.head.data;if(this.length===1)this.head=this.tail=null;else this.head=this.head.next;--this.length;return ret;};BufferList.prototype.clear=function clear(){this.head=this.tail=null;this.length=0;};BufferList.prototype.join=function join(s){if(this.length===0)return'';var p=this.head;var ret=''+p.data;while(p=p.next){ret+=s+p.data;}return ret;};BufferList.prototype.concat=function concat(n){if(this.length===0)return Buffer.alloc(0);if(this.length===1)return this.head.data;var ret=Buffer.allocUnsafe(n>>>0);var p=this.head;var i=0;while(p){copyBuffer(p.data,ret,i);i+=p.data.length;p=p.next;}return ret;};return BufferList;}();},{"safe-buffer":600}],594:[function(require,module,exports){'use strict';var processNextTick=require('process-nextick-args');function destroy(err,cb){var _this=this;var readableDestroyed=this._readableState&&this._readableState.destroyed;var writableDestroyed=this._writableState&&this._writableState.destroyed;if(readableDestroyed||writableDestroyed){if(cb){cb(err);}else if(err&&(!this._writableState||!this._writableState.errorEmitted)){processNextTick(emitErrorNT,this,err);}return;}if(this._readableState){this._readableState.destroyed=true;}if(this._writableState){this._writableState.destroyed=true;}this._destroy(err||null,function(err){if(!cb&&err){processNextTick(emitErrorNT,_this,err);if(_this._writableState){_this._writableState.errorEmitted=true;}}else if(cb){cb(err);}});}function undestroy(){if(this._readableState){this._readableState.destroyed=false;this._readableState.reading=false;this._readableState.ended=false;this._readableState.endEmitted=false;}if(this._writableState){this._writableState.destroyed=false;this._writableState.ended=false;this._writableState.ending=false;this._writableState.finished=false;this._writableState.errorEmitted=false;}}function emitErrorNT(self,err){self.emit('error',err);}module.exports={destroy:destroy,undestroy:undestroy};},{"process-nextick-args":586}],595:[function(require,module,exports){module.exports=require('events').EventEmitter;},{"events":393}],596:[function(require,module,exports){module.exports=require('./readable').PassThrough},{"./readable":597}],597:[function(require,module,exports){exports=module.exports=require('./lib/_stream_readable.js');exports.Stream=exports;exports.Readable=exports;exports.Writable=require('./lib/_stream_writable.js');exports.Duplex=require('./lib/_stream_duplex.js');exports.Transform=require('./lib/_stream_transform.js');exports.PassThrough=require('./lib/_stream_passthrough.js');},{"./lib/_stream_duplex.js":588,"./lib/_stream_passthrough.js":589,"./lib/_stream_readable.js":590,"./lib/_stream_transform.js":591,"./lib/_stream_writable.js":592}],598:[function(require,module,exports){module.exports=require('./readable').Transform},{"./readable":597}],599:[function(require,module,exports){module.exports=require('./lib/_stream_writable.js');},{"./lib/_stream_writable.js":592}],600:[function(require,module,exports){var buffer=require('buffer');var Buffer=buffer.Buffer;function copyProps(src,dst){for(var key in src){dst[key]=src[key];}}if(Buffer.from&&Buffer.alloc&&Buffer.allocUnsafe&&Buffer.allocUnsafeSlow){module.exports=buffer;}else{copyProps(buffer,exports);exports.Buffer=SafeBuffer;}function SafeBuffer(arg,encodingOrOffset,length){return Buffer(arg,encodingOrOffset,length);}copyProps(Buffer,SafeBuffer);SafeBuffer.from=function(arg,encodingOrOffset,length){if(typeof arg==='number'){throw new TypeError('Argument must not be a number');}return Buffer(arg,encodingOrOffset,length);};SafeBuffer.alloc=function(size,fill,encoding){if(typeof size!=='number'){throw new TypeError('Argument must be a number');}var buf=Buffer(size);if(fill!==undefined){if(typeof encoding==='string'){buf.fill(fill,encoding);}else{buf.fill(fill);}}else{buf.fill(0);}return buf;};SafeBuffer.allocUnsafe=function(size){if(typeof size!=='number'){throw new TypeError('Argument must be a number');}return Buffer(size);};SafeBuffer.allocUnsafeSlow=function(size){if(typeof size!=='number'){throw new TypeError('Argument must be a number');}return buffer.SlowBuffer(size);};},{"buffer":211}],601:[function(require,module,exports){(function(Buffer){;(function(sax){sax.parser=function(strict,opt){return new SAXParser(strict,opt);};sax.SAXParser=SAXParser;sax.SAXStream=SAXStream;sax.createStream=createStream;sax.MAX_BUFFER_LENGTH=64*1024;var buffers=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];sax.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function SAXParser(strict,opt){if(!(this instanceof SAXParser))return new SAXParser(strict,opt);var parser=this;clearBuffers(parser);parser.q=parser.c="";parser.bufferCheckPosition=sax.MAX_BUFFER_LENGTH;parser.opt=opt||{};parser.opt.lowercase=parser.opt.lowercase||parser.opt.lowercasetags;parser.looseCase=parser.opt.lowercase?"toLowerCase":"toUpperCase";parser.tags=[];parser.closed=parser.closedRoot=parser.sawRoot=false;parser.tag=parser.error=null;parser.strict=!!strict;parser.noscript=!!(strict||parser.opt.noscript);parser.state=S.BEGIN;parser.ENTITIES=Object.create(sax.ENTITIES);parser.attribList=[];if(parser.opt.xmlns)parser.ns=Object.create(rootNS);parser.trackPosition=parser.opt.position!==false;if(parser.trackPosition){parser.position=parser.line=parser.column=0;}emit(parser,"onready");}if(!Object.create)Object.create=function(o){function f(){this.__proto__=o}f.prototype=o;return new f;};if(!Object.getPrototypeOf)Object.getPrototypeOf=function(o){return o.__proto__;};if(!Object.keys)Object.keys=function(o){var a=[];for(var i in o)if(o.hasOwnProperty(i))a.push(i);return a;};function checkBufferLength(parser){var maxAllowed=Math.max(sax.MAX_BUFFER_LENGTH,10),maxActual=0;for(var i=0,l=buffers.length;i<l;i++){var len=parser[buffers[i]].length;if(len>maxAllowed){switch(buffers[i]){case"textNode":closeText(parser);break
case"cdata":emitNode(parser,"oncdata",parser.cdata);parser.cdata="";break
case"script":emitNode(parser,"onscript",parser.script);parser.script="";break
default:error(parser,"Max buffer length exceeded: "+buffers[i]);}}maxActual=Math.max(maxActual,len);}parser.bufferCheckPosition=(sax.MAX_BUFFER_LENGTH-maxActual)+parser.position;}function clearBuffers(parser){for(var i=0,l=buffers.length;i<l;i++){parser[buffers[i]]="";}}function flushBuffers(parser){closeText(parser);if(parser.cdata!==""){emitNode(parser,"oncdata",parser.cdata);parser.cdata="";}if(parser.script!==""){emitNode(parser,"onscript",parser.script);parser.script="";}}SAXParser.prototype={end:function(){end(this);},write:write,resume:function(){this.error=null;return this;},close:function(){return this.write(null);},flush:function(){flushBuffers(this);}};try{var Stream=require("stream").Stream;}catch(ex){var Stream=function(){};}var streamWraps=sax.EVENTS.filter(function(ev){return ev!=="error"&&ev!=="end";});function createStream(strict,opt){return new SAXStream(strict,opt);}function SAXStream(strict,opt){if(!(this instanceof SAXStream))return new SAXStream(strict,opt);Stream.apply(this);this._parser=new SAXParser(strict,opt);this.writable=true;this.readable=true;var me=this;this._parser.onend=function(){me.emit("end");};this._parser.onerror=function(er){me.emit("error",er);me._parser.error=null;};this._decoder=null;streamWraps.forEach(function(ev){Object.defineProperty(me,"on"+ev,{get:function(){return me._parser["on"+ev];},set:function(h){if(!h){me.removeAllListeners(ev);return me._parser["on"+ev]=h;}me.on(ev,h);},enumerable:true,configurable:false});})}SAXStream.prototype=Object.create(Stream.prototype,{constructor:{value:SAXStream}});SAXStream.prototype.write=function(data){if(typeof Buffer==='function'&&typeof Buffer.isBuffer==='function'&&Buffer.isBuffer(data)){if(!this._decoder){var SD=require('string_decoder').StringDecoder;this._decoder=new SD('utf8');}data=this._decoder.write(data);}this._parser.write(data.toString());this.emit("data",data);return true;};SAXStream.prototype.end=function(chunk){if(chunk&&chunk.length)this.write(chunk);this._parser.end();return true;};SAXStream.prototype.on=function(ev,handler){var me=this;if(!me._parser["on"+ev]&&streamWraps.indexOf(ev)!==-1){me._parser["on"+ev]=function(){var args=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);args.splice(0,0,ev);me.emit.apply(me,args);};}return Stream.prototype.on.call(me,ev,handler);};var whitespace="\r\n\t ",number="0124356789",letter="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",quote="'\"",entity=number+letter+"#",attribEnd=whitespace+">",CDATA="[CDATA[",DOCTYPE="DOCTYPE",XML_NAMESPACE="http://www.w3.org/XML/1998/namespace",XMLNS_NAMESPACE="http://www.w3.org/2000/xmlns/",rootNS={xml:XML_NAMESPACE,xmlns:XMLNS_NAMESPACE};whitespace=charClass(whitespace);number=charClass(number);letter=charClass(letter);var nameStart=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/;var nameBody=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;quote=charClass(quote);entity=charClass(entity);attribEnd=charClass(attribEnd);function charClass(str){return str.split("").reduce(function(s,c){s[c]=true;return s;},{});}function isRegExp(c){return Object.prototype.toString.call(c)==='[object RegExp]';}function is(charclass,c){return isRegExp(charclass)?!!c.match(charclass):charclass[c];}function not(charclass,c){return!is(charclass,c);}var S=0;sax.STATE={BEGIN:S++,TEXT:S++,TEXT_ENTITY:S++,OPEN_WAKA:S++,SGML_DECL:S++,SGML_DECL_QUOTED:S++,DOCTYPE:S++,DOCTYPE_QUOTED:S++,DOCTYPE_DTD:S++,DOCTYPE_DTD_QUOTED:S++,COMMENT_STARTING:S++,COMMENT:S++,COMMENT_ENDING:S++,COMMENT_ENDED:S++,CDATA:S++,CDATA_ENDING:S++,CDATA_ENDING_2:S++,PROC_INST:S++,PROC_INST_BODY:S++,PROC_INST_ENDING:S++,OPEN_TAG:S++,OPEN_TAG_SLASH:S++,ATTRIB:S++,ATTRIB_NAME:S++,ATTRIB_NAME_SAW_WHITE:S++,ATTRIB_VALUE:S++,ATTRIB_VALUE_QUOTED:S++,ATTRIB_VALUE_CLOSED:S++,ATTRIB_VALUE_UNQUOTED:S++,ATTRIB_VALUE_ENTITY_Q:S++,ATTRIB_VALUE_ENTITY_U:S++,CLOSE_TAG:S++,CLOSE_TAG_SAW_WHITE:S++,SCRIPT:S++,SCRIPT_ENDING:S++};sax.ENTITIES={"amp":"&","gt":">","lt":"<","quot":"\"","apos":"'","AElig":198,"Aacute":193,"Acirc":194,"Agrave":192,"Aring":197,"Atilde":195,"Auml":196,"Ccedil":199,"ETH":208,"Eacute":201,"Ecirc":202,"Egrave":200,"Euml":203,"Iacute":205,"Icirc":206,"Igrave":204,"Iuml":207,"Ntilde":209,"Oacute":211,"Ocirc":212,"Ograve":210,"Oslash":216,"Otilde":213,"Ouml":214,"THORN":222,"Uacute":218,"Ucirc":219,"Ugrave":217,"Uuml":220,"Yacute":221,"aacute":225,"acirc":226,"aelig":230,"agrave":224,"aring":229,"atilde":227,"auml":228,"ccedil":231,"eacute":233,"ecirc":234,"egrave":232,"eth":240,"euml":235,"iacute":237,"icirc":238,"igrave":236,"iuml":239,"ntilde":241,"oacute":243,"ocirc":244,"ograve":242,"oslash":248,"otilde":245,"ouml":246,"szlig":223,"thorn":254,"uacute":250,"ucirc":251,"ugrave":249,"uuml":252,"yacute":253,"yuml":255,"copy":169,"reg":174,"nbsp":160,"iexcl":161,"cent":162,"pound":163,"curren":164,"yen":165,"brvbar":166,"sect":167,"uml":168,"ordf":170,"laquo":171,"not":172,"shy":173,"macr":175,"deg":176,"plusmn":177,"sup1":185,"sup2":178,"sup3":179,"acute":180,"micro":181,"para":182,"middot":183,"cedil":184,"ordm":186,"raquo":187,"frac14":188,"frac12":189,"frac34":190,"iquest":191,"times":215,"divide":247,"OElig":338,"oelig":339,"Scaron":352,"scaron":353,"Yuml":376,"fnof":402,"circ":710,"tilde":732,"Alpha":913,"Beta":914,"Gamma":915,"Delta":916,"Epsilon":917,"Zeta":918,"Eta":919,"Theta":920,"Iota":921,"Kappa":922,"Lambda":923,"Mu":924,"Nu":925,"Xi":926,"Omicron":927,"Pi":928,"Rho":929,"Sigma":931,"Tau":932,"Upsilon":933,"Phi":934,"Chi":935,"Psi":936,"Omega":937,"alpha":945,"beta":946,"gamma":947,"delta":948,"epsilon":949,"zeta":950,"eta":951,"theta":952,"iota":953,"kappa":954,"lambda":955,"mu":956,"nu":957,"xi":958,"omicron":959,"pi":960,"rho":961,"sigmaf":962,"sigma":963,"tau":964,"upsilon":965,"phi":966,"chi":967,"psi":968,"omega":969,"thetasym":977,"upsih":978,"piv":982,"ensp":8194,"emsp":8195,"thinsp":8201,"zwnj":8204,"zwj":8205,"lrm":8206,"rlm":8207,"ndash":8211,"mdash":8212,"lsquo":8216,"rsquo":8217,"sbquo":8218,"ldquo":8220,"rdquo":8221,"bdquo":8222,"dagger":8224,"Dagger":8225,"bull":8226,"hellip":8230,"permil":8240,"prime":8242,"Prime":8243,"lsaquo":8249,"rsaquo":8250,"oline":8254,"frasl":8260,"euro":8364,"image":8465,"weierp":8472,"real":8476,"trade":8482,"alefsym":8501,"larr":8592,"uarr":8593,"rarr":8594,"darr":8595,"harr":8596,"crarr":8629,"lArr":8656,"uArr":8657,"rArr":8658,"dArr":8659,"hArr":8660,"forall":8704,"part":8706,"exist":8707,"empty":8709,"nabla":8711,"isin":8712,"notin":8713,"ni":8715,"prod":8719,"sum":8721,"minus":8722,"lowast":8727,"radic":8730,"prop":8733,"infin":8734,"ang":8736,"and":8743,"or":8744,"cap":8745,"cup":8746,"int":8747,"there4":8756,"sim":8764,"cong":8773,"asymp":8776,"ne":8800,"equiv":8801,"le":8804,"ge":8805,"sub":8834,"sup":8835,"nsub":8836,"sube":8838,"supe":8839,"oplus":8853,"otimes":8855,"perp":8869,"sdot":8901,"lceil":8968,"rceil":8969,"lfloor":8970,"rfloor":8971,"lang":9001,"rang":9002,"loz":9674,"spades":9824,"clubs":9827,"hearts":9829,"diams":9830};Object.keys(sax.ENTITIES).forEach(function(key){var e=sax.ENTITIES[key];var s=typeof e==='number'?String.fromCharCode(e):e;sax.ENTITIES[key]=s;});for(var S in sax.STATE)sax.STATE[sax.STATE[S]]=S;S=sax.STATE;function emit(parser,event,data){parser[event]&&parser[event](data);}function emitNode(parser,nodeType,data){if(parser.textNode)closeText(parser);emit(parser,nodeType,data);}function closeText(parser){parser.textNode=textopts(parser.opt,parser.textNode);if(parser.textNode)emit(parser,"ontext",parser.textNode);parser.textNode="";}function textopts(opt,text){if(opt.trim)text=text.trim();if(opt.normalize)text=text.replace(/\s+/g," ");return text;}function error(parser,er){closeText(parser);if(parser.trackPosition){er+="\nLine: "+parser.line+"\nColumn: "+parser.column+"\nChar: "+parser.c;}er=new Error(er);parser.error=er;emit(parser,"onerror",er);return parser;}function end(parser){if(!parser.closedRoot)strictFail(parser,"Unclosed root tag");if((parser.state!==S.BEGIN)&&(parser.state!==S.TEXT))error(parser,"Unexpected end");closeText(parser);parser.c="";parser.closed=true;emit(parser,"onend");SAXParser.call(parser,parser.strict,parser.opt);return parser;}function strictFail(parser,message){if(typeof parser!=='object'||!(parser instanceof SAXParser))throw new Error('bad call to strictFail');if(parser.strict)error(parser,message);}function newTag(parser){if(!parser.strict)parser.tagName=parser.tagName[parser.looseCase]();var parent=parser.tags[parser.tags.length-1]||parser,tag=parser.tag={name:parser.tagName,attributes:{}};if(parser.opt.xmlns)tag.ns=parent.ns;parser.attribList.length=0;}function qname(name,attribute){var i=name.indexOf(":"),qualName=i<0?["",name]:name.split(":"),prefix=qualName[0],local=qualName[1];if(attribute&&name==="xmlns"){prefix="xmlns";local="";}return{prefix:prefix,local:local};}function attrib(parser){if(!parser.strict)parser.attribName=parser.attribName[parser.looseCase]();if(parser.attribList.indexOf(parser.attribName)!==-1||parser.tag.attributes.hasOwnProperty(parser.attribName)){return parser.attribName=parser.attribValue="";}if(parser.opt.xmlns){var qn=qname(parser.attribName,true),prefix=qn.prefix,local=qn.local;if(prefix==="xmlns"){if(local==="xml"&&parser.attribValue!==XML_NAMESPACE){strictFail(parser,"xml: prefix must be bound to "+XML_NAMESPACE+"\n"+"Actual: "+parser.attribValue);}else if(local==="xmlns"&&parser.attribValue!==XMLNS_NAMESPACE){strictFail(parser,"xmlns: prefix must be bound to "+XMLNS_NAMESPACE+"\n"+"Actual: "+parser.attribValue);}else{var tag=parser.tag,parent=parser.tags[parser.tags.length-1]||parser;if(tag.ns===parent.ns){tag.ns=Object.create(parent.ns);}tag.ns[local]=parser.attribValue;}}parser.attribList.push([parser.attribName,parser.attribValue]);}else{parser.tag.attributes[parser.attribName]=parser.attribValue;emitNode(parser,"onattribute",{name:parser.attribName,value:parser.attribValue});}parser.attribName=parser.attribValue="";}function openTag(parser,selfClosing){if(parser.opt.xmlns){var tag=parser.tag;var qn=qname(parser.tagName);tag.prefix=qn.prefix;tag.local=qn.local;tag.uri=tag.ns[qn.prefix]||"";if(tag.prefix&&!tag.uri){strictFail(parser,"Unbound namespace prefix: "+JSON.stringify(parser.tagName));tag.uri=qn.prefix;}var parent=parser.tags[parser.tags.length-1]||parser;if(tag.ns&&parent.ns!==tag.ns){Object.keys(tag.ns).forEach(function(p){emitNode(parser,"onopennamespace",{prefix:p,uri:tag.ns[p]});});}for(var i=0,l=parser.attribList.length;i<l;i++){var nv=parser.attribList[i];var name=nv[0],value=nv[1],qualName=qname(name,true),prefix=qualName.prefix,local=qualName.local,uri=prefix==""?"":(tag.ns[prefix]||""),a={name:name,value:value,prefix:prefix,local:local,uri:uri};if(prefix&&prefix!="xmlns"&&!uri){strictFail(parser,"Unbound namespace prefix: "+JSON.stringify(prefix));a.uri=prefix;}parser.tag.attributes[name]=a;emitNode(parser,"onattribute",a);}parser.attribList.length=0;}parser.tag.isSelfClosing=!!selfClosing;parser.sawRoot=true;parser.tags.push(parser.tag);emitNode(parser,"onopentag",parser.tag);if(!selfClosing){if(!parser.noscript&&parser.tagName.toLowerCase()==="script"){parser.state=S.SCRIPT;}else{parser.state=S.TEXT;}parser.tag=null;parser.tagName="";}parser.attribName=parser.attribValue="";parser.attribList.length=0;}function closeTag(parser){if(!parser.tagName){strictFail(parser,"Weird empty close tag.");parser.textNode+="</>";parser.state=S.TEXT;return;}if(parser.script){if(parser.tagName!=="script"){parser.script+="</"+parser.tagName+">";parser.tagName="";parser.state=S.SCRIPT;return;}emitNode(parser,"onscript",parser.script);parser.script="";}var t=parser.tags.length;var tagName=parser.tagName;if(!parser.strict)tagName=tagName[parser.looseCase]();var closeTo=tagName;while(t--){var close=parser.tags[t];if(close.name!==closeTo){strictFail(parser,"Unexpected close tag");}else break;}if(t<0){strictFail(parser,"Unmatched closing tag: "+parser.tagName);parser.textNode+="</"+parser.tagName+">";parser.state=S.TEXT;return;}parser.tagName=tagName;var s=parser.tags.length;while(s-->t){var tag=parser.tag=parser.tags.pop();parser.tagName=parser.tag.name;emitNode(parser,"onclosetag",parser.tagName);var x={};for(var i in tag.ns)x[i]=tag.ns[i];var parent=parser.tags[parser.tags.length-1]||parser;if(parser.opt.xmlns&&tag.ns!==parent.ns){Object.keys(tag.ns).forEach(function(p){var n=tag.ns[p];emitNode(parser,"onclosenamespace",{prefix:p,uri:n});});}}if(t===0)parser.closedRoot=true;parser.tagName=parser.attribValue=parser.attribName="";parser.attribList.length=0;parser.state=S.TEXT;}function parseEntity(parser){var entity=parser.entity,entityLC=entity.toLowerCase(),num,numStr="";if(parser.ENTITIES[entity])return parser.ENTITIES[entity];if(parser.ENTITIES[entityLC])return parser.ENTITIES[entityLC];entity=entityLC;if(entity.charAt(0)==="#"){if(entity.charAt(1)==="x"){entity=entity.slice(2);num=parseInt(entity,16);numStr=num.toString(16);}else{entity=entity.slice(1);num=parseInt(entity,10);numStr=num.toString(10);}}entity=entity.replace(/^0+/,"");if(numStr.toLowerCase()!==entity){strictFail(parser,"Invalid character entity");return"&"+parser.entity+";";}return String.fromCodePoint(num);}function write(chunk){var parser=this;if(this.error)throw this.error;if(parser.closed)return error(parser,"Cannot write after close. Assign an onready handler.");if(chunk===null)return end(parser);var i=0,c="";while(parser.c=c=chunk.charAt(i++)){if(parser.trackPosition){parser.position++;if(c==="\n"){parser.line++;parser.column=0;}else parser.column++;}switch(parser.state){case S.BEGIN:if(c==="<"){parser.state=S.OPEN_WAKA;parser.startTagPosition=parser.position;}else if(not(whitespace,c)){strictFail(parser,"Non-whitespace before first tag.");parser.textNode=c;parser.state=S.TEXT;}continue;case S.TEXT:if(parser.sawRoot&&!parser.closedRoot){var starti=i-1;while(c&&c!=="<"&&c!=="&"){c=chunk.charAt(i++);if(c&&parser.trackPosition){parser.position++;if(c==="\n"){parser.line++;parser.column=0;}else parser.column++;}}parser.textNode+=chunk.substring(starti,i-1);}if(c==="<"){parser.state=S.OPEN_WAKA;parser.startTagPosition=parser.position;}else{if(not(whitespace,c)&&(!parser.sawRoot||parser.closedRoot))strictFail(parser,"Text data outside of root node.");if(c==="&")parser.state=S.TEXT_ENTITY;else parser.textNode+=c;}continue;case S.SCRIPT:if(c==="<"){parser.state=S.SCRIPT_ENDING;}else parser.script+=c;continue;case S.SCRIPT_ENDING:if(c==="/"){parser.state=S.CLOSE_TAG;}else{parser.script+="<"+c;parser.state=S.SCRIPT;}continue;case S.OPEN_WAKA:if(c==="!"){parser.state=S.SGML_DECL;parser.sgmlDecl="";}else if(is(whitespace,c)){}else if(is(nameStart,c)){parser.state=S.OPEN_TAG;parser.tagName=c;}else if(c==="/"){parser.state=S.CLOSE_TAG;parser.tagName="";}else if(c==="?"){parser.state=S.PROC_INST;parser.procInstName=parser.procInstBody="";}else{strictFail(parser,"Unencoded <");if(parser.startTagPosition+1<parser.position){var pad=parser.position-parser.startTagPosition;c=new Array(pad).join(" ")+c;}parser.textNode+="<"+c;parser.state=S.TEXT;}continue;case S.SGML_DECL:if((parser.sgmlDecl+c).toUpperCase()===CDATA){emitNode(parser,"onopencdata");parser.state=S.CDATA;parser.sgmlDecl="";parser.cdata="";}else if(parser.sgmlDecl+c==="--"){parser.state=S.COMMENT;parser.comment="";parser.sgmlDecl="";}else if((parser.sgmlDecl+c).toUpperCase()===DOCTYPE){parser.state=S.DOCTYPE;if(parser.doctype||parser.sawRoot)strictFail(parser,"Inappropriately located doctype declaration");parser.doctype="";parser.sgmlDecl="";}else if(c===">"){emitNode(parser,"onsgmldeclaration",parser.sgmlDecl);parser.sgmlDecl="";parser.state=S.TEXT;}else if(is(quote,c)){parser.state=S.SGML_DECL_QUOTED;parser.sgmlDecl+=c;}else parser.sgmlDecl+=c;continue;case S.SGML_DECL_QUOTED:if(c===parser.q){parser.state=S.SGML_DECL;parser.q="";}parser.sgmlDecl+=c;continue;case S.DOCTYPE:if(c===">"){parser.state=S.TEXT;emitNode(parser,"ondoctype",parser.doctype);parser.doctype=true;}else{parser.doctype+=c;if(c==="[")parser.state=S.DOCTYPE_DTD;else if(is(quote,c)){parser.state=S.DOCTYPE_QUOTED;parser.q=c;}}continue;case S.DOCTYPE_QUOTED:parser.doctype+=c;if(c===parser.q){parser.q="";parser.state=S.DOCTYPE;}continue;case S.DOCTYPE_DTD:parser.doctype+=c;if(c==="]")parser.state=S.DOCTYPE;else if(is(quote,c)){parser.state=S.DOCTYPE_DTD_QUOTED;parser.q=c;}continue;case S.DOCTYPE_DTD_QUOTED:parser.doctype+=c;if(c===parser.q){parser.state=S.DOCTYPE_DTD;parser.q="";}continue;case S.COMMENT:if(c==="-")parser.state=S.COMMENT_ENDING;else parser.comment+=c;continue
case S.COMMENT_ENDING:if(c==="-"){parser.state=S.COMMENT_ENDED;parser.comment=textopts(parser.opt,parser.comment);if(parser.comment)emitNode(parser,"oncomment",parser.comment);parser.comment="";}else{parser.comment+="-"+c;parser.state=S.COMMENT;}continue;case S.COMMENT_ENDED:if(c!==">"){strictFail(parser,"Malformed comment");parser.comment+="--"+c;parser.state=S.COMMENT;}else parser.state=S.TEXT;continue
case S.CDATA:if(c==="]")parser.state=S.CDATA_ENDING;else parser.cdata+=c;continue
case S.CDATA_ENDING:if(c==="]")parser.state=S.CDATA_ENDING_2;else{parser.cdata+="]"+c;parser.state=S.CDATA;}continue;case S.CDATA_ENDING_2:if(c===">"){if(parser.cdata)emitNode(parser,"oncdata",parser.cdata);emitNode(parser,"onclosecdata");parser.cdata="";parser.state=S.TEXT;}else if(c==="]"){parser.cdata+="]";}else{parser.cdata+="]]"+c;parser.state=S.CDATA;}continue;case S.PROC_INST:if(c==="?")parser.state=S.PROC_INST_ENDING;else if(is(whitespace,c))parser.state=S.PROC_INST_BODY;else parser.procInstName+=c;continue;case S.PROC_INST_BODY:if(!parser.procInstBody&&is(whitespace,c))continue;else if(c==="?")parser.state=S.PROC_INST_ENDING;else parser.procInstBody+=c;continue;case S.PROC_INST_ENDING:if(c===">"){emitNode(parser,"onprocessinginstruction",{name:parser.procInstName,body:parser.procInstBody});parser.procInstName=parser.procInstBody="";parser.state=S.TEXT;}else{parser.procInstBody+="?"+c;parser.state=S.PROC_INST_BODY;}continue;case S.OPEN_TAG:if(is(nameBody,c))parser.tagName+=c;else{newTag(parser);if(c===">")openTag(parser);else if(c==="/")parser.state=S.OPEN_TAG_SLASH;else{if(not(whitespace,c))strictFail(parser,"Invalid character in tag name");parser.state=S.ATTRIB;}}continue;case S.OPEN_TAG_SLASH:if(c===">"){openTag(parser,true);closeTag(parser);}else{strictFail(parser,"Forward-slash in opening tag not followed by >");parser.state=S.ATTRIB;}continue;case S.ATTRIB:if(is(whitespace,c))continue;else if(c===">")openTag(parser);else if(c==="/")parser.state=S.OPEN_TAG_SLASH;else if(is(nameStart,c)){parser.attribName=c;parser.attribValue="";parser.state=S.ATTRIB_NAME;}else strictFail(parser,"Invalid attribute name");continue;case S.ATTRIB_NAME:if(c==="=")parser.state=S.ATTRIB_VALUE;else if(c===">"){strictFail(parser,"Attribute without value");parser.attribValue=parser.attribName;attrib(parser);openTag(parser);}else if(is(whitespace,c))parser.state=S.ATTRIB_NAME_SAW_WHITE;else if(is(nameBody,c))parser.attribName+=c;else strictFail(parser,"Invalid attribute name");continue;case S.ATTRIB_NAME_SAW_WHITE:if(c==="=")parser.state=S.ATTRIB_VALUE;else if(is(whitespace,c))continue;else{strictFail(parser,"Attribute without value");parser.tag.attributes[parser.attribName]="";parser.attribValue="";emitNode(parser,"onattribute",{name:parser.attribName,value:""});parser.attribName="";if(c===">")openTag(parser);else if(is(nameStart,c)){parser.attribName=c;parser.state=S.ATTRIB_NAME;}else{strictFail(parser,"Invalid attribute name");parser.state=S.ATTRIB;}}continue;case S.ATTRIB_VALUE:if(is(whitespace,c))continue;else if(is(quote,c)){parser.q=c;parser.state=S.ATTRIB_VALUE_QUOTED;}else{strictFail(parser,"Unquoted attribute value");parser.state=S.ATTRIB_VALUE_UNQUOTED;parser.attribValue=c;}continue;case S.ATTRIB_VALUE_QUOTED:if(c!==parser.q){if(c==="&")parser.state=S.ATTRIB_VALUE_ENTITY_Q;else parser.attribValue+=c;continue;}attrib(parser);parser.q="";parser.state=S.ATTRIB_VALUE_CLOSED;continue;case S.ATTRIB_VALUE_CLOSED:if(is(whitespace,c)){parser.state=S.ATTRIB;}else if(c===">")openTag(parser);else if(c==="/")parser.state=S.OPEN_TAG_SLASH;else if(is(nameStart,c)){strictFail(parser,"No whitespace between attributes");parser.attribName=c;parser.attribValue="";parser.state=S.ATTRIB_NAME;}else strictFail(parser,"Invalid attribute name");continue;case S.ATTRIB_VALUE_UNQUOTED:if(not(attribEnd,c)){if(c==="&")parser.state=S.ATTRIB_VALUE_ENTITY_U;else parser.attribValue+=c;continue;}attrib(parser);if(c===">")openTag(parser);else parser.state=S.ATTRIB;continue;case S.CLOSE_TAG:if(!parser.tagName){if(is(whitespace,c))continue;else if(not(nameStart,c)){if(parser.script){parser.script+="</"+c;parser.state=S.SCRIPT;}else{strictFail(parser,"Invalid tagname in closing tag.");}}else parser.tagName=c;}else if(c===">")closeTag(parser);else if(is(nameBody,c))parser.tagName+=c;else if(parser.script){parser.script+="</"+parser.tagName;parser.tagName="";parser.state=S.SCRIPT;}else{if(not(whitespace,c))strictFail(parser,"Invalid tagname in closing tag");parser.state=S.CLOSE_TAG_SAW_WHITE;}continue;case S.CLOSE_TAG_SAW_WHITE:if(is(whitespace,c))continue;if(c===">")closeTag(parser);else strictFail(parser,"Invalid characters in closing tag");continue;case S.TEXT_ENTITY:case S.ATTRIB_VALUE_ENTITY_Q:case S.ATTRIB_VALUE_ENTITY_U:switch(parser.state){case S.TEXT_ENTITY:var returnState=S.TEXT,buffer="textNode";break;case S.ATTRIB_VALUE_ENTITY_Q:var returnState=S.ATTRIB_VALUE_QUOTED,buffer="attribValue";break;case S.ATTRIB_VALUE_ENTITY_U:var returnState=S.ATTRIB_VALUE_UNQUOTED,buffer="attribValue";break;}if(c===";"){parser[buffer]+=parseEntity(parser);parser.entity="";parser.state=returnState;}else if(is(entity,c))parser.entity+=c;else{strictFail(parser,"Invalid character entity");parser[buffer]+="&"+parser.entity+c;parser.entity="";parser.state=returnState;}continue;default:throw new Error(parser,"Unknown state: "+parser.state);}}if(parser.position>=parser.bufferCheckPosition)checkBufferLength(parser);return parser;}/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */if(!String.fromCodePoint){(function(){var stringFromCharCode=String.fromCharCode;var floor=Math.floor;var fromCodePoint=function(){var MAX_SIZE=0x4000;var codeUnits=[];var highSurrogate;var lowSurrogate;var index=-1;var length=arguments.length;if(!length){return'';}var result='';while(++index<length){var codePoint=Number(arguments[index]);if(!isFinite(codePoint)||codePoint<0||codePoint>0x10FFFF||floor(codePoint)!=codePoint){throw RangeError('Invalid code point: '+codePoint);}if(codePoint<=0xFFFF){codeUnits.push(codePoint);}else{codePoint-=0x10000;highSurrogate=(codePoint>>10)+0xD800;lowSurrogate=(codePoint%0x400)+0xDC00;codeUnits.push(highSurrogate,lowSurrogate);}if(index+1==length||codeUnits.length>MAX_SIZE){result+=stringFromCharCode.apply(null,codeUnits);codeUnits.length=0;}}return result;};if(Object.defineProperty){Object.defineProperty(String,'fromCodePoint',{'value':fromCodePoint,'configurable':true,'writable':true});}else{String.fromCodePoint=fromCodePoint;}}());}})(typeof exports==="undefined"?sax={}:exports);}).call(this,undefined)},{"stream":604,"string_decoder":210}],602:[function(require,module,exports){'use strict';var domify=require('min-dom/lib/domify'),domClasses=require('min-dom/lib/classes'),domMatches=require('min-dom/lib/matches'),domDelegate=require('min-dom/lib/delegate'),domQuery=require('min-dom/lib/query'),domEvent=require('min-dom/lib/event'),domAttr=require('min-dom/lib/attr');var filter=require('lodash/collection/filter'),assign=require('lodash/object/assign');var inherits=require('inherits');var EventEmitter=require('events');var DEFAULT_OPTIONS={scrollSymbolLeft:'‹',scrollSymbolRight:'›'};function ScrollTabs($el,options){EventEmitter.call(this);this.options=options=assign({},DEFAULT_OPTIONS,options);this.container=$el;this._createScrollButtons($el,options);this._bindEvents($el);}inherits(ScrollTabs,EventEmitter);ScrollTabs.prototype._createButton=function(parentNode,options){var className=options.className,direction=options.direction;var button=domQuery('.'+className,parentNode);if(!button){button=domify('<span class="scroll-tabs-button '+className+'">'+options.label+'</span>');parentNode.insertBefore(button,parentNode.childNodes[0]);}domAttr(button,'data-direction',direction);return button;};ScrollTabs.prototype._createScrollButtons=function(parentNode,options){this._createButton(parentNode,{className:'scroll-tabs-left',label:options.scrollSymbolLeft,direction:-1});this._createButton(parentNode,{className:'scroll-tabs-right',label:options.scrollSymbolRight,direction:1});};ScrollTabs.prototype.getActiveTabNode=function(){return domQuery(this.options.selectors.active,this.container);};ScrollTabs.prototype.getTabsContainerNode=function(){return domQuery(this.options.selectors.tabsContainer,this.container);};ScrollTabs.prototype.getAllTabNodes=function(){return domQuery.all(this.options.selectors.tab,this.container);};ScrollTabs.prototype.getVisibleTabs=function(){var allTabs=this.getAllTabNodes();var ignore=this.options.selectors.ignore;return filter(allTabs,function(tabNode){return!domMatches(tabNode,ignore);});};ScrollTabs.prototype.getAdjacentTab=function(referenceTabNode,n){var visibleTabs=this.getVisibleTabs();var index=visibleTabs.indexOf(referenceTabNode);return visibleTabs[index+n];};ScrollTabs.prototype._bindEvents=function(node){this._bindWheelEvent(node);this._bindTabClickEvents(node);this._bindScrollButtonEvents(node);};ScrollTabs.prototype._bindTabClickEvents=function(node){var selector=this.options.selectors.tab;var self=this;domDelegate.bind(node,selector,'click',function onClick(event){self.scrollToTabNode(event.delegateTarget);});};ScrollTabs.prototype._bindWheelEvent=function(node){var self=this;domEvent.bind(node,'wheel',function(e){var direction=Math.sign(e.deltaY);var oldActiveTab=self.getActiveTabNode();var newActiveTab=self.getAdjacentTab(oldActiveTab,direction);if(newActiveTab){self.scrollToTabNode(newActiveTab);self.emit('scroll',newActiveTab,oldActiveTab,direction);}e.preventDefault();});};ScrollTabs.prototype._bindScrollButtonEvents=function(node){var self=this;domDelegate.bind(node,'.scroll-tabs-button','click',function(event){var target=event.delegateTarget;var direction=parseInt(domAttr(target,'data-direction'),10);var oldActiveTabNode=self.getActiveTabNode();var newActiveTabNode=self.getAdjacentTab(oldActiveTabNode,direction);if(newActiveTabNode){self.scrollToTabNode(newActiveTabNode);self.emit('scroll',newActiveTabNode,oldActiveTabNode,direction);}event.preventDefault();});};ScrollTabs.prototype.scrollToTabNode=function(tabNode){if(!tabNode){return;}var tabsContainerNode=tabNode.parentNode;var tabWidth=tabNode.offsetWidth,tabOffsetLeft=tabNode.offsetLeft,tabOffsetRight=tabOffsetLeft+tabWidth,containerWidth=tabsContainerNode.offsetWidth,containerScrollLeft=tabsContainerNode.scrollLeft;if(containerScrollLeft>tabOffsetLeft){tabsContainerNode.scrollLeft=0;}else if(tabOffsetRight>containerWidth){tabsContainerNode.scrollLeft=tabOffsetRight-containerWidth;}};ScrollTabs.prototype.update=function(){var tabsContainerNode=this.getTabsContainerNode();var overflow=tabsContainerNode.scrollWidth>tabsContainerNode.offsetWidth;var overflowClass='scroll-tabs-overflow';domClasses(this.container).toggle(overflowClass,overflow);if(overflow){this.scrollToTabNode(this.getActiveTabNode());}};function create($el,options){var scrollTabs=get($el);if(!scrollTabs){scrollTabs=new ScrollTabs($el,options);$el.__scrollTabs=scrollTabs;}return scrollTabs;}module.exports=create;function get($el){return $el.__scrollTabs;}module.exports.get=get;},{"events":393,"inherits":398,"lodash/collection/filter":415,"lodash/object/assign":547,"min-dom/lib/attr":561,"min-dom/lib/classes":562,"min-dom/lib/delegate":565,"min-dom/lib/domify":566,"min-dom/lib/event":567,"min-dom/lib/matches":568,"min-dom/lib/query":569}],603:[function(require,module,exports){'use strict';function calculateUpdate(currentSelection,currentValue,newValue){var currentCursor=currentSelection.start,newCursor=currentCursor,diff=newValue.length-currentValue.length,idx;var lengthDelta=newValue.length-currentValue.length;var currentTail=currentValue.substring(currentCursor);if(newValue.lastIndexOf(currentTail)===newValue.length-currentTail.length){currentValue=currentValue.substring(0,currentValue.length-currentTail.length);newValue=newValue.substring(0,newValue.length-currentTail.length);}var diff=createDiff(currentValue,newValue);if(diff){if(diff.type==='remove'){newCursor=diff.newStart;}else{newCursor=diff.newEnd;}}return range(newCursor);}module.exports=calculateUpdate;function createDiff(currentValue,newValue){var insert;var l_str,l_char,l_idx=0,s_str,s_char,s_idx=0;if(newValue.length>currentValue.length){l_str=newValue;s_str=currentValue;}else{l_str=currentValue;s_str=newValue;}while(l_idx<l_str.length){l_char=l_str.charAt(l_idx);s_char=s_str.charAt(s_idx);if(l_char!==s_char){if(!insert){insert={l_start:l_idx,s_start:s_idx};}l_idx++;}else{if(insert&&!insert.complete){insert.l_end=l_idx;insert.s_end=s_idx;insert.complete=true;}s_idx++;l_idx++;}}if(insert&&!insert.complete){insert.complete=true;insert.s_end=s_str.length;insert.l_end=l_str.length;}if(!insert){return;}if(newValue.length>currentValue.length){return{newStart:insert.l_start,newEnd:insert.l_end,type:'add'};}else{return{newStart:insert.s_start,newEnd:insert.s_end,type:newValue.length<currentValue.length?'remove':'replace'};}}function range(start,end){return{start:start,end:end===undefined?start:end};}module.exports.range=range;function splitStr(str,position){return{before:str.substring(0,position),after:str.substring(position)};}},{}],604:[function(require,module,exports){module.exports=Stream;var EE=require('events').EventEmitter;var inherits=require('inherits');inherits(Stream,EE);Stream.Readable=require('readable-stream/readable.js');Stream.Writable=require('readable-stream/writable.js');Stream.Duplex=require('readable-stream/duplex.js');Stream.Transform=require('readable-stream/transform.js');Stream.PassThrough=require('readable-stream/passthrough.js');Stream.Stream=Stream;function Stream(){EE.call(this);}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause();}}}source.on('data',ondata);function ondrain(){if(source.readable&&source.resume){source.resume();}}dest.on('drain',ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on('end',onend);source.on('close',onclose);}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end();}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==='function')dest.destroy();}function onerror(er){cleanup();if(EE.listenerCount(this,'error')===0){throw er;}}source.on('error',onerror);dest.on('error',onerror);function cleanup(){source.removeListener('data',ondata);dest.removeListener('drain',ondrain);source.removeListener('end',onend);source.removeListener('close',onclose);source.removeListener('error',onerror);dest.removeListener('error',onerror);source.removeListener('end',cleanup);source.removeListener('close',cleanup);dest.removeListener('close',cleanup);}source.on('end',cleanup);source.on('close',cleanup);dest.on('close',cleanup);dest.emit('pipe',source);return dest;};},{"events":393,"inherits":398,"readable-stream/duplex.js":587,"readable-stream/passthrough.js":596,"readable-stream/readable.js":597,"readable-stream/transform.js":598,"readable-stream/writable.js":599}],605:[function(require,module,exports){'use strict';var Buffer=require('safe-buffer').Buffer;var isEncoding=Buffer.isEncoding||function(encoding){encoding=''+encoding;switch(encoding&&encoding.toLowerCase()){case'hex':case'utf8':case'utf-8':case'ascii':case'binary':case'base64':case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':case'raw':return true;default:return false;}};function _normalizeEncoding(enc){if(!enc)return'utf8';var retried;while(true){switch(enc){case'utf8':case'utf-8':return'utf8';case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return'utf16le';case'latin1':case'binary':return'latin1';case'base64':case'ascii':case'hex':return enc;default:if(retried)return;enc=(''+enc).toLowerCase();retried=true;}}};function normalizeEncoding(enc){var nenc=_normalizeEncoding(enc);if(typeof nenc!=='string'&&(Buffer.isEncoding===isEncoding||!isEncoding(enc)))throw new Error('Unknown encoding: '+enc);return nenc||enc;}exports.StringDecoder=StringDecoder;function StringDecoder(encoding){this.encoding=normalizeEncoding(encoding);var nb;switch(this.encoding){case'utf16le':this.text=utf16Text;this.end=utf16End;nb=4;break;case'utf8':this.fillLast=utf8FillLast;nb=4;break;case'base64':this.text=base64Text;this.end=base64End;nb=3;break;default:this.write=simpleWrite;this.end=simpleEnd;return;}this.lastNeed=0;this.lastTotal=0;this.lastChar=Buffer.allocUnsafe(nb);}StringDecoder.prototype.write=function(buf){if(buf.length===0)return'';var r;var i;if(this.lastNeed){r=this.fillLast(buf);if(r===undefined)return'';i=this.lastNeed;this.lastNeed=0;}else{i=0;}if(i<buf.length)return r?r+this.text(buf,i):this.text(buf,i);return r||'';};StringDecoder.prototype.end=utf8End;StringDecoder.prototype.text=utf8Text;StringDecoder.prototype.fillLast=function(buf){if(this.lastNeed<=buf.length){buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal);}buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,buf.length);this.lastNeed-=buf.length;};function utf8CheckByte(byte){if(byte<=0x7F)return 0;else if(byte>>5===0x06)return 2;else if(byte>>4===0x0E)return 3;else if(byte>>3===0x1E)return 4;return-1;}function utf8CheckIncomplete(self,buf,i){var j=buf.length-1;if(j<i)return 0;var nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0)self.lastNeed=nb-1;return nb;}if(--j<i)return 0;nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0)self.lastNeed=nb-2;return nb;}if(--j<i)return 0;nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0){if(nb===2)nb=0;else self.lastNeed=nb-3;}return nb;}return 0;}function utf8CheckExtraBytes(self,buf,p){if((buf[0]&0xC0)!==0x80){self.lastNeed=0;return'\ufffd'.repeat(p);}if(self.lastNeed>1&&buf.length>1){if((buf[1]&0xC0)!==0x80){self.lastNeed=1;return'\ufffd'.repeat(p+1);}if(self.lastNeed>2&&buf.length>2){if((buf[2]&0xC0)!==0x80){self.lastNeed=2;return'\ufffd'.repeat(p+2);}}}}function utf8FillLast(buf){var p=this.lastTotal-this.lastNeed;var r=utf8CheckExtraBytes(this,buf,p);if(r!==undefined)return r;if(this.lastNeed<=buf.length){buf.copy(this.lastChar,p,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal);}buf.copy(this.lastChar,p,0,buf.length);this.lastNeed-=buf.length;}function utf8Text(buf,i){var total=utf8CheckIncomplete(this,buf,i);if(!this.lastNeed)return buf.toString('utf8',i);this.lastTotal=total;var end=buf.length-(total-this.lastNeed);buf.copy(this.lastChar,0,end);return buf.toString('utf8',i,end);}function utf8End(buf){var r=buf&&buf.length?this.write(buf):'';if(this.lastNeed)return r+'\ufffd'.repeat(this.lastTotal-this.lastNeed);return r;}function utf16Text(buf,i){if((buf.length-i)%2===0){var r=buf.toString('utf16le',i);if(r){var c=r.charCodeAt(r.length-1);if(c>=0xD800&&c<=0xDBFF){this.lastNeed=2;this.lastTotal=4;this.lastChar[0]=buf[buf.length-2];this.lastChar[1]=buf[buf.length-1];return r.slice(0,-1);}}return r;}this.lastNeed=1;this.lastTotal=2;this.lastChar[0]=buf[buf.length-1];return buf.toString('utf16le',i,buf.length-1);}function utf16End(buf){var r=buf&&buf.length?this.write(buf):'';if(this.lastNeed){var end=this.lastTotal-this.lastNeed;return r+this.lastChar.toString('utf16le',0,end);}return r;}function base64Text(buf,i){var n=(buf.length-i)%3;if(n===0)return buf.toString('base64',i);this.lastNeed=3-n;this.lastTotal=3;if(n===1){this.lastChar[0]=buf[buf.length-1];}else{this.lastChar[0]=buf[buf.length-2];this.lastChar[1]=buf[buf.length-1];}return buf.toString('base64',i,buf.length-n);}function base64End(buf){var r=buf&&buf.length?this.write(buf):'';if(this.lastNeed)return r+this.lastChar.toString('base64',0,3-this.lastNeed);return r;}function simpleWrite(buf){return buf.toString(this.encoding);}function simpleEnd(buf){return buf&&buf.length?this.write(buf):'';}},{"safe-buffer":600}],606:[function(require,module,exports){(function(global){"use strict";function TinyStack(){this.data=[null];this.top=0;}TinyStack.prototype.clear=function clear(){this.data=[null];this.top=0;return this;};TinyStack.prototype.length=function length(){return this.top;};TinyStack.prototype.peek=function peek(){return this.data[this.top];};TinyStack.prototype.pop=function pop(){if(this.top>0){this.top--;return this.data.pop();}else{return undefined;}};TinyStack.prototype.push=function push(arg){this.data[++this.top]=arg;return this;};function factory(){return new TinyStack();}if(typeof exports!="undefined"){module.exports=factory;}else if(typeof define=="function"){define(function(){return factory;});}else{global.stack=factory;}})(this);},{}],607:[function(require,module,exports){module.exports=append;var appendTo=require('./appendTo');function append(element,node){appendTo(node,element);return element;}},{"./appendTo":608}],608:[function(require,module,exports){module.exports=appendTo;var ensureImported=require('./util/ensureImported');function appendTo(element,target){target.appendChild(ensureImported(element,target));return element;}},{"./util/ensureImported":618}],609:[function(require,module,exports){module.exports=attr;var LENGTH_ATTR=2;var CSS_PROPERTIES={'alignment-baseline':1,'baseline-shift':1,'clip':1,'clip-path':1,'clip-rule':1,'color':1,'color-interpolation':1,'color-interpolation-filters':1,'color-profile':1,'color-rendering':1,'cursor':1,'direction':1,'display':1,'dominant-baseline':1,'enable-background':1,'fill':1,'fill-opacity':1,'fill-rule':1,'filter':1,'flood-color':1,'flood-opacity':1,'font':1,'font-family':1,'font-size':LENGTH_ATTR,'font-size-adjust':1,'font-stretch':1,'font-style':1,'font-variant':1,'font-weight':1,'glyph-orientation-horizontal':1,'glyph-orientation-vertical':1,'image-rendering':1,'kerning':1,'letter-spacing':1,'lighting-color':1,'marker':1,'marker-end':1,'marker-mid':1,'marker-start':1,'mask':1,'opacity':1,'overflow':1,'pointer-events':1,'shape-rendering':1,'stop-color':1,'stop-opacity':1,'stroke':1,'stroke-dasharray':1,'stroke-dashoffset':1,'stroke-linecap':1,'stroke-linejoin':1,'stroke-miterlimit':1,'stroke-opacity':1,'stroke-width':LENGTH_ATTR,'text-anchor':1,'text-decoration':1,'text-rendering':1,'unicode-bidi':1,'visibility':1,'word-spacing':1,'writing-mode':1};function getAttribute(node,name){if(CSS_PROPERTIES[name]){return node.style[name];}else{return node.getAttributeNS(null,name);}}function setAttribute(node,name,value){var hyphenated=name.replace(/([a-z])([A-Z])/g,'$1-$2').toLowerCase();var type=CSS_PROPERTIES[hyphenated];if(type){if(type===LENGTH_ATTR&&typeof value==='number'){value=String(value)+'px';}node.style[hyphenated]=value;}else{node.setAttributeNS(null,name,value);}}function setAttributes(node,attrs){var names=Object.keys(attrs),i,name;for(i=0,name;(name=names[i]);i++){setAttribute(node,name,attrs[name]);}}function attr(node,name,value){if(typeof name==='string'){if(value!==undefined){setAttribute(node,name,value);}else{return getAttribute(node,name);}}else{setAttributes(node,name);}return node;}},{}],610:[function(require,module,exports){module.exports=classes;var index=function(arr,obj){if(arr.indexOf){return arr.indexOf(obj);}for(var i=0;i<arr.length;++i){if(arr[i]===obj){return i;}}return-1;};var re=/\s+/;var toString=Object.prototype.toString;function defined(o){return typeof o!=='undefined';}function classes(el){return new ClassList(el);}function ClassList(el){if(!el||!el.nodeType){throw new Error('A DOM element reference is required');}this.el=el;this.list=el.classList;}ClassList.prototype.add=function(name){if(this.list){this.list.add(name);return this;}var arr=this.array();var i=index(arr,name);if(!~i){arr.push(name);}if(defined(this.el.className.baseVal)){this.el.className.baseVal=arr.join(' ');}else{this.el.className=arr.join(' ');}return this;};ClassList.prototype.remove=function(name){if('[object RegExp]'===toString.call(name)){return this.removeMatching(name);}if(this.list){this.list.remove(name);return this;}var arr=this.array();var i=index(arr,name);if(~i){arr.splice(i,1);}this.el.className.baseVal=arr.join(' ');return this;};ClassList.prototype.removeMatching=function(re){var arr=this.array();for(var i=0;i<arr.length;i++){if(re.test(arr[i])){this.remove(arr[i]);}}return this;};ClassList.prototype.toggle=function(name,force){if(this.list){if(defined(force)){if(force!==this.list.toggle(name,force)){this.list.toggle(name);}}else{this.list.toggle(name);}return this;}if(defined(force)){if(!force){this.remove(name);}else{this.add(name);}}else{if(this.has(name)){this.remove(name);}else{this.add(name);}}return this;};ClassList.prototype.array=function(){var className=this.el.getAttribute('class')||'';var str=className.replace(/^\s+|\s+$/g,'');var arr=str.split(re);if(''===arr[0]){arr.shift();}return arr;};ClassList.prototype.has=ClassList.prototype.contains=function(name){return(this.list?this.list.contains(name):!!~index(this.array(),name));};},{}],611:[function(require,module,exports){module.exports=clear;var remove=require('./remove');function clear(element){var child;while((child=element.firstChild)){remove(child);}return element;}},{"./remove":616}],612:[function(require,module,exports){module.exports=clone;function clone(element){return element.cloneNode(true);}},{}],613:[function(require,module,exports){module.exports=create;var attr=require('./attr');var parse=require('./util/parse');var ns=require('./util/ns');function create(name,attrs){var element;if(name.charAt(0)==='<'){element=parse(name).firstChild;element=document.importNode(element,true);}else{element=document.createElementNS(ns.svg,name);}if(attrs){attr(element,attrs);}return element;}},{"./attr":609,"./util/ns":619,"./util/parse":620}],614:[function(require,module,exports){module.exports={createPoint:createPoint,createMatrix:createMatrix,createTransform:createTransform};var create=require('./create');var node=create('svg');function extend(object,props){var i,k,keys=Object.keys(props);for(i=0;(k=keys[i]);i++){object[k]=props[k];}return object;}function createPoint(x,y){var point=node.createSVGPoint();switch(arguments.length){case 0:return point;case 2:x={x:x,y:y};break;}return extend(point,x);}function createMatrix(a,b,c,d,e,f){var matrix=node.createSVGMatrix();switch(arguments.length){case 0:return matrix;case 6:a={a:a,b:b,c:c,d:d,e:e,f:f};break;}return extend(matrix,a);}function createTransform(matrix){if(matrix){return node.createSVGTransformFromMatrix(matrix);}else{return node.createSVGTransform();}}},{"./create":613}],615:[function(require,module,exports){module.exports=innerSVG;var clear=require('./clear');var appendTo=require('./appendTo');var parse=require('./util/parse');var serialize=require('./util/serialize');function set(element,svg){var node,documentElement=parse(svg).documentElement;clear(element);if(!svg){return;}node=documentElement.firstChild;while(node){appendTo(node,element);node=node.nextSibling;}}function get(element){var child=element.firstChild,output=[];while(child){serialize(child,output);child=child.nextSibling;}return output.join('');}function innerSVG(element,svg){if(svg!==undefined){try{set(element,svg);}catch(e){throw new Error('error parsing SVG: '+e.message);}return element;}else{return get(element);}}},{"./appendTo":608,"./clear":611,"./util/parse":620,"./util/serialize":621}],616:[function(require,module,exports){module.exports=remove;function remove(element){element.parentNode.removeChild(element);return element;}},{}],617:[function(require,module,exports){module.exports=transform;function wrapMatrix(transformList,transform){if(transform instanceof SVGMatrix){return transformList.createSVGTransformFromMatrix(transform);}else{return transform;}}function setTransforms(transformList,transforms){var i,t;transformList.clear();for(i=0;(t=transforms[i]);i++){transformList.appendItem(wrapMatrix(transformList,t));}transformList.consolidate();}function transform(node,transforms){var transformList=node.transform.baseVal;if(arguments.length===1){return transformList.consolidate();}else{if(transforms.length){setTransforms(transformList,transforms);}else{transformList.initialize(wrapMatrix(transformList,transforms));}}}},{}],618:[function(require,module,exports){module.exports=ensureImported;function ensureImported(element,target){if(element.ownerDocument!==target.ownerDocument){try{return target.ownerDocument.importNode(element,true);}catch(e){}}return element;}},{}],619:[function(require,module,exports){var ns={svg:'http://www.w3.org/2000/svg'};module.exports=ns;},{}],620:[function(require,module,exports){module.exports=parse;var ns=require('./ns');var SVG_START='<svg xmlns="'+ns.svg+'"';function parse(svg){if(svg.substring(0,4)==='<svg'){if(svg.indexOf(ns.svg)===-1){svg=SVG_START+svg.substring(4);}}else{svg=SVG_START+'>'+svg+'</svg>';}return parseDocument(svg);}function parseDocument(svg){var parser;parser=new DOMParser();parser.async=false;return parser.parseFromString(svg,'text/xml');}},{"./ns":619}],621:[function(require,module,exports){module.exports=serialize;var TEXT_ENTITIES=/([&<>]{1})/g;var ATTR_ENTITIES=/([\n\r"]{1})/g;var ENTITY_REPLACEMENT={'&':'&amp;','<':'&lt;','>':'&gt;','"':'\''};function escape(str,pattern){function replaceFn(match,entity){return ENTITY_REPLACEMENT[entity]||entity;}return str.replace(pattern,replaceFn);}function serialize(node,output){var i,len,attrMap,attrNode,childNodes;switch(node.nodeType){case 3:output.push(escape(node.textContent,TEXT_ENTITIES));break;case 1:output.push('<',node.tagName);if(node.hasAttributes()){attrMap=node.attributes;for(i=0,len=attrMap.length;i<len;++i){attrNode=attrMap.item(i);output.push(' ',attrNode.name,'="',escape(attrNode.value,ATTR_ENTITIES),'"');}}if(node.hasChildNodes()){output.push('>');childNodes=node.childNodes;for(i=0,len=childNodes.length;i<len;++i){serialize(childNodes.item(i),output);}output.push('</',node.tagName,'>');}else{output.push('/>');}break;case 8:output.push('<!--',escape(node.nodeValue,TEXT_ENTITIES),'-->');break;case 4:output.push('<![CDATA[',node.nodeValue,']]>');break;default:throw new Error('unable to handle node '+node.nodeType);}return output;}},{}],622:[function(require,module,exports){(function(global){module.exports=deprecate;function deprecate(fn,msg){if(config('noDeprecation')){return fn;}var warned=false;function deprecated(){if(!warned){if(config('throwDeprecation')){throw new Error(msg);}else if(config('traceDeprecation')){console.trace(msg);}else{console.warn(msg);}warned=true;}return fn.apply(this,arguments);}return deprecated;}function config(name){try{if(!global.localStorage)return false;}catch(_){return false;}var val=global.localStorage[name];if(null==val)return false;return String(val).toLowerCase()==='true';}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}]},{},[1])